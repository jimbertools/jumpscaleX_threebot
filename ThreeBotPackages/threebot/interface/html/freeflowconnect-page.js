((typeof self !== 'undefined' ? self : this)["webpackJsonp"] = (typeof self !== 'undefined' ? self : this)["webpackJsonp"] || []).push([["freeflowconnect-page"],{

/***/ "./node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js?!./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&":
/*!***********************************************************************************************************************************************************!*\
  !*** ./node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader??ref--13-0!./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js& ***!
  \***********************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var vuex__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vuex */ \"./node_modules/vuex/dist/vuex.esm.js\");\n/* harmony import */ var _plugins_janus_videoroom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../plugins/janus.videoroom */ \"./src/plugins/janus.videoroom.js\");\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  name: 'freeflowconnect',\n  components: {},\n  props: [],\n  data () {\n    return {\n      message: null,\n      expanded: false,\n      showCreateRoomDialog: false,\n      roomName: null,\n      userName: null,\n      janus: null,\n      muted: false,\n      published: false\n    }\n  },\n  computed: {\n    ...Object(vuex__WEBPACK_IMPORTED_MODULE_0__[\"mapGetters\"])(['currentRoom']),\n    roomNameFromRoute () {\n      return this.$route.params.roomName\n    },\n    getUsers () {\n      let myUser = this.currentRoom.users.filter((userName) => userName === this.userName)\n      let otherUsers = this.currentRoom.users.filter((userName) => userName !== this.userName)\n      return myUser.concat(otherUsers)\n    }\n  },\n  mounted () {\n    this.roomName = this.roomNameFromRoute\n\n    if (this.userName === null || this.userName === undefined) {\n      this.showCreateRoomDialog = true\n      return\n    }\n\n    if (this.roomNameFromRoute !== undefined) {\n      // join the room\n      this.setCurrentRoom(this.roomNameFromRoute)\n      this.$socket.emit('joinRoom', { room: this.roomNameFromRoute, user: this.userName })\n\n      this.janus = new _plugins_janus_videoroom__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.roomName)\n      console.log(this.janus)\n    } else {\n      // don't join the room\n    }\n  },\n  methods: {\n    ...Object(vuex__WEBPACK_IMPORTED_MODULE_0__[\"mapActions\"])(['setCurrentRoom', 'getCurrentRoom']),\n\n    confirmRoomName () {\n      this.showCreateRoomDialog = false\n      console.log('Helloooooo: ' + this.roomName)\n      this.createRoom()\n    },\n\n    createRoom (events) {\n      if (this.roomName !== null) {\n        if (this.roomNameFromRoute === null || this.roomNameFromRoute === undefined) {\n          this.roomName = this.roomName + '-' + Math.random().toString(36).substring(2, 15).toUpperCase()\n\n          this.$router.push({\n            name: 'connectWithRoom', params: { roomName: this.roomName }\n          })\n        } else {\n          this.roomName = this.roomNameFromRoute\n        }\n\n        this.setCurrentRoom(this.roomName)\n        this.$socket.emit('joinRoom', { room: this.roomName, user: this.userName })\n\n        this.janus = new _plugins_janus_videoroom__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.roomName)\n        console.log(this.janus)\n      }\n    },\n    leave: function () {\n      console.log('We are going to attempt to disconnect.')\n      this.janus.disconnect()\n    },\n    join: function () {\n      console.log('We are going to attempt to connect.')\n      this.janus.connect(this.roomName)\n    },\n    showUsers: function () {\n      console.log('showUsers in room ', this.roomName)\n      this.janus.showUsers(this.roomName)\n    },\n    toggleMute: function () {\n      console.log('Toggling microphone')\n\n      var isMuted = this.janus.toggleMute()\n      this.muted = isMuted\n    },\n    unpublish: function () {\n      console.log('Unpublishing feed')\n      this.janus.unpublishOwnFeed()\n      this.published = !this.published\n    },\n    publish: function () {\n      console.log('Publishing feed')\n      this.janus.publishOwnFeed(true)\n      this.published = !this.published\n    }\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQHZ1ZS9jbGktcGx1Z2luLWVzbGludC9ub2RlX21vZHVsZXMvZXNsaW50LWxvYWRlci9pbmRleC5qcz8hLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5qcz92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5qcz8wOGVhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcEFjdGlvbnMsIG1hcEdldHRlcnMgfSBmcm9tICd2dWV4J1xuaW1wb3J0IEphbnVzV3JhcHBlciBmcm9tICcuLi8uLi9wbHVnaW5zL2phbnVzLnZpZGVvcm9vbSdcblxuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAnZnJlZWZsb3djb25uZWN0JyxcbiAgY29tcG9uZW50czoge30sXG4gIHByb3BzOiBbXSxcbiAgZGF0YSAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2U6IG51bGwsXG4gICAgICBleHBhbmRlZDogZmFsc2UsXG4gICAgICBzaG93Q3JlYXRlUm9vbURpYWxvZzogZmFsc2UsXG4gICAgICByb29tTmFtZTogbnVsbCxcbiAgICAgIHVzZXJOYW1lOiBudWxsLFxuICAgICAgamFudXM6IG51bGwsXG4gICAgICBtdXRlZDogZmFsc2UsXG4gICAgICBwdWJsaXNoZWQ6IGZhbHNlXG4gICAgfVxuICB9LFxuICBjb21wdXRlZDoge1xuICAgIC4uLm1hcEdldHRlcnMoWydjdXJyZW50Um9vbSddKSxcbiAgICByb29tTmFtZUZyb21Sb3V0ZSAoKSB7XG4gICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLnJvb21OYW1lXG4gICAgfSxcbiAgICBnZXRVc2VycyAoKSB7XG4gICAgICBsZXQgbXlVc2VyID0gdGhpcy5jdXJyZW50Um9vbS51c2Vycy5maWx0ZXIoKHVzZXJOYW1lKSA9PiB1c2VyTmFtZSA9PT0gdGhpcy51c2VyTmFtZSlcbiAgICAgIGxldCBvdGhlclVzZXJzID0gdGhpcy5jdXJyZW50Um9vbS51c2Vycy5maWx0ZXIoKHVzZXJOYW1lKSA9PiB1c2VyTmFtZSAhPT0gdGhpcy51c2VyTmFtZSlcbiAgICAgIHJldHVybiBteVVzZXIuY29uY2F0KG90aGVyVXNlcnMpXG4gICAgfVxuICB9LFxuICBtb3VudGVkICgpIHtcbiAgICB0aGlzLnJvb21OYW1lID0gdGhpcy5yb29tTmFtZUZyb21Sb3V0ZVxuXG4gICAgaWYgKHRoaXMudXNlck5hbWUgPT09IG51bGwgfHwgdGhpcy51c2VyTmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnNob3dDcmVhdGVSb29tRGlhbG9nID0gdHJ1ZVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKHRoaXMucm9vbU5hbWVGcm9tUm91dGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gam9pbiB0aGUgcm9vbVxuICAgICAgdGhpcy5zZXRDdXJyZW50Um9vbSh0aGlzLnJvb21OYW1lRnJvbVJvdXRlKVxuICAgICAgdGhpcy4kc29ja2V0LmVtaXQoJ2pvaW5Sb29tJywgeyByb29tOiB0aGlzLnJvb21OYW1lRnJvbVJvdXRlLCB1c2VyOiB0aGlzLnVzZXJOYW1lIH0pXG5cbiAgICAgIHRoaXMuamFudXMgPSBuZXcgSmFudXNXcmFwcGVyKHRoaXMucm9vbU5hbWUpXG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmphbnVzKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBkb24ndCBqb2luIHRoZSByb29tXG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgLi4ubWFwQWN0aW9ucyhbJ3NldEN1cnJlbnRSb29tJywgJ2dldEN1cnJlbnRSb29tJ10pLFxuXG4gICAgY29uZmlybVJvb21OYW1lICgpIHtcbiAgICAgIHRoaXMuc2hvd0NyZWF0ZVJvb21EaWFsb2cgPSBmYWxzZVxuICAgICAgY29uc29sZS5sb2coJ0hlbGxvb29vb286ICcgKyB0aGlzLnJvb21OYW1lKVxuICAgICAgdGhpcy5jcmVhdGVSb29tKClcbiAgICB9LFxuXG4gICAgY3JlYXRlUm9vbSAoZXZlbnRzKSB7XG4gICAgICBpZiAodGhpcy5yb29tTmFtZSAhPT0gbnVsbCkge1xuICAgICAgICBpZiAodGhpcy5yb29tTmFtZUZyb21Sb3V0ZSA9PT0gbnVsbCB8fCB0aGlzLnJvb21OYW1lRnJvbVJvdXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aGlzLnJvb21OYW1lID0gdGhpcy5yb29tTmFtZSArICctJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSkudG9VcHBlckNhc2UoKVxuXG4gICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe1xuICAgICAgICAgICAgbmFtZTogJ2Nvbm5lY3RXaXRoUm9vbScsIHBhcmFtczogeyByb29tTmFtZTogdGhpcy5yb29tTmFtZSB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnJvb21OYW1lID0gdGhpcy5yb29tTmFtZUZyb21Sb3V0ZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRDdXJyZW50Um9vbSh0aGlzLnJvb21OYW1lKVxuICAgICAgICB0aGlzLiRzb2NrZXQuZW1pdCgnam9pblJvb20nLCB7IHJvb206IHRoaXMucm9vbU5hbWUsIHVzZXI6IHRoaXMudXNlck5hbWUgfSlcblxuICAgICAgICB0aGlzLmphbnVzID0gbmV3IEphbnVzV3JhcHBlcih0aGlzLnJvb21OYW1lKVxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmphbnVzKVxuICAgICAgfVxuICAgIH0sXG4gICAgbGVhdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdXZSBhcmUgZ29pbmcgdG8gYXR0ZW1wdCB0byBkaXNjb25uZWN0LicpXG4gICAgICB0aGlzLmphbnVzLmRpc2Nvbm5lY3QoKVxuICAgIH0sXG4gICAgam9pbjogZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coJ1dlIGFyZSBnb2luZyB0byBhdHRlbXB0IHRvIGNvbm5lY3QuJylcbiAgICAgIHRoaXMuamFudXMuY29ubmVjdCh0aGlzLnJvb21OYW1lKVxuICAgIH0sXG4gICAgc2hvd1VzZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZygnc2hvd1VzZXJzIGluIHJvb20gJywgdGhpcy5yb29tTmFtZSlcbiAgICAgIHRoaXMuamFudXMuc2hvd1VzZXJzKHRoaXMucm9vbU5hbWUpXG4gICAgfSxcbiAgICB0b2dnbGVNdXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZygnVG9nZ2xpbmcgbWljcm9waG9uZScpXG5cbiAgICAgIHZhciBpc011dGVkID0gdGhpcy5qYW51cy50b2dnbGVNdXRlKClcbiAgICAgIHRoaXMubXV0ZWQgPSBpc011dGVkXG4gICAgfSxcbiAgICB1bnB1Ymxpc2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdVbnB1Ymxpc2hpbmcgZmVlZCcpXG4gICAgICB0aGlzLmphbnVzLnVucHVibGlzaE93bkZlZWQoKVxuICAgICAgdGhpcy5wdWJsaXNoZWQgPSAhdGhpcy5wdWJsaXNoZWRcbiAgICB9LFxuICAgIHB1Ymxpc2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQdWJsaXNoaW5nIGZlZWQnKVxuICAgICAgdGhpcy5qYW51cy5wdWJsaXNoT3duRmVlZCh0cnVlKVxuICAgICAgdGhpcy5wdWJsaXNoZWQgPSAhdGhpcy5wdWJsaXNoZWRcbiAgICB9XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js?!./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&\n");

/***/ }),

/***/ "./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/.cache/vue-loader\",\"cacheIdentifier\":\"7b93bd1d-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"7b93bd1d-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"render\", function() { return render; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"staticRenderFns\", function() { return staticRenderFns; });\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"section\",\n    { staticClass: \"freeflowconnect\" },\n    [\n      _c(\n        \"v-row\",\n        [\n          _vm.currentRoom\n            ? _c(\n                \"v-flex\",\n                { staticClass: \"py-2 px-4\" },\n                [\n                  _c(\n                    \"v-card\",\n                    [\n                      _c(\n                        \"v-card-title\",\n                        { staticClass: \"primary white--text py-2\" },\n                        [\n                          _c(\n                            \"v-row\",\n                            { staticClass: \"px-2\", attrs: { align: \"center\" } },\n                            [\n                              _c(\"v-avatar\", {\n                                staticClass: \"mr-3\",\n                                attrs: {\n                                  size: \"8\",\n                                  color: \"secondary darken-2 \"\n                                }\n                              }),\n                              _c(\"span\", { staticClass: \"text-uppercase\" }, [\n                                _vm._v(\n                                  \"\\n              \" +\n                                    _vm._s(_vm.currentRoom.name) +\n                                    \"\\n            \"\n                                )\n                              ]),\n                              _c(\"v-spacer\"),\n                              _c(\n                                \"v-btn\",\n                                {\n                                  attrs: { dark: \"\", small: \"\", icon: \"\" },\n                                  on: {\n                                    click: function($event) {\n                                      _vm.expanded = !_vm.expanded\n                                    }\n                                  }\n                                },\n                                [\n                                  !_vm.expanded\n                                    ? _c(\"v-icon\", { attrs: { small: \"\" } }, [\n                                        _vm._v(\"fas fa-expand\")\n                                      ])\n                                    : _c(\"v-icon\", { attrs: { small: \"\" } }, [\n                                        _vm._v(\"fas fa-compress\")\n                                      ])\n                                ],\n                                1\n                              )\n                            ],\n                            1\n                          )\n                        ],\n                        1\n                      ),\n                      _c(\n                        \"v-card-text\",\n                        { staticClass: \"py-2\" },\n                        [\n                          _c(\n                            \"v-row\",\n                            { attrs: { wrap: \"\" } },\n                            _vm._l(_vm.getUsers, function(user, index) {\n                              return _c(\n                                \"v-flex\",\n                                {\n                                  key: index,\n                                  staticClass: \"pa-1\",\n                                  attrs: { \"d-flex\": \"\", md4: \"\" }\n                                },\n                                [\n                                  _c(\n                                    \"v-card\",\n                                    { staticStyle: { width: \"100%\" } },\n                                    [\n                                      _c(\n                                        \"v-card-title\",\n                                        { staticClass: \"primary white--text\" },\n                                        [\n                                          index == 0\n                                            ? _c(\"span\", [\n                                                _c(\"strong\", [\n                                                  _vm._v(_vm._s(user))\n                                                ])\n                                              ])\n                                            : _c(\"span\", [\n                                                _vm._v(_vm._s(user))\n                                              ]),\n                                          _c(\"v-spacer\"),\n                                          index == 0\n                                            ? _c(\n                                                \"div\",\n                                                [\n                                                  !_vm.published\n                                                    ? _c(\n                                                        \"v-btn\",\n                                                        {\n                                                          attrs: {\n                                                            dark: \"\",\n                                                            small: \"\",\n                                                            icon: \"\"\n                                                          },\n                                                          on: {\n                                                            click: _vm.unpublish\n                                                          }\n                                                        },\n                                                        [\n                                                          _c(\n                                                            \"v-icon\",\n                                                            {\n                                                              attrs: {\n                                                                small: \"\"\n                                                              }\n                                                            },\n                                                            [\n                                                              _vm._v(\n                                                                \"fas fa-video\"\n                                                              )\n                                                            ]\n                                                          )\n                                                        ],\n                                                        1\n                                                      )\n                                                    : _c(\n                                                        \"v-btn\",\n                                                        {\n                                                          attrs: {\n                                                            dark: \"\",\n                                                            small: \"\",\n                                                            icon: \"\"\n                                                          },\n                                                          on: {\n                                                            click: _vm.publish\n                                                          }\n                                                        },\n                                                        [\n                                                          _c(\n                                                            \"v-icon\",\n                                                            {\n                                                              attrs: {\n                                                                small: \"\"\n                                                              }\n                                                            },\n                                                            [\n                                                              _vm._v(\n                                                                \"fas fa-video-slash\"\n                                                              )\n                                                            ]\n                                                          )\n                                                        ],\n                                                        1\n                                                      ),\n                                                  !_vm.muted\n                                                    ? _c(\n                                                        \"v-btn\",\n                                                        {\n                                                          attrs: {\n                                                            dark: \"\",\n                                                            small: \"\",\n                                                            icon: \"\"\n                                                          },\n                                                          on: {\n                                                            click:\n                                                              _vm.toggleMute\n                                                          }\n                                                        },\n                                                        [\n                                                          _c(\n                                                            \"v-icon\",\n                                                            {\n                                                              attrs: {\n                                                                small: \"\"\n                                                              }\n                                                            },\n                                                            [\n                                                              _vm._v(\n                                                                \"fas fa-microphone\"\n                                                              )\n                                                            ]\n                                                          )\n                                                        ],\n                                                        1\n                                                      )\n                                                    : _c(\n                                                        \"v-btn\",\n                                                        {\n                                                          attrs: {\n                                                            dark: \"\",\n                                                            small: \"\",\n                                                            icon: \"\"\n                                                          },\n                                                          on: {\n                                                            click:\n                                                              _vm.toggleMute\n                                                          }\n                                                        },\n                                                        [\n                                                          _c(\n                                                            \"v-icon\",\n                                                            {\n                                                              attrs: {\n                                                                small: \"\"\n                                                              }\n                                                            },\n                                                            [\n                                                              _vm._v(\n                                                                \"fas fa-microphone-slash\"\n                                                              )\n                                                            ]\n                                                          )\n                                                        ],\n                                                        1\n                                                      )\n                                                ],\n                                                1\n                                              )\n                                            : _vm._e()\n                                        ],\n                                        1\n                                      ),\n                                      _c(\n                                        \"v-card-text\",\n                                        { staticClass: \"pa-0 ma-0\" },\n                                        [\n                                          _c(\"video\", {\n                                            staticStyle: {\n                                              display: \"flex\",\n                                              width: \"100%\",\n                                              \"border-radius\":\n                                                \"0px 0px 10px 10px\"\n                                            },\n                                            attrs: {\n                                              id: \"feed\" + index,\n                                              controls: \"controls\",\n                                              autoplay: \"autoplay\"\n                                            }\n                                          })\n                                        ]\n                                      )\n                                    ],\n                                    1\n                                  )\n                                ],\n                                1\n                              )\n                            }),\n                            1\n                          )\n                        ],\n                        1\n                      )\n                    ],\n                    1\n                  )\n                ],\n                1\n              )\n            : _vm._e()\n        ],\n        1\n      ),\n      _c(\n        \"v-dialog\",\n        {\n          attrs: { \"max-width\": \"600px\" },\n          model: {\n            value: _vm.showCreateRoomDialog,\n            callback: function($$v) {\n              _vm.showCreateRoomDialog = $$v\n            },\n            expression: \"showCreateRoomDialog\"\n          }\n        },\n        [\n          _c(\n            \"v-card\",\n            [\n              _c(\n                \"v-toolbar\",\n                {\n                  staticClass: \"mb-3 text-uppercase\",\n                  attrs: { color: \"primary\", dark: \"\" }\n                },\n                [\n                  _c(\"v-card-title\", [\n                    _vm._v(\"Please fill in the following information\")\n                  ]),\n                  _c(\"v-spacer\"),\n                  _c(\n                    \"v-btn\",\n                    {\n                      staticClass: \"mr-0\",\n                      attrs: { icon: \"\" },\n                      on: {\n                        click: function($event) {\n                          _vm.showCreateRoomDialog = false\n                        }\n                      }\n                    },\n                    [_c(\"v-icon\", [_vm._v(\"fas fa-times\")])],\n                    1\n                  )\n                ],\n                1\n              ),\n              _c(\n                \"v-card-text\",\n                [\n                  _c(\"p\", [_vm._v(\"What's your name?\")]),\n                  _c(\"v-text-field\", {\n                    attrs: { id: \"nameField\", label: \"Name *\", autofocus: \"\" },\n                    on: {\n                      keyup: function($event) {\n                        if (\n                          !$event.type.indexOf(\"key\") &&\n                          _vm._k(\n                            $event.keyCode,\n                            \"enter\",\n                            13,\n                            $event.key,\n                            \"Enter\"\n                          )\n                        ) {\n                          return null\n                        }\n                        return _vm.confirmRoomName($event)\n                      }\n                    },\n                    model: {\n                      value: _vm.userName,\n                      callback: function($$v) {\n                        _vm.userName = $$v\n                      },\n                      expression: \"userName\"\n                    }\n                  }),\n                  _c(\"p\", [\n                    _vm._v(\"Which room name would you like to create?\")\n                  ]),\n                  _c(\"v-text-field\", {\n                    attrs: { id: \"roomNameField\", label: \"Room name *\" },\n                    on: {\n                      keyup: function($event) {\n                        if (\n                          !$event.type.indexOf(\"key\") &&\n                          _vm._k(\n                            $event.keyCode,\n                            \"enter\",\n                            13,\n                            $event.key,\n                            \"Enter\"\n                          )\n                        ) {\n                          return null\n                        }\n                        return _vm.confirmRoomName($event)\n                      }\n                    },\n                    model: {\n                      value: _vm.roomName,\n                      callback: function($$v) {\n                        _vm.roomName = $$v\n                      },\n                      expression: \"roomName\"\n                    }\n                  })\n                ],\n                1\n              ),\n              _c(\n                \"v-card-actions\",\n                [\n                  _c(\"div\", { staticClass: \"flex-grow-1\" }),\n                  _c(\n                    \"v-btn\",\n                    {\n                      attrs: { text: \"\" },\n                      on: {\n                        click: function($event) {\n                          return _vm.confirmRoomName()\n                        }\n                      }\n                    },\n                    [_vm._v(\"Ok\")]\n                  )\n                ],\n                1\n              )\n            ],\n            1\n          )\n        ],\n        1\n      )\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY2FjaGUtbG9hZGVyL2Rpc3QvY2pzLmpzP3tcImNhY2hlRGlyZWN0b3J5XCI6XCJub2RlX21vZHVsZXMvLmNhY2hlL3Z1ZS1sb2FkZXJcIixcImNhY2hlSWRlbnRpZmllclwiOlwiN2I5M2JkMWQtdnVlLWxvYWRlci10ZW1wbGF0ZVwifSEuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYi9sb2FkZXJzL3RlbXBsYXRlTG9hZGVyLmpzPyEuL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvZnJlZWZsb3djb25uZWN0Lmh0bWw/dnVlJnR5cGU9dGVtcGxhdGUmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL3ZpZXdzL2ZyZWVmbG93Y29ubmVjdC9mcmVlZmxvd2Nvbm5lY3QuaHRtbD85NGRhIl0sInNvdXJjZXNDb250ZW50IjpbInZhciByZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgdmFyIF92bSA9IHRoaXNcbiAgdmFyIF9oID0gX3ZtLiRjcmVhdGVFbGVtZW50XG4gIHZhciBfYyA9IF92bS5fc2VsZi5fYyB8fCBfaFxuICByZXR1cm4gX2MoXG4gICAgXCJzZWN0aW9uXCIsXG4gICAgeyBzdGF0aWNDbGFzczogXCJmcmVlZmxvd2Nvbm5lY3RcIiB9LFxuICAgIFtcbiAgICAgIF9jKFxuICAgICAgICBcInYtcm93XCIsXG4gICAgICAgIFtcbiAgICAgICAgICBfdm0uY3VycmVudFJvb21cbiAgICAgICAgICAgID8gX2MoXG4gICAgICAgICAgICAgICAgXCJ2LWZsZXhcIixcbiAgICAgICAgICAgICAgICB7IHN0YXRpY0NsYXNzOiBcInB5LTIgcHgtNFwiIH0sXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgX2MoXG4gICAgICAgICAgICAgICAgICAgIFwidi1jYXJkXCIsXG4gICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidi1jYXJkLXRpdGxlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN0YXRpY0NsYXNzOiBcInByaW1hcnkgd2hpdGUtLXRleHQgcHktMlwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidi1yb3dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHN0YXRpY0NsYXNzOiBcInB4LTJcIiwgYXR0cnM6IHsgYWxpZ246IFwiY2VudGVyXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFwidi1hdmF0YXJcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWNDbGFzczogXCJtci0zXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogXCI4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFwic2Vjb25kYXJ5IGRhcmtlbi0yIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2MoXCJzcGFuXCIsIHsgc3RhdGljQ2xhc3M6IFwidGV4dC11cHBlcmNhc2VcIiB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fdihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcbiAgICAgICAgICAgICAgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLl9zKF92bS5jdXJyZW50Um9vbS5uYW1lKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2MoXCJ2LXNwYWNlclwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtYnRuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczogeyBkYXJrOiBcIlwiLCBzbWFsbDogXCJcIiwgaWNvbjogXCJcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oJGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5leHBhbmRlZCA9ICFfdm0uZXhwYW5kZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhX3ZtLmV4cGFuZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IF9jKFwidi1pY29uXCIsIHsgYXR0cnM6IHsgc21hbGw6IFwiXCIgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLl92KFwiZmFzIGZhLWV4cGFuZFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfYyhcInYtaWNvblwiLCB7IGF0dHJzOiB7IHNtYWxsOiBcIlwiIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fdihcImZhcyBmYS1jb21wcmVzc1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidi1jYXJkLXRleHRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc3RhdGljQ2xhc3M6IFwicHktMlwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidi1yb3dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGF0dHJzOiB7IHdyYXA6IFwiXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fbChfdm0uZ2V0VXNlcnMsIGZ1bmN0aW9uKHVzZXIsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidi1mbGV4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpY0NsYXNzOiBcInBhLTFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczogeyBcImQtZmxleFwiOiBcIlwiLCBtZDQ6IFwiXCIgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtY2FyZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBzdGF0aWNTdHlsZTogeyB3aWR0aDogXCIxMDAlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtY2FyZC10aXRsZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgc3RhdGljQ2xhc3M6IFwicHJpbWFyeSB3aGl0ZS0tdGV4dFwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPT0gMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IF9jKFwic3BhblwiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcInN0cm9uZ1wiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fdihfdm0uX3ModXNlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogX2MoXCJzcGFuXCIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fdihfdm0uX3ModXNlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcInYtc3BhY2VyXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPT0gMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIV92bS5wdWJsaXNoZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtYnRuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFyazogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtYWxsOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiBfdm0udW5wdWJsaXNoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtaWNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtYWxsOiBcIlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5fdihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZhcyBmYS12aWRlb1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtYnRuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFyazogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtYWxsOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiBfdm0ucHVibGlzaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2LWljb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbWFsbDogXCJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdm0uX3YoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmYXMgZmEtdmlkZW8tc2xhc2hcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhX3ZtLm11dGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2LWJ0blwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhcms6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbWFsbDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLnRvZ2dsZU11dGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidi1pY29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc21hbGw6IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLl92KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmFzIGZhLW1pY3JvcGhvbmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2LWJ0blwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhcms6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbWFsbDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLnRvZ2dsZU11dGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidi1pY29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc21hbGw6IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLl92KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmFzIGZhLW1pY3JvcGhvbmUtc2xhc2hcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfdm0uX2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInYtY2FyZC10ZXh0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBzdGF0aWNDbGFzczogXCJwYS0wIG1hLTBcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jKFwidmlkZW9cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWNTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiZmxleFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJvcmRlci1yYWRpdXNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiMHB4IDBweCAxMHB4IDEwcHhcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBcImZlZWRcIiArIGluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzOiBcImNvbnRyb2xzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXk6IFwiYXV0b3BsYXlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIDogX3ZtLl9lKClcbiAgICAgICAgXSxcbiAgICAgICAgMVxuICAgICAgKSxcbiAgICAgIF9jKFxuICAgICAgICBcInYtZGlhbG9nXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBhdHRyczogeyBcIm1heC13aWR0aFwiOiBcIjYwMHB4XCIgfSxcbiAgICAgICAgICBtb2RlbDoge1xuICAgICAgICAgICAgdmFsdWU6IF92bS5zaG93Q3JlYXRlUm9vbURpYWxvZyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigkJHYpIHtcbiAgICAgICAgICAgICAgX3ZtLnNob3dDcmVhdGVSb29tRGlhbG9nID0gJCR2XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogXCJzaG93Q3JlYXRlUm9vbURpYWxvZ1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBbXG4gICAgICAgICAgX2MoXG4gICAgICAgICAgICBcInYtY2FyZFwiLFxuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICBcInYtdG9vbGJhclwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHN0YXRpY0NsYXNzOiBcIm1iLTMgdGV4dC11cHBlcmNhc2VcIixcbiAgICAgICAgICAgICAgICAgIGF0dHJzOiB7IGNvbG9yOiBcInByaW1hcnlcIiwgZGFyazogXCJcIiB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICBfYyhcInYtY2FyZC10aXRsZVwiLCBbXG4gICAgICAgICAgICAgICAgICAgIF92bS5fdihcIlBsZWFzZSBmaWxsIGluIHRoZSBmb2xsb3dpbmcgaW5mb3JtYXRpb25cIilcbiAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgX2MoXCJ2LXNwYWNlclwiKSxcbiAgICAgICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgICAgICBcInYtYnRuXCIsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdGF0aWNDbGFzczogXCJtci0wXCIsXG4gICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHsgaWNvbjogXCJcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oJGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIF92bS5zaG93Q3JlYXRlUm9vbURpYWxvZyA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBbX2MoXCJ2LWljb25cIiwgW192bS5fdihcImZhcyBmYS10aW1lc1wiKV0pXSxcbiAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICBcInYtY2FyZC10ZXh0XCIsXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgX2MoXCJwXCIsIFtfdm0uX3YoXCJXaGF0J3MgeW91ciBuYW1lP1wiKV0pLFxuICAgICAgICAgICAgICAgICAgX2MoXCJ2LXRleHQtZmllbGRcIiwge1xuICAgICAgICAgICAgICAgICAgICBhdHRyczogeyBpZDogXCJuYW1lRmllbGRcIiwgbGFiZWw6IFwiTmFtZSAqXCIsIGF1dG9mb2N1czogXCJcIiB9LFxuICAgICAgICAgICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgICAgICAgIGtleXVwOiBmdW5jdGlvbigkZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgISRldmVudC50eXBlLmluZGV4T2YoXCJrZXlcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZtLl9rKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRldmVudC5rZXlDb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZW50ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXZlbnQua2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiRW50ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdm0uY29uZmlybVJvb21OYW1lKCRldmVudClcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IF92bS51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oJCR2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdm0udXNlck5hbWUgPSAkJHZcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IFwidXNlck5hbWVcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIF9jKFwicFwiLCBbXG4gICAgICAgICAgICAgICAgICAgIF92bS5fdihcIldoaWNoIHJvb20gbmFtZSB3b3VsZCB5b3UgbGlrZSB0byBjcmVhdGU/XCIpXG4gICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgIF9jKFwidi10ZXh0LWZpZWxkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHsgaWQ6IFwicm9vbU5hbWVGaWVsZFwiLCBsYWJlbDogXCJSb29tIG5hbWUgKlwiIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAga2V5dXA6IGZ1bmN0aW9uKCRldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAhJGV2ZW50LnR5cGUuaW5kZXhPZihcImtleVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICBfdm0uX2soXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV2ZW50LmtleUNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbnRlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRldmVudC5rZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJFbnRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF92bS5jb25maXJtUm9vbU5hbWUoJGV2ZW50KVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogX3ZtLnJvb21OYW1lLFxuICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigkJHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF92bS5yb29tTmFtZSA9ICQkdlxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogXCJyb29tTmFtZVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIF9jKFxuICAgICAgICAgICAgICAgIFwidi1jYXJkLWFjdGlvbnNcIixcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICBfYyhcImRpdlwiLCB7IHN0YXRpY0NsYXNzOiBcImZsZXgtZ3Jvdy0xXCIgfSksXG4gICAgICAgICAgICAgICAgICBfYyhcbiAgICAgICAgICAgICAgICAgICAgXCJ2LWJ0blwiLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHsgdGV4dDogXCJcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oJGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdm0uY29uZmlybVJvb21OYW1lKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFtfdm0uX3YoXCJPa1wiKV1cbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIDFcbiAgICAgICAgICApXG4gICAgICAgIF0sXG4gICAgICAgIDFcbiAgICAgIClcbiAgICBdLFxuICAgIDFcbiAgKVxufVxudmFyIHN0YXRpY1JlbmRlckZucyA9IFtdXG5yZW5kZXIuX3dpdGhTdHJpcHBlZCA9IHRydWVcblxuZXhwb3J0IHsgcmVuZGVyLCBzdGF0aWNSZW5kZXJGbnMgfSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/cache-loader/dist/cjs.js?{\"cacheDirectory\":\"node_modules/.cache/vue-loader\",\"cacheIdentifier\":\"7b93bd1d-vue-loader-template\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\n");

/***/ }),

/***/ "./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/css-loader??ref--8-oneOf-1-1!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--8-oneOf-1-2!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("exports = module.exports = __webpack_require__(/*! ../../../node_modules/css-loader/lib/css-base.js */ \"./node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.i, \"\", \"\"]);\n\n// exports\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9pbmRleC5qcz8hLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvbG9hZGVycy9zdHlsZVBvc3RMb2FkZXIuanMhLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPyEuL25vZGVfbW9kdWxlcy9zYXNzLWxvYWRlci9kaXN0L2Nqcy5qcz8hLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvZnJlZWZsb3djb25uZWN0LnNjc3M/YTFiYyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvbGliL2Nzcy1iYXNlLmpzXCIpKGZhbHNlKTtcbi8vIGltcG9ydHNcblxuXG4vLyBtb2R1bGVcbmV4cG9ydHMucHVzaChbbW9kdWxlLmlkLCBcIlwiLCBcIlwiXSk7XG5cbi8vIGV4cG9ydHNcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\n");

/***/ }),

/***/ "./node_modules/vue-style-loader/index.js?!./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-style-loader??ref--8-oneOf-1-0!./node_modules/css-loader??ref--8-oneOf-1-1!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--8-oneOf-1-2!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(/*! !../../../node_modules/css-loader??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& */ \"./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\");\nif(typeof content === 'string') content = [[module.i, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = __webpack_require__(/*! ../../../node_modules/vue-style-loader/lib/addStylesClient.js */ \"./node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"03a339e4\", content, false, {\"sourceMap\":false,\"shadowMode\":false});\n// Hot Module Replacement\nif(true) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(/*! !../../../node_modules/css-loader??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& */ \"./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\", function() {\n     var newContent = __webpack_require__(/*! !../../../node_modules/css-loader??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& */ \"./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\");\n     if(typeof newContent === 'string') newContent = [[module.i, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvdnVlLXN0eWxlLWxvYWRlci9pbmRleC5qcz8hLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9pbmRleC5qcz8hLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvbG9hZGVycy9zdHlsZVBvc3RMb2FkZXIuanMhLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPyEuL25vZGVfbW9kdWxlcy9zYXNzLWxvYWRlci9kaXN0L2Nqcy5qcz8hLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvZnJlZWZsb3djb25uZWN0LnNjc3M/MWFlYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzdHlsZS1sb2FkZXI6IEFkZHMgc29tZSBjc3MgdG8gdGhlIERPTSBieSBhZGRpbmcgYSA8c3R5bGU+IHRhZ1xuXG4vLyBsb2FkIHRoZSBzdHlsZXNcbnZhciBjb250ZW50ID0gcmVxdWlyZShcIiEhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvaW5kZXguanM/P3JlZi0tOC1vbmVPZi0xLTEhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL2xvYWRlcnMvc3R5bGVQb3N0TG9hZGVyLmpzIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9wb3N0Y3NzLWxvYWRlci9zcmMvaW5kZXguanM/P3JlZi0tOC1vbmVPZi0xLTIhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Nhc3MtbG9hZGVyL2Rpc3QvY2pzLmpzPz9yZWYtLTgtb25lT2YtMS0zIS4vZnJlZWZsb3djb25uZWN0LnNjc3M/dnVlJnR5cGU9c3R5bGUmaW5kZXg9MCZpZD05ODNjYmUyZSZzY29wZWQ9dHJ1ZSZsYW5nPXNjc3MmXCIpO1xuaWYodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSBjb250ZW50ID0gW1ttb2R1bGUuaWQsIGNvbnRlbnQsICcnXV07XG5pZihjb250ZW50LmxvY2FscykgbW9kdWxlLmV4cG9ydHMgPSBjb250ZW50LmxvY2Fscztcbi8vIGFkZCB0aGUgc3R5bGVzIHRvIHRoZSBET01cbnZhciBhZGQgPSByZXF1aXJlKFwiIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtc3R5bGUtbG9hZGVyL2xpYi9hZGRTdHlsZXNDbGllbnQuanNcIikuZGVmYXVsdFxudmFyIHVwZGF0ZSA9IGFkZChcIjAzYTMzOWU0XCIsIGNvbnRlbnQsIGZhbHNlLCB7XCJzb3VyY2VNYXBcIjpmYWxzZSxcInNoYWRvd01vZGVcIjpmYWxzZX0pO1xuLy8gSG90IE1vZHVsZSBSZXBsYWNlbWVudFxuaWYobW9kdWxlLmhvdCkge1xuIC8vIFdoZW4gdGhlIHN0eWxlcyBjaGFuZ2UsIHVwZGF0ZSB0aGUgPHN0eWxlPiB0YWdzXG4gaWYoIWNvbnRlbnQubG9jYWxzKSB7XG4gICBtb2R1bGUuaG90LmFjY2VwdChcIiEhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvaW5kZXguanM/P3JlZi0tOC1vbmVPZi0xLTEhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL2xvYWRlcnMvc3R5bGVQb3N0TG9hZGVyLmpzIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9wb3N0Y3NzLWxvYWRlci9zcmMvaW5kZXguanM/P3JlZi0tOC1vbmVPZi0xLTIhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Nhc3MtbG9hZGVyL2Rpc3QvY2pzLmpzPz9yZWYtLTgtb25lT2YtMS0zIS4vZnJlZWZsb3djb25uZWN0LnNjc3M/dnVlJnR5cGU9c3R5bGUmaW5kZXg9MCZpZD05ODNjYmUyZSZzY29wZWQ9dHJ1ZSZsYW5nPXNjc3MmXCIsIGZ1bmN0aW9uKCkge1xuICAgICB2YXIgbmV3Q29udGVudCA9IHJlcXVpcmUoXCIhIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0xIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYi9sb2FkZXJzL3N0eWxlUG9zdExvYWRlci5qcyEuLi8uLi8uLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0yIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9zYXNzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cmVmLS04LW9uZU9mLTEtMyEuL2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJlwiKTtcbiAgICAgaWYodHlwZW9mIG5ld0NvbnRlbnQgPT09ICdzdHJpbmcnKSBuZXdDb250ZW50ID0gW1ttb2R1bGUuaWQsIG5ld0NvbnRlbnQsICcnXV07XG4gICAgIHVwZGF0ZShuZXdDb250ZW50KTtcbiAgIH0pO1xuIH1cbiAvLyBXaGVuIHRoZSBtb2R1bGUgaXMgZGlzcG9zZWQsIHJlbW92ZSB0aGUgPHN0eWxlPiB0YWdzXG4gbW9kdWxlLmhvdC5kaXNwb3NlKGZ1bmN0aW9uKCkgeyB1cGRhdGUoKTsgfSk7XG59Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/vue-style-loader/index.js?!./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\n");

/***/ }),

/***/ "./src/plugins/janus.js":
/*!******************************!*\
  !*** ./src/plugins/janus.js ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var webrtc_adapter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! webrtc-adapter */ \"./node_modules/webrtc-adapter/src/js/adapter_core.js\");\n/* eslint-disable */\n/*\n\tThe MIT License (MIT)\n\n\tCopyright (c) 2016 Meetecho\n\n\tPermission is hereby granted, free of charge, to any person obtaining\n\ta copy of this software and associated documentation files (the \"Software\"),\n\tto deal in the Software without restriction, including without limitation\n\tthe rights to use, copy, modify, merge, publish, distribute, sublicense,\n\tand/or sell copies of the Software, and to permit persons to whom the\n\tSoftware is furnished to do so, subject to the following conditions:\n\n\tThe above copyright notice and this permission notice shall be included\n\tin all copies or substantial portions of the Software.\n\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\tOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\tFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n\tTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n\tOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n\tARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n\tOTHER DEALINGS IN THE SOFTWARE.\n */\n\n\n// List of sessions\nJanus.sessions = {};\n\nJanus.isExtensionEnabled = function() {\n\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t// No need for the extension, getDisplayMedia is supported\n\t\treturn true;\n\t}\n\tif(window.navigator.userAgent.match('Chrome')) {\n\t\tvar chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n\t\tvar maxver = 33;\n\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t// Older versions of Chrome don't support this extension-based approach, so lie\n\t\t\treturn true;\n\t\t}\n\t\treturn Janus.extension.isInstalled();\n\t} else {\n\t\t// Firefox of others, no need for the extension (but this doesn't mean it will work)\n\t\treturn true;\n\t}\n};\n\nvar defaultExtension = {\n\t// Screensharing Chrome Extension ID\n\textensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n\tisInstalled: function() { return document.querySelector('#janus-extension-installed') !== null; },\n\tgetScreen: function (callback) {\n\t\tvar pending = window.setTimeout(function () {\n\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\terror.name = 'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n\t\t\treturn callback(error);\n\t\t}, 1000);\n\t\tthis.cache[pending] = callback;\n\t\twindow.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n\t},\n\tinit: function () {\n\t\tvar cache = {};\n\t\tthis.cache = cache;\n\t\t// Wait for events from the Chrome Extension\n\t\twindow.addEventListener('message', function (event) {\n\t\t\tif(event.origin != window.location.origin)\n\t\t\t\treturn;\n\t\t\tif(event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n\t\t\t\tvar callback = cache[event.data.id];\n\t\t\t\tdelete cache[event.data.id];\n\n\t\t\t\tif (event.data.sourceId === '') {\n\t\t\t\t\t// user canceled\n\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\terror.name = 'You cancelled the request for permission, giving up...';\n\t\t\t\t\tcallback(error);\n\t\t\t\t} else {\n\t\t\t\t\tcallback(null, event.data.sourceId);\n\t\t\t\t}\n\t\t\t} else if (event.data.type == 'janusGetScreenPending') {\n\t\t\t\tconsole.log('clearing ', event.data.id);\n\t\t\t\twindow.clearTimeout(event.data.id);\n\t\t\t}\n\t\t});\n\t}\n};\n\nJanus.useDefaultDependencies = function (deps) {\n\tvar f = (deps && deps.fetch) || fetch;\n\tvar p = (deps && deps.Promise) || Promise;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\tisArray: function(arr) { return Array.isArray(arr); },\n\t\twebRTCAdapter: (deps && deps.adapter) || webrtc_adapter__WEBPACK_IMPORTED_MODULE_0__[\"default\"],\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar fetchOptions = {\n\t\t\t\tmethod: options.verb,\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json, text/plain, */*'\n\t\t\t\t},\n\t\t\t\tcache: 'no-cache'\n\t\t\t};\n\t\t\tif(options.verb === \"POST\") {\n\t\t\t\tfetchOptions.headers['Content-Type'] = 'application/json';\n\t\t\t}\n\t\t\tif(options.withCredentials !== undefined) {\n\t\t\t\tfetchOptions.credentials = options.withCredentials === true ? 'include' : (options.withCredentials ? options.withCredentials : 'omit');\n\t\t\t}\n\t\t\tif(options.body !== undefined) {\n\t\t\t\tfetchOptions.body = JSON.stringify(options.body);\n\t\t\t}\n\n\t\t\tvar fetching = f(url, fetchOptions).catch(function(error) {\n\t\t\t\treturn p.reject({message: 'Probably a network error, is the server down?', error: error});\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * fetch() does not natively support timeouts.\n\t\t\t * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n\t\t\t */\n\n\t\t\tif(options.timeout !== undefined) {\n\t\t\t\tvar timeout = new p(function(resolve, reject) {\n\t\t\t\t\tvar timerId = setTimeout(function() {\n\t\t\t\t\t\tclearTimeout(timerId);\n\t\t\t\t\t\treturn reject({message: 'Request timed out', timeout: options.timeout});\n\t\t\t\t\t}, options.timeout);\n\t\t\t\t});\n\t\t\t\tfetching = p.race([fetching,timeout]);\n\t\t\t}\n\n\t\t\tfetching.then(function(response) {\n\t\t\t\tif(response.ok) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\treturn response.json().then(function(parsed) {\n\t\t\t\t\t\t\toptions.success(parsed);\n\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\treturn p.reject({message: 'Failed to parse response body', error: error, response: response});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn p.reject({message: 'API call failed', response: response});\n\t\t\t\t}\n\t\t\t}).catch(function(error) {\n\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\toptions.error(error.message || '<< internal error >>', error);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn fetching;\n\t\t}\n\t}\n};\n\nJanus.useOldDependencies = function (deps) {\n\tvar jq = (deps && deps.jQuery) || jQuery;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\tisArray: function(arr) { return jq.isArray(arr); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\twebRTCAdapter: (deps && deps.adapter) || webrtc_adapter__WEBPACK_IMPORTED_MODULE_0__[\"default\"],\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar payload = options.body !== undefined ? {\n\t\t\t\tcontentType: 'application/json',\n\t\t\t\tdata: JSON.stringify(options.body)\n\t\t\t} : {};\n\t\t\tvar credentials = options.withCredentials !== undefined ? {xhrFields: {withCredentials: options.withCredentials}} : {};\n\n\t\t\treturn jq.ajax(jq.extend(payload, credentials, {\n\t\t\t\turl: url,\n\t\t\t\ttype: options.verb,\n\t\t\t\tcache: false,\n\t\t\t\tdataType: 'json',\n\t\t\t\tasync: options.async,\n\t\t\t\ttimeout: options.timeout,\n\t\t\t\tsuccess: function(result) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.success(result);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, err) {\n\t\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.error(status, err);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t},\n\t};\n};\n\nJanus.noop = function() {};\n\nJanus.dataChanDefaultLabel = \"JanusDataChannel\";\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Initialization\nJanus.init = function(options) {\n\toptions = options || {};\n\toptions.callback = (typeof options.callback == \"function\") ? options.callback : Janus.noop;\n\tif(Janus.initDone === true) {\n\t\t// Already initialized\n\t\toptions.callback();\n\t} else {\n\t\tif(typeof console == \"undefined\" || typeof console.log == \"undefined\")\n\t\t\tconsole = { log: function() {} };\n\t\t// Console logging (all debugging disabled by default)\n\t\tJanus.trace = Janus.noop;\n\t\tJanus.debug = Janus.noop;\n\t\tJanus.vdebug = Janus.noop;\n\t\tJanus.log = Janus.noop;\n\t\tJanus.warn = Janus.noop;\n\t\tJanus.error = Janus.noop;\n\t\tif(options.debug === true || options.debug === \"all\") {\n\t\t\t// Enable all debugging levels\n\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\tJanus.log = console.log.bind(console);\n\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\tJanus.error = console.error.bind(console);\n\t\t} else if(Array.isArray(options.debug)) {\n\t\t\tfor(var i in options.debug) {\n\t\t\t\tvar d = options.debug[i];\n\t\t\t\tswitch(d) {\n\t\t\t\t\tcase \"trace\":\n\t\t\t\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"debug\":\n\t\t\t\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"vdebug\":\n\t\t\t\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\tJanus.log = console.log.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"warn\":\n\t\t\t\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"error\":\n\t\t\t\t\t\tJanus.error = console.error.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error(\"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\");\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tJanus.log(\"Initializing library\");\n\n\t\tvar usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n\t\tJanus.isArray = usedDependencies.isArray;\n\t\tJanus.webRTCAdapter = usedDependencies.webRTCAdapter;\n\t\tJanus.httpAPICall = usedDependencies.httpAPICall;\n\t\tJanus.newWebSocket = usedDependencies.newWebSocket;\n\t\tJanus.extension = usedDependencies.extension;\n\t\tJanus.extension.init();\n\n\t\t// Helper method to enumerate devices\n\t\tJanus.listDevices = function(callback, config) {\n\t\t\tcallback = (typeof callback == \"function\") ? callback : Janus.noop;\n\t\t\tif (config == null) config = { audio: true, video: true };\n\t\t\tif(Janus.isGetUserMediaAvailable()) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia(config)\n\t\t\t\t.then(function(stream) {\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\t\tJanus.debug(devices);\n\t\t\t\t\t\tcallback(devices);\n\t\t\t\t\t\t// Get rid of the now useless stream\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar tracks = stream.getTracks();\n\t\t\t\t\t\t\tfor(var i in tracks) {\n\t\t\t\t\t\t\t\tvar mst = tracks[i];\n\t\t\t\t\t\t\t\tif(mst !== null && mst !== undefined)\n\t\t\t\t\t\t\t\t\tmst.stop();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err) {\n\t\t\t\t\tJanus.error(err);\n\t\t\t\t\tcallback([]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tJanus.warn(\"navigator.mediaDevices unavailable\");\n\t\t\t\tcallback([]);\n\t\t\t}\n\t\t}\n\t\t// Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n\t\tJanus.attachMediaStream = function(element, stream) {\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\n\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\n\t\t\t\tif(chromever >= 52) {\n\t\t\t\t\telement.srcObject = stream;\n\t\t\t\t} else if(typeof element.src !== 'undefined') {\n\t\t\t\t\telement.src = URL.createObjectURL(stream);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.error(\"Error attaching stream to element\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telement.srcObject = stream;\n\t\t\t}\n\t\t};\n\t\tJanus.reattachMediaStream = function(to, from) {\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\n\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\n\t\t\t\tif(chromever >= 52) {\n\t\t\t\t\tto.srcObject = from.srcObject;\n\t\t\t\t} else if(typeof to.src !== 'undefined') {\n\t\t\t\t\tto.src = from.src;\n\t\t\t\t} else {\n\t\t\t\t\tJanus.error(\"Error reattaching stream to element\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tto.srcObject = from.srcObject;\n\t\t\t}\n\t\t};\n\t\t// Detect tab close: make sure we don't loose existing onbeforeunload handlers\n\t\t// (note: for iOS we need to subscribe to a different event, 'pagehide', see\n\t\t// https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n\t\tvar iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n\t\tvar eventName = iOS ? 'pagehide' : 'beforeunload';\n\t\tvar oldOBF = window[\"on\" + eventName];\n\t\twindow.addEventListener(eventName, function(event) {\n\t\t\tJanus.log(\"Closing window\");\n\t\t\tfor(var s in Janus.sessions) {\n\t\t\t\tif(Janus.sessions[s] !== null && Janus.sessions[s] !== undefined &&\n\t\t\t\t\t\tJanus.sessions[s].destroyOnUnload) {\n\t\t\t\t\tJanus.log(\"Destroying session \" + s);\n\t\t\t\t\tJanus.sessions[s].destroy({asyncRequest: false, notifyDestroyed: false});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(oldOBF && typeof oldOBF == \"function\")\n\t\t\t\toldOBF();\n\t\t});\n\t\t// If this is a Safari Technology Preview, check if VP8 is supported\n\t\tJanus.safariVp8 = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'safari' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 605) {\n\t\t\t// Let's see if RTCRtpSender.getCapabilities() is there\n\t\t\tif(RTCRtpSender && RTCRtpSender.getCapabilities && RTCRtpSender.getCapabilities(\"video\") &&\n\t\t\t\t\tRTCRtpSender.getCapabilities(\"video\").codecs && RTCRtpSender.getCapabilities(\"video\").codecs.length) {\n\t\t\t\tfor(var i in RTCRtpSender.getCapabilities(\"video\").codecs) {\n\t\t\t\t\tvar codec = RTCRtpSender.getCapabilities(\"video\").codecs[i];\n\t\t\t\t\tif(codec && codec.mimeType && codec.mimeType.toLowerCase() === \"video/vp8\") {\n\t\t\t\t\t\tJanus.safariVp8 = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t} else {\n\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We do it in a very ugly way, as there's no alternative...\n\t\t\t\t// We create a PeerConnection to see if VP8 is in an offer\n\t\t\t\tvar testpc = new RTCPeerConnection({}, {});\n\t\t\t\ttestpc.createOffer({offerToReceiveVideo: true}).then(function(offer) {\n\t\t\t\t\tJanus.safariVp8 = offer.sdp.indexOf(\"VP8\") !== -1;\n\t\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t\t}\n\t\t\t\t\ttestpc.close();\n\t\t\t\t\ttestpc = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Check if this browser supports Unified Plan and transceivers\n\t\t// Based on https://codepen.io/anon/pen/ZqLwWV?editors=0010\n\t\tJanus.unifiedPlan = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'firefox' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 59) {\n\t\t\t// Firefox definitely does, starting from version 59\n\t\t\tJanus.unifiedPlan = true;\n\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'chrome' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version < 72) {\n\t\t\t// Chrome does, but it's only usable from version 72 on\n\t\t\tJanus.unifiedPlan = false;\n\t\t} else if(!('currentDirection' in RTCRtpTransceiver.prototype)) {\n\t\t\t// Safari supports addTransceiver() but not Unified Plan when\n\t\t\t// currentDirection is not defined (see codepen above)\n\t\t\tJanus.unifiedPlan = false;\n\t\t} else {\n\t\t\t// Check if addTransceiver() throws an exception\n\t\t\tconst tempPc = new RTCPeerConnection();\n\t\t\ttry {\n\t\t\t\ttempPc.addTransceiver('audio');\n\t\t\t\tJanus.unifiedPlan = true;\n\t\t\t} catch (e) {}\n\t\t\ttempPc.close();\n\t\t}\n\t\tJanus.initDone = true;\n\t\toptions.callback();\n\t}\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function() {\n\treturn window.RTCPeerConnection !== undefined && window.RTCPeerConnection !== null;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function() {\n\treturn navigator.mediaDevices !== undefined && navigator.mediaDevices !== null &&\n\t\tnavigator.mediaDevices.getUserMedia !== undefined && navigator.mediaDevices.getUserMedia !== null;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function(len) {\n\tvar charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\tvar randomString = '';\n\tfor (var i = 0; i < len; i++) {\n\t\tvar randomPoz = Math.floor(Math.random() * charSet.length);\n\t\trandomString += charSet.substring(randomPoz,randomPoz+1);\n\t}\n\treturn randomString;\n}\n\n\nfunction Janus(gatewayCallbacks) {\n\tif(Janus.initDone === undefined) {\n\t\tgatewayCallbacks.error(\"Library not initialized\");\n\t\treturn {};\n\t}\n\tif(!Janus.isWebrtcSupported()) {\n\t\tgatewayCallbacks.error(\"WebRTC not supported by this browser\");\n\t\treturn {};\n\t}\n\tJanus.log(\"Library initialized: \" + Janus.initDone);\n\tgatewayCallbacks = gatewayCallbacks || {};\n\tgatewayCallbacks.success = (typeof gatewayCallbacks.success == \"function\") ? gatewayCallbacks.success : Janus.noop;\n\tgatewayCallbacks.error = (typeof gatewayCallbacks.error == \"function\") ? gatewayCallbacks.error : Janus.noop;\n\tgatewayCallbacks.destroyed = (typeof gatewayCallbacks.destroyed == \"function\") ? gatewayCallbacks.destroyed : Janus.noop;\n\tif(gatewayCallbacks.server === null || gatewayCallbacks.server === undefined) {\n\t\tgatewayCallbacks.error(\"Invalid server url\");\n\t\treturn {};\n\t}\n\tvar websockets = false;\n\tvar ws = null;\n\tvar wsHandlers = {};\n\tvar wsKeepaliveTimeoutId = null;\n\n\tvar servers = null, serversIndex = 0;\n\tvar server = gatewayCallbacks.server;\n\tif(Janus.isArray(server)) {\n\t\tJanus.log(\"Multiple servers provided (\" + server.length + \"), will use the first that works\");\n\t\tserver = null;\n\t\tservers = gatewayCallbacks.server;\n\t\tJanus.debug(servers);\n\t} else {\n\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\twebsockets = true;\n\t\t\tJanus.log(\"Using WebSockets to contact Janus: \" + server);\n\t\t} else {\n\t\t\twebsockets = false;\n\t\t\tJanus.log(\"Using REST API to contact Janus: \" + server);\n\t\t}\n\t}\n\tvar iceServers = gatewayCallbacks.iceServers;\n\tif(iceServers === undefined || iceServers === null)\n\t\ticeServers = [{urls: \"stun:stun.l.google.com:19302\"}];\n\tvar iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n\tvar bundlePolicy = gatewayCallbacks.bundlePolicy;\n\t// Whether IPv6 candidates should be gathered\n\tvar ipv6Support = gatewayCallbacks.ipv6;\n\tif(ipv6Support === undefined || ipv6Support === null)\n\t\tipv6Support = false;\n\t// Whether we should enable the withCredentials flag for XHR requests\n\tvar withCredentials = false;\n\tif(gatewayCallbacks.withCredentials !== undefined && gatewayCallbacks.withCredentials !== null)\n\t\twithCredentials = gatewayCallbacks.withCredentials === true;\n\t// Optional max events\n\tvar maxev = 10;\n\tif(gatewayCallbacks.max_poll_events !== undefined && gatewayCallbacks.max_poll_events !== null)\n\t\tmaxev = gatewayCallbacks.max_poll_events;\n\tif(maxev < 1)\n\t\tmaxev = 1;\n\t// Token to use (only if the token based authentication mechanism is enabled)\n\tvar token = null;\n\tif(gatewayCallbacks.token !== undefined && gatewayCallbacks.token !== null)\n\t\ttoken = gatewayCallbacks.token;\n\t// API secret to use (only if the shared API secret is enabled)\n\tvar apisecret = null;\n\tif(gatewayCallbacks.apisecret !== undefined && gatewayCallbacks.apisecret !== null)\n\t\tapisecret = gatewayCallbacks.apisecret;\n\t// Whether we should destroy this session when onbeforeunload is called\n\tthis.destroyOnUnload = true;\n\tif(gatewayCallbacks.destroyOnUnload !== undefined && gatewayCallbacks.destroyOnUnload !== null)\n\t\tthis.destroyOnUnload = (gatewayCallbacks.destroyOnUnload === true);\n\t// Some timeout-related values\n\tvar keepAlivePeriod = 25000;\n\tif(gatewayCallbacks.keepAlivePeriod !== undefined && gatewayCallbacks.keepAlivePeriod !== null)\n\t\tkeepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n\tif(isNaN(keepAlivePeriod))\n\t\tkeepAlivePeriod = 25000;\n\tvar longPollTimeout = 60000;\n\tif(gatewayCallbacks.longPollTimeout !== undefined && gatewayCallbacks.longPollTimeout !== null)\n\t\tlongPollTimeout = gatewayCallbacks.longPollTimeout;\n\tif(isNaN(longPollTimeout))\n\t\tlongPollTimeout = 60000;\n\n\tvar connected = false;\n\tvar sessionId = null;\n\tvar pluginHandles = {};\n\tvar that = this;\n\tvar retries = 0;\n\tvar transactions = {};\n\tcreateSession(gatewayCallbacks);\n\n\t// Public methods\n\tthis.getServer = function() { return server; };\n\tthis.isConnected = function() { return connected; };\n\tthis.reconnect = function(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks[\"reconnect\"] = true;\n\t\tcreateSession(callbacks);\n\t};\n\tthis.getSessionId = function() { return sessionId; };\n\tthis.destroy = function(callbacks) { destroySession(callbacks); };\n\tthis.attach = function(callbacks) { createHandle(callbacks); };\n\n\tfunction eventHandler() {\n\t\tif(sessionId == null)\n\t\t\treturn;\n\t\tJanus.debug('Long poll...');\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar longpoll = server + \"/\" + sessionId + \"?rid=\" + new Date().getTime();\n\t\tif(maxev !== undefined && maxev !== null)\n\t\t\tlongpoll = longpoll + \"&maxev=\" + maxev;\n\t\tif(token !== null && token !== undefined)\n\t\t\tlongpoll = longpoll + \"&token=\" + encodeURIComponent(token);\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\tlongpoll = longpoll + \"&apisecret=\" + encodeURIComponent(apisecret);\n\t\tJanus.httpAPICall(longpoll, {\n\t\t\tverb: 'GET',\n\t\t\twithCredentials: withCredentials,\n\t\t\tsuccess: handleEvent,\n\t\t\ttimeout: longPollTimeout,\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\n\t\t\t\tretries++;\n\t\t\t\tif(retries > 3) {\n\t\t\t\t\t// Did we just lose the server? :-(\n\t\t\t\t\tconnected = false;\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\teventHandler();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private event handler: this will trigger plugin callbacks, if set\n\tfunction handleEvent(json, skipTimeout) {\n\t\tretries = 0;\n\t\tif(!websockets && sessionId !== undefined && sessionId !== null && skipTimeout !== true)\n\t\t\teventHandler();\n\t\tif(!websockets && Janus.isArray(json)) {\n\t\t\t// We got an array: it means we passed a maxev > 1, iterate on all objects\n\t\t\tfor(var i=0; i<json.length; i++) {\n\t\t\t\thandleEvent(json[i], true);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(json[\"janus\"] === \"keepalive\") {\n\t\t\t// Nothing happened\n\t\t\tJanus.vdebug(\"Got a keepalive on session \" + sessionId);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"ack\") {\n\t\t\t// Just an ack, we can probably ignore\n\t\t\tJanus.debug(\"Got an ack on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction !== null && transaction !== undefined) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\n\t\t\t\t\treportSuccess(json);\n\t\t\t\t}\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"success\") {\n\t\t\t// Success!\n\t\t\tJanus.debug(\"Got a success on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction !== null && transaction !== undefined) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\n\t\t\t\t\treportSuccess(json);\n\t\t\t\t}\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"trickle\") {\n\t\t\t// We got a trickle candidate from Janus\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar candidate = json[\"candidate\"];\n\t\t\tJanus.debug(\"Got a trickled candidate on session \" + sessionId);\n\t\t\tJanus.debug(candidate);\n\t\t\tvar config = pluginHandle.webrtcStuff;\n\t\t\tif(config.pc && config.remoteSdp) {\n\t\t\t\t// Add candidate right now\n\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t// end-of-candidates\n\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t} else {\n\t\t\t\t\t// New candidate\n\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We didn't do setRemoteDescription (trickle got here before the offer?)\n\t\t\t\tJanus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n\t\t\t\tif(!config.candidates)\n\t\t\t\t\tconfig.candidates = [];\n\t\t\t\tconfig.candidates.push(candidate);\n\t\t\t\tJanus.debug(config.candidates);\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"webrtcup\") {\n\t\t\t// The PeerConnection with the server is up! Notify this\n\t\t\tJanus.debug(\"Got a webrtcup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(true);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"hangup\") {\n\t\t\t// A plugin asked the core to hangup a PeerConnection on one of our handles\n\t\t\tJanus.debug(\"Got a hangup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(false, json[\"reason\"]);\n\t\t\tpluginHandle.hangup();\n\t\t} else if(json[\"janus\"] === \"detached\") {\n\t\t\t// A plugin asked the core to detach one of our handles\n\t\t\tJanus.debug(\"Got a detached event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\t// Don't warn here because destroyHandle causes this situation.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.detached = true;\n\t\t\tpluginHandle.ondetached();\n\t\t\tpluginHandle.detach();\n\t\t} else if(json[\"janus\"] === \"media\") {\n\t\t\t// Media started/stopped flowing\n\t\t\tJanus.debug(\"Got a media event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.mediaState(json[\"type\"], json[\"receiving\"]);\n\t\t} else if(json[\"janus\"] === \"slowlink\") {\n\t\t\tJanus.debug(\"Got a slowlink event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\t// Trouble uplink or downlink\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.slowLink(json[\"uplink\"], json[\"lost\"]);\n\t\t} else if(json[\"janus\"] === \"error\") {\n\t\t\t// Oops, something wrong happened\n\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction !== null && transaction !== undefined) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\n\t\t\t\t\treportSuccess(json);\n\t\t\t\t}\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"event\") {\n\t\t\tJanus.debug(\"Got a plugin event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(sender === undefined || sender === null) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\tif(plugindata === undefined || plugindata === null) {\n\t\t\t\tJanus.warn(\"Missing plugindata...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tJanus.debug(\"  -- Event is coming from \" + sender + \" (\" + plugindata[\"plugin\"] + \")\");\n\t\t\tvar data = plugindata[\"data\"];\n\t\t\tJanus.debug(data);\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\n\t\t\t\tJanus.warn(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar jsep = json[\"jsep\"];\n\t\t\tif(jsep !== undefined && jsep !== null) {\n\t\t\t\tJanus.debug(\"Handling SDP as well...\");\n\t\t\t\tJanus.debug(jsep);\n\t\t\t}\n\t\t\tvar callback = pluginHandle.onmessage;\n\t\t\tif(callback !== null && callback !== undefined) {\n\t\t\t\tJanus.debug(\"Notifying application...\");\n\t\t\t\t// Send to callback specified when attaching plugin handle\n\t\t\t\tcallback(data, jsep);\n\t\t\t} else {\n\t\t\t\t// Send to generic callback (?)\n\t\t\t\tJanus.debug(\"No provided notification callback\");\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"timeout\") {\n\t\t\tJanus.error(\"Timeout on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tif (websockets) {\n\t\t\t\tws.close(3504, \"Gateway timeout\");\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tJanus.warn(\"Unknown message/event  '\" + json[\"janus\"] + \"' on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t}\n\t}\n\n\t// Private helper to send keep-alive messages on WebSockets\n\tfunction keepAlive() {\n\t\tif(server === null || !websockets || !connected)\n\t\t\treturn;\n\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\tvar request = { \"janus\": \"keepalive\", \"session_id\": sessionId, \"transaction\": Janus.randomString(12) };\n\t\tif(token !== null && token !== undefined)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tws.send(JSON.stringify(request));\n\t}\n\n\t// Private method to create a session\n\tfunction createSession(callbacks) {\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"create\", \"transaction\": transaction };\n\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t// We're reconnecting, claim the session\n\t\t\tconnected = false;\n\t\t\trequest[\"janus\"] = \"claim\";\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t// If we were using websockets, ignore the old connection\n\t\t\tif(ws) {\n\t\t\t\tws.onopen = null;\n\t\t\t\tws.onerror = null;\n\t\t\t\tws.onclose = null;\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t\twsKeepaliveTimeoutId = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(token !== null && token !== undefined)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(server === null && Janus.isArray(servers)) {\n\t\t\t// We still need to find a working server from the list we were given\n\t\t\tserver = servers[serversIndex];\n\t\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\t\twebsockets = true;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying WebSockets to contact Janus (\" + server + \")\");\n\t\t\t} else {\n\t\t\t\twebsockets = false;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying REST API to contact Janus (\" + server + \")\");\n\t\t\t}\n\t\t}\n\t\tif(websockets) {\n\t\t\tws = Janus.newWebSocket(server, 'janus-protocol');\n\t\t\twsHandlers = {\n\t\t\t\t'error': function() {\n\t\t\t\t\tJanus.error(\"Error connecting to the Janus WebSockets server... \" + server);\n\t\t\t\t\tif (Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\t\tserversIndex++;\n\t\t\t\t\t\tif (serversIndex == servers.length) {\n\t\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Let's try the next server\n\t\t\t\t\t\tserver = null;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tcreateSession(callbacks);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallbacks.error(\"Error connecting to the Janus WebSockets server: Is the server down?\");\n\t\t\t\t},\n\n\t\t\t\t'open': function() {\n\t\t\t\t\t// We need to be notified about the success\n\t\t\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\t\t\tJanus.debug(json);\n\t\t\t\t\t\tif (json[\"janus\"] !== \"success\") {\n\t\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\t\t\t\t\tconnected = true;\n\t\t\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t};\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t},\n\n\t\t\t\t'message': function(event) {\n\t\t\t\t\thandleEvent(JSON.parse(event.data));\n\t\t\t\t},\n\n\t\t\t\t'close': function() {\n\t\t\t\t\tif (server === null || !connected) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconnected = false;\n\t\t\t\t\t// FIXME What if this is called when the page is closed?\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\tws.addEventListener(eventName, wsHandlers[eventName]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconnected = true;\n\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t}\n\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\teventHandler();\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\tserversIndex++;\n\t\t\t\t\tif(serversIndex == servers.length) {\n\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Let's try the next server\n\t\t\t\t\tserver = null;\n\t\t\t\t\tsetTimeout(function() { createSession(callbacks); }, 200);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to destroy a session\n\tfunction destroySession(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\t// FIXME This method triggers a success even when we fail\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tvar asyncRequest = true;\n\t\tif(callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\n\t\t\tasyncRequest = (callbacks.asyncRequest === true);\n\t\tvar notifyDestroyed = true;\n\t\tif(callbacks.notifyDestroyed !== undefined && callbacks.notifyDestroyed !== null)\n\t\t\tnotifyDestroyed = (callbacks.notifyDestroyed === true);\n\t\tvar cleanupHandles = false;\n\t\tif(callbacks.cleanupHandles !== undefined && callbacks.cleanupHandles !== null)\n\t\t\tcleanupHandles = (callbacks.cleanupHandles === true);\n\t\tJanus.log(\"Destroying session \" + sessionId + \" (async=\" + asyncRequest + \")\");\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(sessionId === undefined || sessionId === null) {\n\t\t\tJanus.warn(\"No session to destroy\");\n\t\t\tcallbacks.success();\n\t\t\tif(notifyDestroyed)\n\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\treturn;\n\t\t}\n\t\tif(cleanupHandles) {\n\t\t\tfor(var handleId in pluginHandles)\n\t\t\t\tdestroyHandle(handleId, { noRequest: true });\n\t\t}\n\t\t// No need to destroy all handles first, Janus will do that itself\n\t\tvar request = { \"janus\": \"destroy\", \"transaction\": Janus.randomString(12) };\n\t\tif(token !== null && token !== undefined)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\n\t\t\tvar unbindWebSocket = function() {\n\t\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\t\tws.removeEventListener(eventName, wsHandlers[eventName]);\n\t\t\t\t}\n\t\t\t\tws.removeEventListener('message', onUnbindMessage);\n\t\t\t\tws.removeEventListener('error', onUnbindError);\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t}\n\t\t\t\tws.close();\n\t\t\t};\n\n\t\t\tvar onUnbindMessage = function(event){\n\t\t\t\tvar data = JSON.parse(event.data);\n\t\t\t\tif(data.session_id == request.session_id && data.transaction == request.transaction) {\n\t\t\t\t\tunbindWebSocket();\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar onUnbindError = function(event) {\n\t\t\t\tunbindWebSocket();\n\t\t\t\tcallbacks.error(\"Failed to destroy the server: Is the server down?\");\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t};\n\n\t\t\tws.addEventListener('message', onUnbindMessage);\n\t\t\tws.addEventListener('error', onUnbindError);\n\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\tasync: asyncRequest,\t// Sometimes we need false here, or destroying in onbeforeunload won't work\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed session:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// Reset everything anyway\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a plugin handle\n\tfunction createHandle(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.consentDialog = (typeof callbacks.consentDialog == \"function\") ? callbacks.consentDialog : Janus.noop;\n\t\tcallbacks.iceState = (typeof callbacks.iceState == \"function\") ? callbacks.iceState : Janus.noop;\n\t\tcallbacks.mediaState = (typeof callbacks.mediaState == \"function\") ? callbacks.mediaState : Janus.noop;\n\t\tcallbacks.webrtcState = (typeof callbacks.webrtcState == \"function\") ? callbacks.webrtcState : Janus.noop;\n\t\tcallbacks.slowLink = (typeof callbacks.slowLink == \"function\") ? callbacks.slowLink : Janus.noop;\n\t\tcallbacks.onmessage = (typeof callbacks.onmessage == \"function\") ? callbacks.onmessage : Janus.noop;\n\t\tcallbacks.onlocalstream = (typeof callbacks.onlocalstream == \"function\") ? callbacks.onlocalstream : Janus.noop;\n\t\tcallbacks.onremotestream = (typeof callbacks.onremotestream == \"function\") ? callbacks.onremotestream : Janus.noop;\n\t\tcallbacks.ondata = (typeof callbacks.ondata == \"function\") ? callbacks.ondata : Janus.noop;\n\t\tcallbacks.ondataopen = (typeof callbacks.ondataopen == \"function\") ? callbacks.ondataopen : Janus.noop;\n\t\tcallbacks.oncleanup = (typeof callbacks.oncleanup == \"function\") ? callbacks.oncleanup : Janus.noop;\n\t\tcallbacks.ondetached = (typeof callbacks.ondetached == \"function\") ? callbacks.ondetached : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar plugin = callbacks.plugin;\n\t\tif(plugin === undefined || plugin === null) {\n\t\t\tJanus.error(\"Invalid plugin\");\n\t\t\tcallbacks.error(\"Invalid plugin\");\n\t\t\treturn;\n\t\t}\n\t\tvar opaqueId = callbacks.opaqueId;\n\t\tvar handleToken = callbacks.token ? callbacks.token : token;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"attach\", \"plugin\": plugin, \"opaque_id\": opaqueId, \"transaction\": transaction };\n\t\tif(handleToken !== null && handleToken !== undefined)\n\t\t\trequest[\"token\"] = handleToken;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t}\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t};\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t}\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a message\n\tfunction sendMessage(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar message = callbacks.message;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"message\", \"body\": message, \"transaction\": transaction };\n\t\tif(pluginHandle.token !== null && pluginHandle.token !== undefined)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(jsep !== null && jsep !== undefined)\n\t\t\trequest.jsep = jsep;\n\t\tJanus.debug(\"Sending message to plugin (handle=\" + handleId + \"):\");\n\t\tJanus.debug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(plugindata === undefined || plugindata === null) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"] !== undefined && json[\"error\"] !== null) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t};\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(plugindata === undefined || plugindata === null) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"] !== undefined && json[\"error\"] !== null) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a trickle candidate\n\tfunction sendTrickleCandidate(handleId, candidate) {\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"trickle\", \"candidate\": candidate, \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token !== null && pluginHandle.token !== undefined)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tJanus.vdebug(\"Sending trickle candidate (handle=\" + handleId + \"):\");\n\t\tJanus.vdebug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.vdebug(\"Candidate sent!\");\n\t\t\t\tJanus.vdebug(json);\n\t\t\t\tif(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a data channel\n\tfunction createDataChannel(handleId, dclabel, incoming, pendingText) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar onDataChannelMessage = function(event) {\n\t\t\tJanus.log('Received message on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tpluginHandle.ondata(event.data, label);\n\t\t}\n\t\tvar onDataChannelStateChange = function(event) {\n\t\t\tJanus.log('Received state change on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tvar dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : \"null\";\n\t\t\tJanus.log('State change on <' + label + '> data channel: ' + dcState);\n\t\t\tif(dcState === 'open') {\n\t\t\t\t// Any pending messages to send?\n\t\t\t\tif(config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n\t\t\t\t\tJanus.log(\"Sending pending messages on <\" + label + \">:\", config.dataChannel[label].pending.length);\n\t\t\t\t\tfor(var i in config.dataChannel[label].pending) {\n\t\t\t\t\t\tvar text = config.dataChannel[label].pending[i];\n\t\t\t\t\t\tJanus.log(\"Sending string on data channel <\" + label + \">: \" + text);\n\t\t\t\t\t\tconfig.dataChannel[label].send(text);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.dataChannel[label].pending = [];\n\t\t\t\t}\n\t\t\t\t// Notify the open data channel\n\t\t\t\tpluginHandle.ondataopen(label);\n\t\t\t}\n\t\t}\n\t\tvar onDataChannelError = function(error) {\n\t\t\tJanus.error('Got error on data channel:', error);\n\t\t\t// TODO\n\t\t}\n\t\tif(!incoming) {\n\t\t\t// FIXME Add options (ordered, maxRetransmits, etc.)\n\t\t\tconfig.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, {ordered:false});\n\t\t} else {\n\t\t\t// The channel was created by Janus\n\t\t\tconfig.dataChannel[dclabel] = incoming;\n\t\t}\n\t\tconfig.dataChannel[dclabel].onmessage = onDataChannelMessage;\n\t\tconfig.dataChannel[dclabel].onopen = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onclose = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onerror = onDataChannelError;\n\t\tconfig.dataChannel[dclabel].pending = [];\n\t\tif(pendingText)\n\t\t\tconfig.dataChannel[dclabel].pending.push(pendingText);\n\t}\n\n\t// Private method to send a data channel message\n\tfunction sendData(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar text = callbacks.text;\n\t\tif(text === null || text === undefined) {\n\t\t\tJanus.warn(\"Invalid text\");\n\t\t\tcallbacks.error(\"Invalid text\");\n\t\t\treturn;\n\t\t}\n\t\tvar label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n\t\tif(!config.dataChannel[label]) {\n\t\t\t// Create new data channel and wait for it to open\n\t\t\tcreateDataChannel(handleId, label, false, text);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(config.dataChannel[label].readyState !== \"open\") {\n\t\t\tconfig.dataChannel[label].pending.push(text);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.log(\"Sending string on data channel <\" + label + \">: \" + text);\n\t\tconfig.dataChannel[label].send(text);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to send a DTMF tone\n\tfunction sendDtmf(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config.dtmfSender === null || config.dtmfSender === undefined) {\n\t\t\t// Create the DTMF sender the proper way, if possible\n\t\t\tif(config.pc !== undefined && config.pc !== null) {\n\t\t\t\tvar senders = config.pc.getSenders();\n\t\t\t\tvar audioSender = senders.find(function(sender) {\n\t\t\t\t\treturn sender.track && sender.track.kind === 'audio';\n\t\t\t\t});\n\t\t\t\tif(!audioSender) {\n\t\t\t\t\tJanus.warn(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\tcallbacks.error(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconfig.dtmfSender = audioSender.dtmf;\n\t\t\t\tif(config.dtmfSender) {\n\t\t\t\t\tJanus.log(\"Created DTMF Sender\");\n\t\t\t\t\tconfig.dtmfSender.ontonechange = function(tone) { Janus.debug(\"Sent DTMF tone: \" + tone.tone); };\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(config.dtmfSender === null || config.dtmfSender === undefined) {\n\t\t\t\tJanus.warn(\"Invalid DTMF configuration\");\n\t\t\t\tcallbacks.error(\"Invalid DTMF configuration\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tvar dtmf = callbacks.dtmf;\n\t\tif(dtmf === null || dtmf === undefined) {\n\t\t\tJanus.warn(\"Invalid DTMF parameters\");\n\t\t\tcallbacks.error(\"Invalid DTMF parameters\");\n\t\t\treturn;\n\t\t}\n\t\tvar tones = dtmf.tones;\n\t\tif(tones === null || tones === undefined) {\n\t\t\tJanus.warn(\"Invalid DTMF string\");\n\t\t\tcallbacks.error(\"Invalid DTMF string\");\n\t\t\treturn;\n\t\t}\n\t\tvar duration = dtmf.duration;\n\t\tif(duration === null || duration === undefined)\n\t\t\tduration = 500;\t// We choose 500ms as the default duration for a tone\n\t\tvar gap = dtmf.gap;\n\t\tif(gap === null || gap === undefined)\n\t\t\tgap = 50;\t// We choose 50ms as the default gap between tones\n\t\tJanus.debug(\"Sending DTMF string \" + tones + \" (duration \" + duration + \"ms, gap \" + gap + \"ms)\");\n\t\tconfig.dtmfSender.insertDTMF(tones, duration, gap);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to destroy a plugin handle\n\tfunction destroyHandle(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar asyncRequest = true;\n\t\tif(callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\n\t\t\tasyncRequest = (callbacks.asyncRequest === true);\n\t\tvar noRequest = true;\n\t\tif(callbacks.noRequest !== undefined && callbacks.noRequest !== null)\n\t\t\tnoRequest = (callbacks.noRequest === true);\n\t\tJanus.log(\"Destroying handle \" + handleId + \" (async=\" + asyncRequest + \")\");\n\t\tcleanupWebrtc(handleId);\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined || pluginHandle.detached) {\n\t\t\t// Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(noRequest) {\n\t\t\t// We're only removing the handle locally\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"detach\", \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token !== null && pluginHandle.token !== undefined)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\tasync: asyncRequest,\t// Sometimes we need false here, or destroying in onbeforeunload won't work\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed handle:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// We cleanup anyway\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t}\n\t\t});\n\t}\n\n\t// WebRTC stuff\n\tfunction streamsDone(handleId, jsep, media, callbacks, stream) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.debug(\"streamsDone:\", stream);\n\t\tif(stream) {\n\t\t\tJanus.debug(\"  -- Audio tracks:\", stream.getAudioTracks());\n\t\t\tJanus.debug(\"  -- Video tracks:\", stream.getVideoTracks());\n\t\t}\n\t\t// We're now capturing the new stream: check if we're updating or if it's a new thing\n\t\tvar addTracks = false;\n\t\tif(!config.myStream || !media.update || config.streamExternal) {\n\t\t\tconfig.myStream = stream;\n\t\t\taddTracks = true;\n\t\t} else {\n\t\t\t// We only need to update the existing stream\n\t\t\tif(((!media.update && isAudioSendEnabled(media)) || (media.update && (media.addAudio || media.replaceAudio))) &&\n\t\t\t\t\tstream.getAudioTracks() && stream.getAudioTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tvar audioTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var i in transceivers) {\n\t\t\t\t\t\t\tvar t = transceivers[i];\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(audioTransceiver && audioTransceiver.sender) {\n\t\t\t\t\t\taudioTransceiver.sender.replaceTrack(stream.getAudioTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(((!media.update && isVideoSendEnabled(media)) || (media.update && (media.addVideo || media.replaceVideo))) &&\n\t\t\t\t\tstream.getVideoTracks() && stream.getVideoTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getVideoTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tvar videoTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var i in transceivers) {\n\t\t\t\t\t\t\tvar t = transceivers[i];\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(videoTransceiver && videoTransceiver.sender) {\n\t\t\t\t\t\tvideoTransceiver.sender.replaceTrack(stream.getVideoTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// If we still need to create a PeerConnection, let's do that\n\t\tif(!config.pc) {\n\t\t\tvar pc_config = {\"iceServers\": iceServers, \"iceTransportPolicy\": iceTransportPolicy, \"bundlePolicy\": bundlePolicy};\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t// For Chrome versions before 72, we force a plan-b semantic, and unified-plan otherwise\n\t\t\t\tpc_config[\"sdpSemantics\"] = (Janus.webRTCAdapter.browserDetails.version < 72) ? \"plan-b\" : \"unified-plan\";\n\t\t\t}\n\t\t\tvar pc_constraints = {\n\t\t\t\t\"optional\": [{\"DtlsSrtpKeyAgreement\": true}]\n\t\t\t};\n\t\t\tif(ipv6Support === true) {\n\t\t\t\tpc_constraints.optional.push({\"googIPv6\":true});\n\t\t\t}\n\t\t\t// Any custom constraint to add?\n\t\t\tif(callbacks.rtcConstraints && typeof callbacks.rtcConstraints === 'object') {\n\t\t\t\tJanus.debug(\"Adding custom PeerConnection constraints:\", callbacks.rtcConstraints);\n\t\t\t\tfor(var i in callbacks.rtcConstraints) {\n\t\t\t\t\tpc_constraints.optional.push(callbacks.rtcConstraints[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\t\t// This is Edge, enable BUNDLE explicitly\n\t\t\t\tpc_config.bundlePolicy = \"max-bundle\";\n\t\t\t}\n\t\t\tJanus.log(\"Creating PeerConnection\");\n\t\t\tJanus.debug(pc_constraints);\n\t\t\tconfig.pc = new RTCPeerConnection(pc_config, pc_constraints);\n\t\t\tJanus.debug(config.pc);\n\t\t\tif(config.pc.getStats) {\t// FIXME\n\t\t\t\tconfig.volume = {};\n\t\t\t\tconfig.bitrate.value = \"0 kbits/sec\";\n\t\t\t}\n\t\t\tJanus.log(\"Preparing local SDP and gathering candidates (trickle=\" + config.trickle + \")\");\n\t\t\tconfig.pc.oniceconnectionstatechange = function(e) {\n\t\t\t\tif(config.pc)\n\t\t\t\t\tpluginHandle.iceState(config.pc.iceConnectionState);\n\t\t\t};\n\t\t\tconfig.pc.onicecandidate = function(event) {\n\t\t\t\tif (event.candidate == null ||\n\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === 'edge' && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n\t\t\t\t\tJanus.log(\"End of candidates.\");\n\t\t\t\t\tconfig.iceDone = true;\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Notify end of candidates\n\t\t\t\t\t\tsendTrickleCandidate(handleId, {\"completed\": true});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// No trickle, time to send the complete SDP (including all candidates)\n\t\t\t\t\t\tsendSDP(handleId, callbacks);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\t\tvar candidate = {\n\t\t\t\t\t\t\"candidate\": event.candidate.candidate,\n\t\t\t\t\t\t\"sdpMid\": event.candidate.sdpMid,\n\t\t\t\t\t\t\"sdpMLineIndex\": event.candidate.sdpMLineIndex\n\t\t\t\t\t};\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Send candidate\n\t\t\t\t\t\tsendTrickleCandidate(handleId, candidate);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tconfig.pc.ontrack = function(event) {\n\t\t\t\tJanus.log(\"Handling Remote Track\");\n\t\t\t\tJanus.debug(event);\n\t\t\t\tif(!event.streams)\n\t\t\t\t\treturn;\n\t\t\t\tconfig.remoteStream = event.streams[0];\n\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\tif(event.track.onended)\n\t\t\t\t\treturn;\n\t\t\t\tJanus.log(\"Adding onended callback to track:\", event.track);\n\t\t\t\tevent.track.onended = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track muted/removed:\", ev);\n\t\t\t\t\tif(config.remoteStream) {\n\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\n\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tevent.track.onmute = event.track.onended;\n\t\t\t\tevent.track.onunmute = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track flowing again:\", ev);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconfig.remoteStream.addTrack(ev.target);\n\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif(addTracks && stream !== null && stream !== undefined) {\n\t\t\tJanus.log('Adding local stream');\n\t\t\tvar simulcast2 = callbacks.simulcast2 === true ? true : false;\n\t\t\tstream.getTracks().forEach(function(track) {\n\t\t\t\tJanus.log('Adding local track:', track);\n\t\t\t\tif(!simulcast2) {\n\t\t\t\t\tconfig.pc.addTrack(track, stream);\n\t\t\t\t} else {\n\t\t\t\t\tif(track.kind === \"audio\") {\n\t\t\t\t\t\tconfig.pc.addTrack(track, stream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.log('Enabling rid-based simulcasting:', track);\n\t\t\t\t\t\tconfig.pc.addTransceiver(track, {\n\t\t\t\t\t\t\tdirection: \"sendrecv\",\n\t\t\t\t\t\t\tstreams: [stream],\n\t\t\t\t\t\t\tsendEncodings: [\n\t\t\t\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: 900000 },\n\t\t\t\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: 300000, scaleResolutionDownBy: 2 },\n\t\t\t\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: 100000, scaleResolutionDownBy: 4 }\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Any data channel to create?\n\t\tif(isDataEnabled(media) && !config.dataChannel[Janus.dataChanDefaultLabel]) {\n\t\t\tJanus.log(\"Creating data channel\");\n\t\t\tcreateDataChannel(handleId, Janus.dataChanDefaultLabel, false);\n\t\t\tconfig.pc.ondatachannel = function(event) {\n\t\t\t\tJanus.log(\"Data channel created by Janus:\", event);\n\t\t\t\tcreateDataChannel(handleId, event.channel.label, event.channel);\n\t\t\t};\n\t\t}\n\t\t// If there's a new local stream, let's notify the application\n\t\tif(config.myStream)\n\t\t\tpluginHandle.onlocalstream(config.myStream);\n\t\t// Create offer/answer now\n\t\tif(jsep === null || jsep === undefined) {\n\t\t\tcreateOffer(handleId, media, callbacks);\n\t\t} else {\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i in config.candidates) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Create the answer now\n\t\t\t\t\tcreateAnswer(handleId, media, callbacks);\n\t\t\t\t}, callbacks.error);\n\t\t}\n\t}\n\n\tfunction prepareWebrtc(handleId, offer, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tvar jsep = callbacks.jsep;\n\t\tif(offer && jsep) {\n\t\t\tJanus.error(\"Provided a JSEP to a createOffer\");\n\t\t\tcallbacks.error(\"Provided a JSEP to a createOffer\");\n\t\t\treturn;\n\t\t} else if(!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n\t\t\tJanus.error(\"A valid JSEP is required for createAnswer\");\n\t\t\tcallbacks.error(\"A valid JSEP is required for createAnswer\");\n\t\t\treturn;\n\t\t}\n\t\tcallbacks.media = callbacks.media || { audio: true, video: true };\n\t\tvar media = callbacks.media;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tconfig.trickle = isTrickleEnabled(callbacks.trickle);\n\t\t// Are we updating a session?\n\t\tif(config.pc === undefined || config.pc === null) {\n\t\t\t// Nope, new PeerConnection\n\t\t\tmedia.update = false;\n\t\t\tmedia.keepAudio = false;\n\t\t\tmedia.keepVideo = false;\n\t\t} else if(config.pc !== undefined && config.pc !== null) {\n\t\t\tJanus.log(\"Updating existing media session\");\n\t\t\tmedia.update = true;\n\t\t\t// Check if there's anything to add/remove/replace, or if we\n\t\t\t// can go directly to preparing the new SDP offer or answer\n\t\t\tif(callbacks.stream !== null && callbacks.stream !== undefined) {\n\t\t\t\t// External stream: is this the same as the one we were using before?\n\t\t\t\tif(callbacks.stream !== config.myStream) {\n\t\t\t\t\tJanus.log(\"Renegotiation involves a new external stream\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Check if there are changes on audio\n\t\t\t\tif(media.addAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.audioSend = false;\n\t\t\t\t} else if(media.replaceAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t}\n\t\t\t\tif(config.myStream === null || config.myStream === undefined) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(config.myStream.getAudioTracks() === null\n\t\t\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\n\t\t\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\n\t\t\t\t\t\t// No audio track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have an audio track: should we keep it as it is?\n\t\t\t\t\t\tif(isAudioSendEnabled(media) &&\n\t\t\t\t\t\t\t\t!media.removeAudio && !media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Check if there are changes on video\n\t\t\t\tif(media.addVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.videoSend = false;\n\t\t\t\t} else if(media.replaceVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t}\n\t\t\t\tif(config.myStream === null || config.myStream === undefined) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(config.myStream.getVideoTracks() === null\n\t\t\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\n\t\t\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\n\t\t\t\t\t\t// No video track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have a video track: should we keep it as it is?\n\t\t\t\t\t\tif(isVideoSendEnabled(media) &&\n\t\t\t\t\t\t\t\t!media.removeVideo && !media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Data channels can only be added\n\t\t\t\tif(media.addData)\n\t\t\t\t\tmedia.data = true;\n\t\t\t}\n\t\t\t// If we're updating and keeping all tracks, let's skip the getUserMedia part\n\t\t\tif((isAudioSendEnabled(media) && media.keepAudio) &&\n\t\t\t\t\t(isVideoSendEnabled(media) && media.keepVideo)) {\n\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, config.myStream);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t// If we're updating, check if we need to remove/replace one of the tracks\n\t\tif(media.update && !config.streamExternal) {\n\t\t\tif(media.removeAudio || media.replaceAudio) {\n\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\tvar s = config.myStream.getAudioTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing audio track:\", s);\n\t\t\t\t\tconfig.myStream.removeTrack(s);\n\t\t\t\t\ttry {\n\t\t\t\t\t\ts.stop();\n\t\t\t\t\t} catch(e) {};\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar ra = true;\n\t\t\t\t\tif(media.replaceAudio && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\tra = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(ra) {\n\t\t\t\t\t\tfor(var index in config.pc.getSenders()) {\n\t\t\t\t\t\t\tvar s = config.pc.getSenders()[index];\n\t\t\t\t\t\t\tif(s && s.track && s.track.kind === \"audio\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing audio sender:\", s);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(media.removeVideo || media.replaceVideo) {\n\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\tvar s = config.myStream.getVideoTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing video track:\", s);\n\t\t\t\t\tconfig.myStream.removeTrack(s);\n\t\t\t\t\ttry {\n\t\t\t\t\t\ts.stop();\n\t\t\t\t\t} catch(e) {};\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar rv = true;\n\t\t\t\t\tif(media.replaceVideo && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\trv = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(rv) {\n\t\t\t\t\t\tfor(var index in config.pc.getSenders()) {\n\t\t\t\t\t\t\tvar s = config.pc.getSenders()[index];\n\t\t\t\t\t\t\tif(s && s.track && s.track.kind === \"video\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing video sender:\", s);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Was a MediaStream object passed, or do we need to take care of that?\n\t\tif(callbacks.stream !== null && callbacks.stream !== undefined) {\n\t\t\tvar stream = callbacks.stream;\n\t\t\tJanus.log(\"MediaStream provided by the application\");\n\t\t\tJanus.debug(stream);\n\t\t\t// If this is an update, let's check if we need to release the previous stream\n\t\t\tif(media.update) {\n\t\t\t\tif(config.myStream && config.myStream !== callbacks.stream && !config.streamExternal) {\n\t\t\t\t\t// We're replacing a stream we captured ourselves with an external one\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Try a MediaStreamTrack.stop() for each track\n\t\t\t\t\t\tvar tracks = config.myStream.getTracks();\n\t\t\t\t\t\tfor(var i in tracks) {\n\t\t\t\t\t\t\tvar mst = tracks[i];\n\t\t\t\t\t\t\tJanus.log(mst);\n\t\t\t\t\t\t\tif(mst !== null && mst !== undefined)\n\t\t\t\t\t\t\t\tmst.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t// Do nothing if this fails\n\t\t\t\t\t}\n\t\t\t\t\tconfig.myStream = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Skip the getUserMedia part\n\t\t\tconfig.streamExternal = true;\n\t\t\tpluginHandle.consentDialog(false);\n\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\treturn;\n\t\t}\n\t\tif(isAudioSendEnabled(media) || isVideoSendEnabled(media)) {\n\t\t\tif(!Janus.isGetUserMediaAvailable()) {\n\t\t\t\tcallbacks.error(\"getUserMedia not available\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar constraints = { mandatory: {}, optional: []};\n\t\t\tpluginHandle.consentDialog(true);\n\t\t\tvar audioSupport = isAudioSendEnabled(media);\n\t\t\tif(audioSupport === true && media != undefined && media != null) {\n\t\t\t\tif(typeof media.audio === 'object') {\n\t\t\t\t\taudioSupport = media.audio;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar videoSupport = isVideoSendEnabled(media);\n\t\t\tif(videoSupport === true && media != undefined && media != null) {\n\t\t\t\tvar simulcast = callbacks.simulcast === true ? true : false;\n\t\t\t\tvar simulcast2 = callbacks.simulcast2 === true ? true : false;\n\t\t\t\tif((simulcast || simulcast2) && !jsep && (media.video === undefined || media.video === false))\n\t\t\t\t\tmedia.video = \"hires\";\n\t\t\t\tif(media.video && media.video != 'screen' && media.video != 'window') {\n\t\t\t\t\tif(typeof media.video === 'object') {\n\t\t\t\t\t\tvideoSupport = media.video;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar width = 0;\n\t\t\t\t\t\tvar height = 0, maxHeight = 0;\n\t\t\t\t\t\tif(media.video === 'lowres') {\n\t\t\t\t\t\t\t// Small resolution, 4:3\n\t\t\t\t\t\t\theight = 240;\n\t\t\t\t\t\t\tmaxHeight = 240;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'lowres-16:9') {\n\t\t\t\t\t\t\t// Small resolution, 16:9\n\t\t\t\t\t\t\theight = 180;\n\t\t\t\t\t\t\tmaxHeight = 180;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'hires' || media.video === 'hires-16:9' || media.video === 'hdres') {\n\t\t\t\t\t\t\t// High(HD) resolution is only 16:9\n\t\t\t\t\t\t\theight = 720;\n\t\t\t\t\t\t\tmaxHeight = 720;\n\t\t\t\t\t\t\twidth = 1280;\n\t\t\t\t\t\t} else if(media.video === 'fhdres') {\n\t\t\t\t\t\t\t// Full HD resolution is only 16:9\n\t\t\t\t\t\t\theight = 1080;\n\t\t\t\t\t\t\tmaxHeight = 1080;\n\t\t\t\t\t\t\twidth = 1920;\n\t\t\t\t\t\t} else if(media.video === '4kres') {\n\t\t\t\t\t\t\t// 4K resolution is only 16:9\n\t\t\t\t\t\t\theight = 2160;\n\t\t\t\t\t\t\tmaxHeight = 2160;\n\t\t\t\t\t\t\twidth = 3840;\n\t\t\t\t\t\t} else if(media.video === 'stdres') {\n\t\t\t\t\t\t\t// Normal resolution, 4:3\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth  = 640;\n\t\t\t\t\t\t} else if(media.video === 'stdres-16:9') {\n\t\t\t\t\t\t\t// Normal resolution, 16:9\n\t\t\t\t\t\t\theight = 360;\n\t\t\t\t\t\t\tmaxHeight = 360;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Default video setting is stdres 4:3\");\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Adding media constraint:\", media.video);\n\t\t\t\t\t\tvideoSupport = {\n\t\t\t\t\t\t\t'height': {'ideal': height},\n\t\t\t\t\t\t\t'width':  {'ideal': width}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tJanus.log(\"Adding video constraint:\", videoSupport);\n\t\t\t\t\t}\n\t\t\t\t} else if(media.video === 'screen' || media.video === 'window') {\n\t\t\t\t\tif(!media.screenshareFrameRate) {\n\t\t\t\t\t\tmedia.screenshareFrameRate = 3;\n\t\t\t\t\t}\n\t\t\t\t\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\t\t\t// The new experimental getDisplayMedia API is available, let's use that\n\t\t\t\t\t\t// https://groups.google.com/forum/#!topic/discuss-webrtc/Uf0SrR4uxzk\n\t\t\t\t\t\t// https://webrtchacks.com/chrome-screensharing-getdisplaymedia/\n\t\t\t\t\t\tnavigator.mediaDevices.getDisplayMedia({ video: true })\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tif(isAudioSendEnabled(media) && !media.keepAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// We're going to try and use the extension for Chrome 34+, the old approach\n\t\t\t\t\t// for older versions of Chrome, or the experimental support in Firefox 33+\n\t\t\t\t\tfunction callbackUserMedia (error, stream) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tif(error) {\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tfunction getScreenMedia(constraints, gsmCallback, useAudio) {\n\t\t\t\t\t\tJanus.log(\"Adding media constraint (screen capture)\");\n\t\t\t\t\t\tJanus.debug(constraints);\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tif(useAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(function(error) { pluginHandle.consentDialog(false); gsmCallback(error); });\n\t\t\t\t\t};\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\n\t\t\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\n\t\t\t\t\t\tvar maxver = 33;\n\t\t\t\t\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\t\t\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\t\t\t\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t\t\t\t\t// Chrome 26->33 requires some awkward chrome://flags manipulation\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\tgoogLeakyBucket: true,\n\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Chrome 34+ requires an extension\n\t\t\t\t\t\t\tJanus.extension.getScreen(function (error, sourceId) {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\t\treturn callbacks.error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\toptional: [\n\t\t\t\t\t\t\t\t\t\t\t{googLeakyBucket: true},\n\t\t\t\t\t\t\t\t\t\t\t{googTemporalLayeredScreencast: true}\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tconstraints.video.mandatory.chromeMediaSourceId = sourceId;\n\t\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia,\n\t\t\t\t\t\t\t\t\tisAudioSendEnabled(media) && !media.keepAudio);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.version >= 33) {\n\t\t\t\t\t\t\t// Firefox 33+ has experimental support for screen sharing\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmozMediaSource: media.video,\n\t\t\t\t\t\t\t\t\tmediaSource: media.video\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, function (err, stream) {\n\t\t\t\t\t\t\t\tcallbackUserMedia(err, stream);\n\t\t\t\t\t\t\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\n\t\t\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\t\tvar lastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\tvar polly = window.setInterval(function () {\n\t\t\t\t\t\t\t\t\t\tif(!stream)\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\tif(stream.currentTime == lastTime) {\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\t\tif(stream.onended) {\n\t\t\t\t\t\t\t\t\t\t\t\tstream.onended();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tlastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\t\t\terror.name = 'Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)';\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we got here, we're not screensharing\n\t\t\tif(media === null || media === undefined || media.video !== 'screen') {\n\t\t\t\t// Check whether all media sources are actually available or not\n\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\tvar audioExist = devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'audioinput';\n\t\t\t\t\t}),\n\t\t\t\t\tvideoExist = isScreenSendEnabled(media) || devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'videoinput';\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check whether a missing device is really a problem\n\t\t\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\t\t\tvar needAudioDevice = isAudioSendRequired(media);\n\t\t\t\t\tvar needVideoDevice = isVideoSendRequired(media);\n\t\t\t\t\tif(audioSend || videoSend || needAudioDevice || needVideoDevice) {\n\t\t\t\t\t\t// We need to send either audio or video\n\t\t\t\t\t\tvar haveAudioDevice = audioSend ? audioExist : false;\n\t\t\t\t\t\tvar haveVideoDevice = videoSend ? videoExist : false;\n\t\t\t\t\t\tif(!haveAudioDevice && !haveVideoDevice) {\n\t\t\t\t\t\t\t// FIXME Should we really give up, or just assume recvonly for both?\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('No capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveAudioDevice && needAudioDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Audio capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveVideoDevice && needVideoDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Video capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar gumConstraints = {\n\t\t\t\t\t\taudio: (audioExist && !media.keepAudio) ? audioSupport : false,\n\t\t\t\t\t\tvideo: (videoExist && !media.keepVideo) ? videoSupport : false\n\t\t\t\t\t};\n\t\t\t\t\tJanus.debug(\"getUserMedia constraints\", gumConstraints);\n\t\t\t\t\tif (!gumConstraints.audio && !gumConstraints.video) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(gumConstraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error({code: error.code, name: error.name, message: error.message});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\tcallbacks.error('enumerateDevices error', error);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// No need to do a getUserMedia, create offer/answer right away\n\t\t\tstreamsDone(handleId, jsep, media, callbacks);\n\t\t}\n\t}\n\n\tfunction prepareWebrtcPeer(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(jsep !== undefined && jsep !== null) {\n\t\t\tif(config.pc === null) {\n\t\t\t\tJanus.warn(\"Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\tcallbacks.error(\"No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i in config.candidates) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Done\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t}, callbacks.error);\n\t\t} else {\n\t\t\tcallbacks.error(\"Invalid JSEP\");\n\t\t}\n\t}\n\n\tfunction createOffer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = callbacks.simulcast === true ? true : false;\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\t// https://code.google.com/p/webrtc/issues/detail?id=3508\n\t\tvar mediaConstraints = {};\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var i in transceivers) {\n\t\t\t\t\tvar t = transceivers[i];\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver)\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver)\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmediaConstraints[\"offerToReceiveAudio\"] = isAudioRecvEnabled(media);\n\t\t\tmediaConstraints[\"offerToReceiveVideo\"] = isVideoRecvEnabled(media);\n\t\t}\n\t\tvar iceRestart = callbacks.iceRestart === true ? true : false;\n\t\tif(iceRestart) {\n\t\t\tmediaConstraints[\"iceRestart\"] = true;\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders().find(function(s) {return s.track.kind == \"video\"});\n\t\t\tif(sender) {\n\t\t\t\tvar parameters = sender.getParameters();\n\t\t\t\tif(!parameters)\n\t\t\t\t\tparameters = {};\n\t\t\t\tparameters.encodings = [\n\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: 900000 },\n\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: 300000, scaleResolutionDownBy: 2 },\n\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: 100000, scaleResolutionDownBy: 4 }\n\t\t\t\t];\n\t\t\t\tsender.setParameters(parameters);\n\t\t\t}\n\t\t}\n\t\tconfig.pc.createOffer(mediaConstraints)\n\t\t\t.then(function(offer) {\n\t\t\t\tJanus.debug(offer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": offer.type,\n\t\t\t\t\t\"sdp\": offer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\toffer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome (Safari STP may support it too)\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\") {\n\t\t\t\t\t\tJanus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\toffer.sdp = mungeSdpForSimulcasting(offer.sdp);\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = offer.sdp;\n\t\t\t\tconfig.pc.setLocalDescription(offer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tJanus.log(\"Offer ready\");\n\t\t\t\tJanus.debug(callbacks);\n\t\t\t\tcallbacks.success(offer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction createAnswer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = callbacks.simulcast === true ? true : false;\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\tvar mediaConstraints = null;\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tmediaConstraints = {};\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var i in transceivers) {\n\t\t\t\t\tvar t = transceivers[i];\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver)\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver)\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"firefox\" || Janus.webRTCAdapter.browserDetails.browser == \"edge\") {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tofferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\tofferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tOfferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\t\tOfferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders()[1];\n\t\t\tJanus.log(sender);\n\t\t\tvar parameters = sender.getParameters();\n\t\t\tJanus.log(parameters);\n\t\t\tsender.setParameters({encodings: [\n\t\t\t\t{ rid: \"high\", active: true, priority: \"high\", maxBitrate: 1000000 },\n\t\t\t\t{ rid: \"medium\", active: true, priority: \"medium\", maxBitrate: 300000 },\n\t\t\t\t{ rid: \"low\", active: true, priority: \"low\", maxBitrate: 100000 }\n\t\t\t]});\n\t\t}\n\t\tconfig.pc.createAnswer(mediaConstraints)\n\t\t\t.then(function(answer) {\n\t\t\t\tJanus.debug(answer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": answer.type,\n\t\t\t\t\t\"sdp\": answer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\tanswer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t\t\t// FIXME Apparently trying to simulcast when answering breaks video in Chrome...\n\t\t\t\t\t\t//~ Janus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\t//~ answer.sdp = mungeSdpForSimulcasting(answer.sdp);\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is an answer, and video breaks in Chrome if we enable it\");\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = answer.sdp;\n\t\t\t\tconfig.pc.setLocalDescription(answer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcallbacks.success(answer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction sendSDP(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle, not sending anything\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.log(\"Sending offer/answer SDP...\");\n\t\tif(config.mySdp === null || config.mySdp === undefined) {\n\t\t\tJanus.warn(\"Local SDP instance is invalid, not sending anything...\");\n\t\t\treturn;\n\t\t}\n\t\tconfig.mySdp = {\n\t\t\t\"type\": config.pc.localDescription.type,\n\t\t\t\"sdp\": config.pc.localDescription.sdp\n\t\t};\n\t\tif(config.trickle === false)\n\t\t\tconfig.mySdp[\"trickle\"] = false;\n\t\tJanus.debug(callbacks);\n\t\tconfig.sdpSent = true;\n\t\tcallbacks.success(config.mySdp);\n\t}\n\n\tfunction getVolume(handleId, remote) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn 0;\n\t\t}\n\t\tvar stream = remote ? \"remote\" : \"local\";\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.volume[stream])\n\t\t\tconfig.volume[stream] = { value: 0 };\n\t\t// Start getting the volume, if getStats is supported\n\t\tif(config.pc.getStats && Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\tif(remote && (config.remoteStream === null || config.remoteStream === undefined)) {\n\t\t\t\tJanus.warn(\"Remote stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t} else if(!remote && (config.myStream === null || config.myStream === undefined)) {\n\t\t\t\tJanus.warn(\"Local stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(config.volume[stream].timer === null || config.volume[stream].timer === undefined) {\n\t\t\t\tJanus.log(\"Starting \" + stream + \" volume monitor\");\n\t\t\t\tconfig.volume[stream].timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats(function(stats) {\n\t\t\t\t\t\tvar results = stats.result();\n\t\t\t\t\t\tfor(var i=0; i<results.length; i++) {\n\t\t\t\t\t\t\tvar res = results[i];\n\t\t\t\t\t\t\tif(res.type == 'ssrc') {\n\t\t\t\t\t\t\t\tif(remote && res.stat('audioOutputLevel'))\n\t\t\t\t\t\t\t\t\tconfig.volume[stream].value = parseInt(res.stat('audioOutputLevel'));\n\t\t\t\t\t\t\t\telse if(!remote && res.stat('audioInputLevel'))\n\t\t\t\t\t\t\t\t\tconfig.volume[stream].value = parseInt(res.stat('audioInputLevel'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t\treturn 0;\t// We don't have a volume to return yet\n\t\t\t}\n\t\t\treturn config.volume[stream].value;\n\t\t} else {\n\t\t\t// audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n\t\t\t// seems to be available on Chrome and Firefox, but they don't seem to work\n\t\t\tJanus.warn(\"Getting the \" + stream + \" volume unsupported by browser\");\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tfunction isMuted(handleId, video) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn true;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config.pc === null || config.pc === undefined) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn true;\n\t\t}\n\t\tif(config.myStream === undefined || config.myStream === null) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn true;\n\t\t}\n\t\tif(video) {\n\t\t\t// Check video track\n\t\t\tif(config.myStream.getVideoTracks() === null\n\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\n\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getVideoTracks()[0].enabled;\n\t\t} else {\n\t\t\t// Check audio track\n\t\t\tif(config.myStream.getAudioTracks() === null\n\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\n\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getAudioTracks()[0].enabled;\n\t\t}\n\t}\n\n\tfunction mute(handleId, video, mute) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn false;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config.pc === null || config.pc === undefined) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn false;\n\t\t}\n\t\tif(config.myStream === undefined || config.myStream === null) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn false;\n\t\t}\n\t\tif(video) {\n\t\t\t// Mute/unmute video track\n\t\t\tif(config.myStream.getVideoTracks() === null\n\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\n\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getVideoTracks()[0].enabled = mute ? false : true;\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// Mute/unmute audio track\n\t\t\tif(config.myStream.getAudioTracks() === null\n\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\n\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getAudioTracks()[0].enabled = mute ? false : true;\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction getBitrate(handleId) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn \"Invalid handle\";\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config.pc === null || config.pc === undefined)\n\t\t\treturn \"Invalid PeerConnection\";\n\t\t// Start getting the bitrate, if getStats is supported\n\t\tif(config.pc.getStats) {\n\t\t\tif(config.bitrate.timer === null || config.bitrate.timer === undefined) {\n\t\t\t\tJanus.log(\"Starting bitrate timer (via getStats)\");\n\t\t\t\tconfig.bitrate.timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats()\n\t\t\t\t\t\t.then(function(stats) {\n\t\t\t\t\t\t\tstats.forEach(function (res) {\n\t\t\t\t\t\t\t\tif(!res)\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tvar inStats = false;\n\t\t\t\t\t\t\t\t// Check if these are statistics on incoming media\n\t\t\t\t\t\t\t\tif((res.mediaType === \"video\" || res.id.toLowerCase().indexOf(\"video\") > -1) &&\n\t\t\t\t\t\t\t\t\t\tres.type === \"inbound-rtp\" && res.id.indexOf(\"rtcp\") < 0) {\n\t\t\t\t\t\t\t\t\t// New stats\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t} else if(res.type == 'ssrc' && res.bytesReceived &&\n\t\t\t\t\t\t\t\t\t\t(res.googCodecName === \"VP8\" || res.googCodecName === \"\")) {\n\t\t\t\t\t\t\t\t\t// Older Chromer versions\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Parse stats now\n\t\t\t\t\t\t\t\tif(inStats) {\n\t\t\t\t\t\t\t\t\tconfig.bitrate.bsnow = res.bytesReceived;\n\t\t\t\t\t\t\t\t\tconfig.bitrate.tsnow = res.timestamp;\n\t\t\t\t\t\t\t\t\tif(config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\n\t\t\t\t\t\t\t\t\t\t// Skip this round\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Calculate bitrate\n\t\t\t\t\t\t\t\t\t\tvar timePassed = config.bitrate.tsnow - config.bitrate.tsbefore;\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"safari\")\n\t\t\t\t\t\t\t\t\t\t\ttimePassed = timePassed/1000;\t// Apparently the timestamp is in microseconds, in Safari\n\t\t\t\t\t\t\t\t\t\tvar bitRate = Math.round((config.bitrate.bsnow - config.bitrate.bsbefore) * 8 / timePassed);\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'safari')\n\t\t\t\t\t\t\t\t\t\t\tbitRate = parseInt(bitRate/1000);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.value = bitRate + ' kbits/sec';\n\t\t\t\t\t\t\t\t\t\t//~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t\treturn \"0 kbits/sec\";\t// We don't have a bitrate value yet\n\t\t\t}\n\t\t\treturn config.bitrate.value;\n\t\t} else {\n\t\t\tJanus.warn(\"Getting the video bitrate unsupported by browser\");\n\t\t\treturn \"Feature unsupported by browser\";\n\t\t}\n\t}\n\n\tfunction webrtcError(error) {\n\t\tJanus.error(\"WebRTC error:\", error);\n\t}\n\n\tfunction cleanupWebrtc(handleId, hangupRequest) {\n\t\tJanus.log(\"Cleaning WebRTC stuff\");\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(pluginHandle === null || pluginHandle === undefined) {\n\t\t\t// Nothing to clean\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config !== null && config !== undefined) {\n\t\t\tif(hangupRequest === true) {\n\t\t\t\t// Send a hangup request (we don't really care about the response)\n\t\t\t\tvar request = { \"janus\": \"hangup\", \"transaction\": Janus.randomString(12) };\n\t\t\t\tif(pluginHandle.token !== null && pluginHandle.token !== undefined)\n\t\t\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\t\t\tif(apisecret !== null && apisecret !== undefined)\n\t\t\t\t\trequest[\"apisecret\"] = apisecret;\n\t\t\t\tJanus.debug(\"Sending hangup request (handle=\" + handleId + \"):\");\n\t\t\t\tJanus.debug(request);\n\t\t\t\tif(websockets) {\n\t\t\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t} else {\n\t\t\t\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\t\t\t\tverb: 'POST',\n\t\t\t\t\t\twithCredentials: withCredentials,\n\t\t\t\t\t\tbody: request\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Cleanup stack\n\t\t\tconfig.remoteStream = null;\n\t\t\tif(config.volume) {\n\t\t\t\tif(config.volume[\"local\"] && config.volume[\"local\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"local\"].timer);\n\t\t\t\tif(config.volume[\"remote\"] && config.volume[\"remote\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"remote\"].timer);\n\t\t\t}\n\t\t\tconfig.volume = {};\n\t\t\tif(config.bitrate.timer)\n\t\t\t\tclearInterval(config.bitrate.timer);\n\t\t\tconfig.bitrate.timer = null;\n\t\t\tconfig.bitrate.bsnow = null;\n\t\t\tconfig.bitrate.bsbefore = null;\n\t\t\tconfig.bitrate.tsnow = null;\n\t\t\tconfig.bitrate.tsbefore = null;\n\t\t\tconfig.bitrate.value = null;\n\t\t\ttry {\n\t\t\t\t// Try a MediaStreamTrack.stop() for each track\n\t\t\t\tif(!config.streamExternal && config.myStream !== null && config.myStream !== undefined) {\n\t\t\t\t\tJanus.log(\"Stopping local stream tracks\");\n\t\t\t\t\tvar tracks = config.myStream.getTracks();\n\t\t\t\t\tfor(var i in tracks) {\n\t\t\t\t\t\tvar mst = tracks[i];\n\t\t\t\t\t\tJanus.log(mst);\n\t\t\t\t\t\tif(mst !== null && mst !== undefined)\n\t\t\t\t\t\t\tmst.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch(e) {\n\t\t\t\t// Do nothing if this fails\n\t\t\t}\n\t\t\tconfig.streamExternal = false;\n\t\t\tconfig.myStream = null;\n\t\t\t// Close PeerConnection\n\t\t\ttry {\n\t\t\t\tconfig.pc.close();\n\t\t\t} catch(e) {\n\t\t\t\t// Do nothing\n\t\t\t}\n\t\t\tconfig.pc = null;\n\t\t\tconfig.candidates = null;\n\t\t\tconfig.mySdp = null;\n\t\t\tconfig.remoteSdp = null;\n\t\t\tconfig.iceDone = false;\n\t\t\tconfig.dataChannel = {};\n\t\t\tconfig.dtmfSender = null;\n\t\t}\n\t\tpluginHandle.oncleanup();\n\t}\n\n\t// Helper method to munge an SDP to enable simulcasting (Chrome only)\n\tfunction mungeSdpForSimulcasting(sdp) {\n\t\t// Let's munge the SDP to add the attributes for enabling simulcasting\n\t\t// (based on https://gist.github.com/ggarber/a19b4c33510028b9c657)\n\t\tvar lines = sdp.split(\"\\r\\n\");\n\t\tvar video = false;\n\t\tvar ssrc = [ -1 ], ssrc_fid = [ -1 ];\n\t\tvar cname = null, msid = null, mslabel = null, label = null;\n\t\tvar insertAt = -1;\n\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\tif(mline) {\n\t\t\t\tvar medium = mline[1];\n\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(!video)\n\t\t\t\tcontinue;\n\t\t\tvar fid = lines[i].match(/a=ssrc-group:FID (\\d+) (\\d+)/);\n\t\t\tif(fid) {\n\t\t\t\tssrc[0] = fid[1];\n\t\t\t\tssrc_fid[0] = fid[2];\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(ssrc[0]) {\n\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tcname = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmsid = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmslabel = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tlabel = match[1];\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(lines[i].length == 0) {\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Couldn't find a FID attribute, let's just take the first video SSRC we find\n\t\t\tinsertAt = -1;\n\t\t\tvideo = false;\n\t\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\t\tif(mline) {\n\t\t\t\t\tvar medium = mline[1];\n\t\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(!video)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\tvar value = lines[i].match(/a=ssrc:(\\d+)/);\n\t\t\t\t\tif(value) {\n\t\t\t\t\t\tssrc[0] = value[1];\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tcname = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmsid = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmslabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tlabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(lines[i].length == 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Still nothing, let's just return the SDP we were asked to munge\n\t\t\tJanus.warn(\"Couldn't find the video SSRC, simulcasting NOT enabled\");\n\t\t\treturn sdp;\n\t\t}\n\t\tif(insertAt < 0) {\n\t\t\t// Append at the end\n\t\t\tinsertAt = lines.length;\n\t\t}\n\t\t// Generate a couple of SSRCs (for retransmissions too)\n\t\t// Note: should we check if there are conflicts, here?\n\t\tssrc[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\t// Add attributes to the SDP\n\t\tfor(var i=0; i<ssrc.length; i++) {\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\t// Add the same info for the retransmission SSRC\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t}\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[2] + ' ' + ssrc_fid[2]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[1] + ' ' + ssrc_fid[1]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[0] + ' ' + ssrc_fid[0]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:SIM ' + ssrc[0] + ' ' + ssrc[1] + ' ' + ssrc[2]);\n\t\tsdp = lines.join(\"\\r\\n\");\n\t\tif(!sdp.endsWith(\"\\r\\n\"))\n\t\t\tsdp += \"\\r\\n\";\n\t\treturn sdp;\n\t}\n\n\t// Helper methods to parse a media object\n\tfunction isAudioSendEnabled(media) {\n\t\tJanus.debug(\"isAudioSendEnabled:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioSend === undefined || media.audioSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioSend === true);\n\t}\n\n\tfunction isAudioSendRequired(media) {\n\t\tJanus.debug(\"isAudioSendRequired:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn false;\t// Default\n\t\tif(media.audio === false || media.audioSend === false)\n\t\t\treturn false;\t// If we're not asking to capture audio, it's not required\n\t\tif(media.failIfNoAudio === undefined || media.failIfNoAudio === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoAudio === true);\n\t}\n\n\tfunction isAudioRecvEnabled(media) {\n\t\tJanus.debug(\"isAudioRecvEnabled:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioRecv === undefined || media.audioRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioRecv === true);\n\t}\n\n\tfunction isVideoSendEnabled(media) {\n\t\tJanus.debug(\"isVideoSendEnabled:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoSend === undefined || media.videoSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoSend === true);\n\t}\n\n\tfunction isVideoSendRequired(media) {\n\t\tJanus.debug(\"isVideoSendRequired:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn false;\t// Default\n\t\tif(media.video === false || media.videoSend === false)\n\t\t\treturn false;\t// If we're not asking to capture video, it's not required\n\t\tif(media.failIfNoVideo === undefined || media.failIfNoVideo === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoVideo === true);\n\t}\n\n\tfunction isVideoRecvEnabled(media) {\n\t\tJanus.debug(\"isVideoRecvEnabled:\", media);\n\t\tif(media === undefined || media === null)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoRecv === undefined || media.videoRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoRecv === true);\n\t}\n\n\tfunction isScreenSendEnabled(media) {\n\t\tJanus.debug(\"isScreenSendEnabled:\", media);\n\t\tif (media === undefined || media === null)\n\t\t\treturn false;\n\t\tif (typeof media.video !== 'object' || typeof media.video.mandatory !== 'object')\n\t\t\treturn false;\n\t\tvar constraints = media.video.mandatory;\n\t\tif (constraints.chromeMediaSource)\n\t\t\treturn constraints.chromeMediaSource === 'desktop' || constraints.chromeMediaSource === 'screen';\n\t\telse if (constraints.mozMediaSource)\n\t\t\treturn constraints.mozMediaSource === 'window' || constraints.mozMediaSource === 'screen';\n\t\telse if (constraints.mediaSource)\n\t\t\treturn constraints.mediaSource === 'window' || constraints.mediaSource === 'screen';\n\t\treturn false;\n\t}\n\n\tfunction isDataEnabled(media) {\n\t\tJanus.debug(\"isDataEnabled:\", media);\n\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"edge\") {\n\t\t\tJanus.warn(\"Edge doesn't support data channels yet\");\n\t\t\treturn false;\n\t\t}\n\t\tif(media === undefined || media === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.data === true);\n\t}\n\n\tfunction isTrickleEnabled(trickle) {\n\t\tJanus.debug(\"isTrickleEnabled:\", trickle);\n\t\tif(trickle === undefined || trickle === null)\n\t\t\treturn true;\t// Default is true\n\t\treturn (trickle === true);\n\t}\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Janus);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGx1Z2lucy9qYW51cy5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9wbHVnaW5zL2phbnVzLmpzP2YyMmQiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgKi9cbi8qXG5cdFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuXG5cdENvcHlyaWdodCAoYykgMjAxNiBNZWV0ZWNob1xuXG5cdFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZ1xuXHRhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSxcblx0dG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvblxuXHR0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSxcblx0YW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlXG5cdFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblx0VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcblx0aW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblx0VEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuXHRPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcblx0RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTExcblx0VEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1Jcblx0T1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsXG5cdEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUlxuXHRPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4gKi9cblxuaW1wb3J0IGFkYXB0ZXIgZnJvbSAnd2VicnRjLWFkYXB0ZXInXG4vLyBMaXN0IG9mIHNlc3Npb25zXG5KYW51cy5zZXNzaW9ucyA9IHt9O1xuXG5KYW51cy5pc0V4dGVuc2lvbkVuYWJsZWQgPSBmdW5jdGlvbigpIHtcblx0aWYobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYSkge1xuXHRcdC8vIE5vIG5lZWQgZm9yIHRoZSBleHRlbnNpb24sIGdldERpc3BsYXlNZWRpYSBpcyBzdXBwb3J0ZWRcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRpZih3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgnQ2hyb21lJykpIHtcblx0XHR2YXIgY2hyb21ldmVyID0gcGFyc2VJbnQod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0Nocm9tZVxcLyguKikgLylbMV0sIDEwKTtcblx0XHR2YXIgbWF4dmVyID0gMzM7XG5cdFx0aWYod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goJ0xpbnV4JykpXG5cdFx0XHRtYXh2ZXIgPSAzNTtcdC8vIFwia25vd25cIiBjcmFzaCBpbiBjaHJvbWUgMzQgYW5kIDM1IG9uIGxpbnV4XG5cdFx0aWYoY2hyb21ldmVyID49IDI2ICYmIGNocm9tZXZlciA8PSBtYXh2ZXIpIHtcblx0XHRcdC8vIE9sZGVyIHZlcnNpb25zIG9mIENocm9tZSBkb24ndCBzdXBwb3J0IHRoaXMgZXh0ZW5zaW9uLWJhc2VkIGFwcHJvYWNoLCBzbyBsaWVcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHRyZXR1cm4gSmFudXMuZXh0ZW5zaW9uLmlzSW5zdGFsbGVkKCk7XG5cdH0gZWxzZSB7XG5cdFx0Ly8gRmlyZWZveCBvZiBvdGhlcnMsIG5vIG5lZWQgZm9yIHRoZSBleHRlbnNpb24gKGJ1dCB0aGlzIGRvZXNuJ3QgbWVhbiBpdCB3aWxsIHdvcmspXG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cbn07XG5cbnZhciBkZWZhdWx0RXh0ZW5zaW9uID0ge1xuXHQvLyBTY3JlZW5zaGFyaW5nIENocm9tZSBFeHRlbnNpb24gSURcblx0ZXh0ZW5zaW9uSWQ6ICdoYXBmZ2Zka2xlaWdnampwZnBlbmFqZ2RuZmNranBhaicsXG5cdGlzSW5zdGFsbGVkOiBmdW5jdGlvbigpIHsgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNqYW51cy1leHRlbnNpb24taW5zdGFsbGVkJykgIT09IG51bGw7IH0sXG5cdGdldFNjcmVlbjogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG5cdFx0dmFyIHBlbmRpbmcgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoJ05hdmlnYXRvclVzZXJNZWRpYUVycm9yJyk7XG5cdFx0XHRlcnJvci5uYW1lID0gJ1RoZSByZXF1aXJlZCBDaHJvbWUgZXh0ZW5zaW9uIGlzIG5vdCBpbnN0YWxsZWQ6IGNsaWNrIDxhIGhyZWY9XCIjXCI+aGVyZTwvYT4gdG8gaW5zdGFsbCBpdC4gKE5PVEU6IHRoaXMgd2lsbCBuZWVkIHlvdSB0byByZWZyZXNoIHRoZSBwYWdlKSc7XG5cdFx0XHRyZXR1cm4gY2FsbGJhY2soZXJyb3IpO1xuXHRcdH0sIDEwMDApO1xuXHRcdHRoaXMuY2FjaGVbcGVuZGluZ10gPSBjYWxsYmFjaztcblx0XHR3aW5kb3cucG9zdE1lc3NhZ2UoeyB0eXBlOiAnamFudXNHZXRTY3JlZW4nLCBpZDogcGVuZGluZyB9LCAnKicpO1xuXHR9LFxuXHRpbml0OiBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGNhY2hlID0ge307XG5cdFx0dGhpcy5jYWNoZSA9IGNhY2hlO1xuXHRcdC8vIFdhaXQgZm9yIGV2ZW50cyBmcm9tIHRoZSBDaHJvbWUgRXh0ZW5zaW9uXG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcblx0XHRcdGlmKGV2ZW50Lm9yaWdpbiAhPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luKVxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHRpZihldmVudC5kYXRhLnR5cGUgPT0gJ2phbnVzR290U2NyZWVuJyAmJiBjYWNoZVtldmVudC5kYXRhLmlkXSkge1xuXHRcdFx0XHR2YXIgY2FsbGJhY2sgPSBjYWNoZVtldmVudC5kYXRhLmlkXTtcblx0XHRcdFx0ZGVsZXRlIGNhY2hlW2V2ZW50LmRhdGEuaWRdO1xuXG5cdFx0XHRcdGlmIChldmVudC5kYXRhLnNvdXJjZUlkID09PSAnJykge1xuXHRcdFx0XHRcdC8vIHVzZXIgY2FuY2VsZWRcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoJ05hdmlnYXRvclVzZXJNZWRpYUVycm9yJyk7XG5cdFx0XHRcdFx0ZXJyb3IubmFtZSA9ICdZb3UgY2FuY2VsbGVkIHRoZSByZXF1ZXN0IGZvciBwZXJtaXNzaW9uLCBnaXZpbmcgdXAuLi4nO1xuXHRcdFx0XHRcdGNhbGxiYWNrKGVycm9yKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBldmVudC5kYXRhLnNvdXJjZUlkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChldmVudC5kYXRhLnR5cGUgPT0gJ2phbnVzR2V0U2NyZWVuUGVuZGluZycpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ2NsZWFyaW5nICcsIGV2ZW50LmRhdGEuaWQpO1xuXHRcdFx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KGV2ZW50LmRhdGEuaWQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG59O1xuXG5KYW51cy51c2VEZWZhdWx0RGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gKGRlcHMpIHtcblx0dmFyIGYgPSAoZGVwcyAmJiBkZXBzLmZldGNoKSB8fCBmZXRjaDtcblx0dmFyIHAgPSAoZGVwcyAmJiBkZXBzLlByb21pc2UpIHx8IFByb21pc2U7XG5cdHZhciBzb2NrZXRDbHMgPSAoZGVwcyAmJiBkZXBzLldlYlNvY2tldCkgfHwgV2ViU29ja2V0O1xuXG5cdHJldHVybiB7XG5cdFx0bmV3V2ViU29ja2V0OiBmdW5jdGlvbihzZXJ2ZXIsIHByb3RvKSB7IHJldHVybiBuZXcgc29ja2V0Q2xzKHNlcnZlciwgcHJvdG8pOyB9LFxuXHRcdGV4dGVuc2lvbjogKGRlcHMgJiYgZGVwcy5leHRlbnNpb24pIHx8IGRlZmF1bHRFeHRlbnNpb24sXG5cdFx0aXNBcnJheTogZnVuY3Rpb24oYXJyKSB7IHJldHVybiBBcnJheS5pc0FycmF5KGFycik7IH0sXG5cdFx0d2ViUlRDQWRhcHRlcjogKGRlcHMgJiYgZGVwcy5hZGFwdGVyKSB8fCBhZGFwdGVyLFxuXHRcdGh0dHBBUElDYWxsOiBmdW5jdGlvbih1cmwsIG9wdGlvbnMpIHtcblx0XHRcdHZhciBmZXRjaE9wdGlvbnMgPSB7XG5cdFx0XHRcdG1ldGhvZDogb3B0aW9ucy52ZXJiLFxuXHRcdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdFx0J0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyonXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGNhY2hlOiAnbm8tY2FjaGUnXG5cdFx0XHR9O1xuXHRcdFx0aWYob3B0aW9ucy52ZXJiID09PSBcIlBPU1RcIikge1xuXHRcdFx0XHRmZXRjaE9wdGlvbnMuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7XG5cdFx0XHR9XG5cdFx0XHRpZihvcHRpb25zLndpdGhDcmVkZW50aWFscyAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGZldGNoT3B0aW9ucy5jcmVkZW50aWFscyA9IG9wdGlvbnMud2l0aENyZWRlbnRpYWxzID09PSB0cnVlID8gJ2luY2x1ZGUnIDogKG9wdGlvbnMud2l0aENyZWRlbnRpYWxzID8gb3B0aW9ucy53aXRoQ3JlZGVudGlhbHMgOiAnb21pdCcpO1xuXHRcdFx0fVxuXHRcdFx0aWYob3B0aW9ucy5ib2R5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0ZmV0Y2hPcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmJvZHkpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZmV0Y2hpbmcgPSBmKHVybCwgZmV0Y2hPcHRpb25zKS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHRyZXR1cm4gcC5yZWplY3Qoe21lc3NhZ2U6ICdQcm9iYWJseSBhIG5ldHdvcmsgZXJyb3IsIGlzIHRoZSBzZXJ2ZXIgZG93bj8nLCBlcnJvcjogZXJyb3J9KTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvKlxuXHRcdFx0ICogZmV0Y2goKSBkb2VzIG5vdCBuYXRpdmVseSBzdXBwb3J0IHRpbWVvdXRzLlxuXHRcdFx0ICogV29yayBhcm91bmQgdGhpcyBieSBzdGFydGluZyBhIHRpbWVvdXQgbWFudWFsbHksIGFuZCByYWNpbmcgaXQgYWdhaW5zIHRoZSBmZXRjaCgpIHRvIHNlZSB3aGljaCB0aGluZyByZXNvbHZlcyBmaXJzdC5cblx0XHRcdCAqL1xuXG5cdFx0XHRpZihvcHRpb25zLnRpbWVvdXQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR2YXIgdGltZW91dCA9IG5ldyBwKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0XHRcdHZhciB0aW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dCh0aW1lcklkKTtcblx0XHRcdFx0XHRcdHJldHVybiByZWplY3Qoe21lc3NhZ2U6ICdSZXF1ZXN0IHRpbWVkIG91dCcsIHRpbWVvdXQ6IG9wdGlvbnMudGltZW91dH0pO1xuXHRcdFx0XHRcdH0sIG9wdGlvbnMudGltZW91dCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRmZXRjaGluZyA9IHAucmFjZShbZmV0Y2hpbmcsdGltZW91dF0pO1xuXHRcdFx0fVxuXG5cdFx0XHRmZXRjaGluZy50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGlmKHJlc3BvbnNlLm9rKSB7XG5cdFx0XHRcdFx0aWYodHlwZW9mKG9wdGlvbnMuc3VjY2VzcykgPT09IHR5cGVvZihKYW51cy5ub29wKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKHBhcnNlZCkge1xuXHRcdFx0XHRcdFx0XHRvcHRpb25zLnN1Y2Nlc3MocGFyc2VkKTtcblx0XHRcdFx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBwLnJlamVjdCh7bWVzc2FnZTogJ0ZhaWxlZCB0byBwYXJzZSByZXNwb25zZSBib2R5JywgZXJyb3I6IGVycm9yLCByZXNwb25zZTogcmVzcG9uc2V9KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gcC5yZWplY3Qoe21lc3NhZ2U6ICdBUEkgY2FsbCBmYWlsZWQnLCByZXNwb25zZTogcmVzcG9uc2V9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0aWYodHlwZW9mKG9wdGlvbnMuZXJyb3IpID09PSB0eXBlb2YoSmFudXMubm9vcCkpIHtcblx0XHRcdFx0XHRvcHRpb25zLmVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJzw8IGludGVybmFsIGVycm9yID4+JywgZXJyb3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGZldGNoaW5nO1xuXHRcdH1cblx0fVxufTtcblxuSmFudXMudXNlT2xkRGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gKGRlcHMpIHtcblx0dmFyIGpxID0gKGRlcHMgJiYgZGVwcy5qUXVlcnkpIHx8IGpRdWVyeTtcblx0dmFyIHNvY2tldENscyA9IChkZXBzICYmIGRlcHMuV2ViU29ja2V0KSB8fCBXZWJTb2NrZXQ7XG5cdHJldHVybiB7XG5cdFx0bmV3V2ViU29ja2V0OiBmdW5jdGlvbihzZXJ2ZXIsIHByb3RvKSB7IHJldHVybiBuZXcgc29ja2V0Q2xzKHNlcnZlciwgcHJvdG8pOyB9LFxuXHRcdGlzQXJyYXk6IGZ1bmN0aW9uKGFycikgeyByZXR1cm4ganEuaXNBcnJheShhcnIpOyB9LFxuXHRcdGV4dGVuc2lvbjogKGRlcHMgJiYgZGVwcy5leHRlbnNpb24pIHx8IGRlZmF1bHRFeHRlbnNpb24sXG5cdFx0d2ViUlRDQWRhcHRlcjogKGRlcHMgJiYgZGVwcy5hZGFwdGVyKSB8fCBhZGFwdGVyLFxuXHRcdGh0dHBBUElDYWxsOiBmdW5jdGlvbih1cmwsIG9wdGlvbnMpIHtcblx0XHRcdHZhciBwYXlsb2FkID0gb3B0aW9ucy5ib2R5ICE9PSB1bmRlZmluZWQgPyB7XG5cdFx0XHRcdGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0XHRcdGRhdGE6IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMuYm9keSlcblx0XHRcdH0gOiB7fTtcblx0XHRcdHZhciBjcmVkZW50aWFscyA9IG9wdGlvbnMud2l0aENyZWRlbnRpYWxzICE9PSB1bmRlZmluZWQgPyB7eGhyRmllbGRzOiB7d2l0aENyZWRlbnRpYWxzOiBvcHRpb25zLndpdGhDcmVkZW50aWFsc319IDoge307XG5cblx0XHRcdHJldHVybiBqcS5hamF4KGpxLmV4dGVuZChwYXlsb2FkLCBjcmVkZW50aWFscywge1xuXHRcdFx0XHR1cmw6IHVybCxcblx0XHRcdFx0dHlwZTogb3B0aW9ucy52ZXJiLFxuXHRcdFx0XHRjYWNoZTogZmFsc2UsXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbicsXG5cdFx0XHRcdGFzeW5jOiBvcHRpb25zLmFzeW5jLFxuXHRcdFx0XHR0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXQsXG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0XHRcdGlmKHR5cGVvZihvcHRpb25zLnN1Y2Nlc3MpID09PSB0eXBlb2YoSmFudXMubm9vcCkpIHtcblx0XHRcdFx0XHRcdG9wdGlvbnMuc3VjY2VzcyhyZXN1bHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKHhociwgc3RhdHVzLCBlcnIpIHtcblx0XHRcdFx0XHRpZih0eXBlb2Yob3B0aW9ucy5lcnJvcikgPT09IHR5cGVvZihKYW51cy5ub29wKSkge1xuXHRcdFx0XHRcdFx0b3B0aW9ucy5lcnJvcihzdGF0dXMsIGVycik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KSk7XG5cdFx0fSxcblx0fTtcbn07XG5cbkphbnVzLm5vb3AgPSBmdW5jdGlvbigpIHt9O1xuXG5KYW51cy5kYXRhQ2hhbkRlZmF1bHRMYWJlbCA9IFwiSmFudXNEYXRhQ2hhbm5lbFwiO1xuXG4vLyBOb3RlOiBpbiB0aGUgZnV0dXJlIHdlIG1heSB3YW50IHRvIGNoYW5nZSB0aGlzLCBlLmcuLCBhcyB3YXNcbi8vIGF0dGVtcHRlZCBpbiBodHRwczovL2dpdGh1Yi5jb20vbWVldGVjaG8vamFudXMtZ2F0ZXdheS9pc3N1ZXMvMTY3MFxuSmFudXMuZW5kT2ZDYW5kaWRhdGVzID0gbnVsbDtcblxuLy8gSW5pdGlhbGl6YXRpb25cbkphbnVzLmluaXQgPSBmdW5jdGlvbihvcHRpb25zKSB7XG5cdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRvcHRpb25zLmNhbGxiYWNrID0gKHR5cGVvZiBvcHRpb25zLmNhbGxiYWNrID09IFwiZnVuY3Rpb25cIikgPyBvcHRpb25zLmNhbGxiYWNrIDogSmFudXMubm9vcDtcblx0aWYoSmFudXMuaW5pdERvbmUgPT09IHRydWUpIHtcblx0XHQvLyBBbHJlYWR5IGluaXRpYWxpemVkXG5cdFx0b3B0aW9ucy5jYWxsYmFjaygpO1xuXHR9IGVsc2Uge1xuXHRcdGlmKHR5cGVvZiBjb25zb2xlID09IFwidW5kZWZpbmVkXCIgfHwgdHlwZW9mIGNvbnNvbGUubG9nID09IFwidW5kZWZpbmVkXCIpXG5cdFx0XHRjb25zb2xlID0geyBsb2c6IGZ1bmN0aW9uKCkge30gfTtcblx0XHQvLyBDb25zb2xlIGxvZ2dpbmcgKGFsbCBkZWJ1Z2dpbmcgZGlzYWJsZWQgYnkgZGVmYXVsdClcblx0XHRKYW51cy50cmFjZSA9IEphbnVzLm5vb3A7XG5cdFx0SmFudXMuZGVidWcgPSBKYW51cy5ub29wO1xuXHRcdEphbnVzLnZkZWJ1ZyA9IEphbnVzLm5vb3A7XG5cdFx0SmFudXMubG9nID0gSmFudXMubm9vcDtcblx0XHRKYW51cy53YXJuID0gSmFudXMubm9vcDtcblx0XHRKYW51cy5lcnJvciA9IEphbnVzLm5vb3A7XG5cdFx0aWYob3B0aW9ucy5kZWJ1ZyA9PT0gdHJ1ZSB8fCBvcHRpb25zLmRlYnVnID09PSBcImFsbFwiKSB7XG5cdFx0XHQvLyBFbmFibGUgYWxsIGRlYnVnZ2luZyBsZXZlbHNcblx0XHRcdEphbnVzLnRyYWNlID0gY29uc29sZS50cmFjZS5iaW5kKGNvbnNvbGUpO1xuXHRcdFx0SmFudXMuZGVidWcgPSBjb25zb2xlLmRlYnVnLmJpbmQoY29uc29sZSk7XG5cdFx0XHRKYW51cy52ZGVidWcgPSBjb25zb2xlLmRlYnVnLmJpbmQoY29uc29sZSk7XG5cdFx0XHRKYW51cy5sb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpO1xuXHRcdFx0SmFudXMud2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpO1xuXHRcdFx0SmFudXMuZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7XG5cdFx0fSBlbHNlIGlmKEFycmF5LmlzQXJyYXkob3B0aW9ucy5kZWJ1ZykpIHtcblx0XHRcdGZvcih2YXIgaSBpbiBvcHRpb25zLmRlYnVnKSB7XG5cdFx0XHRcdHZhciBkID0gb3B0aW9ucy5kZWJ1Z1tpXTtcblx0XHRcdFx0c3dpdGNoKGQpIHtcblx0XHRcdFx0XHRjYXNlIFwidHJhY2VcIjpcblx0XHRcdFx0XHRcdEphbnVzLnRyYWNlID0gY29uc29sZS50cmFjZS5iaW5kKGNvbnNvbGUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBcImRlYnVnXCI6XG5cdFx0XHRcdFx0XHRKYW51cy5kZWJ1ZyA9IGNvbnNvbGUuZGVidWcuYmluZChjb25zb2xlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgXCJ2ZGVidWdcIjpcblx0XHRcdFx0XHRcdEphbnVzLnZkZWJ1ZyA9IGNvbnNvbGUuZGVidWcuYmluZChjb25zb2xlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgXCJsb2dcIjpcblx0XHRcdFx0XHRcdEphbnVzLmxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIFwid2FyblwiOlxuXHRcdFx0XHRcdFx0SmFudXMud2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBcImVycm9yXCI6XG5cdFx0XHRcdFx0XHRKYW51cy5lcnJvciA9IGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiVW5rbm93biBkZWJ1Z2dpbmcgb3B0aW9uICdcIiArIGQgKyBcIicgKHN1cHBvcnRlZDogJ3RyYWNlJywgJ2RlYnVnJywgJ3ZkZWJ1ZycsICdsb2cnLCB3YXJuJywgJ2Vycm9yJylcIik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRKYW51cy5sb2coXCJJbml0aWFsaXppbmcgbGlicmFyeVwiKTtcblxuXHRcdHZhciB1c2VkRGVwZW5kZW5jaWVzID0gb3B0aW9ucy5kZXBlbmRlbmNpZXMgfHwgSmFudXMudXNlRGVmYXVsdERlcGVuZGVuY2llcygpO1xuXHRcdEphbnVzLmlzQXJyYXkgPSB1c2VkRGVwZW5kZW5jaWVzLmlzQXJyYXk7XG5cdFx0SmFudXMud2ViUlRDQWRhcHRlciA9IHVzZWREZXBlbmRlbmNpZXMud2ViUlRDQWRhcHRlcjtcblx0XHRKYW51cy5odHRwQVBJQ2FsbCA9IHVzZWREZXBlbmRlbmNpZXMuaHR0cEFQSUNhbGw7XG5cdFx0SmFudXMubmV3V2ViU29ja2V0ID0gdXNlZERlcGVuZGVuY2llcy5uZXdXZWJTb2NrZXQ7XG5cdFx0SmFudXMuZXh0ZW5zaW9uID0gdXNlZERlcGVuZGVuY2llcy5leHRlbnNpb247XG5cdFx0SmFudXMuZXh0ZW5zaW9uLmluaXQoKTtcblxuXHRcdC8vIEhlbHBlciBtZXRob2QgdG8gZW51bWVyYXRlIGRldmljZXNcblx0XHRKYW51cy5saXN0RGV2aWNlcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb25maWcpIHtcblx0XHRcdGNhbGxiYWNrID0gKHR5cGVvZiBjYWxsYmFjayA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2sgOiBKYW51cy5ub29wO1xuXHRcdFx0aWYgKGNvbmZpZyA9PSBudWxsKSBjb25maWcgPSB7IGF1ZGlvOiB0cnVlLCB2aWRlbzogdHJ1ZSB9O1xuXHRcdFx0aWYoSmFudXMuaXNHZXRVc2VyTWVkaWFBdmFpbGFibGUoKSkge1xuXHRcdFx0XHRuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25maWcpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uKHN0cmVhbSkge1xuXHRcdFx0XHRcdG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpLnRoZW4oZnVuY3Rpb24oZGV2aWNlcykge1xuXHRcdFx0XHRcdFx0SmFudXMuZGVidWcoZGV2aWNlcyk7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhkZXZpY2VzKTtcblx0XHRcdFx0XHRcdC8vIEdldCByaWQgb2YgdGhlIG5vdyB1c2VsZXNzIHN0cmVhbVxuXHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0dmFyIHRyYWNrcyA9IHN0cmVhbS5nZXRUcmFja3MoKTtcblx0XHRcdFx0XHRcdFx0Zm9yKHZhciBpIGluIHRyYWNrcykge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBtc3QgPSB0cmFja3NbaV07XG5cdFx0XHRcdFx0XHRcdFx0aWYobXN0ICE9PSBudWxsICYmIG1zdCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRcdFx0XHRcdFx0bXN0LnN0b3AoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBjYXRjaChlKSB7fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoZXJyKTtcblx0XHRcdFx0XHRjYWxsYmFjayhbXSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0SmFudXMud2FybihcIm5hdmlnYXRvci5tZWRpYURldmljZXMgdW5hdmFpbGFibGVcIik7XG5cdFx0XHRcdGNhbGxiYWNrKFtdKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gSGVscGVyIG1ldGhvZHMgdG8gYXR0YWNoL3JlYXR0YWNoIGEgc3RyZWFtIHRvIGEgdmlkZW8gZWxlbWVudCAocHJldmlvdXNseSBwYXJ0IG9mIGFkYXB0ZXIuanMpXG5cdFx0SmFudXMuYXR0YWNoTWVkaWFTdHJlYW0gPSBmdW5jdGlvbihlbGVtZW50LCBzdHJlYW0pIHtcblx0XHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ2Nocm9tZScpIHtcblx0XHRcdFx0dmFyIGNocm9tZXZlciA9IEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMudmVyc2lvbjtcblx0XHRcdFx0aWYoY2hyb21ldmVyID49IDUyKSB7XG5cdFx0XHRcdFx0ZWxlbWVudC5zcmNPYmplY3QgPSBzdHJlYW07XG5cdFx0XHRcdH0gZWxzZSBpZih0eXBlb2YgZWxlbWVudC5zcmMgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0ZWxlbWVudC5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJFcnJvciBhdHRhY2hpbmcgc3RyZWFtIHRvIGVsZW1lbnRcIik7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsZW1lbnQuc3JjT2JqZWN0ID0gc3RyZWFtO1xuXHRcdFx0fVxuXHRcdH07XG5cdFx0SmFudXMucmVhdHRhY2hNZWRpYVN0cmVhbSA9IGZ1bmN0aW9uKHRvLCBmcm9tKSB7XG5cdFx0XHRpZihKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09ICdjaHJvbWUnKSB7XG5cdFx0XHRcdHZhciBjaHJvbWV2ZXIgPSBKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLnZlcnNpb247XG5cdFx0XHRcdGlmKGNocm9tZXZlciA+PSA1Mikge1xuXHRcdFx0XHRcdHRvLnNyY09iamVjdCA9IGZyb20uc3JjT2JqZWN0O1xuXHRcdFx0XHR9IGVsc2UgaWYodHlwZW9mIHRvLnNyYyAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHR0by5zcmMgPSBmcm9tLnNyYztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRKYW51cy5lcnJvcihcIkVycm9yIHJlYXR0YWNoaW5nIHN0cmVhbSB0byBlbGVtZW50XCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0by5zcmNPYmplY3QgPSBmcm9tLnNyY09iamVjdDtcblx0XHRcdH1cblx0XHR9O1xuXHRcdC8vIERldGVjdCB0YWIgY2xvc2U6IG1ha2Ugc3VyZSB3ZSBkb24ndCBsb29zZSBleGlzdGluZyBvbmJlZm9yZXVubG9hZCBoYW5kbGVyc1xuXHRcdC8vIChub3RlOiBmb3IgaU9TIHdlIG5lZWQgdG8gc3Vic2NyaWJlIHRvIGEgZGlmZmVyZW50IGV2ZW50LCAncGFnZWhpZGUnLCBzZWVcblx0XHQvLyBodHRwczovL2dpc3QuZ2l0aHViLmNvbS90aGVodW5tb25rZ3JvdXAvNmJlZTg5NDFhNDliODZiZTMxYTc4N2ZlOGY0YjhjZmUpXG5cdFx0dmFyIGlPUyA9IFsnaVBhZCcsICdpUGhvbmUnLCAnaVBvZCddLmluZGV4T2YobmF2aWdhdG9yLnBsYXRmb3JtKSA+PSAwO1xuXHRcdHZhciBldmVudE5hbWUgPSBpT1MgPyAncGFnZWhpZGUnIDogJ2JlZm9yZXVubG9hZCc7XG5cdFx0dmFyIG9sZE9CRiA9IHdpbmRvd1tcIm9uXCIgKyBldmVudE5hbWVdO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdEphbnVzLmxvZyhcIkNsb3Npbmcgd2luZG93XCIpO1xuXHRcdFx0Zm9yKHZhciBzIGluIEphbnVzLnNlc3Npb25zKSB7XG5cdFx0XHRcdGlmKEphbnVzLnNlc3Npb25zW3NdICE9PSBudWxsICYmIEphbnVzLnNlc3Npb25zW3NdICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0XHRcdEphbnVzLnNlc3Npb25zW3NdLmRlc3Ryb3lPblVubG9hZCkge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIkRlc3Ryb3lpbmcgc2Vzc2lvbiBcIiArIHMpO1xuXHRcdFx0XHRcdEphbnVzLnNlc3Npb25zW3NdLmRlc3Ryb3koe2FzeW5jUmVxdWVzdDogZmFsc2UsIG5vdGlmeURlc3Ryb3llZDogZmFsc2V9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYob2xkT0JGICYmIHR5cGVvZiBvbGRPQkYgPT0gXCJmdW5jdGlvblwiKVxuXHRcdFx0XHRvbGRPQkYoKTtcblx0XHR9KTtcblx0XHQvLyBJZiB0aGlzIGlzIGEgU2FmYXJpIFRlY2hub2xvZ3kgUHJldmlldywgY2hlY2sgaWYgVlA4IGlzIHN1cHBvcnRlZFxuXHRcdEphbnVzLnNhZmFyaVZwOCA9IGZhbHNlO1xuXHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ3NhZmFyaScgJiZcblx0XHRcdFx0SmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy52ZXJzaW9uID49IDYwNSkge1xuXHRcdFx0Ly8gTGV0J3Mgc2VlIGlmIFJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMoKSBpcyB0aGVyZVxuXHRcdFx0aWYoUlRDUnRwU2VuZGVyICYmIFJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMgJiYgUlRDUnRwU2VuZGVyLmdldENhcGFiaWxpdGllcyhcInZpZGVvXCIpICYmXG5cdFx0XHRcdFx0UlRDUnRwU2VuZGVyLmdldENhcGFiaWxpdGllcyhcInZpZGVvXCIpLmNvZGVjcyAmJiBSVENSdHBTZW5kZXIuZ2V0Q2FwYWJpbGl0aWVzKFwidmlkZW9cIikuY29kZWNzLmxlbmd0aCkge1xuXHRcdFx0XHRmb3IodmFyIGkgaW4gUlRDUnRwU2VuZGVyLmdldENhcGFiaWxpdGllcyhcInZpZGVvXCIpLmNvZGVjcykge1xuXHRcdFx0XHRcdHZhciBjb2RlYyA9IFJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMoXCJ2aWRlb1wiKS5jb2RlY3NbaV07XG5cdFx0XHRcdFx0aWYoY29kZWMgJiYgY29kZWMubWltZVR5cGUgJiYgY29kZWMubWltZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ2aWRlby92cDhcIikge1xuXHRcdFx0XHRcdFx0SmFudXMuc2FmYXJpVnA4ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRpZihKYW51cy5zYWZhcmlWcDgpIHtcblx0XHRcdFx0XHRKYW51cy5sb2coXCJUaGlzIHZlcnNpb24gb2YgU2FmYXJpIHN1cHBvcnRzIFZQOFwiKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRKYW51cy53YXJuKFwiVGhpcyB2ZXJzaW9uIG9mIFNhZmFyaSBkb2VzIE5PVCBzdXBwb3J0IFZQODogaWYgeW91J3JlIHVzaW5nIGEgVGVjaG5vbG9neSBQcmV2aWV3LCBcIiArXG5cdFx0XHRcdFx0XHRcInRyeSBlbmFibGluZyB0aGUgJ1dlYlJUQyBWUDggY29kZWMnIHNldHRpbmcgaW4gdGhlICdFeHBlcmltZW50YWwgRmVhdHVyZXMnIERldmVsb3AgbWVudVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gV2UgZG8gaXQgaW4gYSB2ZXJ5IHVnbHkgd2F5LCBhcyB0aGVyZSdzIG5vIGFsdGVybmF0aXZlLi4uXG5cdFx0XHRcdC8vIFdlIGNyZWF0ZSBhIFBlZXJDb25uZWN0aW9uIHRvIHNlZSBpZiBWUDggaXMgaW4gYW4gb2ZmZXJcblx0XHRcdFx0dmFyIHRlc3RwYyA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbih7fSwge30pO1xuXHRcdFx0XHR0ZXN0cGMuY3JlYXRlT2ZmZXIoe29mZmVyVG9SZWNlaXZlVmlkZW86IHRydWV9KS50aGVuKGZ1bmN0aW9uKG9mZmVyKSB7XG5cdFx0XHRcdFx0SmFudXMuc2FmYXJpVnA4ID0gb2ZmZXIuc2RwLmluZGV4T2YoXCJWUDhcIikgIT09IC0xO1xuXHRcdFx0XHRcdGlmKEphbnVzLnNhZmFyaVZwOCkge1xuXHRcdFx0XHRcdFx0SmFudXMubG9nKFwiVGhpcyB2ZXJzaW9uIG9mIFNhZmFyaSBzdXBwb3J0cyBWUDhcIik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdEphbnVzLndhcm4oXCJUaGlzIHZlcnNpb24gb2YgU2FmYXJpIGRvZXMgTk9UIHN1cHBvcnQgVlA4OiBpZiB5b3UncmUgdXNpbmcgYSBUZWNobm9sb2d5IFByZXZpZXcsIFwiICtcblx0XHRcdFx0XHRcdFx0XCJ0cnkgZW5hYmxpbmcgdGhlICdXZWJSVEMgVlA4IGNvZGVjJyBzZXR0aW5nIGluIHRoZSAnRXhwZXJpbWVudGFsIEZlYXR1cmVzJyBEZXZlbG9wIG1lbnVcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHRlc3RwYy5jbG9zZSgpO1xuXHRcdFx0XHRcdHRlc3RwYyA9IG51bGw7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBDaGVjayBpZiB0aGlzIGJyb3dzZXIgc3VwcG9ydHMgVW5pZmllZCBQbGFuIGFuZCB0cmFuc2NlaXZlcnNcblx0XHQvLyBCYXNlZCBvbiBodHRwczovL2NvZGVwZW4uaW8vYW5vbi9wZW4vWnFMd1dWP2VkaXRvcnM9MDAxMFxuXHRcdEphbnVzLnVuaWZpZWRQbGFuID0gZmFsc2U7XG5cdFx0aWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSAnZmlyZWZveCcgJiZcblx0XHRcdFx0SmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy52ZXJzaW9uID49IDU5KSB7XG5cdFx0XHQvLyBGaXJlZm94IGRlZmluaXRlbHkgZG9lcywgc3RhcnRpbmcgZnJvbSB2ZXJzaW9uIDU5XG5cdFx0XHRKYW51cy51bmlmaWVkUGxhbiA9IHRydWU7XG5cdFx0fSBlbHNlIGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ2Nocm9tZScgJiZcblx0XHRcdFx0SmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy52ZXJzaW9uIDwgNzIpIHtcblx0XHRcdC8vIENocm9tZSBkb2VzLCBidXQgaXQncyBvbmx5IHVzYWJsZSBmcm9tIHZlcnNpb24gNzIgb25cblx0XHRcdEphbnVzLnVuaWZpZWRQbGFuID0gZmFsc2U7XG5cdFx0fSBlbHNlIGlmKCEoJ2N1cnJlbnREaXJlY3Rpb24nIGluIFJUQ1J0cFRyYW5zY2VpdmVyLnByb3RvdHlwZSkpIHtcblx0XHRcdC8vIFNhZmFyaSBzdXBwb3J0cyBhZGRUcmFuc2NlaXZlcigpIGJ1dCBub3QgVW5pZmllZCBQbGFuIHdoZW5cblx0XHRcdC8vIGN1cnJlbnREaXJlY3Rpb24gaXMgbm90IGRlZmluZWQgKHNlZSBjb2RlcGVuIGFib3ZlKVxuXHRcdFx0SmFudXMudW5pZmllZFBsYW4gPSBmYWxzZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gQ2hlY2sgaWYgYWRkVHJhbnNjZWl2ZXIoKSB0aHJvd3MgYW4gZXhjZXB0aW9uXG5cdFx0XHRjb25zdCB0ZW1wUGMgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24oKTtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHRlbXBQYy5hZGRUcmFuc2NlaXZlcignYXVkaW8nKTtcblx0XHRcdFx0SmFudXMudW5pZmllZFBsYW4gPSB0cnVlO1xuXHRcdFx0fSBjYXRjaCAoZSkge31cblx0XHRcdHRlbXBQYy5jbG9zZSgpO1xuXHRcdH1cblx0XHRKYW51cy5pbml0RG9uZSA9IHRydWU7XG5cdFx0b3B0aW9ucy5jYWxsYmFjaygpO1xuXHR9XG59O1xuXG4vLyBIZWxwZXIgbWV0aG9kIHRvIGNoZWNrIHdoZXRoZXIgV2ViUlRDIGlzIHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXJcbkphbnVzLmlzV2VicnRjU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gIT09IHVuZGVmaW5lZCAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gIT09IG51bGw7XG59O1xuLy8gSGVscGVyIG1ldGhvZCB0byBjaGVjayB3aGV0aGVyIGRldmljZXMgY2FuIGJlIGFjY2Vzc2VkIGJ5IHRoaXMgYnJvd3NlciAoZS5nLiwgbm90IHBvc3NpYmxlIHZpYSBwbGFpbiBIVFRQKVxuSmFudXMuaXNHZXRVc2VyTWVkaWFBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICE9PSBudWxsICYmXG5cdFx0bmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSAhPT0gbnVsbDtcbn07XG5cbi8vIEhlbHBlciBtZXRob2QgdG8gY3JlYXRlIHJhbmRvbSBpZGVudGlmaWVycyAoZS5nLiwgdHJhbnNhY3Rpb24pXG5KYW51cy5yYW5kb21TdHJpbmcgPSBmdW5jdGlvbihsZW4pIHtcblx0dmFyIGNoYXJTZXQgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknO1xuXHR2YXIgcmFuZG9tU3RyaW5nID0gJyc7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHR2YXIgcmFuZG9tUG96ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhclNldC5sZW5ndGgpO1xuXHRcdHJhbmRvbVN0cmluZyArPSBjaGFyU2V0LnN1YnN0cmluZyhyYW5kb21Qb3oscmFuZG9tUG96KzEpO1xuXHR9XG5cdHJldHVybiByYW5kb21TdHJpbmc7XG59XG5cblxuZnVuY3Rpb24gSmFudXMoZ2F0ZXdheUNhbGxiYWNrcykge1xuXHRpZihKYW51cy5pbml0RG9uZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0Z2F0ZXdheUNhbGxiYWNrcy5lcnJvcihcIkxpYnJhcnkgbm90IGluaXRpYWxpemVkXCIpO1xuXHRcdHJldHVybiB7fTtcblx0fVxuXHRpZighSmFudXMuaXNXZWJydGNTdXBwb3J0ZWQoKSkge1xuXHRcdGdhdGV3YXlDYWxsYmFja3MuZXJyb3IoXCJXZWJSVEMgbm90IHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXJcIik7XG5cdFx0cmV0dXJuIHt9O1xuXHR9XG5cdEphbnVzLmxvZyhcIkxpYnJhcnkgaW5pdGlhbGl6ZWQ6IFwiICsgSmFudXMuaW5pdERvbmUpO1xuXHRnYXRld2F5Q2FsbGJhY2tzID0gZ2F0ZXdheUNhbGxiYWNrcyB8fCB7fTtcblx0Z2F0ZXdheUNhbGxiYWNrcy5zdWNjZXNzID0gKHR5cGVvZiBnYXRld2F5Q2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGdhdGV3YXlDYWxsYmFja3Muc3VjY2VzcyA6IEphbnVzLm5vb3A7XG5cdGdhdGV3YXlDYWxsYmFja3MuZXJyb3IgPSAodHlwZW9mIGdhdGV3YXlDYWxsYmFja3MuZXJyb3IgPT0gXCJmdW5jdGlvblwiKSA/IGdhdGV3YXlDYWxsYmFja3MuZXJyb3IgOiBKYW51cy5ub29wO1xuXHRnYXRld2F5Q2FsbGJhY2tzLmRlc3Ryb3llZCA9ICh0eXBlb2YgZ2F0ZXdheUNhbGxiYWNrcy5kZXN0cm95ZWQgPT0gXCJmdW5jdGlvblwiKSA/IGdhdGV3YXlDYWxsYmFja3MuZGVzdHJveWVkIDogSmFudXMubm9vcDtcblx0aWYoZ2F0ZXdheUNhbGxiYWNrcy5zZXJ2ZXIgPT09IG51bGwgfHwgZ2F0ZXdheUNhbGxiYWNrcy5zZXJ2ZXIgPT09IHVuZGVmaW5lZCkge1xuXHRcdGdhdGV3YXlDYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIHNlcnZlciB1cmxcIik7XG5cdFx0cmV0dXJuIHt9O1xuXHR9XG5cdHZhciB3ZWJzb2NrZXRzID0gZmFsc2U7XG5cdHZhciB3cyA9IG51bGw7XG5cdHZhciB3c0hhbmRsZXJzID0ge307XG5cdHZhciB3c0tlZXBhbGl2ZVRpbWVvdXRJZCA9IG51bGw7XG5cblx0dmFyIHNlcnZlcnMgPSBudWxsLCBzZXJ2ZXJzSW5kZXggPSAwO1xuXHR2YXIgc2VydmVyID0gZ2F0ZXdheUNhbGxiYWNrcy5zZXJ2ZXI7XG5cdGlmKEphbnVzLmlzQXJyYXkoc2VydmVyKSkge1xuXHRcdEphbnVzLmxvZyhcIk11bHRpcGxlIHNlcnZlcnMgcHJvdmlkZWQgKFwiICsgc2VydmVyLmxlbmd0aCArIFwiKSwgd2lsbCB1c2UgdGhlIGZpcnN0IHRoYXQgd29ya3NcIik7XG5cdFx0c2VydmVyID0gbnVsbDtcblx0XHRzZXJ2ZXJzID0gZ2F0ZXdheUNhbGxiYWNrcy5zZXJ2ZXI7XG5cdFx0SmFudXMuZGVidWcoc2VydmVycyk7XG5cdH0gZWxzZSB7XG5cdFx0aWYoc2VydmVyLmluZGV4T2YoXCJ3c1wiKSA9PT0gMCkge1xuXHRcdFx0d2Vic29ja2V0cyA9IHRydWU7XG5cdFx0XHRKYW51cy5sb2coXCJVc2luZyBXZWJTb2NrZXRzIHRvIGNvbnRhY3QgSmFudXM6IFwiICsgc2VydmVyKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0d2Vic29ja2V0cyA9IGZhbHNlO1xuXHRcdFx0SmFudXMubG9nKFwiVXNpbmcgUkVTVCBBUEkgdG8gY29udGFjdCBKYW51czogXCIgKyBzZXJ2ZXIpO1xuXHRcdH1cblx0fVxuXHR2YXIgaWNlU2VydmVycyA9IGdhdGV3YXlDYWxsYmFja3MuaWNlU2VydmVycztcblx0aWYoaWNlU2VydmVycyA9PT0gdW5kZWZpbmVkIHx8IGljZVNlcnZlcnMgPT09IG51bGwpXG5cdFx0aWNlU2VydmVycyA9IFt7dXJsczogXCJzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyXCJ9XTtcblx0dmFyIGljZVRyYW5zcG9ydFBvbGljeSA9IGdhdGV3YXlDYWxsYmFja3MuaWNlVHJhbnNwb3J0UG9saWN5O1xuXHR2YXIgYnVuZGxlUG9saWN5ID0gZ2F0ZXdheUNhbGxiYWNrcy5idW5kbGVQb2xpY3k7XG5cdC8vIFdoZXRoZXIgSVB2NiBjYW5kaWRhdGVzIHNob3VsZCBiZSBnYXRoZXJlZFxuXHR2YXIgaXB2NlN1cHBvcnQgPSBnYXRld2F5Q2FsbGJhY2tzLmlwdjY7XG5cdGlmKGlwdjZTdXBwb3J0ID09PSB1bmRlZmluZWQgfHwgaXB2NlN1cHBvcnQgPT09IG51bGwpXG5cdFx0aXB2NlN1cHBvcnQgPSBmYWxzZTtcblx0Ly8gV2hldGhlciB3ZSBzaG91bGQgZW5hYmxlIHRoZSB3aXRoQ3JlZGVudGlhbHMgZmxhZyBmb3IgWEhSIHJlcXVlc3RzXG5cdHZhciB3aXRoQ3JlZGVudGlhbHMgPSBmYWxzZTtcblx0aWYoZ2F0ZXdheUNhbGxiYWNrcy53aXRoQ3JlZGVudGlhbHMgIT09IHVuZGVmaW5lZCAmJiBnYXRld2F5Q2FsbGJhY2tzLndpdGhDcmVkZW50aWFscyAhPT0gbnVsbClcblx0XHR3aXRoQ3JlZGVudGlhbHMgPSBnYXRld2F5Q2FsbGJhY2tzLndpdGhDcmVkZW50aWFscyA9PT0gdHJ1ZTtcblx0Ly8gT3B0aW9uYWwgbWF4IGV2ZW50c1xuXHR2YXIgbWF4ZXYgPSAxMDtcblx0aWYoZ2F0ZXdheUNhbGxiYWNrcy5tYXhfcG9sbF9ldmVudHMgIT09IHVuZGVmaW5lZCAmJiBnYXRld2F5Q2FsbGJhY2tzLm1heF9wb2xsX2V2ZW50cyAhPT0gbnVsbClcblx0XHRtYXhldiA9IGdhdGV3YXlDYWxsYmFja3MubWF4X3BvbGxfZXZlbnRzO1xuXHRpZihtYXhldiA8IDEpXG5cdFx0bWF4ZXYgPSAxO1xuXHQvLyBUb2tlbiB0byB1c2UgKG9ubHkgaWYgdGhlIHRva2VuIGJhc2VkIGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbSBpcyBlbmFibGVkKVxuXHR2YXIgdG9rZW4gPSBudWxsO1xuXHRpZihnYXRld2F5Q2FsbGJhY2tzLnRva2VuICE9PSB1bmRlZmluZWQgJiYgZ2F0ZXdheUNhbGxiYWNrcy50b2tlbiAhPT0gbnVsbClcblx0XHR0b2tlbiA9IGdhdGV3YXlDYWxsYmFja3MudG9rZW47XG5cdC8vIEFQSSBzZWNyZXQgdG8gdXNlIChvbmx5IGlmIHRoZSBzaGFyZWQgQVBJIHNlY3JldCBpcyBlbmFibGVkKVxuXHR2YXIgYXBpc2VjcmV0ID0gbnVsbDtcblx0aWYoZ2F0ZXdheUNhbGxiYWNrcy5hcGlzZWNyZXQgIT09IHVuZGVmaW5lZCAmJiBnYXRld2F5Q2FsbGJhY2tzLmFwaXNlY3JldCAhPT0gbnVsbClcblx0XHRhcGlzZWNyZXQgPSBnYXRld2F5Q2FsbGJhY2tzLmFwaXNlY3JldDtcblx0Ly8gV2hldGhlciB3ZSBzaG91bGQgZGVzdHJveSB0aGlzIHNlc3Npb24gd2hlbiBvbmJlZm9yZXVubG9hZCBpcyBjYWxsZWRcblx0dGhpcy5kZXN0cm95T25VbmxvYWQgPSB0cnVlO1xuXHRpZihnYXRld2F5Q2FsbGJhY2tzLmRlc3Ryb3lPblVubG9hZCAhPT0gdW5kZWZpbmVkICYmIGdhdGV3YXlDYWxsYmFja3MuZGVzdHJveU9uVW5sb2FkICE9PSBudWxsKVxuXHRcdHRoaXMuZGVzdHJveU9uVW5sb2FkID0gKGdhdGV3YXlDYWxsYmFja3MuZGVzdHJveU9uVW5sb2FkID09PSB0cnVlKTtcblx0Ly8gU29tZSB0aW1lb3V0LXJlbGF0ZWQgdmFsdWVzXG5cdHZhciBrZWVwQWxpdmVQZXJpb2QgPSAyNTAwMDtcblx0aWYoZ2F0ZXdheUNhbGxiYWNrcy5rZWVwQWxpdmVQZXJpb2QgIT09IHVuZGVmaW5lZCAmJiBnYXRld2F5Q2FsbGJhY2tzLmtlZXBBbGl2ZVBlcmlvZCAhPT0gbnVsbClcblx0XHRrZWVwQWxpdmVQZXJpb2QgPSBnYXRld2F5Q2FsbGJhY2tzLmtlZXBBbGl2ZVBlcmlvZDtcblx0aWYoaXNOYU4oa2VlcEFsaXZlUGVyaW9kKSlcblx0XHRrZWVwQWxpdmVQZXJpb2QgPSAyNTAwMDtcblx0dmFyIGxvbmdQb2xsVGltZW91dCA9IDYwMDAwO1xuXHRpZihnYXRld2F5Q2FsbGJhY2tzLmxvbmdQb2xsVGltZW91dCAhPT0gdW5kZWZpbmVkICYmIGdhdGV3YXlDYWxsYmFja3MubG9uZ1BvbGxUaW1lb3V0ICE9PSBudWxsKVxuXHRcdGxvbmdQb2xsVGltZW91dCA9IGdhdGV3YXlDYWxsYmFja3MubG9uZ1BvbGxUaW1lb3V0O1xuXHRpZihpc05hTihsb25nUG9sbFRpbWVvdXQpKVxuXHRcdGxvbmdQb2xsVGltZW91dCA9IDYwMDAwO1xuXG5cdHZhciBjb25uZWN0ZWQgPSBmYWxzZTtcblx0dmFyIHNlc3Npb25JZCA9IG51bGw7XG5cdHZhciBwbHVnaW5IYW5kbGVzID0ge307XG5cdHZhciB0aGF0ID0gdGhpcztcblx0dmFyIHJldHJpZXMgPSAwO1xuXHR2YXIgdHJhbnNhY3Rpb25zID0ge307XG5cdGNyZWF0ZVNlc3Npb24oZ2F0ZXdheUNhbGxiYWNrcyk7XG5cblx0Ly8gUHVibGljIG1ldGhvZHNcblx0dGhpcy5nZXRTZXJ2ZXIgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHNlcnZlcjsgfTtcblx0dGhpcy5pc0Nvbm5lY3RlZCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gY29ubmVjdGVkOyB9O1xuXHR0aGlzLnJlY29ubmVjdCA9IGZ1bmN0aW9uKGNhbGxiYWNrcykge1xuXHRcdGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTtcblx0XHRjYWxsYmFja3Muc3VjY2VzcyA9ICh0eXBlb2YgY2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5zdWNjZXNzIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuZXJyb3IgPSAodHlwZW9mIGNhbGxiYWNrcy5lcnJvciA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmVycm9yIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3NbXCJyZWNvbm5lY3RcIl0gPSB0cnVlO1xuXHRcdGNyZWF0ZVNlc3Npb24oY2FsbGJhY2tzKTtcblx0fTtcblx0dGhpcy5nZXRTZXNzaW9uSWQgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHNlc3Npb25JZDsgfTtcblx0dGhpcy5kZXN0cm95ID0gZnVuY3Rpb24oY2FsbGJhY2tzKSB7IGRlc3Ryb3lTZXNzaW9uKGNhbGxiYWNrcyk7IH07XG5cdHRoaXMuYXR0YWNoID0gZnVuY3Rpb24oY2FsbGJhY2tzKSB7IGNyZWF0ZUhhbmRsZShjYWxsYmFja3MpOyB9O1xuXG5cdGZ1bmN0aW9uIGV2ZW50SGFuZGxlcigpIHtcblx0XHRpZihzZXNzaW9uSWQgPT0gbnVsbClcblx0XHRcdHJldHVybjtcblx0XHRKYW51cy5kZWJ1ZygnTG9uZyBwb2xsLi4uJyk7XG5cdFx0aWYoIWNvbm5lY3RlZCkge1xuXHRcdFx0SmFudXMud2FybihcIklzIHRoZSBzZXJ2ZXIgZG93bj8gKGNvbm5lY3RlZD1mYWxzZSlcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBsb25ncG9sbCA9IHNlcnZlciArIFwiL1wiICsgc2Vzc2lvbklkICsgXCI/cmlkPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cdFx0aWYobWF4ZXYgIT09IHVuZGVmaW5lZCAmJiBtYXhldiAhPT0gbnVsbClcblx0XHRcdGxvbmdwb2xsID0gbG9uZ3BvbGwgKyBcIiZtYXhldj1cIiArIG1heGV2O1xuXHRcdGlmKHRva2VuICE9PSBudWxsICYmIHRva2VuICE9PSB1bmRlZmluZWQpXG5cdFx0XHRsb25ncG9sbCA9IGxvbmdwb2xsICsgXCImdG9rZW49XCIgKyBlbmNvZGVVUklDb21wb25lbnQodG9rZW4pO1xuXHRcdGlmKGFwaXNlY3JldCAhPT0gbnVsbCAmJiBhcGlzZWNyZXQgIT09IHVuZGVmaW5lZClcblx0XHRcdGxvbmdwb2xsID0gbG9uZ3BvbGwgKyBcIiZhcGlzZWNyZXQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoYXBpc2VjcmV0KTtcblx0XHRKYW51cy5odHRwQVBJQ2FsbChsb25ncG9sbCwge1xuXHRcdFx0dmVyYjogJ0dFVCcsXG5cdFx0XHR3aXRoQ3JlZGVudGlhbHM6IHdpdGhDcmVkZW50aWFscyxcblx0XHRcdHN1Y2Nlc3M6IGhhbmRsZUV2ZW50LFxuXHRcdFx0dGltZW91dDogbG9uZ1BvbGxUaW1lb3V0LFxuXHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG5cdFx0XHRcdEphbnVzLmVycm9yKHRleHRTdGF0dXMgKyBcIjpcIiwgZXJyb3JUaHJvd24pO1xuXHRcdFx0XHRyZXRyaWVzKys7XG5cdFx0XHRcdGlmKHJldHJpZXMgPiAzKSB7XG5cdFx0XHRcdFx0Ly8gRGlkIHdlIGp1c3QgbG9zZSB0aGUgc2VydmVyPyA6LShcblx0XHRcdFx0XHRjb25uZWN0ZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRnYXRld2F5Q2FsbGJhY2tzLmVycm9yKFwiTG9zdCBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgKGlzIGl0IGRvd24/KVwiKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0ZXZlbnRIYW5kbGVyKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBQcml2YXRlIGV2ZW50IGhhbmRsZXI6IHRoaXMgd2lsbCB0cmlnZ2VyIHBsdWdpbiBjYWxsYmFja3MsIGlmIHNldFxuXHRmdW5jdGlvbiBoYW5kbGVFdmVudChqc29uLCBza2lwVGltZW91dCkge1xuXHRcdHJldHJpZXMgPSAwO1xuXHRcdGlmKCF3ZWJzb2NrZXRzICYmIHNlc3Npb25JZCAhPT0gdW5kZWZpbmVkICYmIHNlc3Npb25JZCAhPT0gbnVsbCAmJiBza2lwVGltZW91dCAhPT0gdHJ1ZSlcblx0XHRcdGV2ZW50SGFuZGxlcigpO1xuXHRcdGlmKCF3ZWJzb2NrZXRzICYmIEphbnVzLmlzQXJyYXkoanNvbikpIHtcblx0XHRcdC8vIFdlIGdvdCBhbiBhcnJheTogaXQgbWVhbnMgd2UgcGFzc2VkIGEgbWF4ZXYgPiAxLCBpdGVyYXRlIG9uIGFsbCBvYmplY3RzXG5cdFx0XHRmb3IodmFyIGk9MDsgaTxqc29uLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGhhbmRsZUV2ZW50KGpzb25baV0sIHRydWUpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRpZihqc29uW1wiamFudXNcIl0gPT09IFwia2VlcGFsaXZlXCIpIHtcblx0XHRcdC8vIE5vdGhpbmcgaGFwcGVuZWRcblx0XHRcdEphbnVzLnZkZWJ1ZyhcIkdvdCBhIGtlZXBhbGl2ZSBvbiBzZXNzaW9uIFwiICsgc2Vzc2lvbklkKTtcblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2UgaWYoanNvbltcImphbnVzXCJdID09PSBcImFja1wiKSB7XG5cdFx0XHQvLyBKdXN0IGFuIGFjaywgd2UgY2FuIHByb2JhYmx5IGlnbm9yZVxuXHRcdFx0SmFudXMuZGVidWcoXCJHb3QgYW4gYWNrIG9uIHNlc3Npb24gXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHR2YXIgdHJhbnNhY3Rpb24gPSBqc29uW1widHJhbnNhY3Rpb25cIl07XG5cdFx0XHRpZih0cmFuc2FjdGlvbiAhPT0gbnVsbCAmJiB0cmFuc2FjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHZhciByZXBvcnRTdWNjZXNzID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uXTtcblx0XHRcdFx0aWYocmVwb3J0U3VjY2VzcyAhPT0gbnVsbCAmJiByZXBvcnRTdWNjZXNzICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRyZXBvcnRTdWNjZXNzKGpzb24pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGRlbGV0ZSB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25dO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSBpZihqc29uW1wiamFudXNcIl0gPT09IFwic3VjY2Vzc1wiKSB7XG5cdFx0XHQvLyBTdWNjZXNzIVxuXHRcdFx0SmFudXMuZGVidWcoXCJHb3QgYSBzdWNjZXNzIG9uIHNlc3Npb24gXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHR2YXIgdHJhbnNhY3Rpb24gPSBqc29uW1widHJhbnNhY3Rpb25cIl07XG5cdFx0XHRpZih0cmFuc2FjdGlvbiAhPT0gbnVsbCAmJiB0cmFuc2FjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHZhciByZXBvcnRTdWNjZXNzID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uXTtcblx0XHRcdFx0aWYocmVwb3J0U3VjY2VzcyAhPT0gbnVsbCAmJiByZXBvcnRTdWNjZXNzICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRyZXBvcnRTdWNjZXNzKGpzb24pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGRlbGV0ZSB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25dO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSBpZihqc29uW1wiamFudXNcIl0gPT09IFwidHJpY2tsZVwiKSB7XG5cdFx0XHQvLyBXZSBnb3QgYSB0cmlja2xlIGNhbmRpZGF0ZSBmcm9tIEphbnVzXG5cdFx0XHR2YXIgc2VuZGVyID0ganNvbltcInNlbmRlclwiXTtcblx0XHRcdGlmKHNlbmRlciA9PT0gdW5kZWZpbmVkIHx8IHNlbmRlciA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTWlzc2luZyBzZW5kZXIuLi5cIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW3NlbmRlcl07XG5cdFx0XHRpZihwbHVnaW5IYW5kbGUgPT09IHVuZGVmaW5lZCB8fCBwbHVnaW5IYW5kbGUgPT09IG51bGwpIHtcblx0XHRcdFx0SmFudXMuZGVidWcoXCJUaGlzIGhhbmRsZSBpcyBub3QgYXR0YWNoZWQgdG8gdGhpcyBzZXNzaW9uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgY2FuZGlkYXRlID0ganNvbltcImNhbmRpZGF0ZVwiXTtcblx0XHRcdEphbnVzLmRlYnVnKFwiR290IGEgdHJpY2tsZWQgY2FuZGlkYXRlIG9uIHNlc3Npb24gXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0SmFudXMuZGVidWcoY2FuZGlkYXRlKTtcblx0XHRcdHZhciBjb25maWcgPSBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmY7XG5cdFx0XHRpZihjb25maWcucGMgJiYgY29uZmlnLnJlbW90ZVNkcCkge1xuXHRcdFx0XHQvLyBBZGQgY2FuZGlkYXRlIHJpZ2h0IG5vd1xuXHRcdFx0XHRKYW51cy5kZWJ1ZyhcIkFkZGluZyByZW1vdGUgY2FuZGlkYXRlOlwiLCBjYW5kaWRhdGUpO1xuXHRcdFx0XHRpZighY2FuZGlkYXRlIHx8IGNhbmRpZGF0ZS5jb21wbGV0ZWQgPT09IHRydWUpIHtcblx0XHRcdFx0XHQvLyBlbmQtb2YtY2FuZGlkYXRlc1xuXHRcdFx0XHRcdGNvbmZpZy5wYy5hZGRJY2VDYW5kaWRhdGUoSmFudXMuZW5kT2ZDYW5kaWRhdGVzKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBOZXcgY2FuZGlkYXRlXG5cdFx0XHRcdFx0Y29uZmlnLnBjLmFkZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBXZSBkaWRuJ3QgZG8gc2V0UmVtb3RlRGVzY3JpcHRpb24gKHRyaWNrbGUgZ290IGhlcmUgYmVmb3JlIHRoZSBvZmZlcj8pXG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiV2UgZGlkbid0IGRvIHNldFJlbW90ZURlc2NyaXB0aW9uICh0cmlja2xlIGdvdCBoZXJlIGJlZm9yZSB0aGUgb2ZmZXI/KSwgY2FjaGluZyBjYW5kaWRhdGVcIik7XG5cdFx0XHRcdGlmKCFjb25maWcuY2FuZGlkYXRlcylcblx0XHRcdFx0XHRjb25maWcuY2FuZGlkYXRlcyA9IFtdO1xuXHRcdFx0XHRjb25maWcuY2FuZGlkYXRlcy5wdXNoKGNhbmRpZGF0ZSk7XG5cdFx0XHRcdEphbnVzLmRlYnVnKGNvbmZpZy5jYW5kaWRhdGVzKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYoanNvbltcImphbnVzXCJdID09PSBcIndlYnJ0Y3VwXCIpIHtcblx0XHRcdC8vIFRoZSBQZWVyQ29ubmVjdGlvbiB3aXRoIHRoZSBzZXJ2ZXIgaXMgdXAhIE5vdGlmeSB0aGlzXG5cdFx0XHRKYW51cy5kZWJ1ZyhcIkdvdCBhIHdlYnJ0Y3VwIGV2ZW50IG9uIHNlc3Npb24gXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHR2YXIgc2VuZGVyID0ganNvbltcInNlbmRlclwiXTtcblx0XHRcdGlmKHNlbmRlciA9PT0gdW5kZWZpbmVkIHx8IHNlbmRlciA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTWlzc2luZyBzZW5kZXIuLi5cIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW3NlbmRlcl07XG5cdFx0XHRpZihwbHVnaW5IYW5kbGUgPT09IHVuZGVmaW5lZCB8fCBwbHVnaW5IYW5kbGUgPT09IG51bGwpIHtcblx0XHRcdFx0SmFudXMuZGVidWcoXCJUaGlzIGhhbmRsZSBpcyBub3QgYXR0YWNoZWQgdG8gdGhpcyBzZXNzaW9uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRwbHVnaW5IYW5kbGUud2VicnRjU3RhdGUodHJ1ZSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fSBlbHNlIGlmKGpzb25bXCJqYW51c1wiXSA9PT0gXCJoYW5ndXBcIikge1xuXHRcdFx0Ly8gQSBwbHVnaW4gYXNrZWQgdGhlIGNvcmUgdG8gaGFuZ3VwIGEgUGVlckNvbm5lY3Rpb24gb24gb25lIG9mIG91ciBoYW5kbGVzXG5cdFx0XHRKYW51cy5kZWJ1ZyhcIkdvdCBhIGhhbmd1cCBldmVudCBvbiBzZXNzaW9uIFwiICsgc2Vzc2lvbklkKTtcblx0XHRcdEphbnVzLmRlYnVnKGpzb24pO1xuXHRcdFx0dmFyIHNlbmRlciA9IGpzb25bXCJzZW5kZXJcIl07XG5cdFx0XHRpZihzZW5kZXIgPT09IHVuZGVmaW5lZCB8fCBzZW5kZXIgPT09IG51bGwpIHtcblx0XHRcdFx0SmFudXMud2FybihcIk1pc3Npbmcgc2VuZGVyLi4uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1tzZW5kZXJdO1xuXHRcdFx0aWYocGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHwgcGx1Z2luSGFuZGxlID09PSBudWxsKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiVGhpcyBoYW5kbGUgaXMgbm90IGF0dGFjaGVkIHRvIHRoaXMgc2Vzc2lvblwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0YXRlKGZhbHNlLCBqc29uW1wicmVhc29uXCJdKTtcblx0XHRcdHBsdWdpbkhhbmRsZS5oYW5ndXAoKTtcblx0XHR9IGVsc2UgaWYoanNvbltcImphbnVzXCJdID09PSBcImRldGFjaGVkXCIpIHtcblx0XHRcdC8vIEEgcGx1Z2luIGFza2VkIHRoZSBjb3JlIHRvIGRldGFjaCBvbmUgb2Ygb3VyIGhhbmRsZXNcblx0XHRcdEphbnVzLmRlYnVnKFwiR290IGEgZGV0YWNoZWQgZXZlbnQgb24gc2Vzc2lvbiBcIiArIHNlc3Npb25JZCk7XG5cdFx0XHRKYW51cy5kZWJ1Zyhqc29uKTtcblx0XHRcdHZhciBzZW5kZXIgPSBqc29uW1wic2VuZGVyXCJdO1xuXHRcdFx0aWYoc2VuZGVyID09PSB1bmRlZmluZWQgfHwgc2VuZGVyID09PSBudWxsKSB7XG5cdFx0XHRcdEphbnVzLndhcm4oXCJNaXNzaW5nIHNlbmRlci4uLlwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbc2VuZGVyXTtcblx0XHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8IHBsdWdpbkhhbmRsZSA9PT0gbnVsbCkge1xuXHRcdFx0XHQvLyBEb24ndCB3YXJuIGhlcmUgYmVjYXVzZSBkZXN0cm95SGFuZGxlIGNhdXNlcyB0aGlzIHNpdHVhdGlvbi5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0cGx1Z2luSGFuZGxlLmRldGFjaGVkID0gdHJ1ZTtcblx0XHRcdHBsdWdpbkhhbmRsZS5vbmRldGFjaGVkKCk7XG5cdFx0XHRwbHVnaW5IYW5kbGUuZGV0YWNoKCk7XG5cdFx0fSBlbHNlIGlmKGpzb25bXCJqYW51c1wiXSA9PT0gXCJtZWRpYVwiKSB7XG5cdFx0XHQvLyBNZWRpYSBzdGFydGVkL3N0b3BwZWQgZmxvd2luZ1xuXHRcdFx0SmFudXMuZGVidWcoXCJHb3QgYSBtZWRpYSBldmVudCBvbiBzZXNzaW9uIFwiICsgc2Vzc2lvbklkKTtcblx0XHRcdEphbnVzLmRlYnVnKGpzb24pO1xuXHRcdFx0dmFyIHNlbmRlciA9IGpzb25bXCJzZW5kZXJcIl07XG5cdFx0XHRpZihzZW5kZXIgPT09IHVuZGVmaW5lZCB8fCBzZW5kZXIgPT09IG51bGwpIHtcblx0XHRcdFx0SmFudXMud2FybihcIk1pc3Npbmcgc2VuZGVyLi4uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1tzZW5kZXJdO1xuXHRcdFx0aWYocGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHwgcGx1Z2luSGFuZGxlID09PSBudWxsKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiVGhpcyBoYW5kbGUgaXMgbm90IGF0dGFjaGVkIHRvIHRoaXMgc2Vzc2lvblwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0cGx1Z2luSGFuZGxlLm1lZGlhU3RhdGUoanNvbltcInR5cGVcIl0sIGpzb25bXCJyZWNlaXZpbmdcIl0pO1xuXHRcdH0gZWxzZSBpZihqc29uW1wiamFudXNcIl0gPT09IFwic2xvd2xpbmtcIikge1xuXHRcdFx0SmFudXMuZGVidWcoXCJHb3QgYSBzbG93bGluayBldmVudCBvbiBzZXNzaW9uIFwiICsgc2Vzc2lvbklkKTtcblx0XHRcdEphbnVzLmRlYnVnKGpzb24pO1xuXHRcdFx0Ly8gVHJvdWJsZSB1cGxpbmsgb3IgZG93bmxpbmtcblx0XHRcdHZhciBzZW5kZXIgPSBqc29uW1wic2VuZGVyXCJdO1xuXHRcdFx0aWYoc2VuZGVyID09PSB1bmRlZmluZWQgfHwgc2VuZGVyID09PSBudWxsKSB7XG5cdFx0XHRcdEphbnVzLndhcm4oXCJNaXNzaW5nIHNlbmRlci4uLlwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbc2VuZGVyXTtcblx0XHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8IHBsdWdpbkhhbmRsZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy5kZWJ1ZyhcIlRoaXMgaGFuZGxlIGlzIG5vdCBhdHRhY2hlZCB0byB0aGlzIHNlc3Npb25cIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHBsdWdpbkhhbmRsZS5zbG93TGluayhqc29uW1widXBsaW5rXCJdLCBqc29uW1wibG9zdFwiXSk7XG5cdFx0fSBlbHNlIGlmKGpzb25bXCJqYW51c1wiXSA9PT0gXCJlcnJvclwiKSB7XG5cdFx0XHQvLyBPb3BzLCBzb21ldGhpbmcgd3JvbmcgaGFwcGVuZWRcblx0XHRcdEphbnVzLmVycm9yKFwiT29vcHM6IFwiICsganNvbltcImVycm9yXCJdLmNvZGUgKyBcIiBcIiArIGpzb25bXCJlcnJvclwiXS5yZWFzb24pO1x0Ly8gRklYTUVcblx0XHRcdEphbnVzLmRlYnVnKGpzb24pO1xuXHRcdFx0dmFyIHRyYW5zYWN0aW9uID0ganNvbltcInRyYW5zYWN0aW9uXCJdO1xuXHRcdFx0aWYodHJhbnNhY3Rpb24gIT09IG51bGwgJiYgdHJhbnNhY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR2YXIgcmVwb3J0U3VjY2VzcyA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbl07XG5cdFx0XHRcdGlmKHJlcG9ydFN1Y2Nlc3MgIT09IG51bGwgJiYgcmVwb3J0U3VjY2VzcyAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0cmVwb3J0U3VjY2Vzcyhqc29uKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRkZWxldGUgdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uXTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2UgaWYoanNvbltcImphbnVzXCJdID09PSBcImV2ZW50XCIpIHtcblx0XHRcdEphbnVzLmRlYnVnKFwiR290IGEgcGx1Z2luIGV2ZW50IG9uIHNlc3Npb24gXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHR2YXIgc2VuZGVyID0ganNvbltcInNlbmRlclwiXTtcblx0XHRcdGlmKHNlbmRlciA9PT0gdW5kZWZpbmVkIHx8IHNlbmRlciA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTWlzc2luZyBzZW5kZXIuLi5cIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBwbHVnaW5kYXRhID0ganNvbltcInBsdWdpbmRhdGFcIl07XG5cdFx0XHRpZihwbHVnaW5kYXRhID09PSB1bmRlZmluZWQgfHwgcGx1Z2luZGF0YSA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTWlzc2luZyBwbHVnaW5kYXRhLi4uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRKYW51cy5kZWJ1ZyhcIiAgLS0gRXZlbnQgaXMgY29taW5nIGZyb20gXCIgKyBzZW5kZXIgKyBcIiAoXCIgKyBwbHVnaW5kYXRhW1wicGx1Z2luXCJdICsgXCIpXCIpO1xuXHRcdFx0dmFyIGRhdGEgPSBwbHVnaW5kYXRhW1wiZGF0YVwiXTtcblx0XHRcdEphbnVzLmRlYnVnKGRhdGEpO1xuXHRcdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbc2VuZGVyXTtcblx0XHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8IHBsdWdpbkhhbmRsZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiVGhpcyBoYW5kbGUgaXMgbm90IGF0dGFjaGVkIHRvIHRoaXMgc2Vzc2lvblwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGpzZXAgPSBqc29uW1wianNlcFwiXTtcblx0XHRcdGlmKGpzZXAgIT09IHVuZGVmaW5lZCAmJiBqc2VwICE9PSBudWxsKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiSGFuZGxpbmcgU0RQIGFzIHdlbGwuLi5cIik7XG5cdFx0XHRcdEphbnVzLmRlYnVnKGpzZXApO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGNhbGxiYWNrID0gcGx1Z2luSGFuZGxlLm9ubWVzc2FnZTtcblx0XHRcdGlmKGNhbGxiYWNrICE9PSBudWxsICYmIGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0SmFudXMuZGVidWcoXCJOb3RpZnlpbmcgYXBwbGljYXRpb24uLi5cIik7XG5cdFx0XHRcdC8vIFNlbmQgdG8gY2FsbGJhY2sgc3BlY2lmaWVkIHdoZW4gYXR0YWNoaW5nIHBsdWdpbiBoYW5kbGVcblx0XHRcdFx0Y2FsbGJhY2soZGF0YSwganNlcCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBTZW5kIHRvIGdlbmVyaWMgY2FsbGJhY2sgKD8pXG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiTm8gcHJvdmlkZWQgbm90aWZpY2F0aW9uIGNhbGxiYWNrXCIpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZihqc29uW1wiamFudXNcIl0gPT09IFwidGltZW91dFwiKSB7XG5cdFx0XHRKYW51cy5lcnJvcihcIlRpbWVvdXQgb24gc2Vzc2lvbiBcIiArIHNlc3Npb25JZCk7XG5cdFx0XHRKYW51cy5kZWJ1Zyhqc29uKTtcblx0XHRcdGlmICh3ZWJzb2NrZXRzKSB7XG5cdFx0XHRcdHdzLmNsb3NlKDM1MDQsIFwiR2F0ZXdheSB0aW1lb3V0XCIpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRKYW51cy53YXJuKFwiVW5rbm93biBtZXNzYWdlL2V2ZW50ICAnXCIgKyBqc29uW1wiamFudXNcIl0gKyBcIicgb24gc2Vzc2lvbiBcIiArIHNlc3Npb25JZCk7XG5cdFx0XHRKYW51cy5kZWJ1Zyhqc29uKTtcblx0XHR9XG5cdH1cblxuXHQvLyBQcml2YXRlIGhlbHBlciB0byBzZW5kIGtlZXAtYWxpdmUgbWVzc2FnZXMgb24gV2ViU29ja2V0c1xuXHRmdW5jdGlvbiBrZWVwQWxpdmUoKSB7XG5cdFx0aWYoc2VydmVyID09PSBudWxsIHx8ICF3ZWJzb2NrZXRzIHx8ICFjb25uZWN0ZWQpXG5cdFx0XHRyZXR1cm47XG5cdFx0d3NLZWVwYWxpdmVUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KGtlZXBBbGl2ZSwga2VlcEFsaXZlUGVyaW9kKTtcblx0XHR2YXIgcmVxdWVzdCA9IHsgXCJqYW51c1wiOiBcImtlZXBhbGl2ZVwiLCBcInNlc3Npb25faWRcIjogc2Vzc2lvbklkLCBcInRyYW5zYWN0aW9uXCI6IEphbnVzLnJhbmRvbVN0cmluZygxMikgfTtcblx0XHRpZih0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdFtcInRva2VuXCJdID0gdG9rZW47XG5cdFx0aWYoYXBpc2VjcmV0ICE9PSBudWxsICYmIGFwaXNlY3JldCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdFtcImFwaXNlY3JldFwiXSA9IGFwaXNlY3JldDtcblx0XHR3cy5zZW5kKEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcblx0fVxuXG5cdC8vIFByaXZhdGUgbWV0aG9kIHRvIGNyZWF0ZSBhIHNlc3Npb25cblx0ZnVuY3Rpb24gY3JlYXRlU2Vzc2lvbihjYWxsYmFja3MpIHtcblx0XHR2YXIgdHJhbnNhY3Rpb24gPSBKYW51cy5yYW5kb21TdHJpbmcoMTIpO1xuXHRcdHZhciByZXF1ZXN0ID0geyBcImphbnVzXCI6IFwiY3JlYXRlXCIsIFwidHJhbnNhY3Rpb25cIjogdHJhbnNhY3Rpb24gfTtcblx0XHRpZihjYWxsYmFja3NbXCJyZWNvbm5lY3RcIl0pIHtcblx0XHRcdC8vIFdlJ3JlIHJlY29ubmVjdGluZywgY2xhaW0gdGhlIHNlc3Npb25cblx0XHRcdGNvbm5lY3RlZCA9IGZhbHNlO1xuXHRcdFx0cmVxdWVzdFtcImphbnVzXCJdID0gXCJjbGFpbVwiO1xuXHRcdFx0cmVxdWVzdFtcInNlc3Npb25faWRcIl0gPSBzZXNzaW9uSWQ7XG5cdFx0XHQvLyBJZiB3ZSB3ZXJlIHVzaW5nIHdlYnNvY2tldHMsIGlnbm9yZSB0aGUgb2xkIGNvbm5lY3Rpb25cblx0XHRcdGlmKHdzKSB7XG5cdFx0XHRcdHdzLm9ub3BlbiA9IG51bGw7XG5cdFx0XHRcdHdzLm9uZXJyb3IgPSBudWxsO1xuXHRcdFx0XHR3cy5vbmNsb3NlID0gbnVsbDtcblx0XHRcdFx0aWYod3NLZWVwYWxpdmVUaW1lb3V0SWQpIHtcblx0XHRcdFx0XHRjbGVhclRpbWVvdXQod3NLZWVwYWxpdmVUaW1lb3V0SWQpO1xuXHRcdFx0XHRcdHdzS2VlcGFsaXZlVGltZW91dElkID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRpZih0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdFtcInRva2VuXCJdID0gdG9rZW47XG5cdFx0aWYoYXBpc2VjcmV0ICE9PSBudWxsICYmIGFwaXNlY3JldCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdFtcImFwaXNlY3JldFwiXSA9IGFwaXNlY3JldDtcblx0XHRpZihzZXJ2ZXIgPT09IG51bGwgJiYgSmFudXMuaXNBcnJheShzZXJ2ZXJzKSkge1xuXHRcdFx0Ly8gV2Ugc3RpbGwgbmVlZCB0byBmaW5kIGEgd29ya2luZyBzZXJ2ZXIgZnJvbSB0aGUgbGlzdCB3ZSB3ZXJlIGdpdmVuXG5cdFx0XHRzZXJ2ZXIgPSBzZXJ2ZXJzW3NlcnZlcnNJbmRleF07XG5cdFx0XHRpZihzZXJ2ZXIuaW5kZXhPZihcIndzXCIpID09PSAwKSB7XG5cdFx0XHRcdHdlYnNvY2tldHMgPSB0cnVlO1xuXHRcdFx0XHRKYW51cy5sb2coXCJTZXJ2ZXIgI1wiICsgKHNlcnZlcnNJbmRleCsxKSArIFwiOiB0cnlpbmcgV2ViU29ja2V0cyB0byBjb250YWN0IEphbnVzIChcIiArIHNlcnZlciArIFwiKVwiKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdlYnNvY2tldHMgPSBmYWxzZTtcblx0XHRcdFx0SmFudXMubG9nKFwiU2VydmVyICNcIiArIChzZXJ2ZXJzSW5kZXgrMSkgKyBcIjogdHJ5aW5nIFJFU1QgQVBJIHRvIGNvbnRhY3QgSmFudXMgKFwiICsgc2VydmVyICsgXCIpXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZih3ZWJzb2NrZXRzKSB7XG5cdFx0XHR3cyA9IEphbnVzLm5ld1dlYlNvY2tldChzZXJ2ZXIsICdqYW51cy1wcm90b2NvbCcpO1xuXHRcdFx0d3NIYW5kbGVycyA9IHtcblx0XHRcdFx0J2Vycm9yJzogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJFcnJvciBjb25uZWN0aW5nIHRvIHRoZSBKYW51cyBXZWJTb2NrZXRzIHNlcnZlci4uLiBcIiArIHNlcnZlcik7XG5cdFx0XHRcdFx0aWYgKEphbnVzLmlzQXJyYXkoc2VydmVycykgJiYgIWNhbGxiYWNrc1tcInJlY29ubmVjdFwiXSkge1xuXHRcdFx0XHRcdFx0c2VydmVyc0luZGV4Kys7XG5cdFx0XHRcdFx0XHRpZiAoc2VydmVyc0luZGV4ID09IHNlcnZlcnMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdC8vIFdlIHRyaWVkIGFsbCB0aGUgc2VydmVycyB0aGUgdXNlciBnYXZlIHVzIGFuZCB0aGV5IGFsbCBmYWlsZWRcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiRXJyb3IgY29ubmVjdGluZyB0byBhbnkgb2YgdGhlIHByb3ZpZGVkIEphbnVzIHNlcnZlcnM6IElzIHRoZSBzZXJ2ZXIgZG93bj9cIik7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8vIExldCdzIHRyeSB0aGUgbmV4dCBzZXJ2ZXJcblx0XHRcdFx0XHRcdHNlcnZlciA9IG51bGw7XG5cdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRjcmVhdGVTZXNzaW9uKGNhbGxiYWNrcyk7XG5cdFx0XHRcdFx0XHR9LCAyMDApO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJFcnJvciBjb25uZWN0aW5nIHRvIHRoZSBKYW51cyBXZWJTb2NrZXRzIHNlcnZlcjogSXMgdGhlIHNlcnZlciBkb3duP1wiKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHQnb3Blbic6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIFdlIG5lZWQgdG8gYmUgbm90aWZpZWQgYWJvdXQgdGhlIHN1Y2Nlc3Ncblx0XHRcdFx0XHR0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25dID0gZnVuY3Rpb24oanNvbikge1xuXHRcdFx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdFx0XHRpZiAoanNvbltcImphbnVzXCJdICE9PSBcInN1Y2Nlc3NcIikge1xuXHRcdFx0XHRcdFx0XHRKYW51cy5lcnJvcihcIk9vb3BzOiBcIiArIGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcdC8vIEZJWE1FXG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0d3NLZWVwYWxpdmVUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KGtlZXBBbGl2ZSwga2VlcEFsaXZlUGVyaW9kKTtcblx0XHRcdFx0XHRcdGNvbm5lY3RlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRzZXNzaW9uSWQgPSBqc29uW1wic2Vzc2lvbl9pZFwiXSA/IGpzb25bXCJzZXNzaW9uX2lkXCJdIDoganNvbi5kYXRhW1wiaWRcIl07XG5cdFx0XHRcdFx0XHRpZihjYWxsYmFja3NbXCJyZWNvbm5lY3RcIl0pIHtcblx0XHRcdFx0XHRcdFx0SmFudXMubG9nKFwiQ2xhaW1lZCBzZXNzaW9uOiBcIiArIHNlc3Npb25JZCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRKYW51cy5sb2coXCJDcmVhdGVkIHNlc3Npb246IFwiICsgc2Vzc2lvbklkKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLnNlc3Npb25zW3Nlc3Npb25JZF0gPSB0aGF0O1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkocmVxdWVzdCkpO1xuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdCdtZXNzYWdlJzogZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFx0XHRoYW5kbGVFdmVudChKU09OLnBhcnNlKGV2ZW50LmRhdGEpKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHQnY2xvc2UnOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRpZiAoc2VydmVyID09PSBudWxsIHx8ICFjb25uZWN0ZWQpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29ubmVjdGVkID0gZmFsc2U7XG5cdFx0XHRcdFx0Ly8gRklYTUUgV2hhdCBpZiB0aGlzIGlzIGNhbGxlZCB3aGVuIHRoZSBwYWdlIGlzIGNsb3NlZD9cblx0XHRcdFx0XHRnYXRld2F5Q2FsbGJhY2tzLmVycm9yKFwiTG9zdCBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgKGlzIGl0IGRvd24/KVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0Zm9yKHZhciBldmVudE5hbWUgaW4gd3NIYW5kbGVycykge1xuXHRcdFx0XHR3cy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgd3NIYW5kbGVyc1tldmVudE5hbWVdKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRKYW51cy5odHRwQVBJQ2FsbChzZXJ2ZXIsIHtcblx0XHRcdHZlcmI6ICdQT1NUJyxcblx0XHRcdHdpdGhDcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzLFxuXHRcdFx0Ym9keTogcmVxdWVzdCxcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdGlmKGpzb25bXCJqYW51c1wiXSAhPT0gXCJzdWNjZXNzXCIpIHtcblx0XHRcdFx0XHRKYW51cy5lcnJvcihcIk9vb3BzOiBcIiArIGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcdC8vIEZJWE1FXG5cdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKGpzb25bXCJlcnJvclwiXS5yZWFzb24pO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25uZWN0ZWQgPSB0cnVlO1xuXHRcdFx0XHRzZXNzaW9uSWQgPSBqc29uW1wic2Vzc2lvbl9pZFwiXSA/IGpzb25bXCJzZXNzaW9uX2lkXCJdIDoganNvbi5kYXRhW1wiaWRcIl07XG5cdFx0XHRcdGlmKGNhbGxiYWNrc1tcInJlY29ubmVjdFwiXSkge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIkNsYWltZWQgc2Vzc2lvbjogXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIkNyZWF0ZWQgc2Vzc2lvbjogXCIgKyBzZXNzaW9uSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdEphbnVzLnNlc3Npb25zW3Nlc3Npb25JZF0gPSB0aGF0O1xuXHRcdFx0XHRldmVudEhhbmRsZXIoKTtcblx0XHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoKTtcblx0XHRcdH0sXG5cdFx0XHRlcnJvcjogZnVuY3Rpb24odGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblx0XHRcdFx0SmFudXMuZXJyb3IodGV4dFN0YXR1cyArIFwiOlwiLCBlcnJvclRocm93bik7XHQvLyBGSVhNRVxuXHRcdFx0XHRpZihKYW51cy5pc0FycmF5KHNlcnZlcnMpICYmICFjYWxsYmFja3NbXCJyZWNvbm5lY3RcIl0pIHtcblx0XHRcdFx0XHRzZXJ2ZXJzSW5kZXgrKztcblx0XHRcdFx0XHRpZihzZXJ2ZXJzSW5kZXggPT0gc2VydmVycy5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdC8vIFdlIHRyaWVkIGFsbCB0aGUgc2VydmVycyB0aGUgdXNlciBnYXZlIHVzIGFuZCB0aGV5IGFsbCBmYWlsZWRcblx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkVycm9yIGNvbm5lY3RpbmcgdG8gYW55IG9mIHRoZSBwcm92aWRlZCBKYW51cyBzZXJ2ZXJzOiBJcyB0aGUgc2VydmVyIGRvd24/XCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQvLyBMZXQncyB0cnkgdGhlIG5leHQgc2VydmVyXG5cdFx0XHRcdFx0c2VydmVyID0gbnVsbDtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjcmVhdGVTZXNzaW9uKGNhbGxiYWNrcyk7IH0sIDIwMCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKGVycm9yVGhyb3duID09PSBcIlwiKVxuXHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcih0ZXh0U3RhdHVzICsgXCI6IElzIHRoZSBzZXJ2ZXIgZG93bj9cIik7XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IodGV4dFN0YXR1cyArIFwiOiBcIiArIGVycm9yVGhyb3duKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8vIFByaXZhdGUgbWV0aG9kIHRvIGRlc3Ryb3kgYSBzZXNzaW9uXG5cdGZ1bmN0aW9uIGRlc3Ryb3lTZXNzaW9uKGNhbGxiYWNrcykge1xuXHRcdGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTtcblx0XHQvLyBGSVhNRSBUaGlzIG1ldGhvZCB0cmlnZ2VycyBhIHN1Y2Nlc3MgZXZlbiB3aGVuIHdlIGZhaWxcblx0XHRjYWxsYmFja3Muc3VjY2VzcyA9ICh0eXBlb2YgY2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5zdWNjZXNzIDogSmFudXMubm9vcDtcblx0XHR2YXIgYXN5bmNSZXF1ZXN0ID0gdHJ1ZTtcblx0XHRpZihjYWxsYmFja3MuYXN5bmNSZXF1ZXN0ICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2tzLmFzeW5jUmVxdWVzdCAhPT0gbnVsbClcblx0XHRcdGFzeW5jUmVxdWVzdCA9IChjYWxsYmFja3MuYXN5bmNSZXF1ZXN0ID09PSB0cnVlKTtcblx0XHR2YXIgbm90aWZ5RGVzdHJveWVkID0gdHJ1ZTtcblx0XHRpZihjYWxsYmFja3Mubm90aWZ5RGVzdHJveWVkICE9PSB1bmRlZmluZWQgJiYgY2FsbGJhY2tzLm5vdGlmeURlc3Ryb3llZCAhPT0gbnVsbClcblx0XHRcdG5vdGlmeURlc3Ryb3llZCA9IChjYWxsYmFja3Mubm90aWZ5RGVzdHJveWVkID09PSB0cnVlKTtcblx0XHR2YXIgY2xlYW51cEhhbmRsZXMgPSBmYWxzZTtcblx0XHRpZihjYWxsYmFja3MuY2xlYW51cEhhbmRsZXMgIT09IHVuZGVmaW5lZCAmJiBjYWxsYmFja3MuY2xlYW51cEhhbmRsZXMgIT09IG51bGwpXG5cdFx0XHRjbGVhbnVwSGFuZGxlcyA9IChjYWxsYmFja3MuY2xlYW51cEhhbmRsZXMgPT09IHRydWUpO1xuXHRcdEphbnVzLmxvZyhcIkRlc3Ryb3lpbmcgc2Vzc2lvbiBcIiArIHNlc3Npb25JZCArIFwiIChhc3luYz1cIiArIGFzeW5jUmVxdWVzdCArIFwiKVwiKTtcblx0XHRpZighY29ubmVjdGVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSXMgdGhlIHNlcnZlciBkb3duPyAoY29ubmVjdGVkPWZhbHNlKVwiKTtcblx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGlmKHNlc3Npb25JZCA9PT0gdW5kZWZpbmVkIHx8IHNlc3Npb25JZCA9PT0gbnVsbCkge1xuXHRcdFx0SmFudXMud2FybihcIk5vIHNlc3Npb24gdG8gZGVzdHJveVwiKTtcblx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHRpZihub3RpZnlEZXN0cm95ZWQpXG5cdFx0XHRcdGdhdGV3YXlDYWxsYmFja3MuZGVzdHJveWVkKCk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGlmKGNsZWFudXBIYW5kbGVzKSB7XG5cdFx0XHRmb3IodmFyIGhhbmRsZUlkIGluIHBsdWdpbkhhbmRsZXMpXG5cdFx0XHRcdGRlc3Ryb3lIYW5kbGUoaGFuZGxlSWQsIHsgbm9SZXF1ZXN0OiB0cnVlIH0pO1xuXHRcdH1cblx0XHQvLyBObyBuZWVkIHRvIGRlc3Ryb3kgYWxsIGhhbmRsZXMgZmlyc3QsIEphbnVzIHdpbGwgZG8gdGhhdCBpdHNlbGZcblx0XHR2YXIgcmVxdWVzdCA9IHsgXCJqYW51c1wiOiBcImRlc3Ryb3lcIiwgXCJ0cmFuc2FjdGlvblwiOiBKYW51cy5yYW5kb21TdHJpbmcoMTIpIH07XG5cdFx0aWYodG9rZW4gIT09IG51bGwgJiYgdG9rZW4gIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJ0b2tlblwiXSA9IHRva2VuO1xuXHRcdGlmKGFwaXNlY3JldCAhPT0gbnVsbCAmJiBhcGlzZWNyZXQgIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJhcGlzZWNyZXRcIl0gPSBhcGlzZWNyZXQ7XG5cdFx0aWYod2Vic29ja2V0cykge1xuXHRcdFx0cmVxdWVzdFtcInNlc3Npb25faWRcIl0gPSBzZXNzaW9uSWQ7XG5cblx0XHRcdHZhciB1bmJpbmRXZWJTb2NrZXQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0Zm9yKHZhciBldmVudE5hbWUgaW4gd3NIYW5kbGVycykge1xuXHRcdFx0XHRcdHdzLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB3c0hhbmRsZXJzW2V2ZW50TmFtZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHdzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBvblVuYmluZE1lc3NhZ2UpO1xuXHRcdFx0XHR3cy5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIG9uVW5iaW5kRXJyb3IpO1xuXHRcdFx0XHRpZih3c0tlZXBhbGl2ZVRpbWVvdXRJZCkge1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dCh3c0tlZXBhbGl2ZVRpbWVvdXRJZCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0d3MuY2xvc2UoKTtcblx0XHRcdH07XG5cblx0XHRcdHZhciBvblVuYmluZE1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCl7XG5cdFx0XHRcdHZhciBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcblx0XHRcdFx0aWYoZGF0YS5zZXNzaW9uX2lkID09IHJlcXVlc3Quc2Vzc2lvbl9pZCAmJiBkYXRhLnRyYW5zYWN0aW9uID09IHJlcXVlc3QudHJhbnNhY3Rpb24pIHtcblx0XHRcdFx0XHR1bmJpbmRXZWJTb2NrZXQoKTtcblx0XHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0XHRcdGlmKG5vdGlmeURlc3Ryb3llZClcblx0XHRcdFx0XHRcdGdhdGV3YXlDYWxsYmFja3MuZGVzdHJveWVkKCk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHR2YXIgb25VbmJpbmRFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHRcdHVuYmluZFdlYlNvY2tldCgpO1xuXHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJGYWlsZWQgdG8gZGVzdHJveSB0aGUgc2VydmVyOiBJcyB0aGUgc2VydmVyIGRvd24/XCIpO1xuXHRcdFx0XHRpZihub3RpZnlEZXN0cm95ZWQpXG5cdFx0XHRcdFx0Z2F0ZXdheUNhbGxiYWNrcy5kZXN0cm95ZWQoKTtcblx0XHRcdH07XG5cblx0XHRcdHdzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBvblVuYmluZE1lc3NhZ2UpO1xuXHRcdFx0d3MuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBvblVuYmluZEVycm9yKTtcblxuXHRcdFx0d3Muc2VuZChKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdEphbnVzLmh0dHBBUElDYWxsKHNlcnZlciArIFwiL1wiICsgc2Vzc2lvbklkLCB7XG5cdFx0XHR2ZXJiOiAnUE9TVCcsXG5cdFx0XHRhc3luYzogYXN5bmNSZXF1ZXN0LFx0Ly8gU29tZXRpbWVzIHdlIG5lZWQgZmFsc2UgaGVyZSwgb3IgZGVzdHJveWluZyBpbiBvbmJlZm9yZXVubG9hZCB3b24ndCB3b3JrXG5cdFx0XHR3aXRoQ3JlZGVudGlhbHM6IHdpdGhDcmVkZW50aWFscyxcblx0XHRcdGJvZHk6IHJlcXVlc3QsXG5cdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihqc29uKSB7XG5cdFx0XHRcdEphbnVzLmxvZyhcIkRlc3Ryb3llZCBzZXNzaW9uOlwiKTtcblx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdHNlc3Npb25JZCA9IG51bGw7XG5cdFx0XHRcdGNvbm5lY3RlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihqc29uW1wiamFudXNcIl0gIT09IFwic3VjY2Vzc1wiKSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJPb29wczogXCIgKyBqc29uW1wiZXJyb3JcIl0uY29kZSArIFwiIFwiICsganNvbltcImVycm9yXCJdLnJlYXNvbik7XHQvLyBGSVhNRVxuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHRcdGlmKG5vdGlmeURlc3Ryb3llZClcblx0XHRcdFx0XHRnYXRld2F5Q2FsbGJhY2tzLmRlc3Ryb3llZCgpO1xuXHRcdFx0fSxcblx0XHRcdGVycm9yOiBmdW5jdGlvbih0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuXHRcdFx0XHRKYW51cy5lcnJvcih0ZXh0U3RhdHVzICsgXCI6XCIsIGVycm9yVGhyb3duKTtcdC8vIEZJWE1FXG5cdFx0XHRcdC8vIFJlc2V0IGV2ZXJ5dGhpbmcgYW55d2F5XG5cdFx0XHRcdHNlc3Npb25JZCA9IG51bGw7XG5cdFx0XHRcdGNvbm5lY3RlZCA9IGZhbHNlO1xuXHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0XHRpZihub3RpZnlEZXN0cm95ZWQpXG5cdFx0XHRcdFx0Z2F0ZXdheUNhbGxiYWNrcy5kZXN0cm95ZWQoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8vIFByaXZhdGUgbWV0aG9kIHRvIGNyZWF0ZSBhIHBsdWdpbiBoYW5kbGVcblx0ZnVuY3Rpb24gY3JlYXRlSGFuZGxlKGNhbGxiYWNrcykge1xuXHRcdGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTtcblx0XHRjYWxsYmFja3Muc3VjY2VzcyA9ICh0eXBlb2YgY2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5zdWNjZXNzIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuZXJyb3IgPSAodHlwZW9mIGNhbGxiYWNrcy5lcnJvciA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmVycm9yIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuY29uc2VudERpYWxvZyA9ICh0eXBlb2YgY2FsbGJhY2tzLmNvbnNlbnREaWFsb2cgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5jb25zZW50RGlhbG9nIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuaWNlU3RhdGUgPSAodHlwZW9mIGNhbGxiYWNrcy5pY2VTdGF0ZSA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmljZVN0YXRlIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MubWVkaWFTdGF0ZSA9ICh0eXBlb2YgY2FsbGJhY2tzLm1lZGlhU3RhdGUgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5tZWRpYVN0YXRlIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mud2VicnRjU3RhdGUgPSAodHlwZW9mIGNhbGxiYWNrcy53ZWJydGNTdGF0ZSA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLndlYnJ0Y1N0YXRlIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Muc2xvd0xpbmsgPSAodHlwZW9mIGNhbGxiYWNrcy5zbG93TGluayA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLnNsb3dMaW5rIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25tZXNzYWdlID0gKHR5cGVvZiBjYWxsYmFja3Mub25tZXNzYWdlID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Mub25tZXNzYWdlIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25sb2NhbHN0cmVhbSA9ICh0eXBlb2YgY2FsbGJhY2tzLm9ubG9jYWxzdHJlYW0gPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5vbmxvY2Fsc3RyZWFtIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25yZW1vdGVzdHJlYW0gPSAodHlwZW9mIGNhbGxiYWNrcy5vbnJlbW90ZXN0cmVhbSA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLm9ucmVtb3Rlc3RyZWFtIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25kYXRhID0gKHR5cGVvZiBjYWxsYmFja3Mub25kYXRhID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Mub25kYXRhIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25kYXRhb3BlbiA9ICh0eXBlb2YgY2FsbGJhY2tzLm9uZGF0YW9wZW4gPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5vbmRhdGFvcGVuIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25jbGVhbnVwID0gKHR5cGVvZiBjYWxsYmFja3Mub25jbGVhbnVwID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Mub25jbGVhbnVwIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3Mub25kZXRhY2hlZCA9ICh0eXBlb2YgY2FsbGJhY2tzLm9uZGV0YWNoZWQgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5vbmRldGFjaGVkIDogSmFudXMubm9vcDtcblx0XHRpZighY29ubmVjdGVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSXMgdGhlIHNlcnZlciBkb3duPyAoY29ubmVjdGVkPWZhbHNlKVwiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIklzIHRoZSBzZXJ2ZXIgZG93bj8gKGNvbm5lY3RlZD1mYWxzZSlcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBwbHVnaW4gPSBjYWxsYmFja3MucGx1Z2luO1xuXHRcdGlmKHBsdWdpbiA9PT0gdW5kZWZpbmVkIHx8IHBsdWdpbiA9PT0gbnVsbCkge1xuXHRcdFx0SmFudXMuZXJyb3IoXCJJbnZhbGlkIHBsdWdpblwiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkludmFsaWQgcGx1Z2luXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgb3BhcXVlSWQgPSBjYWxsYmFja3Mub3BhcXVlSWQ7XG5cdFx0dmFyIGhhbmRsZVRva2VuID0gY2FsbGJhY2tzLnRva2VuID8gY2FsbGJhY2tzLnRva2VuIDogdG9rZW47XG5cdFx0dmFyIHRyYW5zYWN0aW9uID0gSmFudXMucmFuZG9tU3RyaW5nKDEyKTtcblx0XHR2YXIgcmVxdWVzdCA9IHsgXCJqYW51c1wiOiBcImF0dGFjaFwiLCBcInBsdWdpblwiOiBwbHVnaW4sIFwib3BhcXVlX2lkXCI6IG9wYXF1ZUlkLCBcInRyYW5zYWN0aW9uXCI6IHRyYW5zYWN0aW9uIH07XG5cdFx0aWYoaGFuZGxlVG9rZW4gIT09IG51bGwgJiYgaGFuZGxlVG9rZW4gIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJ0b2tlblwiXSA9IGhhbmRsZVRva2VuO1xuXHRcdGlmKGFwaXNlY3JldCAhPT0gbnVsbCAmJiBhcGlzZWNyZXQgIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJhcGlzZWNyZXRcIl0gPSBhcGlzZWNyZXQ7XG5cdFx0aWYod2Vic29ja2V0cykge1xuXHRcdFx0dHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uXSA9IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdGlmKGpzb25bXCJqYW51c1wiXSAhPT0gXCJzdWNjZXNzXCIpIHtcblx0XHRcdFx0XHRKYW51cy5lcnJvcihcIk9vb3BzOiBcIiArIGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcdC8vIEZJWE1FXG5cdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiT29vcHM6IFwiICsganNvbltcImVycm9yXCJdLmNvZGUgKyBcIiBcIiArIGpzb25bXCJlcnJvclwiXS5yZWFzb24pO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgaGFuZGxlSWQgPSBqc29uLmRhdGFbXCJpZFwiXTtcblx0XHRcdFx0SmFudXMubG9nKFwiQ3JlYXRlZCBoYW5kbGU6IFwiICsgaGFuZGxlSWQpO1xuXHRcdFx0XHR2YXIgcGx1Z2luSGFuZGxlID1cblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzZXNzaW9uIDogdGhhdCxcblx0XHRcdFx0XHRcdHBsdWdpbiA6IHBsdWdpbixcblx0XHRcdFx0XHRcdGlkIDogaGFuZGxlSWQsXG5cdFx0XHRcdFx0XHR0b2tlbiA6IGhhbmRsZVRva2VuLFxuXHRcdFx0XHRcdFx0ZGV0YWNoZWQgOiBmYWxzZSxcblx0XHRcdFx0XHRcdHdlYnJ0Y1N0dWZmIDoge1xuXHRcdFx0XHRcdFx0XHRzdGFydGVkIDogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdG15U3RyZWFtIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0c3RyZWFtRXh0ZXJuYWwgOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0cmVtb3RlU3RyZWFtIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0bXlTZHAgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRtZWRpYUNvbnN0cmFpbnRzIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0cGMgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRkYXRhQ2hhbm5lbCA6IHt9LFxuXHRcdFx0XHRcdFx0XHRkdG1mU2VuZGVyIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0dHJpY2tsZSA6IHRydWUsXG5cdFx0XHRcdFx0XHRcdGljZURvbmUgOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0dm9sdW1lIDoge1xuXHRcdFx0XHRcdFx0XHRcdHZhbHVlIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0XHR0aW1lciA6IG51bGxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Yml0cmF0ZSA6IHtcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA6IG51bGwsXG5cdFx0XHRcdFx0XHRcdFx0YnNub3cgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRcdGJzYmVmb3JlIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0XHR0c25vdyA6IG51bGwsXG5cdFx0XHRcdFx0XHRcdFx0dHNiZWZvcmUgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRcdHRpbWVyIDogbnVsbFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0Z2V0SWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGhhbmRsZUlkOyB9LFxuXHRcdFx0XHRcdFx0Z2V0UGx1Z2luIDogZnVuY3Rpb24oKSB7IHJldHVybiBwbHVnaW47IH0sXG5cdFx0XHRcdFx0XHRnZXRWb2x1bWUgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGdldFZvbHVtZShoYW5kbGVJZCwgdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRSZW1vdGVWb2x1bWUgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGdldFZvbHVtZShoYW5kbGVJZCwgdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRMb2NhbFZvbHVtZSA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZ2V0Vm9sdW1lKGhhbmRsZUlkLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRpc0F1ZGlvTXV0ZWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGlzTXV0ZWQoaGFuZGxlSWQsIGZhbHNlKTsgfSxcblx0XHRcdFx0XHRcdG11dGVBdWRpbyA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbXV0ZShoYW5kbGVJZCwgZmFsc2UsIHRydWUpOyB9LFxuXHRcdFx0XHRcdFx0dW5tdXRlQXVkaW8gOiBmdW5jdGlvbigpIHsgcmV0dXJuIG11dGUoaGFuZGxlSWQsIGZhbHNlLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRpc1ZpZGVvTXV0ZWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGlzTXV0ZWQoaGFuZGxlSWQsIHRydWUpOyB9LFxuXHRcdFx0XHRcdFx0bXV0ZVZpZGVvIDogZnVuY3Rpb24oKSB7IHJldHVybiBtdXRlKGhhbmRsZUlkLCB0cnVlLCB0cnVlKTsgfSxcblx0XHRcdFx0XHRcdHVubXV0ZVZpZGVvIDogZnVuY3Rpb24oKSB7IHJldHVybiBtdXRlKGhhbmRsZUlkLCB0cnVlLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRCaXRyYXRlIDogZnVuY3Rpb24oKSB7IHJldHVybiBnZXRCaXRyYXRlKGhhbmRsZUlkKTsgfSxcblx0XHRcdFx0XHRcdHNlbmQgOiBmdW5jdGlvbihjYWxsYmFja3MpIHsgc2VuZE1lc3NhZ2UoaGFuZGxlSWQsIGNhbGxiYWNrcyk7IH0sXG5cdFx0XHRcdFx0XHRkYXRhIDogZnVuY3Rpb24oY2FsbGJhY2tzKSB7IHNlbmREYXRhKGhhbmRsZUlkLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0ZHRtZiA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBzZW5kRHRtZihoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfSxcblx0XHRcdFx0XHRcdGNvbnNlbnREaWFsb2cgOiBjYWxsYmFja3MuY29uc2VudERpYWxvZyxcblx0XHRcdFx0XHRcdGljZVN0YXRlIDogY2FsbGJhY2tzLmljZVN0YXRlLFxuXHRcdFx0XHRcdFx0bWVkaWFTdGF0ZSA6IGNhbGxiYWNrcy5tZWRpYVN0YXRlLFxuXHRcdFx0XHRcdFx0d2VicnRjU3RhdGUgOiBjYWxsYmFja3Mud2VicnRjU3RhdGUsXG5cdFx0XHRcdFx0XHRzbG93TGluayA6IGNhbGxiYWNrcy5zbG93TGluayxcblx0XHRcdFx0XHRcdG9ubWVzc2FnZSA6IGNhbGxiYWNrcy5vbm1lc3NhZ2UsXG5cdFx0XHRcdFx0XHRjcmVhdGVPZmZlciA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBwcmVwYXJlV2VicnRjKGhhbmRsZUlkLCB0cnVlLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0Y3JlYXRlQW5zd2VyIDogZnVuY3Rpb24oY2FsbGJhY2tzKSB7IHByZXBhcmVXZWJydGMoaGFuZGxlSWQsIGZhbHNlLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0aGFuZGxlUmVtb3RlSnNlcCA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBwcmVwYXJlV2VicnRjUGVlcihoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfSxcblx0XHRcdFx0XHRcdG9ubG9jYWxzdHJlYW0gOiBjYWxsYmFja3Mub25sb2NhbHN0cmVhbSxcblx0XHRcdFx0XHRcdG9ucmVtb3Rlc3RyZWFtIDogY2FsbGJhY2tzLm9ucmVtb3Rlc3RyZWFtLFxuXHRcdFx0XHRcdFx0b25kYXRhIDogY2FsbGJhY2tzLm9uZGF0YSxcblx0XHRcdFx0XHRcdG9uZGF0YW9wZW4gOiBjYWxsYmFja3Mub25kYXRhb3Blbixcblx0XHRcdFx0XHRcdG9uY2xlYW51cCA6IGNhbGxiYWNrcy5vbmNsZWFudXAsXG5cdFx0XHRcdFx0XHRvbmRldGFjaGVkIDogY2FsbGJhY2tzLm9uZGV0YWNoZWQsXG5cdFx0XHRcdFx0XHRoYW5ndXAgOiBmdW5jdGlvbihzZW5kUmVxdWVzdCkgeyBjbGVhbnVwV2VicnRjKGhhbmRsZUlkLCBzZW5kUmVxdWVzdCA9PT0gdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRkZXRhY2ggOiBmdW5jdGlvbihjYWxsYmFja3MpIHsgZGVzdHJveUhhbmRsZShoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0cGx1Z2luSGFuZGxlc1toYW5kbGVJZF0gPSBwbHVnaW5IYW5kbGU7XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKHBsdWdpbkhhbmRsZSk7XG5cdFx0XHR9O1xuXHRcdFx0cmVxdWVzdFtcInNlc3Npb25faWRcIl0gPSBzZXNzaW9uSWQ7XG5cdFx0XHR3cy5zZW5kKEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0SmFudXMuaHR0cEFQSUNhbGwoc2VydmVyICsgXCIvXCIgKyBzZXNzaW9uSWQsIHtcblx0XHRcdHZlcmI6ICdQT1NUJyxcblx0XHRcdHdpdGhDcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzLFxuXHRcdFx0Ym9keTogcmVxdWVzdCxcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdGlmKGpzb25bXCJqYW51c1wiXSAhPT0gXCJzdWNjZXNzXCIpIHtcblx0XHRcdFx0XHRKYW51cy5lcnJvcihcIk9vb3BzOiBcIiArIGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcdC8vIEZJWE1FXG5cdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiT29vcHM6IFwiICsganNvbltcImVycm9yXCJdLmNvZGUgKyBcIiBcIiArIGpzb25bXCJlcnJvclwiXS5yZWFzb24pO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgaGFuZGxlSWQgPSBqc29uLmRhdGFbXCJpZFwiXTtcblx0XHRcdFx0SmFudXMubG9nKFwiQ3JlYXRlZCBoYW5kbGU6IFwiICsgaGFuZGxlSWQpO1xuXHRcdFx0XHR2YXIgcGx1Z2luSGFuZGxlID1cblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzZXNzaW9uIDogdGhhdCxcblx0XHRcdFx0XHRcdHBsdWdpbiA6IHBsdWdpbixcblx0XHRcdFx0XHRcdGlkIDogaGFuZGxlSWQsXG5cdFx0XHRcdFx0XHR0b2tlbiA6IGhhbmRsZVRva2VuLFxuXHRcdFx0XHRcdFx0ZGV0YWNoZWQgOiBmYWxzZSxcblx0XHRcdFx0XHRcdHdlYnJ0Y1N0dWZmIDoge1xuXHRcdFx0XHRcdFx0XHRzdGFydGVkIDogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdG15U3RyZWFtIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0c3RyZWFtRXh0ZXJuYWwgOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0cmVtb3RlU3RyZWFtIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0bXlTZHAgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRtZWRpYUNvbnN0cmFpbnRzIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0cGMgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRkYXRhQ2hhbm5lbCA6IHt9LFxuXHRcdFx0XHRcdFx0XHRkdG1mU2VuZGVyIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0dHJpY2tsZSA6IHRydWUsXG5cdFx0XHRcdFx0XHRcdGljZURvbmUgOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0dm9sdW1lIDoge1xuXHRcdFx0XHRcdFx0XHRcdHZhbHVlIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0XHR0aW1lciA6IG51bGxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0Yml0cmF0ZSA6IHtcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA6IG51bGwsXG5cdFx0XHRcdFx0XHRcdFx0YnNub3cgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRcdGJzYmVmb3JlIDogbnVsbCxcblx0XHRcdFx0XHRcdFx0XHR0c25vdyA6IG51bGwsXG5cdFx0XHRcdFx0XHRcdFx0dHNiZWZvcmUgOiBudWxsLFxuXHRcdFx0XHRcdFx0XHRcdHRpbWVyIDogbnVsbFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0Z2V0SWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGhhbmRsZUlkOyB9LFxuXHRcdFx0XHRcdFx0Z2V0UGx1Z2luIDogZnVuY3Rpb24oKSB7IHJldHVybiBwbHVnaW47IH0sXG5cdFx0XHRcdFx0XHRnZXRWb2x1bWUgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGdldFZvbHVtZShoYW5kbGVJZCwgdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRSZW1vdGVWb2x1bWUgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGdldFZvbHVtZShoYW5kbGVJZCwgdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRMb2NhbFZvbHVtZSA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZ2V0Vm9sdW1lKGhhbmRsZUlkLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRpc0F1ZGlvTXV0ZWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGlzTXV0ZWQoaGFuZGxlSWQsIGZhbHNlKTsgfSxcblx0XHRcdFx0XHRcdG11dGVBdWRpbyA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbXV0ZShoYW5kbGVJZCwgZmFsc2UsIHRydWUpOyB9LFxuXHRcdFx0XHRcdFx0dW5tdXRlQXVkaW8gOiBmdW5jdGlvbigpIHsgcmV0dXJuIG11dGUoaGFuZGxlSWQsIGZhbHNlLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRpc1ZpZGVvTXV0ZWQgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGlzTXV0ZWQoaGFuZGxlSWQsIHRydWUpOyB9LFxuXHRcdFx0XHRcdFx0bXV0ZVZpZGVvIDogZnVuY3Rpb24oKSB7IHJldHVybiBtdXRlKGhhbmRsZUlkLCB0cnVlLCB0cnVlKTsgfSxcblx0XHRcdFx0XHRcdHVubXV0ZVZpZGVvIDogZnVuY3Rpb24oKSB7IHJldHVybiBtdXRlKGhhbmRsZUlkLCB0cnVlLCBmYWxzZSk7IH0sXG5cdFx0XHRcdFx0XHRnZXRCaXRyYXRlIDogZnVuY3Rpb24oKSB7IHJldHVybiBnZXRCaXRyYXRlKGhhbmRsZUlkKTsgfSxcblx0XHRcdFx0XHRcdHNlbmQgOiBmdW5jdGlvbihjYWxsYmFja3MpIHsgc2VuZE1lc3NhZ2UoaGFuZGxlSWQsIGNhbGxiYWNrcyk7IH0sXG5cdFx0XHRcdFx0XHRkYXRhIDogZnVuY3Rpb24oY2FsbGJhY2tzKSB7IHNlbmREYXRhKGhhbmRsZUlkLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0ZHRtZiA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBzZW5kRHRtZihoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfSxcblx0XHRcdFx0XHRcdGNvbnNlbnREaWFsb2cgOiBjYWxsYmFja3MuY29uc2VudERpYWxvZyxcblx0XHRcdFx0XHRcdGljZVN0YXRlIDogY2FsbGJhY2tzLmljZVN0YXRlLFxuXHRcdFx0XHRcdFx0bWVkaWFTdGF0ZSA6IGNhbGxiYWNrcy5tZWRpYVN0YXRlLFxuXHRcdFx0XHRcdFx0d2VicnRjU3RhdGUgOiBjYWxsYmFja3Mud2VicnRjU3RhdGUsXG5cdFx0XHRcdFx0XHRzbG93TGluayA6IGNhbGxiYWNrcy5zbG93TGluayxcblx0XHRcdFx0XHRcdG9ubWVzc2FnZSA6IGNhbGxiYWNrcy5vbm1lc3NhZ2UsXG5cdFx0XHRcdFx0XHRjcmVhdGVPZmZlciA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBwcmVwYXJlV2VicnRjKGhhbmRsZUlkLCB0cnVlLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0Y3JlYXRlQW5zd2VyIDogZnVuY3Rpb24oY2FsbGJhY2tzKSB7IHByZXBhcmVXZWJydGMoaGFuZGxlSWQsIGZhbHNlLCBjYWxsYmFja3MpOyB9LFxuXHRcdFx0XHRcdFx0aGFuZGxlUmVtb3RlSnNlcCA6IGZ1bmN0aW9uKGNhbGxiYWNrcykgeyBwcmVwYXJlV2VicnRjUGVlcihoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfSxcblx0XHRcdFx0XHRcdG9ubG9jYWxzdHJlYW0gOiBjYWxsYmFja3Mub25sb2NhbHN0cmVhbSxcblx0XHRcdFx0XHRcdG9ucmVtb3Rlc3RyZWFtIDogY2FsbGJhY2tzLm9ucmVtb3Rlc3RyZWFtLFxuXHRcdFx0XHRcdFx0b25kYXRhIDogY2FsbGJhY2tzLm9uZGF0YSxcblx0XHRcdFx0XHRcdG9uZGF0YW9wZW4gOiBjYWxsYmFja3Mub25kYXRhb3Blbixcblx0XHRcdFx0XHRcdG9uY2xlYW51cCA6IGNhbGxiYWNrcy5vbmNsZWFudXAsXG5cdFx0XHRcdFx0XHRvbmRldGFjaGVkIDogY2FsbGJhY2tzLm9uZGV0YWNoZWQsXG5cdFx0XHRcdFx0XHRoYW5ndXAgOiBmdW5jdGlvbihzZW5kUmVxdWVzdCkgeyBjbGVhbnVwV2VicnRjKGhhbmRsZUlkLCBzZW5kUmVxdWVzdCA9PT0gdHJ1ZSk7IH0sXG5cdFx0XHRcdFx0XHRkZXRhY2ggOiBmdW5jdGlvbihjYWxsYmFja3MpIHsgZGVzdHJveUhhbmRsZShoYW5kbGVJZCwgY2FsbGJhY2tzKTsgfVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0cGx1Z2luSGFuZGxlc1toYW5kbGVJZF0gPSBwbHVnaW5IYW5kbGU7XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKHBsdWdpbkhhbmRsZSk7XG5cdFx0XHR9LFxuXHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG5cdFx0XHRcdEphbnVzLmVycm9yKHRleHRTdGF0dXMgKyBcIjpcIiwgZXJyb3JUaHJvd24pO1x0Ly8gRklYTUVcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8vIFByaXZhdGUgbWV0aG9kIHRvIHNlbmQgYSBtZXNzYWdlXG5cdGZ1bmN0aW9uIHNlbmRNZXNzYWdlKGhhbmRsZUlkLCBjYWxsYmFja3MpIHtcblx0XHRjYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307XG5cdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MgPSAodHlwZW9mIGNhbGxiYWNrcy5zdWNjZXNzID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Muc3VjY2VzcyA6IEphbnVzLm5vb3A7XG5cdFx0Y2FsbGJhY2tzLmVycm9yID0gKHR5cGVvZiBjYWxsYmFja3MuZXJyb3IgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5lcnJvciA6IEphbnVzLm5vb3A7XG5cdFx0aWYoIWNvbm5lY3RlZCkge1xuXHRcdFx0SmFudXMud2FybihcIklzIHRoZSBzZXJ2ZXIgZG93bj8gKGNvbm5lY3RlZD1mYWxzZSlcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJcyB0aGUgc2VydmVyIGRvd24/IChjb25uZWN0ZWQ9ZmFsc2UpXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBtZXNzYWdlID0gY2FsbGJhY2tzLm1lc3NhZ2U7XG5cdFx0dmFyIGpzZXAgPSBjYWxsYmFja3MuanNlcDtcblx0XHR2YXIgdHJhbnNhY3Rpb24gPSBKYW51cy5yYW5kb21TdHJpbmcoMTIpO1xuXHRcdHZhciByZXF1ZXN0ID0geyBcImphbnVzXCI6IFwibWVzc2FnZVwiLCBcImJvZHlcIjogbWVzc2FnZSwgXCJ0cmFuc2FjdGlvblwiOiB0cmFuc2FjdGlvbiB9O1xuXHRcdGlmKHBsdWdpbkhhbmRsZS50b2tlbiAhPT0gbnVsbCAmJiBwbHVnaW5IYW5kbGUudG9rZW4gIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJ0b2tlblwiXSA9IHBsdWdpbkhhbmRsZS50b2tlbjtcblx0XHRpZihhcGlzZWNyZXQgIT09IG51bGwgJiYgYXBpc2VjcmV0ICE9PSB1bmRlZmluZWQpXG5cdFx0XHRyZXF1ZXN0W1wiYXBpc2VjcmV0XCJdID0gYXBpc2VjcmV0O1xuXHRcdGlmKGpzZXAgIT09IG51bGwgJiYganNlcCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdC5qc2VwID0ganNlcDtcblx0XHRKYW51cy5kZWJ1ZyhcIlNlbmRpbmcgbWVzc2FnZSB0byBwbHVnaW4gKGhhbmRsZT1cIiArIGhhbmRsZUlkICsgXCIpOlwiKTtcblx0XHRKYW51cy5kZWJ1ZyhyZXF1ZXN0KTtcblx0XHRpZih3ZWJzb2NrZXRzKSB7XG5cdFx0XHRyZXF1ZXN0W1wic2Vzc2lvbl9pZFwiXSA9IHNlc3Npb25JZDtcblx0XHRcdHJlcXVlc3RbXCJoYW5kbGVfaWRcIl0gPSBoYW5kbGVJZDtcblx0XHRcdHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbl0gPSBmdW5jdGlvbihqc29uKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiTWVzc2FnZSBzZW50IVwiKTtcblx0XHRcdFx0SmFudXMuZGVidWcoanNvbik7XG5cdFx0XHRcdGlmKGpzb25bXCJqYW51c1wiXSA9PT0gXCJzdWNjZXNzXCIpIHtcblx0XHRcdFx0XHQvLyBXZSBnb3QgYSBzdWNjZXNzLCBtdXN0IGhhdmUgYmVlbiBhIHN5bmNocm9ub3VzIHRyYW5zYWN0aW9uXG5cdFx0XHRcdFx0dmFyIHBsdWdpbmRhdGEgPSBqc29uW1wicGx1Z2luZGF0YVwiXTtcblx0XHRcdFx0XHRpZihwbHVnaW5kYXRhID09PSB1bmRlZmluZWQgfHwgcGx1Z2luZGF0YSA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0SmFudXMud2FybihcIlJlcXVlc3Qgc3VjY2VlZGVkLCBidXQgbWlzc2luZyBwbHVnaW5kYXRhLi4uXCIpO1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0SmFudXMubG9nKFwiU3luY2hyb25vdXMgdHJhbnNhY3Rpb24gc3VjY2Vzc2Z1bCAoXCIgKyBwbHVnaW5kYXRhW1wicGx1Z2luXCJdICsgXCIpXCIpO1xuXHRcdFx0XHRcdHZhciBkYXRhID0gcGx1Z2luZGF0YVtcImRhdGFcIl07XG5cdFx0XHRcdFx0SmFudXMuZGVidWcoZGF0YSk7XG5cdFx0XHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoZGF0YSk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9IGVsc2UgaWYoanNvbltcImphbnVzXCJdICE9PSBcImFja1wiKSB7XG5cdFx0XHRcdFx0Ly8gTm90IGEgc3VjY2VzcyBhbmQgbm90IGFuIGFjaywgbXVzdCBiZSBhbiBlcnJvclxuXHRcdFx0XHRcdGlmKGpzb25bXCJlcnJvclwiXSAhPT0gdW5kZWZpbmVkICYmIGpzb25bXCJlcnJvclwiXSAhPT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJPb29wczogXCIgKyBqc29uW1wiZXJyb3JcIl0uY29kZSArIFwiIFwiICsganNvbltcImVycm9yXCJdLnJlYXNvbik7XHQvLyBGSVhNRVxuXHRcdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJVbmtub3duIGVycm9yXCIpO1x0Ly8gRklYTUVcblx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIlVua25vd24gZXJyb3JcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBJZiB3ZSBnb3QgaGVyZSwgdGhlIHBsdWdpbiBkZWNpZGVkIHRvIGhhbmRsZSB0aGUgcmVxdWVzdCBhc3luY2hyb25vdXNseVxuXHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0fTtcblx0XHRcdHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkocmVxdWVzdCkpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRKYW51cy5odHRwQVBJQ2FsbChzZXJ2ZXIgKyBcIi9cIiArIHNlc3Npb25JZCArIFwiL1wiICsgaGFuZGxlSWQsIHtcblx0XHRcdHZlcmI6ICdQT1NUJyxcblx0XHRcdHdpdGhDcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzLFxuXHRcdFx0Ym9keTogcmVxdWVzdCxcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0SmFudXMuZGVidWcoXCJNZXNzYWdlIHNlbnQhXCIpO1xuXHRcdFx0XHRKYW51cy5kZWJ1Zyhqc29uKTtcblx0XHRcdFx0aWYoanNvbltcImphbnVzXCJdID09PSBcInN1Y2Nlc3NcIikge1xuXHRcdFx0XHRcdC8vIFdlIGdvdCBhIHN1Y2Nlc3MsIG11c3QgaGF2ZSBiZWVuIGEgc3luY2hyb25vdXMgdHJhbnNhY3Rpb25cblx0XHRcdFx0XHR2YXIgcGx1Z2luZGF0YSA9IGpzb25bXCJwbHVnaW5kYXRhXCJdO1xuXHRcdFx0XHRcdGlmKHBsdWdpbmRhdGEgPT09IHVuZGVmaW5lZCB8fCBwbHVnaW5kYXRhID09PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRKYW51cy53YXJuKFwiUmVxdWVzdCBzdWNjZWVkZWQsIGJ1dCBtaXNzaW5nIHBsdWdpbmRhdGEuLi5cIik7XG5cdFx0XHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRKYW51cy5sb2coXCJTeW5jaHJvbm91cyB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsIChcIiArIHBsdWdpbmRhdGFbXCJwbHVnaW5cIl0gKyBcIilcIik7XG5cdFx0XHRcdFx0dmFyIGRhdGEgPSBwbHVnaW5kYXRhW1wiZGF0YVwiXTtcblx0XHRcdFx0XHRKYW51cy5kZWJ1ZyhkYXRhKTtcblx0XHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcyhkYXRhKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH0gZWxzZSBpZihqc29uW1wiamFudXNcIl0gIT09IFwiYWNrXCIpIHtcblx0XHRcdFx0XHQvLyBOb3QgYSBzdWNjZXNzIGFuZCBub3QgYW4gYWNrLCBtdXN0IGJlIGFuIGVycm9yXG5cdFx0XHRcdFx0aWYoanNvbltcImVycm9yXCJdICE9PSB1bmRlZmluZWQgJiYganNvbltcImVycm9yXCJdICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRKYW51cy5lcnJvcihcIk9vb3BzOiBcIiArIGpzb25bXCJlcnJvclwiXS5jb2RlICsgXCIgXCIgKyBqc29uW1wiZXJyb3JcIl0ucmVhc29uKTtcdC8vIEZJWE1FXG5cdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoanNvbltcImVycm9yXCJdLmNvZGUgKyBcIiBcIiArIGpzb25bXCJlcnJvclwiXS5yZWFzb24pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRKYW51cy5lcnJvcihcIlVua25vd24gZXJyb3JcIik7XHQvLyBGSVhNRVxuXHRcdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiVW5rbm93biBlcnJvclwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIElmIHdlIGdvdCBoZXJlLCB0aGUgcGx1Z2luIGRlY2lkZWQgdG8gaGFuZGxlIHRoZSByZXF1ZXN0IGFzeW5jaHJvbm91c2x5XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHR9LFxuXHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG5cdFx0XHRcdEphbnVzLmVycm9yKHRleHRTdGF0dXMgKyBcIjpcIiwgZXJyb3JUaHJvd24pO1x0Ly8gRklYTUVcblx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKHRleHRTdGF0dXMgKyBcIjogXCIgKyBlcnJvclRocm93bik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBQcml2YXRlIG1ldGhvZCB0byBzZW5kIGEgdHJpY2tsZSBjYW5kaWRhdGVcblx0ZnVuY3Rpb24gc2VuZFRyaWNrbGVDYW5kaWRhdGUoaGFuZGxlSWQsIGNhbmRpZGF0ZSkge1xuXHRcdGlmKCFjb25uZWN0ZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJcyB0aGUgc2VydmVyIGRvd24/IChjb25uZWN0ZWQ9ZmFsc2UpXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgcmVxdWVzdCA9IHsgXCJqYW51c1wiOiBcInRyaWNrbGVcIiwgXCJjYW5kaWRhdGVcIjogY2FuZGlkYXRlLCBcInRyYW5zYWN0aW9uXCI6IEphbnVzLnJhbmRvbVN0cmluZygxMikgfTtcblx0XHRpZihwbHVnaW5IYW5kbGUudG9rZW4gIT09IG51bGwgJiYgcGx1Z2luSGFuZGxlLnRva2VuICE9PSB1bmRlZmluZWQpXG5cdFx0XHRyZXF1ZXN0W1widG9rZW5cIl0gPSBwbHVnaW5IYW5kbGUudG9rZW47XG5cdFx0aWYoYXBpc2VjcmV0ICE9PSBudWxsICYmIGFwaXNlY3JldCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0cmVxdWVzdFtcImFwaXNlY3JldFwiXSA9IGFwaXNlY3JldDtcblx0XHRKYW51cy52ZGVidWcoXCJTZW5kaW5nIHRyaWNrbGUgY2FuZGlkYXRlIChoYW5kbGU9XCIgKyBoYW5kbGVJZCArIFwiKTpcIik7XG5cdFx0SmFudXMudmRlYnVnKHJlcXVlc3QpO1xuXHRcdGlmKHdlYnNvY2tldHMpIHtcblx0XHRcdHJlcXVlc3RbXCJzZXNzaW9uX2lkXCJdID0gc2Vzc2lvbklkO1xuXHRcdFx0cmVxdWVzdFtcImhhbmRsZV9pZFwiXSA9IGhhbmRsZUlkO1xuXHRcdFx0d3Muc2VuZChKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdEphbnVzLmh0dHBBUElDYWxsKHNlcnZlciArIFwiL1wiICsgc2Vzc2lvbklkICsgXCIvXCIgKyBoYW5kbGVJZCwge1xuXHRcdFx0dmVyYjogJ1BPU1QnLFxuXHRcdFx0d2l0aENyZWRlbnRpYWxzOiB3aXRoQ3JlZGVudGlhbHMsXG5cdFx0XHRib2R5OiByZXF1ZXN0LFxuXHRcdFx0c3VjY2VzczogZnVuY3Rpb24oanNvbikge1xuXHRcdFx0XHRKYW51cy52ZGVidWcoXCJDYW5kaWRhdGUgc2VudCFcIik7XG5cdFx0XHRcdEphbnVzLnZkZWJ1Zyhqc29uKTtcblx0XHRcdFx0aWYoanNvbltcImphbnVzXCJdICE9PSBcImFja1wiKSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJPb29wczogXCIgKyBqc29uW1wiZXJyb3JcIl0uY29kZSArIFwiIFwiICsganNvbltcImVycm9yXCJdLnJlYXNvbik7XHQvLyBGSVhNRVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdGVycm9yOiBmdW5jdGlvbih0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuXHRcdFx0XHRKYW51cy5lcnJvcih0ZXh0U3RhdHVzICsgXCI6XCIsIGVycm9yVGhyb3duKTtcdC8vIEZJWE1FXG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBQcml2YXRlIG1ldGhvZCB0byBjcmVhdGUgYSBkYXRhIGNoYW5uZWxcblx0ZnVuY3Rpb24gY3JlYXRlRGF0YUNoYW5uZWwoaGFuZGxlSWQsIGRjbGFiZWwsIGluY29taW5nLCBwZW5kaW5nVGV4dCkge1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBjb25maWcgPSBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmY7XG5cdFx0dmFyIG9uRGF0YUNoYW5uZWxNZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdEphbnVzLmxvZygnUmVjZWl2ZWQgbWVzc2FnZSBvbiBkYXRhIGNoYW5uZWw6JywgZXZlbnQpO1xuXHRcdFx0dmFyIGxhYmVsID0gZXZlbnQudGFyZ2V0LmxhYmVsO1xuXHRcdFx0cGx1Z2luSGFuZGxlLm9uZGF0YShldmVudC5kYXRhLCBsYWJlbCk7XG5cdFx0fVxuXHRcdHZhciBvbkRhdGFDaGFubmVsU3RhdGVDaGFuZ2UgPSBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0SmFudXMubG9nKCdSZWNlaXZlZCBzdGF0ZSBjaGFuZ2Ugb24gZGF0YSBjaGFubmVsOicsIGV2ZW50KTtcblx0XHRcdHZhciBsYWJlbCA9IGV2ZW50LnRhcmdldC5sYWJlbDtcblx0XHRcdHZhciBkY1N0YXRlID0gY29uZmlnLmRhdGFDaGFubmVsW2xhYmVsXSA/IGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucmVhZHlTdGF0ZSA6IFwibnVsbFwiO1xuXHRcdFx0SmFudXMubG9nKCdTdGF0ZSBjaGFuZ2Ugb24gPCcgKyBsYWJlbCArICc+IGRhdGEgY2hhbm5lbDogJyArIGRjU3RhdGUpO1xuXHRcdFx0aWYoZGNTdGF0ZSA9PT0gJ29wZW4nKSB7XG5cdFx0XHRcdC8vIEFueSBwZW5kaW5nIG1lc3NhZ2VzIHRvIHNlbmQ/XG5cdFx0XHRcdGlmKGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucGVuZGluZyAmJiBjb25maWcuZGF0YUNoYW5uZWxbbGFiZWxdLnBlbmRpbmcubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIlNlbmRpbmcgcGVuZGluZyBtZXNzYWdlcyBvbiA8XCIgKyBsYWJlbCArIFwiPjpcIiwgY29uZmlnLmRhdGFDaGFubmVsW2xhYmVsXS5wZW5kaW5nLmxlbmd0aCk7XG5cdFx0XHRcdFx0Zm9yKHZhciBpIGluIGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucGVuZGluZykge1xuXHRcdFx0XHRcdFx0dmFyIHRleHQgPSBjb25maWcuZGF0YUNoYW5uZWxbbGFiZWxdLnBlbmRpbmdbaV07XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJTZW5kaW5nIHN0cmluZyBvbiBkYXRhIGNoYW5uZWwgPFwiICsgbGFiZWwgKyBcIj46IFwiICsgdGV4dCk7XG5cdFx0XHRcdFx0XHRjb25maWcuZGF0YUNoYW5uZWxbbGFiZWxdLnNlbmQodGV4dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucGVuZGluZyA9IFtdO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIE5vdGlmeSB0aGUgb3BlbiBkYXRhIGNoYW5uZWxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLm9uZGF0YW9wZW4obGFiZWwpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHR2YXIgb25EYXRhQ2hhbm5lbEVycm9yID0gZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdEphbnVzLmVycm9yKCdHb3QgZXJyb3Igb24gZGF0YSBjaGFubmVsOicsIGVycm9yKTtcblx0XHRcdC8vIFRPRE9cblx0XHR9XG5cdFx0aWYoIWluY29taW5nKSB7XG5cdFx0XHQvLyBGSVhNRSBBZGQgb3B0aW9ucyAob3JkZXJlZCwgbWF4UmV0cmFuc21pdHMsIGV0Yy4pXG5cdFx0XHRjb25maWcuZGF0YUNoYW5uZWxbZGNsYWJlbF0gPSBjb25maWcucGMuY3JlYXRlRGF0YUNoYW5uZWwoZGNsYWJlbCwge29yZGVyZWQ6ZmFsc2V9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gVGhlIGNoYW5uZWwgd2FzIGNyZWF0ZWQgYnkgSmFudXNcblx0XHRcdGNvbmZpZy5kYXRhQ2hhbm5lbFtkY2xhYmVsXSA9IGluY29taW5nO1xuXHRcdH1cblx0XHRjb25maWcuZGF0YUNoYW5uZWxbZGNsYWJlbF0ub25tZXNzYWdlID0gb25EYXRhQ2hhbm5lbE1lc3NhZ2U7XG5cdFx0Y29uZmlnLmRhdGFDaGFubmVsW2RjbGFiZWxdLm9ub3BlbiA9IG9uRGF0YUNoYW5uZWxTdGF0ZUNoYW5nZTtcblx0XHRjb25maWcuZGF0YUNoYW5uZWxbZGNsYWJlbF0ub25jbG9zZSA9IG9uRGF0YUNoYW5uZWxTdGF0ZUNoYW5nZTtcblx0XHRjb25maWcuZGF0YUNoYW5uZWxbZGNsYWJlbF0ub25lcnJvciA9IG9uRGF0YUNoYW5uZWxFcnJvcjtcblx0XHRjb25maWcuZGF0YUNoYW5uZWxbZGNsYWJlbF0ucGVuZGluZyA9IFtdO1xuXHRcdGlmKHBlbmRpbmdUZXh0KVxuXHRcdFx0Y29uZmlnLmRhdGFDaGFubmVsW2RjbGFiZWxdLnBlbmRpbmcucHVzaChwZW5kaW5nVGV4dCk7XG5cdH1cblxuXHQvLyBQcml2YXRlIG1ldGhvZCB0byBzZW5kIGEgZGF0YSBjaGFubmVsIG1lc3NhZ2Vcblx0ZnVuY3Rpb24gc2VuZERhdGEoaGFuZGxlSWQsIGNhbGxiYWNrcykge1xuXHRcdGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTtcblx0XHRjYWxsYmFja3Muc3VjY2VzcyA9ICh0eXBlb2YgY2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5zdWNjZXNzIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuZXJyb3IgPSAodHlwZW9mIGNhbGxiYWNrcy5lcnJvciA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmVycm9yIDogSmFudXMubm9vcDtcblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBjb25maWcgPSBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmY7XG5cdFx0dmFyIHRleHQgPSBjYWxsYmFja3MudGV4dDtcblx0XHRpZih0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgdGV4dFwiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkludmFsaWQgdGV4dFwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGxhYmVsID0gY2FsbGJhY2tzLmxhYmVsID8gY2FsbGJhY2tzLmxhYmVsIDogSmFudXMuZGF0YUNoYW5EZWZhdWx0TGFiZWw7XG5cdFx0aWYoIWNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0pIHtcblx0XHRcdC8vIENyZWF0ZSBuZXcgZGF0YSBjaGFubmVsIGFuZCB3YWl0IGZvciBpdCB0byBvcGVuXG5cdFx0XHRjcmVhdGVEYXRhQ2hhbm5lbChoYW5kbGVJZCwgbGFiZWwsIGZhbHNlLCB0ZXh0KTtcblx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGlmKGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucmVhZHlTdGF0ZSAhPT0gXCJvcGVuXCIpIHtcblx0XHRcdGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0ucGVuZGluZy5wdXNoKHRleHQpO1xuXHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0SmFudXMubG9nKFwiU2VuZGluZyBzdHJpbmcgb24gZGF0YSBjaGFubmVsIDxcIiArIGxhYmVsICsgXCI+OiBcIiArIHRleHQpO1xuXHRcdGNvbmZpZy5kYXRhQ2hhbm5lbFtsYWJlbF0uc2VuZCh0ZXh0KTtcblx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHR9XG5cblx0Ly8gUHJpdmF0ZSBtZXRob2QgdG8gc2VuZCBhIERUTUYgdG9uZVxuXHRmdW5jdGlvbiBzZW5kRHRtZihoYW5kbGVJZCwgY2FsbGJhY2tzKSB7XG5cdFx0Y2FsbGJhY2tzID0gY2FsbGJhY2tzIHx8IHt9O1xuXHRcdGNhbGxiYWNrcy5zdWNjZXNzID0gKHR5cGVvZiBjYWxsYmFja3Muc3VjY2VzcyA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLnN1Y2Nlc3MgOiBKYW51cy5ub29wO1xuXHRcdGNhbGxiYWNrcy5lcnJvciA9ICh0eXBlb2YgY2FsbGJhY2tzLmVycm9yID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3MuZXJyb3IgOiBKYW51cy5ub29wO1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRpZihjb25maWcuZHRtZlNlbmRlciA9PT0gbnVsbCB8fCBjb25maWcuZHRtZlNlbmRlciA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHQvLyBDcmVhdGUgdGhlIERUTUYgc2VuZGVyIHRoZSBwcm9wZXIgd2F5LCBpZiBwb3NzaWJsZVxuXHRcdFx0aWYoY29uZmlnLnBjICE9PSB1bmRlZmluZWQgJiYgY29uZmlnLnBjICE9PSBudWxsKSB7XG5cdFx0XHRcdHZhciBzZW5kZXJzID0gY29uZmlnLnBjLmdldFNlbmRlcnMoKTtcblx0XHRcdFx0dmFyIGF1ZGlvU2VuZGVyID0gc2VuZGVycy5maW5kKGZ1bmN0aW9uKHNlbmRlcikge1xuXHRcdFx0XHRcdHJldHVybiBzZW5kZXIudHJhY2sgJiYgc2VuZGVyLnRyYWNrLmtpbmQgPT09ICdhdWRpbyc7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRpZighYXVkaW9TZW5kZXIpIHtcblx0XHRcdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBEVE1GIGNvbmZpZ3VyYXRpb24gKG5vIGF1ZGlvIHRyYWNrKVwiKTtcblx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIERUTUYgY29uZmlndXJhdGlvbiAobm8gYXVkaW8gdHJhY2spXCIpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25maWcuZHRtZlNlbmRlciA9IGF1ZGlvU2VuZGVyLmR0bWY7XG5cdFx0XHRcdGlmKGNvbmZpZy5kdG1mU2VuZGVyKSB7XG5cdFx0XHRcdFx0SmFudXMubG9nKFwiQ3JlYXRlZCBEVE1GIFNlbmRlclwiKTtcblx0XHRcdFx0XHRjb25maWcuZHRtZlNlbmRlci5vbnRvbmVjaGFuZ2UgPSBmdW5jdGlvbih0b25lKSB7IEphbnVzLmRlYnVnKFwiU2VudCBEVE1GIHRvbmU6IFwiICsgdG9uZS50b25lKTsgfTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYoY29uZmlnLmR0bWZTZW5kZXIgPT09IG51bGwgfHwgY29uZmlnLmR0bWZTZW5kZXIgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBEVE1GIGNvbmZpZ3VyYXRpb25cIik7XG5cdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkludmFsaWQgRFRNRiBjb25maWd1cmF0aW9uXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHZhciBkdG1mID0gY2FsbGJhY2tzLmR0bWY7XG5cdFx0aWYoZHRtZiA9PT0gbnVsbCB8fCBkdG1mID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIERUTUYgcGFyYW1ldGVyc1wiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkludmFsaWQgRFRNRiBwYXJhbWV0ZXJzXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgdG9uZXMgPSBkdG1mLnRvbmVzO1xuXHRcdGlmKHRvbmVzID09PSBudWxsIHx8IHRvbmVzID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIERUTUYgc3RyaW5nXCIpO1xuXHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiSW52YWxpZCBEVE1GIHN0cmluZ1wiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGR1cmF0aW9uID0gZHRtZi5kdXJhdGlvbjtcblx0XHRpZihkdXJhdGlvbiA9PT0gbnVsbCB8fCBkdXJhdGlvbiA9PT0gdW5kZWZpbmVkKVxuXHRcdFx0ZHVyYXRpb24gPSA1MDA7XHQvLyBXZSBjaG9vc2UgNTAwbXMgYXMgdGhlIGRlZmF1bHQgZHVyYXRpb24gZm9yIGEgdG9uZVxuXHRcdHZhciBnYXAgPSBkdG1mLmdhcDtcblx0XHRpZihnYXAgPT09IG51bGwgfHwgZ2FwID09PSB1bmRlZmluZWQpXG5cdFx0XHRnYXAgPSA1MDtcdC8vIFdlIGNob29zZSA1MG1zIGFzIHRoZSBkZWZhdWx0IGdhcCBiZXR3ZWVuIHRvbmVzXG5cdFx0SmFudXMuZGVidWcoXCJTZW5kaW5nIERUTUYgc3RyaW5nIFwiICsgdG9uZXMgKyBcIiAoZHVyYXRpb24gXCIgKyBkdXJhdGlvbiArIFwibXMsIGdhcCBcIiArIGdhcCArIFwibXMpXCIpO1xuXHRcdGNvbmZpZy5kdG1mU2VuZGVyLmluc2VydERUTUYodG9uZXMsIGR1cmF0aW9uLCBnYXApO1xuXHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdH1cblxuXHQvLyBQcml2YXRlIG1ldGhvZCB0byBkZXN0cm95IGEgcGx1Z2luIGhhbmRsZVxuXHRmdW5jdGlvbiBkZXN0cm95SGFuZGxlKGhhbmRsZUlkLCBjYWxsYmFja3MpIHtcblx0XHRjYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307XG5cdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MgPSAodHlwZW9mIGNhbGxiYWNrcy5zdWNjZXNzID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Muc3VjY2VzcyA6IEphbnVzLm5vb3A7XG5cdFx0Y2FsbGJhY2tzLmVycm9yID0gKHR5cGVvZiBjYWxsYmFja3MuZXJyb3IgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5lcnJvciA6IEphbnVzLm5vb3A7XG5cdFx0dmFyIGFzeW5jUmVxdWVzdCA9IHRydWU7XG5cdFx0aWYoY2FsbGJhY2tzLmFzeW5jUmVxdWVzdCAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrcy5hc3luY1JlcXVlc3QgIT09IG51bGwpXG5cdFx0XHRhc3luY1JlcXVlc3QgPSAoY2FsbGJhY2tzLmFzeW5jUmVxdWVzdCA9PT0gdHJ1ZSk7XG5cdFx0dmFyIG5vUmVxdWVzdCA9IHRydWU7XG5cdFx0aWYoY2FsbGJhY2tzLm5vUmVxdWVzdCAhPT0gdW5kZWZpbmVkICYmIGNhbGxiYWNrcy5ub1JlcXVlc3QgIT09IG51bGwpXG5cdFx0XHRub1JlcXVlc3QgPSAoY2FsbGJhY2tzLm5vUmVxdWVzdCA9PT0gdHJ1ZSk7XG5cdFx0SmFudXMubG9nKFwiRGVzdHJveWluZyBoYW5kbGUgXCIgKyBoYW5kbGVJZCArIFwiIChhc3luYz1cIiArIGFzeW5jUmVxdWVzdCArIFwiKVwiKTtcblx0XHRjbGVhbnVwV2VicnRjKGhhbmRsZUlkKTtcblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8IHBsdWdpbkhhbmRsZS5kZXRhY2hlZCkge1xuXHRcdFx0Ly8gUGx1Z2luIHdhcyBhbHJlYWR5IGRldGFjaGVkIGJ5IEphbnVzLCBjYWxsaW5nIGRldGFjaCBhZ2FpbiB3aWxsIHJldHVybiBhIGhhbmRsZSBub3QgZm91bmQgZXJyb3IsIHNvIGp1c3QgZXhpdCBoZXJlXG5cdFx0XHRkZWxldGUgcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRpZihub1JlcXVlc3QpIHtcblx0XHRcdC8vIFdlJ3JlIG9ubHkgcmVtb3ZpbmcgdGhlIGhhbmRsZSBsb2NhbGx5XG5cdFx0XHRkZWxldGUgcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRpZighY29ubmVjdGVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSXMgdGhlIHNlcnZlciBkb3duPyAoY29ubmVjdGVkPWZhbHNlKVwiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIklzIHRoZSBzZXJ2ZXIgZG93bj8gKGNvbm5lY3RlZD1mYWxzZSlcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciByZXF1ZXN0ID0geyBcImphbnVzXCI6IFwiZGV0YWNoXCIsIFwidHJhbnNhY3Rpb25cIjogSmFudXMucmFuZG9tU3RyaW5nKDEyKSB9O1xuXHRcdGlmKHBsdWdpbkhhbmRsZS50b2tlbiAhPT0gbnVsbCAmJiBwbHVnaW5IYW5kbGUudG9rZW4gIT09IHVuZGVmaW5lZClcblx0XHRcdHJlcXVlc3RbXCJ0b2tlblwiXSA9IHBsdWdpbkhhbmRsZS50b2tlbjtcblx0XHRpZihhcGlzZWNyZXQgIT09IG51bGwgJiYgYXBpc2VjcmV0ICE9PSB1bmRlZmluZWQpXG5cdFx0XHRyZXF1ZXN0W1wiYXBpc2VjcmV0XCJdID0gYXBpc2VjcmV0O1xuXHRcdGlmKHdlYnNvY2tldHMpIHtcblx0XHRcdHJlcXVlc3RbXCJzZXNzaW9uX2lkXCJdID0gc2Vzc2lvbklkO1xuXHRcdFx0cmVxdWVzdFtcImhhbmRsZV9pZFwiXSA9IGhhbmRsZUlkO1xuXHRcdFx0d3Muc2VuZChKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7XG5cdFx0XHRkZWxldGUgcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRKYW51cy5odHRwQVBJQ2FsbChzZXJ2ZXIgKyBcIi9cIiArIHNlc3Npb25JZCArIFwiL1wiICsgaGFuZGxlSWQsIHtcblx0XHRcdHZlcmI6ICdQT1NUJyxcblx0XHRcdGFzeW5jOiBhc3luY1JlcXVlc3QsXHQvLyBTb21ldGltZXMgd2UgbmVlZCBmYWxzZSBoZXJlLCBvciBkZXN0cm95aW5nIGluIG9uYmVmb3JldW5sb2FkIHdvbid0IHdvcmtcblx0XHRcdHdpdGhDcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzLFxuXHRcdFx0Ym9keTogcmVxdWVzdCxcblx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0SmFudXMubG9nKFwiRGVzdHJveWVkIGhhbmRsZTpcIik7XG5cdFx0XHRcdEphbnVzLmRlYnVnKGpzb24pO1xuXHRcdFx0XHRpZihqc29uW1wiamFudXNcIl0gIT09IFwic3VjY2Vzc1wiKSB7XG5cdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJPb29wczogXCIgKyBqc29uW1wiZXJyb3JcIl0uY29kZSArIFwiIFwiICsganNvbltcImVycm9yXCJdLnJlYXNvbik7XHQvLyBGSVhNRVxuXHRcdFx0XHR9XG5cdFx0XHRcdGRlbGV0ZSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRcdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoKTtcblx0XHRcdH0sXG5cdFx0XHRlcnJvcjogZnVuY3Rpb24odGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblx0XHRcdFx0SmFudXMuZXJyb3IodGV4dFN0YXR1cyArIFwiOlwiLCBlcnJvclRocm93bik7XHQvLyBGSVhNRVxuXHRcdFx0XHQvLyBXZSBjbGVhbnVwIGFueXdheVxuXHRcdFx0XHRkZWxldGUgcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBXZWJSVEMgc3R1ZmZcblx0ZnVuY3Rpb24gc3RyZWFtc0RvbmUoaGFuZGxlSWQsIGpzZXAsIG1lZGlhLCBjYWxsYmFja3MsIHN0cmVhbSkge1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRKYW51cy5kZWJ1ZyhcInN0cmVhbXNEb25lOlwiLCBzdHJlYW0pO1xuXHRcdGlmKHN0cmVhbSkge1xuXHRcdFx0SmFudXMuZGVidWcoXCIgIC0tIEF1ZGlvIHRyYWNrczpcIiwgc3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkpO1xuXHRcdFx0SmFudXMuZGVidWcoXCIgIC0tIFZpZGVvIHRyYWNrczpcIiwgc3RyZWFtLmdldFZpZGVvVHJhY2tzKCkpO1xuXHRcdH1cblx0XHQvLyBXZSdyZSBub3cgY2FwdHVyaW5nIHRoZSBuZXcgc3RyZWFtOiBjaGVjayBpZiB3ZSdyZSB1cGRhdGluZyBvciBpZiBpdCdzIGEgbmV3IHRoaW5nXG5cdFx0dmFyIGFkZFRyYWNrcyA9IGZhbHNlO1xuXHRcdGlmKCFjb25maWcubXlTdHJlYW0gfHwgIW1lZGlhLnVwZGF0ZSB8fCBjb25maWcuc3RyZWFtRXh0ZXJuYWwpIHtcblx0XHRcdGNvbmZpZy5teVN0cmVhbSA9IHN0cmVhbTtcblx0XHRcdGFkZFRyYWNrcyA9IHRydWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIFdlIG9ubHkgbmVlZCB0byB1cGRhdGUgdGhlIGV4aXN0aW5nIHN0cmVhbVxuXHRcdFx0aWYoKCghbWVkaWEudXBkYXRlICYmIGlzQXVkaW9TZW5kRW5hYmxlZChtZWRpYSkpIHx8IChtZWRpYS51cGRhdGUgJiYgKG1lZGlhLmFkZEF1ZGlvIHx8IG1lZGlhLnJlcGxhY2VBdWRpbykpKSAmJlxuXHRcdFx0XHRcdHN0cmVhbS5nZXRBdWRpb1RyYWNrcygpICYmIHN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCkge1xuXHRcdFx0XHRjb25maWcubXlTdHJlYW0uYWRkVHJhY2soc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF0pO1xuXHRcdFx0XHRpZihKYW51cy51bmlmaWVkUGxhbikge1xuXHRcdFx0XHRcdC8vIFVzZSBUcmFuc2NlaXZlcnNcblx0XHRcdFx0XHRKYW51cy5sb2coKG1lZGlhLnJlcGxhY2VBdWRpbyA/IFwiUmVwbGFjaW5nXCIgOiBcIkFkZGluZ1wiKSArIFwiIGF1ZGlvIHRyYWNrOlwiLCBzdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXSk7XG5cdFx0XHRcdFx0dmFyIGF1ZGlvVHJhbnNjZWl2ZXIgPSBudWxsO1xuXHRcdFx0XHRcdHZhciB0cmFuc2NlaXZlcnMgPSBjb25maWcucGMuZ2V0VHJhbnNjZWl2ZXJzKCk7XG5cdFx0XHRcdFx0aWYodHJhbnNjZWl2ZXJzICYmIHRyYW5zY2VpdmVycy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRmb3IodmFyIGkgaW4gdHJhbnNjZWl2ZXJzKSB7XG5cdFx0XHRcdFx0XHRcdHZhciB0ID0gdHJhbnNjZWl2ZXJzW2ldO1xuXHRcdFx0XHRcdFx0XHRpZigodC5zZW5kZXIgJiYgdC5zZW5kZXIudHJhY2sgJiYgdC5zZW5kZXIudHJhY2sua2luZCA9PT0gXCJhdWRpb1wiKSB8fFxuXHRcdFx0XHRcdFx0XHRcdFx0KHQucmVjZWl2ZXIgJiYgdC5yZWNlaXZlci50cmFjayAmJiB0LnJlY2VpdmVyLnRyYWNrLmtpbmQgPT09IFwiYXVkaW9cIikpIHtcblx0XHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyID0gdDtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihhdWRpb1RyYW5zY2VpdmVyICYmIGF1ZGlvVHJhbnNjZWl2ZXIuc2VuZGVyKSB7XG5cdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLnNlbmRlci5yZXBsYWNlVHJhY2soc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25maWcucGMuYWRkVHJhY2soc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF0sIHN0cmVhbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdEphbnVzLmxvZygobWVkaWEucmVwbGFjZUF1ZGlvID8gXCJSZXBsYWNpbmdcIiA6IFwiQWRkaW5nXCIpICsgXCIgYXVkaW8gdHJhY2s6XCIsIHN0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdKTtcblx0XHRcdFx0XHRjb25maWcucGMuYWRkVHJhY2soc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF0sIHN0cmVhbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmKCgoIW1lZGlhLnVwZGF0ZSAmJiBpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpKSB8fCAobWVkaWEudXBkYXRlICYmIChtZWRpYS5hZGRWaWRlbyB8fCBtZWRpYS5yZXBsYWNlVmlkZW8pKSkgJiZcblx0XHRcdFx0XHRzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKSAmJiBzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGgpIHtcblx0XHRcdFx0Y29uZmlnLm15U3RyZWFtLmFkZFRyYWNrKHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdKTtcblx0XHRcdFx0aWYoSmFudXMudW5pZmllZFBsYW4pIHtcblx0XHRcdFx0XHQvLyBVc2UgVHJhbnNjZWl2ZXJzXG5cdFx0XHRcdFx0SmFudXMubG9nKChtZWRpYS5yZXBsYWNlVmlkZW8gPyBcIlJlcGxhY2luZ1wiIDogXCJBZGRpbmdcIikgKyBcIiB2aWRlbyB0cmFjazpcIiwgc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0pO1xuXHRcdFx0XHRcdHZhciB2aWRlb1RyYW5zY2VpdmVyID0gbnVsbDtcblx0XHRcdFx0XHR2YXIgdHJhbnNjZWl2ZXJzID0gY29uZmlnLnBjLmdldFRyYW5zY2VpdmVycygpO1xuXHRcdFx0XHRcdGlmKHRyYW5zY2VpdmVycyAmJiB0cmFuc2NlaXZlcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0Zm9yKHZhciBpIGluIHRyYW5zY2VpdmVycykge1xuXHRcdFx0XHRcdFx0XHR2YXIgdCA9IHRyYW5zY2VpdmVyc1tpXTtcblx0XHRcdFx0XHRcdFx0aWYoKHQuc2VuZGVyICYmIHQuc2VuZGVyLnRyYWNrICYmIHQuc2VuZGVyLnRyYWNrLmtpbmQgPT09IFwidmlkZW9cIikgfHxcblx0XHRcdFx0XHRcdFx0XHRcdCh0LnJlY2VpdmVyICYmIHQucmVjZWl2ZXIudHJhY2sgJiYgdC5yZWNlaXZlci50cmFjay5raW5kID09PSBcInZpZGVvXCIpKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmlkZW9UcmFuc2NlaXZlciA9IHQ7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYodmlkZW9UcmFuc2NlaXZlciAmJiB2aWRlb1RyYW5zY2VpdmVyLnNlbmRlcikge1xuXHRcdFx0XHRcdFx0dmlkZW9UcmFuc2NlaXZlci5zZW5kZXIucmVwbGFjZVRyYWNrKHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uZmlnLnBjLmFkZFRyYWNrKHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdLCBzdHJlYW0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRKYW51cy5sb2coKG1lZGlhLnJlcGxhY2VWaWRlbyA/IFwiUmVwbGFjaW5nXCIgOiBcIkFkZGluZ1wiKSArIFwiIHZpZGVvIHRyYWNrOlwiLCBzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXSk7XG5cdFx0XHRcdFx0Y29uZmlnLnBjLmFkZFRyYWNrKHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdLCBzdHJlYW0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdC8vIElmIHdlIHN0aWxsIG5lZWQgdG8gY3JlYXRlIGEgUGVlckNvbm5lY3Rpb24sIGxldCdzIGRvIHRoYXRcblx0XHRpZighY29uZmlnLnBjKSB7XG5cdFx0XHR2YXIgcGNfY29uZmlnID0ge1wiaWNlU2VydmVyc1wiOiBpY2VTZXJ2ZXJzLCBcImljZVRyYW5zcG9ydFBvbGljeVwiOiBpY2VUcmFuc3BvcnRQb2xpY3ksIFwiYnVuZGxlUG9saWN5XCI6IGJ1bmRsZVBvbGljeX07XG5cdFx0XHRpZihKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09IFwiY2hyb21lXCIpIHtcblx0XHRcdFx0Ly8gRm9yIENocm9tZSB2ZXJzaW9ucyBiZWZvcmUgNzIsIHdlIGZvcmNlIGEgcGxhbi1iIHNlbWFudGljLCBhbmQgdW5pZmllZC1wbGFuIG90aGVyd2lzZVxuXHRcdFx0XHRwY19jb25maWdbXCJzZHBTZW1hbnRpY3NcIl0gPSAoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy52ZXJzaW9uIDwgNzIpID8gXCJwbGFuLWJcIiA6IFwidW5pZmllZC1wbGFuXCI7XG5cdFx0XHR9XG5cdFx0XHR2YXIgcGNfY29uc3RyYWludHMgPSB7XG5cdFx0XHRcdFwib3B0aW9uYWxcIjogW3tcIkR0bHNTcnRwS2V5QWdyZWVtZW50XCI6IHRydWV9XVxuXHRcdFx0fTtcblx0XHRcdGlmKGlwdjZTdXBwb3J0ID09PSB0cnVlKSB7XG5cdFx0XHRcdHBjX2NvbnN0cmFpbnRzLm9wdGlvbmFsLnB1c2goe1wiZ29vZ0lQdjZcIjp0cnVlfSk7XG5cdFx0XHR9XG5cdFx0XHQvLyBBbnkgY3VzdG9tIGNvbnN0cmFpbnQgdG8gYWRkP1xuXHRcdFx0aWYoY2FsbGJhY2tzLnJ0Y0NvbnN0cmFpbnRzICYmIHR5cGVvZiBjYWxsYmFja3MucnRjQ29uc3RyYWludHMgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiQWRkaW5nIGN1c3RvbSBQZWVyQ29ubmVjdGlvbiBjb25zdHJhaW50czpcIiwgY2FsbGJhY2tzLnJ0Y0NvbnN0cmFpbnRzKTtcblx0XHRcdFx0Zm9yKHZhciBpIGluIGNhbGxiYWNrcy5ydGNDb25zdHJhaW50cykge1xuXHRcdFx0XHRcdHBjX2NvbnN0cmFpbnRzLm9wdGlvbmFsLnB1c2goY2FsbGJhY2tzLnJ0Y0NvbnN0cmFpbnRzW2ldKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSBcImVkZ2VcIikge1xuXHRcdFx0XHQvLyBUaGlzIGlzIEVkZ2UsIGVuYWJsZSBCVU5ETEUgZXhwbGljaXRseVxuXHRcdFx0XHRwY19jb25maWcuYnVuZGxlUG9saWN5ID0gXCJtYXgtYnVuZGxlXCI7XG5cdFx0XHR9XG5cdFx0XHRKYW51cy5sb2coXCJDcmVhdGluZyBQZWVyQ29ubmVjdGlvblwiKTtcblx0XHRcdEphbnVzLmRlYnVnKHBjX2NvbnN0cmFpbnRzKTtcblx0XHRcdGNvbmZpZy5wYyA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbihwY19jb25maWcsIHBjX2NvbnN0cmFpbnRzKTtcblx0XHRcdEphbnVzLmRlYnVnKGNvbmZpZy5wYyk7XG5cdFx0XHRpZihjb25maWcucGMuZ2V0U3RhdHMpIHtcdC8vIEZJWE1FXG5cdFx0XHRcdGNvbmZpZy52b2x1bWUgPSB7fTtcblx0XHRcdFx0Y29uZmlnLmJpdHJhdGUudmFsdWUgPSBcIjAga2JpdHMvc2VjXCI7XG5cdFx0XHR9XG5cdFx0XHRKYW51cy5sb2coXCJQcmVwYXJpbmcgbG9jYWwgU0RQIGFuZCBnYXRoZXJpbmcgY2FuZGlkYXRlcyAodHJpY2tsZT1cIiArIGNvbmZpZy50cmlja2xlICsgXCIpXCIpO1xuXHRcdFx0Y29uZmlnLnBjLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZihjb25maWcucGMpXG5cdFx0XHRcdFx0cGx1Z2luSGFuZGxlLmljZVN0YXRlKGNvbmZpZy5wYy5pY2VDb25uZWN0aW9uU3RhdGUpO1xuXHRcdFx0fTtcblx0XHRcdGNvbmZpZy5wYy5vbmljZWNhbmRpZGF0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHRcdGlmIChldmVudC5jYW5kaWRhdGUgPT0gbnVsbCB8fFxuXHRcdFx0XHRcdFx0KEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ2VkZ2UnICYmIGV2ZW50LmNhbmRpZGF0ZS5jYW5kaWRhdGUuaW5kZXhPZignZW5kT2ZDYW5kaWRhdGVzJykgPiAwKSkge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIkVuZCBvZiBjYW5kaWRhdGVzLlwiKTtcblx0XHRcdFx0XHRjb25maWcuaWNlRG9uZSA9IHRydWU7XG5cdFx0XHRcdFx0aWYoY29uZmlnLnRyaWNrbGUgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdC8vIE5vdGlmeSBlbmQgb2YgY2FuZGlkYXRlc1xuXHRcdFx0XHRcdFx0c2VuZFRyaWNrbGVDYW5kaWRhdGUoaGFuZGxlSWQsIHtcImNvbXBsZXRlZFwiOiB0cnVlfSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIE5vIHRyaWNrbGUsIHRpbWUgdG8gc2VuZCB0aGUgY29tcGxldGUgU0RQIChpbmNsdWRpbmcgYWxsIGNhbmRpZGF0ZXMpXG5cdFx0XHRcdFx0XHRzZW5kU0RQKGhhbmRsZUlkLCBjYWxsYmFja3MpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBKU09OLnN0cmluZ2lmeSBkb2Vzbid0IHdvcmsgb24gc29tZSBXZWJSVEMgb2JqZWN0cyBhbnltb3JlXG5cdFx0XHRcdFx0Ly8gU2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD00NjczNjZcblx0XHRcdFx0XHR2YXIgY2FuZGlkYXRlID0ge1xuXHRcdFx0XHRcdFx0XCJjYW5kaWRhdGVcIjogZXZlbnQuY2FuZGlkYXRlLmNhbmRpZGF0ZSxcblx0XHRcdFx0XHRcdFwic2RwTWlkXCI6IGV2ZW50LmNhbmRpZGF0ZS5zZHBNaWQsXG5cdFx0XHRcdFx0XHRcInNkcE1MaW5lSW5kZXhcIjogZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXhcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdGlmKGNvbmZpZy50cmlja2xlID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHQvLyBTZW5kIGNhbmRpZGF0ZVxuXHRcdFx0XHRcdFx0c2VuZFRyaWNrbGVDYW5kaWRhdGUoaGFuZGxlSWQsIGNhbmRpZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXHRcdFx0Y29uZmlnLnBjLm9udHJhY2sgPSBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0XHRKYW51cy5sb2coXCJIYW5kbGluZyBSZW1vdGUgVHJhY2tcIik7XG5cdFx0XHRcdEphbnVzLmRlYnVnKGV2ZW50KTtcblx0XHRcdFx0aWYoIWV2ZW50LnN0cmVhbXMpXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRjb25maWcucmVtb3RlU3RyZWFtID0gZXZlbnQuc3RyZWFtc1swXTtcblx0XHRcdFx0cGx1Z2luSGFuZGxlLm9ucmVtb3Rlc3RyZWFtKGNvbmZpZy5yZW1vdGVTdHJlYW0pO1xuXHRcdFx0XHRpZihldmVudC50cmFjay5vbmVuZGVkKVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0SmFudXMubG9nKFwiQWRkaW5nIG9uZW5kZWQgY2FsbGJhY2sgdG8gdHJhY2s6XCIsIGV2ZW50LnRyYWNrKTtcblx0XHRcdFx0ZXZlbnQudHJhY2sub25lbmRlZCA9IGZ1bmN0aW9uKGV2KSB7XG5cdFx0XHRcdFx0SmFudXMubG9nKFwiUmVtb3RlIHRyYWNrIG11dGVkL3JlbW92ZWQ6XCIsIGV2KTtcblx0XHRcdFx0XHRpZihjb25maWcucmVtb3RlU3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRjb25maWcucmVtb3RlU3RyZWFtLnJlbW92ZVRyYWNrKGV2LnRhcmdldCk7XG5cdFx0XHRcdFx0XHRwbHVnaW5IYW5kbGUub25yZW1vdGVzdHJlYW0oY29uZmlnLnJlbW90ZVN0cmVhbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRldmVudC50cmFjay5vbm11dGUgPSBldmVudC50cmFjay5vbmVuZGVkO1xuXHRcdFx0XHRldmVudC50cmFjay5vbnVubXV0ZSA9IGZ1bmN0aW9uKGV2KSB7XG5cdFx0XHRcdFx0SmFudXMubG9nKFwiUmVtb3RlIHRyYWNrIGZsb3dpbmcgYWdhaW46XCIsIGV2KTtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0Y29uZmlnLnJlbW90ZVN0cmVhbS5hZGRUcmFjayhldi50YXJnZXQpO1xuXHRcdFx0XHRcdFx0cGx1Z2luSGFuZGxlLm9ucmVtb3Rlc3RyZWFtKGNvbmZpZy5yZW1vdGVTdHJlYW0pO1xuXHRcdFx0XHRcdH0gY2F0Y2goZSkge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoZSk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fTtcblx0XHRcdH07XG5cdFx0fVxuXHRcdGlmKGFkZFRyYWNrcyAmJiBzdHJlYW0gIT09IG51bGwgJiYgc3RyZWFtICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLmxvZygnQWRkaW5nIGxvY2FsIHN0cmVhbScpO1xuXHRcdFx0dmFyIHNpbXVsY2FzdDIgPSBjYWxsYmFja3Muc2ltdWxjYXN0MiA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTtcblx0XHRcdHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrKSB7XG5cdFx0XHRcdEphbnVzLmxvZygnQWRkaW5nIGxvY2FsIHRyYWNrOicsIHRyYWNrKTtcblx0XHRcdFx0aWYoIXNpbXVsY2FzdDIpIHtcblx0XHRcdFx0XHRjb25maWcucGMuYWRkVHJhY2sodHJhY2ssIHN0cmVhbSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYodHJhY2sua2luZCA9PT0gXCJhdWRpb1wiKSB7XG5cdFx0XHRcdFx0XHRjb25maWcucGMuYWRkVHJhY2sodHJhY2ssIHN0cmVhbSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdEphbnVzLmxvZygnRW5hYmxpbmcgcmlkLWJhc2VkIHNpbXVsY2FzdGluZzonLCB0cmFjayk7XG5cdFx0XHRcdFx0XHRjb25maWcucGMuYWRkVHJhbnNjZWl2ZXIodHJhY2ssIHtcblx0XHRcdFx0XHRcdFx0ZGlyZWN0aW9uOiBcInNlbmRyZWN2XCIsXG5cdFx0XHRcdFx0XHRcdHN0cmVhbXM6IFtzdHJlYW1dLFxuXHRcdFx0XHRcdFx0XHRzZW5kRW5jb2RpbmdzOiBbXG5cdFx0XHRcdFx0XHRcdFx0eyByaWQ6IFwiaFwiLCBhY3RpdmU6IHRydWUsIG1heEJpdHJhdGU6IDkwMDAwMCB9LFxuXHRcdFx0XHRcdFx0XHRcdHsgcmlkOiBcIm1cIiwgYWN0aXZlOiB0cnVlLCBtYXhCaXRyYXRlOiAzMDAwMDAsIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogMiB9LFxuXHRcdFx0XHRcdFx0XHRcdHsgcmlkOiBcImxcIiwgYWN0aXZlOiB0cnVlLCBtYXhCaXRyYXRlOiAxMDAwMDAsIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogNCB9XG5cdFx0XHRcdFx0XHRcdF1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdC8vIEFueSBkYXRhIGNoYW5uZWwgdG8gY3JlYXRlP1xuXHRcdGlmKGlzRGF0YUVuYWJsZWQobWVkaWEpICYmICFjb25maWcuZGF0YUNoYW5uZWxbSmFudXMuZGF0YUNoYW5EZWZhdWx0TGFiZWxdKSB7XG5cdFx0XHRKYW51cy5sb2coXCJDcmVhdGluZyBkYXRhIGNoYW5uZWxcIik7XG5cdFx0XHRjcmVhdGVEYXRhQ2hhbm5lbChoYW5kbGVJZCwgSmFudXMuZGF0YUNoYW5EZWZhdWx0TGFiZWwsIGZhbHNlKTtcblx0XHRcdGNvbmZpZy5wYy5vbmRhdGFjaGFubmVsID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFx0SmFudXMubG9nKFwiRGF0YSBjaGFubmVsIGNyZWF0ZWQgYnkgSmFudXM6XCIsIGV2ZW50KTtcblx0XHRcdFx0Y3JlYXRlRGF0YUNoYW5uZWwoaGFuZGxlSWQsIGV2ZW50LmNoYW5uZWwubGFiZWwsIGV2ZW50LmNoYW5uZWwpO1xuXHRcdFx0fTtcblx0XHR9XG5cdFx0Ly8gSWYgdGhlcmUncyBhIG5ldyBsb2NhbCBzdHJlYW0sIGxldCdzIG5vdGlmeSB0aGUgYXBwbGljYXRpb25cblx0XHRpZihjb25maWcubXlTdHJlYW0pXG5cdFx0XHRwbHVnaW5IYW5kbGUub25sb2NhbHN0cmVhbShjb25maWcubXlTdHJlYW0pO1xuXHRcdC8vIENyZWF0ZSBvZmZlci9hbnN3ZXIgbm93XG5cdFx0aWYoanNlcCA9PT0gbnVsbCB8fCBqc2VwID09PSB1bmRlZmluZWQpIHtcblx0XHRcdGNyZWF0ZU9mZmVyKGhhbmRsZUlkLCBtZWRpYSwgY2FsbGJhY2tzKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uZmlnLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKGpzZXApXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIlJlbW90ZSBkZXNjcmlwdGlvbiBhY2NlcHRlZCFcIik7XG5cdFx0XHRcdFx0Y29uZmlnLnJlbW90ZVNkcCA9IGpzZXAuc2RwO1xuXHRcdFx0XHRcdC8vIEFueSB0cmlja2xlIGNhbmRpZGF0ZSB3ZSBjYWNoZWQ/XG5cdFx0XHRcdFx0aWYoY29uZmlnLmNhbmRpZGF0ZXMgJiYgY29uZmlnLmNhbmRpZGF0ZXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0Zm9yKHZhciBpIGluIGNvbmZpZy5jYW5kaWRhdGVzKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBjYW5kaWRhdGUgPSBjb25maWcuY2FuZGlkYXRlc1tpXTtcblx0XHRcdFx0XHRcdFx0SmFudXMuZGVidWcoXCJBZGRpbmcgcmVtb3RlIGNhbmRpZGF0ZTpcIiwgY2FuZGlkYXRlKTtcblx0XHRcdFx0XHRcdFx0aWYoIWNhbmRpZGF0ZSB8fCBjYW5kaWRhdGUuY29tcGxldGVkID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gZW5kLW9mLWNhbmRpZGF0ZXNcblx0XHRcdFx0XHRcdFx0XHRjb25maWcucGMuYWRkSWNlQ2FuZGlkYXRlKEphbnVzLmVuZE9mQ2FuZGlkYXRlcyk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gTmV3IGNhbmRpZGF0ZVxuXHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5wYy5hZGRJY2VDYW5kaWRhdGUoY2FuZGlkYXRlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0Y29uZmlnLmNhbmRpZGF0ZXMgPSBbXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSBhbnN3ZXIgbm93XG5cdFx0XHRcdFx0Y3JlYXRlQW5zd2VyKGhhbmRsZUlkLCBtZWRpYSwgY2FsbGJhY2tzKTtcblx0XHRcdFx0fSwgY2FsbGJhY2tzLmVycm9yKTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBwcmVwYXJlV2VicnRjKGhhbmRsZUlkLCBvZmZlciwgY2FsbGJhY2tzKSB7XG5cdFx0Y2FsbGJhY2tzID0gY2FsbGJhY2tzIHx8IHt9O1xuXHRcdGNhbGxiYWNrcy5zdWNjZXNzID0gKHR5cGVvZiBjYWxsYmFja3Muc3VjY2VzcyA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLnN1Y2Nlc3MgOiBKYW51cy5ub29wO1xuXHRcdGNhbGxiYWNrcy5lcnJvciA9ICh0eXBlb2YgY2FsbGJhY2tzLmVycm9yID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3MuZXJyb3IgOiB3ZWJydGNFcnJvcjtcblx0XHR2YXIganNlcCA9IGNhbGxiYWNrcy5qc2VwO1xuXHRcdGlmKG9mZmVyICYmIGpzZXApIHtcblx0XHRcdEphbnVzLmVycm9yKFwiUHJvdmlkZWQgYSBKU0VQIHRvIGEgY3JlYXRlT2ZmZXJcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJQcm92aWRlZCBhIEpTRVAgdG8gYSBjcmVhdGVPZmZlclwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2UgaWYoIW9mZmVyICYmICghanNlcCB8fCAhanNlcC50eXBlIHx8ICFqc2VwLnNkcCkpIHtcblx0XHRcdEphbnVzLmVycm9yKFwiQSB2YWxpZCBKU0VQIGlzIHJlcXVpcmVkIGZvciBjcmVhdGVBbnN3ZXJcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJBIHZhbGlkIEpTRVAgaXMgcmVxdWlyZWQgZm9yIGNyZWF0ZUFuc3dlclwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Y2FsbGJhY2tzLm1lZGlhID0gY2FsbGJhY2tzLm1lZGlhIHx8IHsgYXVkaW86IHRydWUsIHZpZGVvOiB0cnVlIH07XG5cdFx0dmFyIG1lZGlhID0gY2FsbGJhY2tzLm1lZGlhO1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRjb25maWcudHJpY2tsZSA9IGlzVHJpY2tsZUVuYWJsZWQoY2FsbGJhY2tzLnRyaWNrbGUpO1xuXHRcdC8vIEFyZSB3ZSB1cGRhdGluZyBhIHNlc3Npb24/XG5cdFx0aWYoY29uZmlnLnBjID09PSB1bmRlZmluZWQgfHwgY29uZmlnLnBjID09PSBudWxsKSB7XG5cdFx0XHQvLyBOb3BlLCBuZXcgUGVlckNvbm5lY3Rpb25cblx0XHRcdG1lZGlhLnVwZGF0ZSA9IGZhbHNlO1xuXHRcdFx0bWVkaWEua2VlcEF1ZGlvID0gZmFsc2U7XG5cdFx0XHRtZWRpYS5rZWVwVmlkZW8gPSBmYWxzZTtcblx0XHR9IGVsc2UgaWYoY29uZmlnLnBjICE9PSB1bmRlZmluZWQgJiYgY29uZmlnLnBjICE9PSBudWxsKSB7XG5cdFx0XHRKYW51cy5sb2coXCJVcGRhdGluZyBleGlzdGluZyBtZWRpYSBzZXNzaW9uXCIpO1xuXHRcdFx0bWVkaWEudXBkYXRlID0gdHJ1ZTtcblx0XHRcdC8vIENoZWNrIGlmIHRoZXJlJ3MgYW55dGhpbmcgdG8gYWRkL3JlbW92ZS9yZXBsYWNlLCBvciBpZiB3ZVxuXHRcdFx0Ly8gY2FuIGdvIGRpcmVjdGx5IHRvIHByZXBhcmluZyB0aGUgbmV3IFNEUCBvZmZlciBvciBhbnN3ZXJcblx0XHRcdGlmKGNhbGxiYWNrcy5zdHJlYW0gIT09IG51bGwgJiYgY2FsbGJhY2tzLnN0cmVhbSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdC8vIEV4dGVybmFsIHN0cmVhbTogaXMgdGhpcyB0aGUgc2FtZSBhcyB0aGUgb25lIHdlIHdlcmUgdXNpbmcgYmVmb3JlP1xuXHRcdFx0XHRpZihjYWxsYmFja3Muc3RyZWFtICE9PSBjb25maWcubXlTdHJlYW0pIHtcblx0XHRcdFx0XHRKYW51cy5sb2coXCJSZW5lZ290aWF0aW9uIGludm9sdmVzIGEgbmV3IGV4dGVybmFsIHN0cmVhbVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gQ2hlY2sgaWYgdGhlcmUgYXJlIGNoYW5nZXMgb24gYXVkaW9cblx0XHRcdFx0aWYobWVkaWEuYWRkQXVkaW8pIHtcblx0XHRcdFx0XHRtZWRpYS5rZWVwQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5yZXBsYWNlQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5yZW1vdmVBdWRpbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLmF1ZGlvU2VuZCA9IHRydWU7XG5cdFx0XHRcdFx0aWYoY29uZmlnLm15U3RyZWFtICYmIGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpICYmIGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoXCJDYW4ndCBhZGQgYXVkaW8gc3RyZWFtLCB0aGVyZSBhbHJlYWR5IGlzIG9uZVwiKTtcblx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkNhbid0IGFkZCBhdWRpbyBzdHJlYW0sIHRoZXJlIGFscmVhZHkgaXMgb25lXCIpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKG1lZGlhLnJlbW92ZUF1ZGlvKSB7XG5cdFx0XHRcdFx0bWVkaWEua2VlcEF1ZGlvID0gZmFsc2U7XG5cdFx0XHRcdFx0bWVkaWEucmVwbGFjZUF1ZGlvID0gZmFsc2U7XG5cdFx0XHRcdFx0bWVkaWEuYWRkQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5hdWRpb1NlbmQgPSBmYWxzZTtcblx0XHRcdFx0fSBlbHNlIGlmKG1lZGlhLnJlcGxhY2VBdWRpbykge1xuXHRcdFx0XHRcdG1lZGlhLmtlZXBBdWRpbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLmFkZEF1ZGlvID0gZmFsc2U7XG5cdFx0XHRcdFx0bWVkaWEucmVtb3ZlQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5hdWRpb1NlbmQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKGNvbmZpZy5teVN0cmVhbSA9PT0gbnVsbCB8fCBjb25maWcubXlTdHJlYW0gPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdC8vIE5vIG1lZGlhIHN0cmVhbTogaWYgd2Ugd2VyZSBhc2tlZCB0byByZXBsYWNlLCBpdCdzIGFjdHVhbGx5IGFuIFwiYWRkXCJcblx0XHRcdFx0XHRpZihtZWRpYS5yZXBsYWNlQXVkaW8pIHtcblx0XHRcdFx0XHRcdG1lZGlhLmtlZXBBdWRpbyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0bWVkaWEucmVwbGFjZUF1ZGlvID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRtZWRpYS5hZGRBdWRpbyA9IHRydWU7XG5cdFx0XHRcdFx0XHRtZWRpYS5hdWRpb1NlbmQgPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihpc0F1ZGlvU2VuZEVuYWJsZWQobWVkaWEpKSB7XG5cdFx0XHRcdFx0XHRtZWRpYS5rZWVwQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRcdG1lZGlhLmFkZEF1ZGlvID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYoY29uZmlnLm15U3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkgPT09IG51bGxcblx0XHRcdFx0XHRcdFx0fHwgY29uZmlnLm15U3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkgPT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHR8fCBjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRcdC8vIE5vIGF1ZGlvIHRyYWNrOiBpZiB3ZSB3ZXJlIGFza2VkIHRvIHJlcGxhY2UsIGl0J3MgYWN0dWFsbHkgYW4gXCJhZGRcIlxuXHRcdFx0XHRcdFx0aWYobWVkaWEucmVwbGFjZUF1ZGlvKSB7XG5cdFx0XHRcdFx0XHRcdG1lZGlhLmtlZXBBdWRpbyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5yZXBsYWNlQXVkaW8gPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0bWVkaWEuYWRkQXVkaW8gPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5hdWRpb1NlbmQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYoaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKSkge1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5rZWVwVmlkZW8gPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0bWVkaWEuYWRkQXVkaW8gPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBXZSBoYXZlIGFuIGF1ZGlvIHRyYWNrOiBzaG91bGQgd2Uga2VlcCBpdCBhcyBpdCBpcz9cblx0XHRcdFx0XHRcdGlmKGlzQXVkaW9TZW5kRW5hYmxlZChtZWRpYSkgJiZcblx0XHRcdFx0XHRcdFx0XHQhbWVkaWEucmVtb3ZlQXVkaW8gJiYgIW1lZGlhLnJlcGxhY2VBdWRpbykge1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5rZWVwQXVkaW8gPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBDaGVjayBpZiB0aGVyZSBhcmUgY2hhbmdlcyBvbiB2aWRlb1xuXHRcdFx0XHRpZihtZWRpYS5hZGRWaWRlbykge1xuXHRcdFx0XHRcdG1lZGlhLmtlZXBWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLnJlcGxhY2VWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLnJlbW92ZVZpZGVvID0gZmFsc2U7XG5cdFx0XHRcdFx0bWVkaWEudmlkZW9TZW5kID0gdHJ1ZTtcblx0XHRcdFx0XHRpZihjb25maWcubXlTdHJlYW0gJiYgY29uZmlnLm15U3RyZWFtLmdldFZpZGVvVHJhY2tzKCkgJiYgY29uZmlnLm15U3RyZWFtLmdldFZpZGVvVHJhY2tzKCkubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRKYW51cy5lcnJvcihcIkNhbid0IGFkZCB2aWRlbyBzdHJlYW0sIHRoZXJlIGFscmVhZHkgaXMgb25lXCIpO1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiQ2FuJ3QgYWRkIHZpZGVvIHN0cmVhbSwgdGhlcmUgYWxyZWFkeSBpcyBvbmVcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYobWVkaWEucmVtb3ZlVmlkZW8pIHtcblx0XHRcdFx0XHRtZWRpYS5rZWVwVmlkZW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5yZXBsYWNlVmlkZW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5hZGRWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLnZpZGVvU2VuZCA9IGZhbHNlO1xuXHRcdFx0XHR9IGVsc2UgaWYobWVkaWEucmVwbGFjZVZpZGVvKSB7XG5cdFx0XHRcdFx0bWVkaWEua2VlcFZpZGVvID0gZmFsc2U7XG5cdFx0XHRcdFx0bWVkaWEuYWRkVmlkZW8gPSBmYWxzZTtcblx0XHRcdFx0XHRtZWRpYS5yZW1vdmVWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdG1lZGlhLnZpZGVvU2VuZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYoY29uZmlnLm15U3RyZWFtID09PSBudWxsIHx8IGNvbmZpZy5teVN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0Ly8gTm8gbWVkaWEgc3RyZWFtOiBpZiB3ZSB3ZXJlIGFza2VkIHRvIHJlcGxhY2UsIGl0J3MgYWN0dWFsbHkgYW4gXCJhZGRcIlxuXHRcdFx0XHRcdGlmKG1lZGlhLnJlcGxhY2VWaWRlbykge1xuXHRcdFx0XHRcdFx0bWVkaWEua2VlcFZpZGVvID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRtZWRpYS5yZXBsYWNlVmlkZW8gPSBmYWxzZTtcblx0XHRcdFx0XHRcdG1lZGlhLmFkZFZpZGVvID0gdHJ1ZTtcblx0XHRcdFx0XHRcdG1lZGlhLnZpZGVvU2VuZCA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKGlzVmlkZW9TZW5kRW5hYmxlZChtZWRpYSkpIHtcblx0XHRcdFx0XHRcdG1lZGlhLmtlZXBWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0bWVkaWEuYWRkVmlkZW8gPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZihjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKSA9PT0gbnVsbFxuXHRcdFx0XHRcdFx0XHR8fCBjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKSA9PT0gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdHx8IGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0Ly8gTm8gdmlkZW8gdHJhY2s6IGlmIHdlIHdlcmUgYXNrZWQgdG8gcmVwbGFjZSwgaXQncyBhY3R1YWxseSBhbiBcImFkZFwiXG5cdFx0XHRcdFx0XHRpZihtZWRpYS5yZXBsYWNlVmlkZW8pIHtcblx0XHRcdFx0XHRcdFx0bWVkaWEua2VlcFZpZGVvID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdG1lZGlhLnJlcGxhY2VWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5hZGRWaWRlbyA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdG1lZGlhLnZpZGVvU2VuZCA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRpZihpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpKSB7XG5cdFx0XHRcdFx0XHRcdG1lZGlhLmtlZXBWaWRlbyA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRtZWRpYS5hZGRWaWRlbyA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIFdlIGhhdmUgYSB2aWRlbyB0cmFjazogc2hvdWxkIHdlIGtlZXAgaXQgYXMgaXQgaXM/XG5cdFx0XHRcdFx0XHRpZihpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpICYmXG5cdFx0XHRcdFx0XHRcdFx0IW1lZGlhLnJlbW92ZVZpZGVvICYmICFtZWRpYS5yZXBsYWNlVmlkZW8pIHtcblx0XHRcdFx0XHRcdFx0bWVkaWEua2VlcFZpZGVvID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gRGF0YSBjaGFubmVscyBjYW4gb25seSBiZSBhZGRlZFxuXHRcdFx0XHRpZihtZWRpYS5hZGREYXRhKVxuXHRcdFx0XHRcdG1lZGlhLmRhdGEgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0Ly8gSWYgd2UncmUgdXBkYXRpbmcgYW5kIGtlZXBpbmcgYWxsIHRyYWNrcywgbGV0J3Mgc2tpcCB0aGUgZ2V0VXNlck1lZGlhIHBhcnRcblx0XHRcdGlmKChpc0F1ZGlvU2VuZEVuYWJsZWQobWVkaWEpICYmIG1lZGlhLmtlZXBBdWRpbykgJiZcblx0XHRcdFx0XHQoaXNWaWRlb1NlbmRFbmFibGVkKG1lZGlhKSAmJiBtZWRpYS5rZWVwVmlkZW8pKSB7XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0c3RyZWFtc0RvbmUoaGFuZGxlSWQsIGpzZXAsIG1lZGlhLCBjYWxsYmFja3MsIGNvbmZpZy5teVN0cmVhbSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gSWYgd2UncmUgdXBkYXRpbmcsIGNoZWNrIGlmIHdlIG5lZWQgdG8gcmVtb3ZlL3JlcGxhY2Ugb25lIG9mIHRoZSB0cmFja3Ncblx0XHRpZihtZWRpYS51cGRhdGUgJiYgIWNvbmZpZy5zdHJlYW1FeHRlcm5hbCkge1xuXHRcdFx0aWYobWVkaWEucmVtb3ZlQXVkaW8gfHwgbWVkaWEucmVwbGFjZUF1ZGlvKSB7XG5cdFx0XHRcdGlmKGNvbmZpZy5teVN0cmVhbSAmJiBjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKSAmJiBjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGgpIHtcblx0XHRcdFx0XHR2YXIgcyA9IGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdO1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIlJlbW92aW5nIGF1ZGlvIHRyYWNrOlwiLCBzKTtcblx0XHRcdFx0XHRjb25maWcubXlTdHJlYW0ucmVtb3ZlVHJhY2socyk7XG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdHMuc3RvcCgpO1xuXHRcdFx0XHRcdH0gY2F0Y2goZSkge307XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYoY29uZmlnLnBjLmdldFNlbmRlcnMoKSAmJiBjb25maWcucGMuZ2V0U2VuZGVycygpLmxlbmd0aCkge1xuXHRcdFx0XHRcdHZhciByYSA9IHRydWU7XG5cdFx0XHRcdFx0aWYobWVkaWEucmVwbGFjZUF1ZGlvICYmIEphbnVzLnVuaWZpZWRQbGFuKSB7XG5cdFx0XHRcdFx0XHQvLyBXZSBjYW4gdXNlIHJlcGxhY2VUcmFja1xuXHRcdFx0XHRcdFx0cmEgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYocmEpIHtcblx0XHRcdFx0XHRcdGZvcih2YXIgaW5kZXggaW4gY29uZmlnLnBjLmdldFNlbmRlcnMoKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgcyA9IGNvbmZpZy5wYy5nZXRTZW5kZXJzKClbaW5kZXhdO1xuXHRcdFx0XHRcdFx0XHRpZihzICYmIHMudHJhY2sgJiYgcy50cmFjay5raW5kID09PSBcImF1ZGlvXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRKYW51cy5sb2coXCJSZW1vdmluZyBhdWRpbyBzZW5kZXI6XCIsIHMpO1xuXHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5wYy5yZW1vdmVUcmFjayhzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYobWVkaWEucmVtb3ZlVmlkZW8gfHwgbWVkaWEucmVwbGFjZVZpZGVvKSB7XG5cdFx0XHRcdGlmKGNvbmZpZy5teVN0cmVhbSAmJiBjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKSAmJiBjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGgpIHtcblx0XHRcdFx0XHR2YXIgcyA9IGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdO1xuXHRcdFx0XHRcdEphbnVzLmxvZyhcIlJlbW92aW5nIHZpZGVvIHRyYWNrOlwiLCBzKTtcblx0XHRcdFx0XHRjb25maWcubXlTdHJlYW0ucmVtb3ZlVHJhY2socyk7XG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdHMuc3RvcCgpO1xuXHRcdFx0XHRcdH0gY2F0Y2goZSkge307XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYoY29uZmlnLnBjLmdldFNlbmRlcnMoKSAmJiBjb25maWcucGMuZ2V0U2VuZGVycygpLmxlbmd0aCkge1xuXHRcdFx0XHRcdHZhciBydiA9IHRydWU7XG5cdFx0XHRcdFx0aWYobWVkaWEucmVwbGFjZVZpZGVvICYmIEphbnVzLnVuaWZpZWRQbGFuKSB7XG5cdFx0XHRcdFx0XHQvLyBXZSBjYW4gdXNlIHJlcGxhY2VUcmFja1xuXHRcdFx0XHRcdFx0cnYgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYocnYpIHtcblx0XHRcdFx0XHRcdGZvcih2YXIgaW5kZXggaW4gY29uZmlnLnBjLmdldFNlbmRlcnMoKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgcyA9IGNvbmZpZy5wYy5nZXRTZW5kZXJzKClbaW5kZXhdO1xuXHRcdFx0XHRcdFx0XHRpZihzICYmIHMudHJhY2sgJiYgcy50cmFjay5raW5kID09PSBcInZpZGVvXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRKYW51cy5sb2coXCJSZW1vdmluZyB2aWRlbyBzZW5kZXI6XCIsIHMpO1xuXHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5wYy5yZW1vdmVUcmFjayhzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBXYXMgYSBNZWRpYVN0cmVhbSBvYmplY3QgcGFzc2VkLCBvciBkbyB3ZSBuZWVkIHRvIHRha2UgY2FyZSBvZiB0aGF0P1xuXHRcdGlmKGNhbGxiYWNrcy5zdHJlYW0gIT09IG51bGwgJiYgY2FsbGJhY2tzLnN0cmVhbSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR2YXIgc3RyZWFtID0gY2FsbGJhY2tzLnN0cmVhbTtcblx0XHRcdEphbnVzLmxvZyhcIk1lZGlhU3RyZWFtIHByb3ZpZGVkIGJ5IHRoZSBhcHBsaWNhdGlvblwiKTtcblx0XHRcdEphbnVzLmRlYnVnKHN0cmVhbSk7XG5cdFx0XHQvLyBJZiB0aGlzIGlzIGFuIHVwZGF0ZSwgbGV0J3MgY2hlY2sgaWYgd2UgbmVlZCB0byByZWxlYXNlIHRoZSBwcmV2aW91cyBzdHJlYW1cblx0XHRcdGlmKG1lZGlhLnVwZGF0ZSkge1xuXHRcdFx0XHRpZihjb25maWcubXlTdHJlYW0gJiYgY29uZmlnLm15U3RyZWFtICE9PSBjYWxsYmFja3Muc3RyZWFtICYmICFjb25maWcuc3RyZWFtRXh0ZXJuYWwpIHtcblx0XHRcdFx0XHQvLyBXZSdyZSByZXBsYWNpbmcgYSBzdHJlYW0gd2UgY2FwdHVyZWQgb3Vyc2VsdmVzIHdpdGggYW4gZXh0ZXJuYWwgb25lXG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdC8vIFRyeSBhIE1lZGlhU3RyZWFtVHJhY2suc3RvcCgpIGZvciBlYWNoIHRyYWNrXG5cdFx0XHRcdFx0XHR2YXIgdHJhY2tzID0gY29uZmlnLm15U3RyZWFtLmdldFRyYWNrcygpO1xuXHRcdFx0XHRcdFx0Zm9yKHZhciBpIGluIHRyYWNrcykge1xuXHRcdFx0XHRcdFx0XHR2YXIgbXN0ID0gdHJhY2tzW2ldO1xuXHRcdFx0XHRcdFx0XHRKYW51cy5sb2cobXN0KTtcblx0XHRcdFx0XHRcdFx0aWYobXN0ICE9PSBudWxsICYmIG1zdCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRcdFx0XHRcdG1zdC5zdG9wKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdFx0XHQvLyBEbyBub3RoaW5nIGlmIHRoaXMgZmFpbHNcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29uZmlnLm15U3RyZWFtID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gU2tpcCB0aGUgZ2V0VXNlck1lZGlhIHBhcnRcblx0XHRcdGNvbmZpZy5zdHJlYW1FeHRlcm5hbCA9IHRydWU7XG5cdFx0XHRwbHVnaW5IYW5kbGUuY29uc2VudERpYWxvZyhmYWxzZSk7XG5cdFx0XHRzdHJlYW1zRG9uZShoYW5kbGVJZCwganNlcCwgbWVkaWEsIGNhbGxiYWNrcywgc3RyZWFtKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0aWYoaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKSB8fCBpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpKSB7XG5cdFx0XHRpZighSmFudXMuaXNHZXRVc2VyTWVkaWFBdmFpbGFibGUoKSkge1xuXHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJnZXRVc2VyTWVkaWEgbm90IGF2YWlsYWJsZVwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGNvbnN0cmFpbnRzID0geyBtYW5kYXRvcnk6IHt9LCBvcHRpb25hbDogW119O1xuXHRcdFx0cGx1Z2luSGFuZGxlLmNvbnNlbnREaWFsb2codHJ1ZSk7XG5cdFx0XHR2YXIgYXVkaW9TdXBwb3J0ID0gaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdGlmKGF1ZGlvU3VwcG9ydCA9PT0gdHJ1ZSAmJiBtZWRpYSAhPSB1bmRlZmluZWQgJiYgbWVkaWEgIT0gbnVsbCkge1xuXHRcdFx0XHRpZih0eXBlb2YgbWVkaWEuYXVkaW8gPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdFx0YXVkaW9TdXBwb3J0ID0gbWVkaWEuYXVkaW87XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHZhciB2aWRlb1N1cHBvcnQgPSBpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpO1xuXHRcdFx0aWYodmlkZW9TdXBwb3J0ID09PSB0cnVlICYmIG1lZGlhICE9IHVuZGVmaW5lZCAmJiBtZWRpYSAhPSBudWxsKSB7XG5cdFx0XHRcdHZhciBzaW11bGNhc3QgPSBjYWxsYmFja3Muc2ltdWxjYXN0ID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdFx0XHR2YXIgc2ltdWxjYXN0MiA9IGNhbGxiYWNrcy5zaW11bGNhc3QyID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdFx0XHRpZigoc2ltdWxjYXN0IHx8IHNpbXVsY2FzdDIpICYmICFqc2VwICYmIChtZWRpYS52aWRlbyA9PT0gdW5kZWZpbmVkIHx8IG1lZGlhLnZpZGVvID09PSBmYWxzZSkpXG5cdFx0XHRcdFx0bWVkaWEudmlkZW8gPSBcImhpcmVzXCI7XG5cdFx0XHRcdGlmKG1lZGlhLnZpZGVvICYmIG1lZGlhLnZpZGVvICE9ICdzY3JlZW4nICYmIG1lZGlhLnZpZGVvICE9ICd3aW5kb3cnKSB7XG5cdFx0XHRcdFx0aWYodHlwZW9mIG1lZGlhLnZpZGVvID09PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRcdFx0dmlkZW9TdXBwb3J0ID0gbWVkaWEudmlkZW87XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZhciB3aWR0aCA9IDA7XG5cdFx0XHRcdFx0XHR2YXIgaGVpZ2h0ID0gMCwgbWF4SGVpZ2h0ID0gMDtcblx0XHRcdFx0XHRcdGlmKG1lZGlhLnZpZGVvID09PSAnbG93cmVzJykge1xuXHRcdFx0XHRcdFx0XHQvLyBTbWFsbCByZXNvbHV0aW9uLCA0OjNcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gMjQwO1xuXHRcdFx0XHRcdFx0XHRtYXhIZWlnaHQgPSAyNDA7XG5cdFx0XHRcdFx0XHRcdHdpZHRoID0gMzIwO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmKG1lZGlhLnZpZGVvID09PSAnbG93cmVzLTE2OjknKSB7XG5cdFx0XHRcdFx0XHRcdC8vIFNtYWxsIHJlc29sdXRpb24sIDE2Ojlcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gMTgwO1xuXHRcdFx0XHRcdFx0XHRtYXhIZWlnaHQgPSAxODA7XG5cdFx0XHRcdFx0XHRcdHdpZHRoID0gMzIwO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmKG1lZGlhLnZpZGVvID09PSAnaGlyZXMnIHx8IG1lZGlhLnZpZGVvID09PSAnaGlyZXMtMTY6OScgfHwgbWVkaWEudmlkZW8gPT09ICdoZHJlcycpIHtcblx0XHRcdFx0XHRcdFx0Ly8gSGlnaChIRCkgcmVzb2x1dGlvbiBpcyBvbmx5IDE2Ojlcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gNzIwO1xuXHRcdFx0XHRcdFx0XHRtYXhIZWlnaHQgPSA3MjA7XG5cdFx0XHRcdFx0XHRcdHdpZHRoID0gMTI4MDtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZihtZWRpYS52aWRlbyA9PT0gJ2ZoZHJlcycpIHtcblx0XHRcdFx0XHRcdFx0Ly8gRnVsbCBIRCByZXNvbHV0aW9uIGlzIG9ubHkgMTY6OVxuXHRcdFx0XHRcdFx0XHRoZWlnaHQgPSAxMDgwO1xuXHRcdFx0XHRcdFx0XHRtYXhIZWlnaHQgPSAxMDgwO1xuXHRcdFx0XHRcdFx0XHR3aWR0aCA9IDE5MjA7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYobWVkaWEudmlkZW8gPT09ICc0a3JlcycpIHtcblx0XHRcdFx0XHRcdFx0Ly8gNEsgcmVzb2x1dGlvbiBpcyBvbmx5IDE2Ojlcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gMjE2MDtcblx0XHRcdFx0XHRcdFx0bWF4SGVpZ2h0ID0gMjE2MDtcblx0XHRcdFx0XHRcdFx0d2lkdGggPSAzODQwO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmKG1lZGlhLnZpZGVvID09PSAnc3RkcmVzJykge1xuXHRcdFx0XHRcdFx0XHQvLyBOb3JtYWwgcmVzb2x1dGlvbiwgNDozXG5cdFx0XHRcdFx0XHRcdGhlaWdodCA9IDQ4MDtcblx0XHRcdFx0XHRcdFx0bWF4SGVpZ2h0ID0gNDgwO1xuXHRcdFx0XHRcdFx0XHR3aWR0aCAgPSA2NDA7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYobWVkaWEudmlkZW8gPT09ICdzdGRyZXMtMTY6OScpIHtcblx0XHRcdFx0XHRcdFx0Ly8gTm9ybWFsIHJlc29sdXRpb24sIDE2Ojlcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gMzYwO1xuXHRcdFx0XHRcdFx0XHRtYXhIZWlnaHQgPSAzNjA7XG5cdFx0XHRcdFx0XHRcdHdpZHRoID0gNjQwO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0SmFudXMubG9nKFwiRGVmYXVsdCB2aWRlbyBzZXR0aW5nIGlzIHN0ZHJlcyA0OjNcIik7XG5cdFx0XHRcdFx0XHRcdGhlaWdodCA9IDQ4MDtcblx0XHRcdFx0XHRcdFx0bWF4SGVpZ2h0ID0gNDgwO1xuXHRcdFx0XHRcdFx0XHR3aWR0aCA9IDY0MDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIkFkZGluZyBtZWRpYSBjb25zdHJhaW50OlwiLCBtZWRpYS52aWRlbyk7XG5cdFx0XHRcdFx0XHR2aWRlb1N1cHBvcnQgPSB7XG5cdFx0XHRcdFx0XHRcdCdoZWlnaHQnOiB7J2lkZWFsJzogaGVpZ2h0fSxcblx0XHRcdFx0XHRcdFx0J3dpZHRoJzogIHsnaWRlYWwnOiB3aWR0aH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJBZGRpbmcgdmlkZW8gY29uc3RyYWludDpcIiwgdmlkZW9TdXBwb3J0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZihtZWRpYS52aWRlbyA9PT0gJ3NjcmVlbicgfHwgbWVkaWEudmlkZW8gPT09ICd3aW5kb3cnKSB7XG5cdFx0XHRcdFx0aWYoIW1lZGlhLnNjcmVlbnNoYXJlRnJhbWVSYXRlKSB7XG5cdFx0XHRcdFx0XHRtZWRpYS5zY3JlZW5zaGFyZUZyYW1lUmF0ZSA9IDM7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXREaXNwbGF5TWVkaWEpIHtcblx0XHRcdFx0XHRcdC8vIFRoZSBuZXcgZXhwZXJpbWVudGFsIGdldERpc3BsYXlNZWRpYSBBUEkgaXMgYXZhaWxhYmxlLCBsZXQncyB1c2UgdGhhdFxuXHRcdFx0XHRcdFx0Ly8gaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9mb3J1bS8jIXRvcGljL2Rpc2N1c3Mtd2VicnRjL1VmMFNyUjR1eHprXG5cdFx0XHRcdFx0XHQvLyBodHRwczovL3dlYnJ0Y2hhY2tzLmNvbS9jaHJvbWUtc2NyZWVuc2hhcmluZy1nZXRkaXNwbGF5bWVkaWEvXG5cdFx0XHRcdFx0XHRuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYSh7IHZpZGVvOiB0cnVlIH0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKHN0cmVhbSkge1xuXHRcdFx0XHRcdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0XHRpZihpc0F1ZGlvU2VuZEVuYWJsZWQobWVkaWEpICYmICFtZWRpYS5rZWVwQXVkaW8pIHtcblx0XHRcdFx0XHRcdFx0XHRcdG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsgYXVkaW86IHRydWUsIHZpZGVvOiBmYWxzZSB9KVxuXHRcdFx0XHRcdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKGF1ZGlvU3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0cmVhbS5hZGRUcmFjayhhdWRpb1N0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyZWFtc0RvbmUoaGFuZGxlSWQsIGpzZXAsIG1lZGlhLCBjYWxsYmFja3MsIHN0cmVhbSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJlYW1zRG9uZShoYW5kbGVJZCwganNlcCwgbWVkaWEsIGNhbGxiYWNrcywgc3RyZWFtKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0sIGZ1bmN0aW9uIChlcnJvcikge1xuXHRcdFx0XHRcdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gV2UncmUgZ29pbmcgdG8gdHJ5IGFuZCB1c2UgdGhlIGV4dGVuc2lvbiBmb3IgQ2hyb21lIDM0KywgdGhlIG9sZCBhcHByb2FjaFxuXHRcdFx0XHRcdC8vIGZvciBvbGRlciB2ZXJzaW9ucyBvZiBDaHJvbWUsIG9yIHRoZSBleHBlcmltZW50YWwgc3VwcG9ydCBpbiBGaXJlZm94IDMzK1xuXHRcdFx0XHRcdGZ1bmN0aW9uIGNhbGxiYWNrVXNlck1lZGlhIChlcnJvciwgc3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRwbHVnaW5IYW5kbGUuY29uc2VudERpYWxvZyhmYWxzZSk7XG5cdFx0XHRcdFx0XHRpZihlcnJvcikge1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0c3RyZWFtc0RvbmUoaGFuZGxlSWQsIGpzZXAsIG1lZGlhLCBjYWxsYmFja3MsIHN0cmVhbSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRmdW5jdGlvbiBnZXRTY3JlZW5NZWRpYShjb25zdHJhaW50cywgZ3NtQ2FsbGJhY2ssIHVzZUF1ZGlvKSB7XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJBZGRpbmcgbWVkaWEgY29uc3RyYWludCAoc2NyZWVuIGNhcHR1cmUpXCIpO1xuXHRcdFx0XHRcdFx0SmFudXMuZGVidWcoY29uc3RyYWludHMpO1xuXHRcdFx0XHRcdFx0bmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpXG5cdFx0XHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKHN0cmVhbSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmKHVzZUF1ZGlvKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7IGF1ZGlvOiB0cnVlLCB2aWRlbzogZmFsc2UgfSlcblx0XHRcdFx0XHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChhdWRpb1N0cmVhbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJlYW0uYWRkVHJhY2soYXVkaW9TdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGdzbUNhbGxiYWNrKG51bGwsIHN0cmVhbSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRnc21DYWxsYmFjayhudWxsLCBzdHJlYW0pO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdFx0LmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7IHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTsgZ3NtQ2FsbGJhY2soZXJyb3IpOyB9KTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ2Nocm9tZScpIHtcblx0XHRcdFx0XHRcdHZhciBjaHJvbWV2ZXIgPSBKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLnZlcnNpb247XG5cdFx0XHRcdFx0XHR2YXIgbWF4dmVyID0gMzM7XG5cdFx0XHRcdFx0XHRpZih3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgnTGludXgnKSlcblx0XHRcdFx0XHRcdFx0bWF4dmVyID0gMzU7XHQvLyBcImtub3duXCIgY3Jhc2ggaW4gY2hyb21lIDM0IGFuZCAzNSBvbiBsaW51eFxuXHRcdFx0XHRcdFx0aWYoY2hyb21ldmVyID49IDI2ICYmIGNocm9tZXZlciA8PSBtYXh2ZXIpIHtcblx0XHRcdFx0XHRcdFx0Ly8gQ2hyb21lIDI2LT4zMyByZXF1aXJlcyBzb21lIGF3a3dhcmQgY2hyb21lOi8vZmxhZ3MgbWFuaXB1bGF0aW9uXG5cdFx0XHRcdFx0XHRcdGNvbnN0cmFpbnRzID0ge1xuXHRcdFx0XHRcdFx0XHRcdHZpZGVvOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRtYW5kYXRvcnk6IHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Z29vZ0xlYWt5QnVja2V0OiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRtYXhXaWR0aDogd2luZG93LnNjcmVlbi53aWR0aCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4SGVpZ2h0OiB3aW5kb3cuc2NyZWVuLmhlaWdodCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWluRnJhbWVSYXRlOiBtZWRpYS5zY3JlZW5zaGFyZUZyYW1lUmF0ZSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4RnJhbWVSYXRlOiBtZWRpYS5zY3JlZW5zaGFyZUZyYW1lUmF0ZSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2hyb21lTWVkaWFTb3VyY2U6ICdzY3JlZW4nXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHRhdWRpbzogaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKSAmJiAhbWVkaWEua2VlcEF1ZGlvXG5cdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdGdldFNjcmVlbk1lZGlhKGNvbnN0cmFpbnRzLCBjYWxsYmFja1VzZXJNZWRpYSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvLyBDaHJvbWUgMzQrIHJlcXVpcmVzIGFuIGV4dGVuc2lvblxuXHRcdFx0XHRcdFx0XHRKYW51cy5leHRlbnNpb24uZ2V0U2NyZWVuKGZ1bmN0aW9uIChlcnJvciwgc291cmNlSWQpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBjYWxsYmFja3MuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRjb25zdHJhaW50cyA9IHtcblx0XHRcdFx0XHRcdFx0XHRcdGF1ZGlvOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0XHRcdHZpZGVvOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdG1hbmRhdG9yeToge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNocm9tZU1lZGlhU291cmNlOiAnZGVza3RvcCcsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4V2lkdGg6IHdpbmRvdy5zY3JlZW4ud2lkdGgsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4SGVpZ2h0OiB3aW5kb3cuc2NyZWVuLmhlaWdodCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRtaW5GcmFtZVJhdGU6IG1lZGlhLnNjcmVlbnNoYXJlRnJhbWVSYXRlLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG1heEZyYW1lUmF0ZTogbWVkaWEuc2NyZWVuc2hhcmVGcmFtZVJhdGUsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0XHRcdG9wdGlvbmFsOiBbXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0e2dvb2dMZWFreUJ1Y2tldDogdHJ1ZX0sXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0e2dvb2dUZW1wb3JhbExheWVyZWRTY3JlZW5jYXN0OiB0cnVlfVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRdXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHRjb25zdHJhaW50cy52aWRlby5tYW5kYXRvcnkuY2hyb21lTWVkaWFTb3VyY2VJZCA9IHNvdXJjZUlkO1xuXHRcdFx0XHRcdFx0XHRcdGdldFNjcmVlbk1lZGlhKGNvbnN0cmFpbnRzLCBjYWxsYmFja1VzZXJNZWRpYSxcblx0XHRcdFx0XHRcdFx0XHRcdGlzQXVkaW9TZW5kRW5hYmxlZChtZWRpYSkgJiYgIW1lZGlhLmtlZXBBdWRpbyk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSBpZihKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09ICdmaXJlZm94Jykge1xuXHRcdFx0XHRcdFx0aWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy52ZXJzaW9uID49IDMzKSB7XG5cdFx0XHRcdFx0XHRcdC8vIEZpcmVmb3ggMzMrIGhhcyBleHBlcmltZW50YWwgc3VwcG9ydCBmb3Igc2NyZWVuIHNoYXJpbmdcblx0XHRcdFx0XHRcdFx0Y29uc3RyYWludHMgPSB7XG5cdFx0XHRcdFx0XHRcdFx0dmlkZW86IHtcblx0XHRcdFx0XHRcdFx0XHRcdG1vek1lZGlhU291cmNlOiBtZWRpYS52aWRlbyxcblx0XHRcdFx0XHRcdFx0XHRcdG1lZGlhU291cmNlOiBtZWRpYS52aWRlb1xuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0YXVkaW86IGlzQXVkaW9TZW5kRW5hYmxlZChtZWRpYSkgJiYgIW1lZGlhLmtlZXBBdWRpb1xuXHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRnZXRTY3JlZW5NZWRpYShjb25zdHJhaW50cywgZnVuY3Rpb24gKGVyciwgc3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tVc2VyTWVkaWEoZXJyLCBzdHJlYW0pO1xuXHRcdFx0XHRcdFx0XHRcdC8vIFdvcmthcm91bmQgZm9yIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTEwNDU4MTBcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWVycikge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGxhc3RUaW1lID0gc3RyZWFtLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHBvbGx5ID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYoIXN0cmVhbSlcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR3aW5kb3cuY2xlYXJJbnRlcnZhbChwb2xseSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmKHN0cmVhbS5jdXJyZW50VGltZSA9PSBsYXN0VGltZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHdpbmRvdy5jbGVhckludGVydmFsKHBvbGx5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZihzdHJlYW0ub25lbmRlZCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyZWFtLm9uZW5kZWQoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0bGFzdFRpbWUgPSBzdHJlYW0uY3VycmVudFRpbWU7XG5cdFx0XHRcdFx0XHRcdFx0XHR9LCA1MDApO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoJ05hdmlnYXRvclVzZXJNZWRpYUVycm9yJyk7XG5cdFx0XHRcdFx0XHRcdGVycm9yLm5hbWUgPSAnWW91ciB2ZXJzaW9uIG9mIEZpcmVmb3ggZG9lcyBub3Qgc3VwcG9ydCBzY3JlZW4gc2hhcmluZywgcGxlYXNlIGluc3RhbGwgRmlyZWZveCAzMyAob3IgbW9yZSByZWNlbnQgdmVyc2lvbnMpJztcblx0XHRcdFx0XHRcdFx0cGx1Z2luSGFuZGxlLmNvbnNlbnREaWFsb2coZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gSWYgd2UgZ290IGhlcmUsIHdlJ3JlIG5vdCBzY3JlZW5zaGFyaW5nXG5cdFx0XHRpZihtZWRpYSA9PT0gbnVsbCB8fCBtZWRpYSA9PT0gdW5kZWZpbmVkIHx8IG1lZGlhLnZpZGVvICE9PSAnc2NyZWVuJykge1xuXHRcdFx0XHQvLyBDaGVjayB3aGV0aGVyIGFsbCBtZWRpYSBzb3VyY2VzIGFyZSBhY3R1YWxseSBhdmFpbGFibGUgb3Igbm90XG5cdFx0XHRcdG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpLnRoZW4oZnVuY3Rpb24oZGV2aWNlcykge1xuXHRcdFx0XHRcdHZhciBhdWRpb0V4aXN0ID0gZGV2aWNlcy5zb21lKGZ1bmN0aW9uKGRldmljZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRldmljZS5raW5kID09PSAnYXVkaW9pbnB1dCc7XG5cdFx0XHRcdFx0fSksXG5cdFx0XHRcdFx0dmlkZW9FeGlzdCA9IGlzU2NyZWVuU2VuZEVuYWJsZWQobWVkaWEpIHx8IGRldmljZXMuc29tZShmdW5jdGlvbihkZXZpY2UpIHtcblx0XHRcdFx0XHRcdHJldHVybiBkZXZpY2Uua2luZCA9PT0gJ3ZpZGVvaW5wdXQnO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gQ2hlY2sgd2hldGhlciBhIG1pc3NpbmcgZGV2aWNlIGlzIHJlYWxseSBhIHByb2JsZW1cblx0XHRcdFx0XHR2YXIgYXVkaW9TZW5kID0gaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdFx0XHR2YXIgdmlkZW9TZW5kID0gaXNWaWRlb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdFx0XHR2YXIgbmVlZEF1ZGlvRGV2aWNlID0gaXNBdWRpb1NlbmRSZXF1aXJlZChtZWRpYSk7XG5cdFx0XHRcdFx0dmFyIG5lZWRWaWRlb0RldmljZSA9IGlzVmlkZW9TZW5kUmVxdWlyZWQobWVkaWEpO1xuXHRcdFx0XHRcdGlmKGF1ZGlvU2VuZCB8fCB2aWRlb1NlbmQgfHwgbmVlZEF1ZGlvRGV2aWNlIHx8IG5lZWRWaWRlb0RldmljZSkge1xuXHRcdFx0XHRcdFx0Ly8gV2UgbmVlZCB0byBzZW5kIGVpdGhlciBhdWRpbyBvciB2aWRlb1xuXHRcdFx0XHRcdFx0dmFyIGhhdmVBdWRpb0RldmljZSA9IGF1ZGlvU2VuZCA/IGF1ZGlvRXhpc3QgOiBmYWxzZTtcblx0XHRcdFx0XHRcdHZhciBoYXZlVmlkZW9EZXZpY2UgPSB2aWRlb1NlbmQgPyB2aWRlb0V4aXN0IDogZmFsc2U7XG5cdFx0XHRcdFx0XHRpZighaGF2ZUF1ZGlvRGV2aWNlICYmICFoYXZlVmlkZW9EZXZpY2UpIHtcblx0XHRcdFx0XHRcdFx0Ly8gRklYTUUgU2hvdWxkIHdlIHJlYWxseSBnaXZlIHVwLCBvciBqdXN0IGFzc3VtZSByZWN2b25seSBmb3IgYm90aD9cblx0XHRcdFx0XHRcdFx0cGx1Z2luSGFuZGxlLmNvbnNlbnREaWFsb2coZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3IoJ05vIGNhcHR1cmUgZGV2aWNlIGZvdW5kJyk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZighaGF2ZUF1ZGlvRGV2aWNlICYmIG5lZWRBdWRpb0RldmljZSkge1xuXHRcdFx0XHRcdFx0XHRwbHVnaW5IYW5kbGUuY29uc2VudERpYWxvZyhmYWxzZSk7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcignQXVkaW8gY2FwdHVyZSBpcyByZXF1aXJlZCwgYnV0IG5vIGNhcHR1cmUgZGV2aWNlIGZvdW5kJyk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZighaGF2ZVZpZGVvRGV2aWNlICYmIG5lZWRWaWRlb0RldmljZSkge1xuXHRcdFx0XHRcdFx0XHRwbHVnaW5IYW5kbGUuY29uc2VudERpYWxvZyhmYWxzZSk7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrcy5lcnJvcignVmlkZW8gY2FwdHVyZSBpcyByZXF1aXJlZCwgYnV0IG5vIGNhcHR1cmUgZGV2aWNlIGZvdW5kJyk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR2YXIgZ3VtQ29uc3RyYWludHMgPSB7XG5cdFx0XHRcdFx0XHRhdWRpbzogKGF1ZGlvRXhpc3QgJiYgIW1lZGlhLmtlZXBBdWRpbykgPyBhdWRpb1N1cHBvcnQgOiBmYWxzZSxcblx0XHRcdFx0XHRcdHZpZGVvOiAodmlkZW9FeGlzdCAmJiAhbWVkaWEua2VlcFZpZGVvKSA/IHZpZGVvU3VwcG9ydCA6IGZhbHNlXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRKYW51cy5kZWJ1ZyhcImdldFVzZXJNZWRpYSBjb25zdHJhaW50c1wiLCBndW1Db25zdHJhaW50cyk7XG5cdFx0XHRcdFx0aWYgKCFndW1Db25zdHJhaW50cy5hdWRpbyAmJiAhZ3VtQ29uc3RyYWludHMudmlkZW8pIHtcblx0XHRcdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0XHRcdHN0cmVhbXNEb25lKGhhbmRsZUlkLCBqc2VwLCBtZWRpYSwgY2FsbGJhY2tzLCBzdHJlYW0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShndW1Db25zdHJhaW50cylcblx0XHRcdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oc3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRcdFx0cGx1Z2luSGFuZGxlLmNvbnNlbnREaWFsb2coZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRcdHN0cmVhbXNEb25lKGhhbmRsZUlkLCBqc2VwLCBtZWRpYSwgY2FsbGJhY2tzLCBzdHJlYW0pO1xuXHRcdFx0XHRcdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHRcdFx0XHRcdHBsdWdpbkhhbmRsZS5jb25zZW50RGlhbG9nKGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFja3MuZXJyb3Ioe2NvZGU6IGVycm9yLmNvZGUsIG5hbWU6IGVycm9yLm5hbWUsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2V9KTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0XHRwbHVnaW5IYW5kbGUuY29uc2VudERpYWxvZyhmYWxzZSk7XG5cdFx0XHRcdFx0Y2FsbGJhY2tzLmVycm9yKCdlbnVtZXJhdGVEZXZpY2VzIGVycm9yJywgZXJyb3IpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gTm8gbmVlZCB0byBkbyBhIGdldFVzZXJNZWRpYSwgY3JlYXRlIG9mZmVyL2Fuc3dlciByaWdodCBhd2F5XG5cdFx0XHRzdHJlYW1zRG9uZShoYW5kbGVJZCwganNlcCwgbWVkaWEsIGNhbGxiYWNrcyk7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gcHJlcGFyZVdlYnJ0Y1BlZXIoaGFuZGxlSWQsIGNhbGxiYWNrcykge1xuXHRcdGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTtcblx0XHRjYWxsYmFja3Muc3VjY2VzcyA9ICh0eXBlb2YgY2FsbGJhY2tzLnN1Y2Nlc3MgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5zdWNjZXNzIDogSmFudXMubm9vcDtcblx0XHRjYWxsYmFja3MuZXJyb3IgPSAodHlwZW9mIGNhbGxiYWNrcy5lcnJvciA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmVycm9yIDogd2VicnRjRXJyb3I7XG5cdFx0dmFyIGpzZXAgPSBjYWxsYmFja3MuanNlcDtcblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0Y2FsbGJhY2tzLmVycm9yKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBjb25maWcgPSBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmY7XG5cdFx0aWYoanNlcCAhPT0gdW5kZWZpbmVkICYmIGpzZXAgIT09IG51bGwpIHtcblx0XHRcdGlmKGNvbmZpZy5wYyA9PT0gbnVsbCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiV2FpdCwgbm8gUGVlckNvbm5lY3Rpb24/PyBpZiB0aGlzIGlzIGFuIGFuc3dlciwgdXNlIGNyZWF0ZUFuc3dlciBhbmQgbm90IGhhbmRsZVJlbW90ZUpzZXBcIik7XG5cdFx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIk5vIFBlZXJDb25uZWN0aW9uOiBpZiB0aGlzIGlzIGFuIGFuc3dlciwgdXNlIGNyZWF0ZUFuc3dlciBhbmQgbm90IGhhbmRsZVJlbW90ZUpzZXBcIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGNvbmZpZy5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihqc2VwKVxuXHRcdFx0XHQudGhlbihmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRKYW51cy5sb2coXCJSZW1vdGUgZGVzY3JpcHRpb24gYWNjZXB0ZWQhXCIpO1xuXHRcdFx0XHRcdGNvbmZpZy5yZW1vdGVTZHAgPSBqc2VwLnNkcDtcblx0XHRcdFx0XHQvLyBBbnkgdHJpY2tsZSBjYW5kaWRhdGUgd2UgY2FjaGVkP1xuXHRcdFx0XHRcdGlmKGNvbmZpZy5jYW5kaWRhdGVzICYmIGNvbmZpZy5jYW5kaWRhdGVzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdGZvcih2YXIgaSBpbiBjb25maWcuY2FuZGlkYXRlcykge1xuXHRcdFx0XHRcdFx0XHR2YXIgY2FuZGlkYXRlID0gY29uZmlnLmNhbmRpZGF0ZXNbaV07XG5cdFx0XHRcdFx0XHRcdEphbnVzLmRlYnVnKFwiQWRkaW5nIHJlbW90ZSBjYW5kaWRhdGU6XCIsIGNhbmRpZGF0ZSk7XG5cdFx0XHRcdFx0XHRcdGlmKCFjYW5kaWRhdGUgfHwgY2FuZGlkYXRlLmNvbXBsZXRlZCA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdC8vIGVuZC1vZi1jYW5kaWRhdGVzXG5cdFx0XHRcdFx0XHRcdFx0Y29uZmlnLnBjLmFkZEljZUNhbmRpZGF0ZShKYW51cy5lbmRPZkNhbmRpZGF0ZXMpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdC8vIE5ldyBjYW5kaWRhdGVcblx0XHRcdFx0XHRcdFx0XHRjb25maWcucGMuYWRkSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGNvbmZpZy5jYW5kaWRhdGVzID0gW107XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vIERvbmVcblx0XHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcygpO1xuXHRcdFx0XHR9LCBjYWxsYmFja3MuZXJyb3IpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIEpTRVBcIik7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gY3JlYXRlT2ZmZXIoaGFuZGxlSWQsIG1lZGlhLCBjYWxsYmFja3MpIHtcblx0XHRjYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307XG5cdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MgPSAodHlwZW9mIGNhbGxiYWNrcy5zdWNjZXNzID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3Muc3VjY2VzcyA6IEphbnVzLm5vb3A7XG5cdFx0Y2FsbGJhY2tzLmVycm9yID0gKHR5cGVvZiBjYWxsYmFja3MuZXJyb3IgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5lcnJvciA6IEphbnVzLm5vb3A7XG5cdFx0Y2FsbGJhY2tzLmN1c3RvbWl6ZVNkcCA9ICh0eXBlb2YgY2FsbGJhY2tzLmN1c3RvbWl6ZVNkcCA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLmN1c3RvbWl6ZVNkcCA6IEphbnVzLm5vb3A7XG5cdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbaGFuZGxlSWRdO1xuXHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUgPT09IHVuZGVmaW5lZCB8fFxuXHRcdFx0XHRwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdGNhbGxiYWNrcy5lcnJvcihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgY29uZmlnID0gcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmO1xuXHRcdHZhciBzaW11bGNhc3QgPSBjYWxsYmFja3Muc2ltdWxjYXN0ID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdGlmKCFzaW11bGNhc3QpIHtcblx0XHRcdEphbnVzLmxvZyhcIkNyZWF0aW5nIG9mZmVyIChpY2VEb25lPVwiICsgY29uZmlnLmljZURvbmUgKyBcIilcIik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdEphbnVzLmxvZyhcIkNyZWF0aW5nIG9mZmVyIChpY2VEb25lPVwiICsgY29uZmlnLmljZURvbmUgKyBcIiwgc2ltdWxjYXN0PVwiICsgc2ltdWxjYXN0ICsgXCIpXCIpO1xuXHRcdH1cblx0XHQvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3dlYnJ0Yy9pc3N1ZXMvZGV0YWlsP2lkPTM1MDhcblx0XHR2YXIgbWVkaWFDb25zdHJhaW50cyA9IHt9O1xuXHRcdGlmKEphbnVzLnVuaWZpZWRQbGFuKSB7XG5cdFx0XHQvLyBXZSBjYW4gdXNlIFRyYW5zY2VpdmVyc1xuXHRcdFx0dmFyIGF1ZGlvVHJhbnNjZWl2ZXIgPSBudWxsLCB2aWRlb1RyYW5zY2VpdmVyID0gbnVsbDtcblx0XHRcdHZhciB0cmFuc2NlaXZlcnMgPSBjb25maWcucGMuZ2V0VHJhbnNjZWl2ZXJzKCk7XG5cdFx0XHRpZih0cmFuc2NlaXZlcnMgJiYgdHJhbnNjZWl2ZXJzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Zm9yKHZhciBpIGluIHRyYW5zY2VpdmVycykge1xuXHRcdFx0XHRcdHZhciB0ID0gdHJhbnNjZWl2ZXJzW2ldO1xuXHRcdFx0XHRcdGlmKCh0LnNlbmRlciAmJiB0LnNlbmRlci50cmFjayAmJiB0LnNlbmRlci50cmFjay5raW5kID09PSBcImF1ZGlvXCIpIHx8XG5cdFx0XHRcdFx0XHRcdCh0LnJlY2VpdmVyICYmIHQucmVjZWl2ZXIudHJhY2sgJiYgdC5yZWNlaXZlci50cmFjay5raW5kID09PSBcImF1ZGlvXCIpKSB7XG5cdFx0XHRcdFx0XHRpZighYXVkaW9UcmFuc2NlaXZlcilcblx0XHRcdFx0XHRcdFx0YXVkaW9UcmFuc2NlaXZlciA9IHQ7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYoKHQuc2VuZGVyICYmIHQuc2VuZGVyLnRyYWNrICYmIHQuc2VuZGVyLnRyYWNrLmtpbmQgPT09IFwidmlkZW9cIikgfHxcblx0XHRcdFx0XHRcdFx0KHQucmVjZWl2ZXIgJiYgdC5yZWNlaXZlci50cmFjayAmJiB0LnJlY2VpdmVyLnRyYWNrLmtpbmQgPT09IFwidmlkZW9cIikpIHtcblx0XHRcdFx0XHRcdGlmKCF2aWRlb1RyYW5zY2VpdmVyKVxuXHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyID0gdDtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gSGFuZGxlIGF1ZGlvIChhbmQgcmVsYXRlZCBjaGFuZ2VzLCBpZiBhbnkpXG5cdFx0XHR2YXIgYXVkaW9TZW5kID0gaXNBdWRpb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdHZhciBhdWRpb1JlY3YgPSBpc0F1ZGlvUmVjdkVuYWJsZWQobWVkaWEpO1xuXHRcdFx0aWYoIWF1ZGlvU2VuZCAmJiAhYXVkaW9SZWN2KSB7XG5cdFx0XHRcdC8vIEF1ZGlvIGRpc2FibGVkOiBoYXZlIHdlIHJlbW92ZWQgaXQ/XG5cdFx0XHRcdGlmKG1lZGlhLnJlbW92ZUF1ZGlvICYmIGF1ZGlvVHJhbnNjZWl2ZXIpIHtcblx0XHRcdFx0XHRpZiAoYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwiaW5hY3RpdmVcIik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJpbmFjdGl2ZVwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRKYW51cy5sb2coXCJTZXR0aW5nIGF1ZGlvIHRyYW5zY2VpdmVyIHRvIGluYWN0aXZlOlwiLCBhdWRpb1RyYW5zY2VpdmVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gVGFrZSBjYXJlIG9mIGF1ZGlvIG0tbGluZVxuXHRcdFx0XHRpZihhdWRpb1NlbmQgJiYgYXVkaW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYoYXVkaW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwic2VuZHJlY3ZcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwic2VuZHJlY3ZcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgYXVkaW8gdHJhbnNjZWl2ZXIgdG8gc2VuZHJlY3Y6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKGF1ZGlvU2VuZCAmJiAhYXVkaW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYoYXVkaW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwic2VuZG9ubHlcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwic2VuZG9ubHlcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgYXVkaW8gdHJhbnNjZWl2ZXIgdG8gc2VuZG9ubHk6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKCFhdWRpb1NlbmQgJiYgYXVkaW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYoYXVkaW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwicmVjdm9ubHlcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwicmVjdm9ubHlcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgYXVkaW8gdHJhbnNjZWl2ZXIgdG8gcmVjdm9ubHk6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBJbiB0aGVvcnksIHRoaXMgaXMgdGhlIG9ubHkgY2FzZSB3aGVyZSB3ZSBtaWdodCBub3QgaGF2ZSBhIHRyYW5zY2VpdmVyIHlldFxuXHRcdFx0XHRcdFx0YXVkaW9UcmFuc2NlaXZlciA9IGNvbmZpZy5wYy5hZGRUcmFuc2NlaXZlcihcImF1ZGlvXCIsIHsgZGlyZWN0aW9uOiBcInJlY3Zvbmx5XCIgfSk7XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJBZGRpbmcgcmVjdm9ubHkgYXVkaW8gdHJhbnNjZWl2ZXI6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gSGFuZGxlIHZpZGVvIChhbmQgcmVsYXRlZCBjaGFuZ2VzLCBpZiBhbnkpXG5cdFx0XHR2YXIgdmlkZW9TZW5kID0gaXNWaWRlb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdHZhciB2aWRlb1JlY3YgPSBpc1ZpZGVvUmVjdkVuYWJsZWQobWVkaWEpO1xuXHRcdFx0aWYoIXZpZGVvU2VuZCAmJiAhdmlkZW9SZWN2KSB7XG5cdFx0XHRcdC8vIFZpZGVvIGRpc2FibGVkOiBoYXZlIHdlIHJlbW92ZWQgaXQ/XG5cdFx0XHRcdGlmKG1lZGlhLnJlbW92ZVZpZGVvICYmIHZpZGVvVHJhbnNjZWl2ZXIpIHtcblx0XHRcdFx0XHRpZiAodmlkZW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwiaW5hY3RpdmVcIik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJpbmFjdGl2ZVwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRKYW51cy5sb2coXCJTZXR0aW5nIHZpZGVvIHRyYW5zY2VpdmVyIHRvIGluYWN0aXZlOlwiLCB2aWRlb1RyYW5zY2VpdmVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gVGFrZSBjYXJlIG9mIHZpZGVvIG0tbGluZVxuXHRcdFx0XHRpZih2aWRlb1NlbmQgJiYgdmlkZW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYodmlkZW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwic2VuZHJlY3ZcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwic2VuZHJlY3ZcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgdmlkZW8gdHJhbnNjZWl2ZXIgdG8gc2VuZHJlY3Y6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKHZpZGVvU2VuZCAmJiAhdmlkZW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYodmlkZW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwic2VuZG9ubHlcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwic2VuZG9ubHlcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgdmlkZW8gdHJhbnNjZWl2ZXIgdG8gc2VuZG9ubHk6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKCF2aWRlb1NlbmQgJiYgdmlkZW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYodmlkZW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0aWYgKHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwicmVjdm9ubHlcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwicmVjdm9ubHlcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgdmlkZW8gdHJhbnNjZWl2ZXIgdG8gcmVjdm9ubHk6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBJbiB0aGVvcnksIHRoaXMgaXMgdGhlIG9ubHkgY2FzZSB3aGVyZSB3ZSBtaWdodCBub3QgaGF2ZSBhIHRyYW5zY2VpdmVyIHlldFxuXHRcdFx0XHRcdFx0dmlkZW9UcmFuc2NlaXZlciA9IGNvbmZpZy5wYy5hZGRUcmFuc2NlaXZlcihcInZpZGVvXCIsIHsgZGlyZWN0aW9uOiBcInJlY3Zvbmx5XCIgfSk7XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJBZGRpbmcgcmVjdm9ubHkgdmlkZW8gdHJhbnNjZWl2ZXI6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRtZWRpYUNvbnN0cmFpbnRzW1wib2ZmZXJUb1JlY2VpdmVBdWRpb1wiXSA9IGlzQXVkaW9SZWN2RW5hYmxlZChtZWRpYSk7XG5cdFx0XHRtZWRpYUNvbnN0cmFpbnRzW1wib2ZmZXJUb1JlY2VpdmVWaWRlb1wiXSA9IGlzVmlkZW9SZWN2RW5hYmxlZChtZWRpYSk7XG5cdFx0fVxuXHRcdHZhciBpY2VSZXN0YXJ0ID0gY2FsbGJhY2tzLmljZVJlc3RhcnQgPT09IHRydWUgPyB0cnVlIDogZmFsc2U7XG5cdFx0aWYoaWNlUmVzdGFydCkge1xuXHRcdFx0bWVkaWFDb25zdHJhaW50c1tcImljZVJlc3RhcnRcIl0gPSB0cnVlO1xuXHRcdH1cblx0XHRKYW51cy5kZWJ1ZyhtZWRpYUNvbnN0cmFpbnRzKTtcblx0XHQvLyBDaGVjayBpZiB0aGlzIGlzIEZpcmVmb3ggYW5kIHdlJ3ZlIGJlZW4gYXNrZWQgdG8gZG8gc2ltdWxjYXN0aW5nXG5cdFx0dmFyIHNlbmRWaWRlbyA9IGlzVmlkZW9TZW5kRW5hYmxlZChtZWRpYSk7XG5cdFx0aWYoc2VuZFZpZGVvICYmIHNpbXVsY2FzdCAmJiBKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09IFwiZmlyZWZveFwiKSB7XG5cdFx0XHQvLyBGSVhNRSBCYXNlZCBvbiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS92b2x1bnRhcy8wODhiYzNjYzYyMDk0NzMwNjQ3YlxuXHRcdFx0SmFudXMubG9nKFwiRW5hYmxpbmcgU2ltdWxjYXN0aW5nIGZvciBGaXJlZm94IChSSUQpXCIpO1xuXHRcdFx0dmFyIHNlbmRlciA9IGNvbmZpZy5wYy5nZXRTZW5kZXJzKCkuZmluZChmdW5jdGlvbihzKSB7cmV0dXJuIHMudHJhY2sua2luZCA9PSBcInZpZGVvXCJ9KTtcblx0XHRcdGlmKHNlbmRlcikge1xuXHRcdFx0XHR2YXIgcGFyYW1ldGVycyA9IHNlbmRlci5nZXRQYXJhbWV0ZXJzKCk7XG5cdFx0XHRcdGlmKCFwYXJhbWV0ZXJzKVxuXHRcdFx0XHRcdHBhcmFtZXRlcnMgPSB7fTtcblx0XHRcdFx0cGFyYW1ldGVycy5lbmNvZGluZ3MgPSBbXG5cdFx0XHRcdFx0eyByaWQ6IFwiaFwiLCBhY3RpdmU6IHRydWUsIG1heEJpdHJhdGU6IDkwMDAwMCB9LFxuXHRcdFx0XHRcdHsgcmlkOiBcIm1cIiwgYWN0aXZlOiB0cnVlLCBtYXhCaXRyYXRlOiAzMDAwMDAsIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogMiB9LFxuXHRcdFx0XHRcdHsgcmlkOiBcImxcIiwgYWN0aXZlOiB0cnVlLCBtYXhCaXRyYXRlOiAxMDAwMDAsIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogNCB9XG5cdFx0XHRcdF07XG5cdFx0XHRcdHNlbmRlci5zZXRQYXJhbWV0ZXJzKHBhcmFtZXRlcnMpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRjb25maWcucGMuY3JlYXRlT2ZmZXIobWVkaWFDb25zdHJhaW50cylcblx0XHRcdC50aGVuKGZ1bmN0aW9uKG9mZmVyKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKG9mZmVyKTtcblx0XHRcdFx0Ly8gSlNPTi5zdHJpbmdpZnkgZG9lc24ndCB3b3JrIG9uIHNvbWUgV2ViUlRDIG9iamVjdHMgYW55bW9yZVxuXHRcdFx0XHQvLyBTZWUgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTQ2NzM2NlxuXHRcdFx0XHR2YXIganNlcCA9IHtcblx0XHRcdFx0XHRcInR5cGVcIjogb2ZmZXIudHlwZSxcblx0XHRcdFx0XHRcInNkcFwiOiBvZmZlci5zZHBcblx0XHRcdFx0fTtcblx0XHRcdFx0Y2FsbGJhY2tzLmN1c3RvbWl6ZVNkcChqc2VwKTtcblx0XHRcdFx0b2ZmZXIuc2RwID0ganNlcC5zZHA7XG5cdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgbG9jYWwgZGVzY3JpcHRpb25cIik7XG5cdFx0XHRcdGlmKHNlbmRWaWRlbyAmJiBzaW11bGNhc3QpIHtcblx0XHRcdFx0XHQvLyBUaGlzIFNEUCBtdW5naW5nIG9ubHkgd29ya3Mgd2l0aCBDaHJvbWUgKFNhZmFyaSBTVFAgbWF5IHN1cHBvcnQgaXQgdG9vKVxuXHRcdFx0XHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gXCJjaHJvbWVcIiB8fFxuXHRcdFx0XHRcdFx0XHRKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09IFwic2FmYXJpXCIpIHtcblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIkVuYWJsaW5nIFNpbXVsY2FzdGluZyBmb3IgQ2hyb21lIChTRFAgbXVuZ2luZylcIik7XG5cdFx0XHRcdFx0XHRvZmZlci5zZHAgPSBtdW5nZVNkcEZvclNpbXVsY2FzdGluZyhvZmZlci5zZHApO1xuXHRcdFx0XHRcdH0gZWxzZSBpZihKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgIT09IFwiZmlyZWZveFwiKSB7XG5cdFx0XHRcdFx0XHRKYW51cy53YXJuKFwic2ltdWxjYXN0PXRydWUsIGJ1dCB0aGlzIGlzIG5vdCBDaHJvbWUgbm9yIEZpcmVmb3gsIGlnbm9yaW5nXCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRjb25maWcubXlTZHAgPSBvZmZlci5zZHA7XG5cdFx0XHRcdGNvbmZpZy5wYy5zZXRMb2NhbERlc2NyaXB0aW9uKG9mZmVyKVxuXHRcdFx0XHRcdC5jYXRjaChjYWxsYmFja3MuZXJyb3IpO1xuXHRcdFx0XHRjb25maWcubWVkaWFDb25zdHJhaW50cyA9IG1lZGlhQ29uc3RyYWludHM7XG5cdFx0XHRcdGlmKCFjb25maWcuaWNlRG9uZSAmJiAhY29uZmlnLnRyaWNrbGUpIHtcblx0XHRcdFx0XHQvLyBEb24ndCBkbyBhbnl0aGluZyB1bnRpbCB3ZSBoYXZlIGFsbCBjYW5kaWRhdGVzXG5cdFx0XHRcdFx0SmFudXMubG9nKFwiV2FpdGluZyBmb3IgYWxsIGNhbmRpZGF0ZXMuLi5cIik7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdEphbnVzLmxvZyhcIk9mZmVyIHJlYWR5XCIpO1xuXHRcdFx0XHRKYW51cy5kZWJ1ZyhjYWxsYmFja3MpO1xuXHRcdFx0XHRjYWxsYmFja3Muc3VjY2VzcyhvZmZlcik7XG5cdFx0XHR9LCBjYWxsYmFja3MuZXJyb3IpO1xuXHR9XG5cblx0ZnVuY3Rpb24gY3JlYXRlQW5zd2VyKGhhbmRsZUlkLCBtZWRpYSwgY2FsbGJhY2tzKSB7XG5cdFx0Y2FsbGJhY2tzID0gY2FsbGJhY2tzIHx8IHt9O1xuXHRcdGNhbGxiYWNrcy5zdWNjZXNzID0gKHR5cGVvZiBjYWxsYmFja3Muc3VjY2VzcyA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLnN1Y2Nlc3MgOiBKYW51cy5ub29wO1xuXHRcdGNhbGxiYWNrcy5lcnJvciA9ICh0eXBlb2YgY2FsbGJhY2tzLmVycm9yID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3MuZXJyb3IgOiBKYW51cy5ub29wO1xuXHRcdGNhbGxiYWNrcy5jdXN0b21pemVTZHAgPSAodHlwZW9mIGNhbGxiYWNrcy5jdXN0b21pemVTZHAgPT0gXCJmdW5jdGlvblwiKSA/IGNhbGxiYWNrcy5jdXN0b21pemVTZHAgOiBKYW51cy5ub29wO1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRjYWxsYmFja3MuZXJyb3IoXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHR2YXIgc2ltdWxjYXN0ID0gY2FsbGJhY2tzLnNpbXVsY2FzdCA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTtcblx0XHRpZighc2ltdWxjYXN0KSB7XG5cdFx0XHRKYW51cy5sb2coXCJDcmVhdGluZyBhbnN3ZXIgKGljZURvbmU9XCIgKyBjb25maWcuaWNlRG9uZSArIFwiKVwiKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0SmFudXMubG9nKFwiQ3JlYXRpbmcgYW5zd2VyIChpY2VEb25lPVwiICsgY29uZmlnLmljZURvbmUgKyBcIiwgc2ltdWxjYXN0PVwiICsgc2ltdWxjYXN0ICsgXCIpXCIpO1xuXHRcdH1cblx0XHR2YXIgbWVkaWFDb25zdHJhaW50cyA9IG51bGw7XG5cdFx0aWYoSmFudXMudW5pZmllZFBsYW4pIHtcblx0XHRcdC8vIFdlIGNhbiB1c2UgVHJhbnNjZWl2ZXJzXG5cdFx0XHRtZWRpYUNvbnN0cmFpbnRzID0ge307XG5cdFx0XHR2YXIgYXVkaW9UcmFuc2NlaXZlciA9IG51bGwsIHZpZGVvVHJhbnNjZWl2ZXIgPSBudWxsO1xuXHRcdFx0dmFyIHRyYW5zY2VpdmVycyA9IGNvbmZpZy5wYy5nZXRUcmFuc2NlaXZlcnMoKTtcblx0XHRcdGlmKHRyYW5zY2VpdmVycyAmJiB0cmFuc2NlaXZlcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IodmFyIGkgaW4gdHJhbnNjZWl2ZXJzKSB7XG5cdFx0XHRcdFx0dmFyIHQgPSB0cmFuc2NlaXZlcnNbaV07XG5cdFx0XHRcdFx0aWYoKHQuc2VuZGVyICYmIHQuc2VuZGVyLnRyYWNrICYmIHQuc2VuZGVyLnRyYWNrLmtpbmQgPT09IFwiYXVkaW9cIikgfHxcblx0XHRcdFx0XHRcdFx0KHQucmVjZWl2ZXIgJiYgdC5yZWNlaXZlci50cmFjayAmJiB0LnJlY2VpdmVyLnRyYWNrLmtpbmQgPT09IFwiYXVkaW9cIikpIHtcblx0XHRcdFx0XHRcdGlmKCFhdWRpb1RyYW5zY2VpdmVyKVxuXHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyID0gdDtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZigodC5zZW5kZXIgJiYgdC5zZW5kZXIudHJhY2sgJiYgdC5zZW5kZXIudHJhY2sua2luZCA9PT0gXCJ2aWRlb1wiKSB8fFxuXHRcdFx0XHRcdFx0XHQodC5yZWNlaXZlciAmJiB0LnJlY2VpdmVyLnRyYWNrICYmIHQucmVjZWl2ZXIudHJhY2sua2luZCA9PT0gXCJ2aWRlb1wiKSkge1xuXHRcdFx0XHRcdFx0aWYoIXZpZGVvVHJhbnNjZWl2ZXIpXG5cdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIgPSB0O1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvLyBIYW5kbGUgYXVkaW8gKGFuZCByZWxhdGVkIGNoYW5nZXMsIGlmIGFueSlcblx0XHRcdHZhciBhdWRpb1NlbmQgPSBpc0F1ZGlvU2VuZEVuYWJsZWQobWVkaWEpO1xuXHRcdFx0dmFyIGF1ZGlvUmVjdiA9IGlzQXVkaW9SZWN2RW5hYmxlZChtZWRpYSk7XG5cdFx0XHRpZighYXVkaW9TZW5kICYmICFhdWRpb1JlY3YpIHtcblx0XHRcdFx0Ly8gQXVkaW8gZGlzYWJsZWQ6IGhhdmUgd2UgcmVtb3ZlZCBpdD9cblx0XHRcdFx0aWYobWVkaWEucmVtb3ZlQXVkaW8gJiYgYXVkaW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRpZiAoYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdFx0YXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24oXCJpbmFjdGl2ZVwiKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJpbmFjdGl2ZVwiO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0SmFudXMubG9nKFwiU2V0dGluZyBhdWRpbyB0cmFuc2NlaXZlciB0byBpbmFjdGl2ZTpcIiwgYXVkaW9UcmFuc2NlaXZlcik7XG5cdFx0XHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdFx0XHRKYW51cy5lcnJvcihlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFRha2UgY2FyZSBvZiBhdWRpbyBtLWxpbmVcblx0XHRcdFx0aWYoYXVkaW9TZW5kICYmIGF1ZGlvUmVjdikge1xuXHRcdFx0XHRcdGlmKGF1ZGlvVHJhbnNjZWl2ZXIpIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGlmIChhdWRpb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbikge1xuXHRcdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwic2VuZHJlY3ZcIik7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0YXVkaW9UcmFuc2NlaXZlci5kaXJlY3Rpb24gPSBcInNlbmRyZWN2XCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0SmFudXMubG9nKFwiU2V0dGluZyBhdWRpbyB0cmFuc2NlaXZlciB0byBzZW5kcmVjdjpcIiwgYXVkaW9UcmFuc2NlaXZlcik7XG5cdFx0XHRcdFx0XHR9IGNhdGNoKGUpIHtcblx0XHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYoYXVkaW9TZW5kICYmICFhdWRpb1JlY3YpIHtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0aWYoYXVkaW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0XHRpZiAoYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbihcInNlbmRvbmx5XCIpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJzZW5kb25seVwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgYXVkaW8gdHJhbnNjZWl2ZXIgdG8gc2VuZG9ubHk6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gY2F0Y2goZSkge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYoIWF1ZGlvU2VuZCAmJiBhdWRpb1JlY3YpIHtcblx0XHRcdFx0XHRpZihhdWRpb1RyYW5zY2VpdmVyKSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRpZiAoYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdFx0XHRhdWRpb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbihcInJlY3Zvbmx5XCIpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJyZWN2b25seVwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgYXVkaW8gdHJhbnNjZWl2ZXIgdG8gcmVjdm9ubHk6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdFx0XHRcdEphbnVzLmVycm9yKGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBJbiB0aGVvcnksIHRoaXMgaXMgdGhlIG9ubHkgY2FzZSB3aGVyZSB3ZSBtaWdodCBub3QgaGF2ZSBhIHRyYW5zY2VpdmVyIHlldFxuXHRcdFx0XHRcdFx0YXVkaW9UcmFuc2NlaXZlciA9IGNvbmZpZy5wYy5hZGRUcmFuc2NlaXZlcihcImF1ZGlvXCIsIHsgZGlyZWN0aW9uOiBcInJlY3Zvbmx5XCIgfSk7XG5cdFx0XHRcdFx0XHRKYW51cy5sb2coXCJBZGRpbmcgcmVjdm9ubHkgYXVkaW8gdHJhbnNjZWl2ZXI6XCIsIGF1ZGlvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gSGFuZGxlIHZpZGVvIChhbmQgcmVsYXRlZCBjaGFuZ2VzLCBpZiBhbnkpXG5cdFx0XHR2YXIgdmlkZW9TZW5kID0gaXNWaWRlb1NlbmRFbmFibGVkKG1lZGlhKTtcblx0XHRcdHZhciB2aWRlb1JlY3YgPSBpc1ZpZGVvUmVjdkVuYWJsZWQobWVkaWEpO1xuXHRcdFx0aWYoIXZpZGVvU2VuZCAmJiAhdmlkZW9SZWN2KSB7XG5cdFx0XHRcdC8vIFZpZGVvIGRpc2FibGVkOiBoYXZlIHdlIHJlbW92ZWQgaXQ/XG5cdFx0XHRcdGlmKG1lZGlhLnJlbW92ZVZpZGVvICYmIHZpZGVvVHJhbnNjZWl2ZXIpIHtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0aWYgKHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwiaW5hY3RpdmVcIik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwiaW5hY3RpdmVcIjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgdmlkZW8gdHJhbnNjZWl2ZXIgdG8gaW5hY3RpdmU6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdH0gY2F0Y2goZSkge1xuXHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBUYWtlIGNhcmUgb2YgdmlkZW8gbS1saW5lXG5cdFx0XHRcdGlmKHZpZGVvU2VuZCAmJiB2aWRlb1JlY3YpIHtcblx0XHRcdFx0XHRpZih2aWRlb1RyYW5zY2VpdmVyKSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRpZiAodmlkZW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcblx0XHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbihcInNlbmRyZWN2XCIpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gXCJzZW5kcmVjdlwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIlNldHRpbmcgdmlkZW8gdHJhbnNjZWl2ZXIgdG8gc2VuZHJlY3Y6XCIsIHZpZGVvVHJhbnNjZWl2ZXIpO1xuXHRcdFx0XHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdFx0XHRcdEphbnVzLmVycm9yKGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmKHZpZGVvU2VuZCAmJiAhdmlkZW9SZWN2KSB7XG5cdFx0XHRcdFx0aWYodmlkZW9UcmFuc2NlaXZlcikge1xuXHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0aWYgKHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmlkZW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24oXCJzZW5kb25seVwiKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9IFwic2VuZG9ubHlcIjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRKYW51cy5sb2coXCJTZXR0aW5nIHZpZGVvIHRyYW5zY2VpdmVyIHRvIHNlbmRvbmx5OlwiLCB2aWRlb1RyYW5zY2VpdmVyKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2goZSkge1xuXHRcdFx0XHRcdFx0XHRKYW51cy5lcnJvcihlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZighdmlkZW9TZW5kICYmIHZpZGVvUmVjdikge1xuXHRcdFx0XHRcdGlmKHZpZGVvVHJhbnNjZWl2ZXIpIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGlmICh2aWRlb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbikge1xuXHRcdFx0XHRcdFx0XHRcdHZpZGVvVHJhbnNjZWl2ZXIuc2V0RGlyZWN0aW9uKFwicmVjdm9ubHlcIik7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0dmlkZW9UcmFuc2NlaXZlci5kaXJlY3Rpb24gPSBcInJlY3Zvbmx5XCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0SmFudXMubG9nKFwiU2V0dGluZyB2aWRlbyB0cmFuc2NlaXZlciB0byByZWN2b25seTpcIiwgdmlkZW9UcmFuc2NlaXZlcik7XG5cdFx0XHRcdFx0XHR9IGNhdGNoKGUpIHtcblx0XHRcdFx0XHRcdFx0SmFudXMuZXJyb3IoZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIEluIHRoZW9yeSwgdGhpcyBpcyB0aGUgb25seSBjYXNlIHdoZXJlIHdlIG1pZ2h0IG5vdCBoYXZlIGEgdHJhbnNjZWl2ZXIgeWV0XG5cdFx0XHRcdFx0XHR2aWRlb1RyYW5zY2VpdmVyID0gY29uZmlnLnBjLmFkZFRyYW5zY2VpdmVyKFwidmlkZW9cIiwgeyBkaXJlY3Rpb246IFwicmVjdm9ubHlcIiB9KTtcblx0XHRcdFx0XHRcdEphbnVzLmxvZyhcIkFkZGluZyByZWN2b25seSB2aWRlbyB0cmFuc2NlaXZlcjpcIiwgdmlkZW9UcmFuc2NlaXZlcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PSBcImZpcmVmb3hcIiB8fCBKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT0gXCJlZGdlXCIpIHtcblx0XHRcdFx0bWVkaWFDb25zdHJhaW50cyA9IHtcblx0XHRcdFx0XHRvZmZlclRvUmVjZWl2ZUF1ZGlvOiBpc0F1ZGlvUmVjdkVuYWJsZWQobWVkaWEpLFxuXHRcdFx0XHRcdG9mZmVyVG9SZWNlaXZlVmlkZW86IGlzVmlkZW9SZWN2RW5hYmxlZChtZWRpYSlcblx0XHRcdFx0fTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1lZGlhQ29uc3RyYWludHMgPSB7XG5cdFx0XHRcdFx0bWFuZGF0b3J5OiB7XG5cdFx0XHRcdFx0XHRPZmZlclRvUmVjZWl2ZUF1ZGlvOiBpc0F1ZGlvUmVjdkVuYWJsZWQobWVkaWEpLFxuXHRcdFx0XHRcdFx0T2ZmZXJUb1JlY2VpdmVWaWRlbzogaXNWaWRlb1JlY3ZFbmFibGVkKG1lZGlhKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9XG5cdFx0SmFudXMuZGVidWcobWVkaWFDb25zdHJhaW50cyk7XG5cdFx0Ly8gQ2hlY2sgaWYgdGhpcyBpcyBGaXJlZm94IGFuZCB3ZSd2ZSBiZWVuIGFza2VkIHRvIGRvIHNpbXVsY2FzdGluZ1xuXHRcdHZhciBzZW5kVmlkZW8gPSBpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpO1xuXHRcdGlmKHNlbmRWaWRlbyAmJiBzaW11bGNhc3QgJiYgSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSBcImZpcmVmb3hcIikge1xuXHRcdFx0Ly8gRklYTUUgQmFzZWQgb24gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vdm9sdW50YXMvMDg4YmMzY2M2MjA5NDczMDY0N2Jcblx0XHRcdEphbnVzLmxvZyhcIkVuYWJsaW5nIFNpbXVsY2FzdGluZyBmb3IgRmlyZWZveCAoUklEKVwiKTtcblx0XHRcdHZhciBzZW5kZXIgPSBjb25maWcucGMuZ2V0U2VuZGVycygpWzFdO1xuXHRcdFx0SmFudXMubG9nKHNlbmRlcik7XG5cdFx0XHR2YXIgcGFyYW1ldGVycyA9IHNlbmRlci5nZXRQYXJhbWV0ZXJzKCk7XG5cdFx0XHRKYW51cy5sb2cocGFyYW1ldGVycyk7XG5cdFx0XHRzZW5kZXIuc2V0UGFyYW1ldGVycyh7ZW5jb2RpbmdzOiBbXG5cdFx0XHRcdHsgcmlkOiBcImhpZ2hcIiwgYWN0aXZlOiB0cnVlLCBwcmlvcml0eTogXCJoaWdoXCIsIG1heEJpdHJhdGU6IDEwMDAwMDAgfSxcblx0XHRcdFx0eyByaWQ6IFwibWVkaXVtXCIsIGFjdGl2ZTogdHJ1ZSwgcHJpb3JpdHk6IFwibWVkaXVtXCIsIG1heEJpdHJhdGU6IDMwMDAwMCB9LFxuXHRcdFx0XHR7IHJpZDogXCJsb3dcIiwgYWN0aXZlOiB0cnVlLCBwcmlvcml0eTogXCJsb3dcIiwgbWF4Qml0cmF0ZTogMTAwMDAwIH1cblx0XHRcdF19KTtcblx0XHR9XG5cdFx0Y29uZmlnLnBjLmNyZWF0ZUFuc3dlcihtZWRpYUNvbnN0cmFpbnRzKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24oYW5zd2VyKSB7XG5cdFx0XHRcdEphbnVzLmRlYnVnKGFuc3dlcik7XG5cdFx0XHRcdC8vIEpTT04uc3RyaW5naWZ5IGRvZXNuJ3Qgd29yayBvbiBzb21lIFdlYlJUQyBvYmplY3RzIGFueW1vcmVcblx0XHRcdFx0Ly8gU2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD00NjczNjZcblx0XHRcdFx0dmFyIGpzZXAgPSB7XG5cdFx0XHRcdFx0XCJ0eXBlXCI6IGFuc3dlci50eXBlLFxuXHRcdFx0XHRcdFwic2RwXCI6IGFuc3dlci5zZHBcblx0XHRcdFx0fTtcblx0XHRcdFx0Y2FsbGJhY2tzLmN1c3RvbWl6ZVNkcChqc2VwKTtcblx0XHRcdFx0YW5zd2VyLnNkcCA9IGpzZXAuc2RwO1xuXHRcdFx0XHRKYW51cy5sb2coXCJTZXR0aW5nIGxvY2FsIGRlc2NyaXB0aW9uXCIpO1xuXHRcdFx0XHRpZihzZW5kVmlkZW8gJiYgc2ltdWxjYXN0KSB7XG5cdFx0XHRcdFx0Ly8gVGhpcyBTRFAgbXVuZ2luZyBvbmx5IHdvcmtzIHdpdGggQ2hyb21lXG5cdFx0XHRcdFx0aWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSBcImNocm9tZVwiKSB7XG5cdFx0XHRcdFx0XHQvLyBGSVhNRSBBcHBhcmVudGx5IHRyeWluZyB0byBzaW11bGNhc3Qgd2hlbiBhbnN3ZXJpbmcgYnJlYWtzIHZpZGVvIGluIENocm9tZS4uLlxuXHRcdFx0XHRcdFx0Ly9+IEphbnVzLmxvZyhcIkVuYWJsaW5nIFNpbXVsY2FzdGluZyBmb3IgQ2hyb21lIChTRFAgbXVuZ2luZylcIik7XG5cdFx0XHRcdFx0XHQvL34gYW5zd2VyLnNkcCA9IG11bmdlU2RwRm9yU2ltdWxjYXN0aW5nKGFuc3dlci5zZHApO1xuXHRcdFx0XHRcdFx0SmFudXMud2FybihcInNpbXVsY2FzdD10cnVlLCBidXQgdGhpcyBpcyBhbiBhbnN3ZXIsIGFuZCB2aWRlbyBicmVha3MgaW4gQ2hyb21lIGlmIHdlIGVuYWJsZSBpdFwiKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyICE9PSBcImZpcmVmb3hcIikge1xuXHRcdFx0XHRcdFx0SmFudXMud2FybihcInNpbXVsY2FzdD10cnVlLCBidXQgdGhpcyBpcyBub3QgQ2hyb21lIG5vciBGaXJlZm94LCBpZ25vcmluZ1wiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29uZmlnLm15U2RwID0gYW5zd2VyLnNkcDtcblx0XHRcdFx0Y29uZmlnLnBjLnNldExvY2FsRGVzY3JpcHRpb24oYW5zd2VyKVxuXHRcdFx0XHRcdC5jYXRjaChjYWxsYmFja3MuZXJyb3IpO1xuXHRcdFx0XHRjb25maWcubWVkaWFDb25zdHJhaW50cyA9IG1lZGlhQ29uc3RyYWludHM7XG5cdFx0XHRcdGlmKCFjb25maWcuaWNlRG9uZSAmJiAhY29uZmlnLnRyaWNrbGUpIHtcblx0XHRcdFx0XHQvLyBEb24ndCBkbyBhbnl0aGluZyB1bnRpbCB3ZSBoYXZlIGFsbCBjYW5kaWRhdGVzXG5cdFx0XHRcdFx0SmFudXMubG9nKFwiV2FpdGluZyBmb3IgYWxsIGNhbmRpZGF0ZXMuLi5cIik7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrcy5zdWNjZXNzKGFuc3dlcik7XG5cdFx0XHR9LCBjYWxsYmFja3MuZXJyb3IpO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2VuZFNEUChoYW5kbGVJZCwgY2FsbGJhY2tzKSB7XG5cdFx0Y2FsbGJhY2tzID0gY2FsbGJhY2tzIHx8IHt9O1xuXHRcdGNhbGxiYWNrcy5zdWNjZXNzID0gKHR5cGVvZiBjYWxsYmFja3Muc3VjY2VzcyA9PSBcImZ1bmN0aW9uXCIpID8gY2FsbGJhY2tzLnN1Y2Nlc3MgOiBKYW51cy5ub29wO1xuXHRcdGNhbGxiYWNrcy5lcnJvciA9ICh0eXBlb2YgY2FsbGJhY2tzLmVycm9yID09IFwiZnVuY3Rpb25cIikgPyBjYWxsYmFja3MuZXJyb3IgOiBKYW51cy5ub29wO1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGUsIG5vdCBzZW5kaW5nIGFueXRoaW5nXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgY29uZmlnID0gcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmO1xuXHRcdEphbnVzLmxvZyhcIlNlbmRpbmcgb2ZmZXIvYW5zd2VyIFNEUC4uLlwiKTtcblx0XHRpZihjb25maWcubXlTZHAgPT09IG51bGwgfHwgY29uZmlnLm15U2RwID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJMb2NhbCBTRFAgaW5zdGFuY2UgaXMgaW52YWxpZCwgbm90IHNlbmRpbmcgYW55dGhpbmcuLi5cIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGNvbmZpZy5teVNkcCA9IHtcblx0XHRcdFwidHlwZVwiOiBjb25maWcucGMubG9jYWxEZXNjcmlwdGlvbi50eXBlLFxuXHRcdFx0XCJzZHBcIjogY29uZmlnLnBjLmxvY2FsRGVzY3JpcHRpb24uc2RwXG5cdFx0fTtcblx0XHRpZihjb25maWcudHJpY2tsZSA9PT0gZmFsc2UpXG5cdFx0XHRjb25maWcubXlTZHBbXCJ0cmlja2xlXCJdID0gZmFsc2U7XG5cdFx0SmFudXMuZGVidWcoY2FsbGJhY2tzKTtcblx0XHRjb25maWcuc2RwU2VudCA9IHRydWU7XG5cdFx0Y2FsbGJhY2tzLnN1Y2Nlc3MoY29uZmlnLm15U2RwKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldFZvbHVtZShoYW5kbGVJZCwgcmVtb3RlKSB7XG5cdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbaGFuZGxlSWRdO1xuXHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUgPT09IHVuZGVmaW5lZCB8fFxuXHRcdFx0XHRwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybiAwO1xuXHRcdH1cblx0XHR2YXIgc3RyZWFtID0gcmVtb3RlID8gXCJyZW1vdGVcIiA6IFwibG9jYWxcIjtcblx0XHR2YXIgY29uZmlnID0gcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmO1xuXHRcdGlmKCFjb25maWcudm9sdW1lW3N0cmVhbV0pXG5cdFx0XHRjb25maWcudm9sdW1lW3N0cmVhbV0gPSB7IHZhbHVlOiAwIH07XG5cdFx0Ly8gU3RhcnQgZ2V0dGluZyB0aGUgdm9sdW1lLCBpZiBnZXRTdGF0cyBpcyBzdXBwb3J0ZWRcblx0XHRpZihjb25maWcucGMuZ2V0U3RhdHMgJiYgSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSBcImNocm9tZVwiKSB7XG5cdFx0XHRpZihyZW1vdGUgJiYgKGNvbmZpZy5yZW1vdGVTdHJlYW0gPT09IG51bGwgfHwgY29uZmlnLnJlbW90ZVN0cmVhbSA9PT0gdW5kZWZpbmVkKSkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiUmVtb3RlIHN0cmVhbSB1bmF2YWlsYWJsZVwiKTtcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHR9IGVsc2UgaWYoIXJlbW90ZSAmJiAoY29uZmlnLm15U3RyZWFtID09PSBudWxsIHx8IGNvbmZpZy5teVN0cmVhbSA9PT0gdW5kZWZpbmVkKSkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTG9jYWwgc3RyZWFtIHVuYXZhaWxhYmxlXCIpO1xuXHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdH1cblx0XHRcdGlmKGNvbmZpZy52b2x1bWVbc3RyZWFtXS50aW1lciA9PT0gbnVsbCB8fCBjb25maWcudm9sdW1lW3N0cmVhbV0udGltZXIgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRKYW51cy5sb2coXCJTdGFydGluZyBcIiArIHN0cmVhbSArIFwiIHZvbHVtZSBtb25pdG9yXCIpO1xuXHRcdFx0XHRjb25maWcudm9sdW1lW3N0cmVhbV0udGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRjb25maWcucGMuZ2V0U3RhdHMoZnVuY3Rpb24oc3RhdHMpIHtcblx0XHRcdFx0XHRcdHZhciByZXN1bHRzID0gc3RhdHMucmVzdWx0KCk7XG5cdFx0XHRcdFx0XHRmb3IodmFyIGk9MDsgaTxyZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdHZhciByZXMgPSByZXN1bHRzW2ldO1xuXHRcdFx0XHRcdFx0XHRpZihyZXMudHlwZSA9PSAnc3NyYycpIHtcblx0XHRcdFx0XHRcdFx0XHRpZihyZW1vdGUgJiYgcmVzLnN0YXQoJ2F1ZGlvT3V0cHV0TGV2ZWwnKSlcblx0XHRcdFx0XHRcdFx0XHRcdGNvbmZpZy52b2x1bWVbc3RyZWFtXS52YWx1ZSA9IHBhcnNlSW50KHJlcy5zdGF0KCdhdWRpb091dHB1dExldmVsJykpO1xuXHRcdFx0XHRcdFx0XHRcdGVsc2UgaWYoIXJlbW90ZSAmJiByZXMuc3RhdCgnYXVkaW9JbnB1dExldmVsJykpXG5cdFx0XHRcdFx0XHRcdFx0XHRjb25maWcudm9sdW1lW3N0cmVhbV0udmFsdWUgPSBwYXJzZUludChyZXMuc3RhdCgnYXVkaW9JbnB1dExldmVsJykpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0sIDIwMCk7XG5cdFx0XHRcdHJldHVybiAwO1x0Ly8gV2UgZG9uJ3QgaGF2ZSBhIHZvbHVtZSB0byByZXR1cm4geWV0XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gY29uZmlnLnZvbHVtZVtzdHJlYW1dLnZhbHVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBhdWRpb0lucHV0TGV2ZWwgYW5kIGF1ZGlvT3V0cHV0TGV2ZWwgc2VlbSBvbmx5IGF2YWlsYWJsZSBpbiBDaHJvbWU/IGF1ZGlvTGV2ZWxcblx0XHRcdC8vIHNlZW1zIHRvIGJlIGF2YWlsYWJsZSBvbiBDaHJvbWUgYW5kIEZpcmVmb3gsIGJ1dCB0aGV5IGRvbid0IHNlZW0gdG8gd29ya1xuXHRcdFx0SmFudXMud2FybihcIkdldHRpbmcgdGhlIFwiICsgc3RyZWFtICsgXCIgdm9sdW1lIHVuc3VwcG9ydGVkIGJ5IGJyb3dzZXJcIik7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBpc011dGVkKGhhbmRsZUlkLCB2aWRlbykge1xuXHRcdHZhciBwbHVnaW5IYW5kbGUgPSBwbHVnaW5IYW5kbGVzW2hhbmRsZUlkXTtcblx0XHRpZihwbHVnaW5IYW5kbGUgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlID09PSB1bmRlZmluZWQgfHxcblx0XHRcdFx0cGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRKYW51cy53YXJuKFwiSW52YWxpZCBoYW5kbGVcIik7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRpZihjb25maWcucGMgPT09IG51bGwgfHwgY29uZmlnLnBjID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIFBlZXJDb25uZWN0aW9uXCIpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdGlmKGNvbmZpZy5teVN0cmVhbSA9PT0gdW5kZWZpbmVkIHx8IGNvbmZpZy5teVN0cmVhbSA9PT0gbnVsbCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgbG9jYWwgTWVkaWFTdHJlYW1cIik7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0aWYodmlkZW8pIHtcblx0XHRcdC8vIENoZWNrIHZpZGVvIHRyYWNrXG5cdFx0XHRpZihjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKSA9PT0gbnVsbFxuXHRcdFx0XHRcdHx8IGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpID09PSB1bmRlZmluZWRcblx0XHRcdFx0XHR8fCBjb25maWcubXlTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0SmFudXMud2FybihcIk5vIHZpZGVvIHRyYWNrXCIpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiAhY29uZmlnLm15U3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0uZW5hYmxlZDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gQ2hlY2sgYXVkaW8gdHJhY2tcblx0XHRcdGlmKGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpID09PSBudWxsXG5cdFx0XHRcdFx0fHwgY29uZmlnLm15U3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkgPT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdHx8IGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTm8gYXVkaW8gdHJhY2tcIik7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICFjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXS5lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIG11dGUoaGFuZGxlSWQsIHZpZGVvLCBtdXRlKSB7XG5cdFx0dmFyIHBsdWdpbkhhbmRsZSA9IHBsdWdpbkhhbmRsZXNbaGFuZGxlSWRdO1xuXHRcdGlmKHBsdWdpbkhhbmRsZSA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUgPT09IHVuZGVmaW5lZCB8fFxuXHRcdFx0XHRwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IG51bGwgfHwgcGx1Z2luSGFuZGxlLndlYnJ0Y1N0dWZmID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIGhhbmRsZVwiKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRpZihjb25maWcucGMgPT09IG51bGwgfHwgY29uZmlnLnBjID09PSB1bmRlZmluZWQpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIFBlZXJDb25uZWN0aW9uXCIpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZihjb25maWcubXlTdHJlYW0gPT09IHVuZGVmaW5lZCB8fCBjb25maWcubXlTdHJlYW0gPT09IG51bGwpIHtcblx0XHRcdEphbnVzLndhcm4oXCJJbnZhbGlkIGxvY2FsIE1lZGlhU3RyZWFtXCIpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZih2aWRlbykge1xuXHRcdFx0Ly8gTXV0ZS91bm11dGUgdmlkZW8gdHJhY2tcblx0XHRcdGlmKGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpID09PSBudWxsXG5cdFx0XHRcdFx0fHwgY29uZmlnLm15U3RyZWFtLmdldFZpZGVvVHJhY2tzKCkgPT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdHx8IGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRKYW51cy53YXJuKFwiTm8gdmlkZW8gdHJhY2tcIik7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdGNvbmZpZy5teVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdLmVuYWJsZWQgPSBtdXRlID8gZmFsc2UgOiB0cnVlO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIE11dGUvdW5tdXRlIGF1ZGlvIHRyYWNrXG5cdFx0XHRpZihjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKSA9PT0gbnVsbFxuXHRcdFx0XHRcdHx8IGNvbmZpZy5teVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpID09PSB1bmRlZmluZWRcblx0XHRcdFx0XHR8fCBjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0SmFudXMud2FybihcIk5vIGF1ZGlvIHRyYWNrXCIpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRjb25maWcubXlTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXS5lbmFibGVkID0gbXV0ZSA/IGZhbHNlIDogdHJ1ZTtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIGdldEJpdHJhdGUoaGFuZGxlSWQpIHtcblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkIHx8XG5cdFx0XHRcdHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZiA9PT0gbnVsbCB8fCBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmYgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0SmFudXMud2FybihcIkludmFsaWQgaGFuZGxlXCIpO1xuXHRcdFx0cmV0dXJuIFwiSW52YWxpZCBoYW5kbGVcIjtcblx0XHR9XG5cdFx0dmFyIGNvbmZpZyA9IHBsdWdpbkhhbmRsZS53ZWJydGNTdHVmZjtcblx0XHRpZihjb25maWcucGMgPT09IG51bGwgfHwgY29uZmlnLnBjID09PSB1bmRlZmluZWQpXG5cdFx0XHRyZXR1cm4gXCJJbnZhbGlkIFBlZXJDb25uZWN0aW9uXCI7XG5cdFx0Ly8gU3RhcnQgZ2V0dGluZyB0aGUgYml0cmF0ZSwgaWYgZ2V0U3RhdHMgaXMgc3VwcG9ydGVkXG5cdFx0aWYoY29uZmlnLnBjLmdldFN0YXRzKSB7XG5cdFx0XHRpZihjb25maWcuYml0cmF0ZS50aW1lciA9PT0gbnVsbCB8fCBjb25maWcuYml0cmF0ZS50aW1lciA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdEphbnVzLmxvZyhcIlN0YXJ0aW5nIGJpdHJhdGUgdGltZXIgKHZpYSBnZXRTdGF0cylcIik7XG5cdFx0XHRcdGNvbmZpZy5iaXRyYXRlLnRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Y29uZmlnLnBjLmdldFN0YXRzKClcblx0XHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKHN0YXRzKSB7XG5cdFx0XHRcdFx0XHRcdHN0YXRzLmZvckVhY2goZnVuY3Rpb24gKHJlcykge1xuXHRcdFx0XHRcdFx0XHRcdGlmKCFyZXMpXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGluU3RhdHMgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHQvLyBDaGVjayBpZiB0aGVzZSBhcmUgc3RhdGlzdGljcyBvbiBpbmNvbWluZyBtZWRpYVxuXHRcdFx0XHRcdFx0XHRcdGlmKChyZXMubWVkaWFUeXBlID09PSBcInZpZGVvXCIgfHwgcmVzLmlkLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInZpZGVvXCIpID4gLTEpICYmXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJlcy50eXBlID09PSBcImluYm91bmQtcnRwXCIgJiYgcmVzLmlkLmluZGV4T2YoXCJydGNwXCIpIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gTmV3IHN0YXRzXG5cdFx0XHRcdFx0XHRcdFx0XHRpblN0YXRzID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYocmVzLnR5cGUgPT0gJ3NzcmMnICYmIHJlcy5ieXRlc1JlY2VpdmVkICYmXG5cdFx0XHRcdFx0XHRcdFx0XHRcdChyZXMuZ29vZ0NvZGVjTmFtZSA9PT0gXCJWUDhcIiB8fCByZXMuZ29vZ0NvZGVjTmFtZSA9PT0gXCJcIikpIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8vIE9sZGVyIENocm9tZXIgdmVyc2lvbnNcblx0XHRcdFx0XHRcdFx0XHRcdGluU3RhdHMgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHQvLyBQYXJzZSBzdGF0cyBub3dcblx0XHRcdFx0XHRcdFx0XHRpZihpblN0YXRzKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb25maWcuYml0cmF0ZS5ic25vdyA9IHJlcy5ieXRlc1JlY2VpdmVkO1xuXHRcdFx0XHRcdFx0XHRcdFx0Y29uZmlnLmJpdHJhdGUudHNub3cgPSByZXMudGltZXN0YW1wO1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoY29uZmlnLmJpdHJhdGUuYnNiZWZvcmUgPT09IG51bGwgfHwgY29uZmlnLmJpdHJhdGUudHNiZWZvcmUgPT09IG51bGwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly8gU2tpcCB0aGlzIHJvdW5kXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5iaXRyYXRlLmJzYmVmb3JlID0gY29uZmlnLmJpdHJhdGUuYnNub3c7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5iaXRyYXRlLnRzYmVmb3JlID0gY29uZmlnLmJpdHJhdGUudHNub3c7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBDYWxjdWxhdGUgYml0cmF0ZVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgdGltZVBhc3NlZCA9IGNvbmZpZy5iaXRyYXRlLnRzbm93IC0gY29uZmlnLmJpdHJhdGUudHNiZWZvcmU7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PSBcInNhZmFyaVwiKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRpbWVQYXNzZWQgPSB0aW1lUGFzc2VkLzEwMDA7XHQvLyBBcHBhcmVudGx5IHRoZSB0aW1lc3RhbXAgaXMgaW4gbWljcm9zZWNvbmRzLCBpbiBTYWZhcmlcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGJpdFJhdGUgPSBNYXRoLnJvdW5kKChjb25maWcuYml0cmF0ZS5ic25vdyAtIGNvbmZpZy5iaXRyYXRlLmJzYmVmb3JlKSAqIDggLyB0aW1lUGFzc2VkKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYoSmFudXMud2ViUlRDQWRhcHRlci5icm93c2VyRGV0YWlscy5icm93c2VyID09PSAnc2FmYXJpJylcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRiaXRSYXRlID0gcGFyc2VJbnQoYml0UmF0ZS8xMDAwKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y29uZmlnLmJpdHJhdGUudmFsdWUgPSBiaXRSYXRlICsgJyBrYml0cy9zZWMnO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL34gSmFudXMubG9nKFwiRXN0aW1hdGVkIGJpdHJhdGUgaXMgXCIgKyBjb25maWcuYml0cmF0ZS52YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5iaXRyYXRlLmJzYmVmb3JlID0gY29uZmlnLmJpdHJhdGUuYnNub3c7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbmZpZy5iaXRyYXRlLnRzYmVmb3JlID0gY29uZmlnLmJpdHJhdGUudHNub3c7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdFx0cmV0dXJuIFwiMCBrYml0cy9zZWNcIjtcdC8vIFdlIGRvbid0IGhhdmUgYSBiaXRyYXRlIHZhbHVlIHlldFxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGNvbmZpZy5iaXRyYXRlLnZhbHVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRKYW51cy53YXJuKFwiR2V0dGluZyB0aGUgdmlkZW8gYml0cmF0ZSB1bnN1cHBvcnRlZCBieSBicm93c2VyXCIpO1xuXHRcdFx0cmV0dXJuIFwiRmVhdHVyZSB1bnN1cHBvcnRlZCBieSBicm93c2VyXCI7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gd2VicnRjRXJyb3IoZXJyb3IpIHtcblx0XHRKYW51cy5lcnJvcihcIldlYlJUQyBlcnJvcjpcIiwgZXJyb3IpO1xuXHR9XG5cblx0ZnVuY3Rpb24gY2xlYW51cFdlYnJ0YyhoYW5kbGVJZCwgaGFuZ3VwUmVxdWVzdCkge1xuXHRcdEphbnVzLmxvZyhcIkNsZWFuaW5nIFdlYlJUQyBzdHVmZlwiKTtcblx0XHR2YXIgcGx1Z2luSGFuZGxlID0gcGx1Z2luSGFuZGxlc1toYW5kbGVJZF07XG5cdFx0aWYocGx1Z2luSGFuZGxlID09PSBudWxsIHx8IHBsdWdpbkhhbmRsZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHQvLyBOb3RoaW5nIHRvIGNsZWFuXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHZhciBjb25maWcgPSBwbHVnaW5IYW5kbGUud2VicnRjU3R1ZmY7XG5cdFx0aWYoY29uZmlnICE9PSBudWxsICYmIGNvbmZpZyAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRpZihoYW5ndXBSZXF1ZXN0ID09PSB0cnVlKSB7XG5cdFx0XHRcdC8vIFNlbmQgYSBoYW5ndXAgcmVxdWVzdCAod2UgZG9uJ3QgcmVhbGx5IGNhcmUgYWJvdXQgdGhlIHJlc3BvbnNlKVxuXHRcdFx0XHR2YXIgcmVxdWVzdCA9IHsgXCJqYW51c1wiOiBcImhhbmd1cFwiLCBcInRyYW5zYWN0aW9uXCI6IEphbnVzLnJhbmRvbVN0cmluZygxMikgfTtcblx0XHRcdFx0aWYocGx1Z2luSGFuZGxlLnRva2VuICE9PSBudWxsICYmIHBsdWdpbkhhbmRsZS50b2tlbiAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRcdHJlcXVlc3RbXCJ0b2tlblwiXSA9IHBsdWdpbkhhbmRsZS50b2tlbjtcblx0XHRcdFx0aWYoYXBpc2VjcmV0ICE9PSBudWxsICYmIGFwaXNlY3JldCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRcdHJlcXVlc3RbXCJhcGlzZWNyZXRcIl0gPSBhcGlzZWNyZXQ7XG5cdFx0XHRcdEphbnVzLmRlYnVnKFwiU2VuZGluZyBoYW5ndXAgcmVxdWVzdCAoaGFuZGxlPVwiICsgaGFuZGxlSWQgKyBcIik6XCIpO1xuXHRcdFx0XHRKYW51cy5kZWJ1ZyhyZXF1ZXN0KTtcblx0XHRcdFx0aWYod2Vic29ja2V0cykge1xuXHRcdFx0XHRcdHJlcXVlc3RbXCJzZXNzaW9uX2lkXCJdID0gc2Vzc2lvbklkO1xuXHRcdFx0XHRcdHJlcXVlc3RbXCJoYW5kbGVfaWRcIl0gPSBoYW5kbGVJZDtcblx0XHRcdFx0XHR3cy5zZW5kKEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRKYW51cy5odHRwQVBJQ2FsbChzZXJ2ZXIgKyBcIi9cIiArIHNlc3Npb25JZCArIFwiL1wiICsgaGFuZGxlSWQsIHtcblx0XHRcdFx0XHRcdHZlcmI6ICdQT1NUJyxcblx0XHRcdFx0XHRcdHdpdGhDcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzLFxuXHRcdFx0XHRcdFx0Ym9keTogcmVxdWVzdFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvLyBDbGVhbnVwIHN0YWNrXG5cdFx0XHRjb25maWcucmVtb3RlU3RyZWFtID0gbnVsbDtcblx0XHRcdGlmKGNvbmZpZy52b2x1bWUpIHtcblx0XHRcdFx0aWYoY29uZmlnLnZvbHVtZVtcImxvY2FsXCJdICYmIGNvbmZpZy52b2x1bWVbXCJsb2NhbFwiXS50aW1lcilcblx0XHRcdFx0XHRjbGVhckludGVydmFsKGNvbmZpZy52b2x1bWVbXCJsb2NhbFwiXS50aW1lcik7XG5cdFx0XHRcdGlmKGNvbmZpZy52b2x1bWVbXCJyZW1vdGVcIl0gJiYgY29uZmlnLnZvbHVtZVtcInJlbW90ZVwiXS50aW1lcilcblx0XHRcdFx0XHRjbGVhckludGVydmFsKGNvbmZpZy52b2x1bWVbXCJyZW1vdGVcIl0udGltZXIpO1xuXHRcdFx0fVxuXHRcdFx0Y29uZmlnLnZvbHVtZSA9IHt9O1xuXHRcdFx0aWYoY29uZmlnLmJpdHJhdGUudGltZXIpXG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoY29uZmlnLmJpdHJhdGUudGltZXIpO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUudGltZXIgPSBudWxsO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUuYnNub3cgPSBudWxsO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUuYnNiZWZvcmUgPSBudWxsO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUudHNub3cgPSBudWxsO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUudHNiZWZvcmUgPSBudWxsO1xuXHRcdFx0Y29uZmlnLmJpdHJhdGUudmFsdWUgPSBudWxsO1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Ly8gVHJ5IGEgTWVkaWFTdHJlYW1UcmFjay5zdG9wKCkgZm9yIGVhY2ggdHJhY2tcblx0XHRcdFx0aWYoIWNvbmZpZy5zdHJlYW1FeHRlcm5hbCAmJiBjb25maWcubXlTdHJlYW0gIT09IG51bGwgJiYgY29uZmlnLm15U3RyZWFtICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRKYW51cy5sb2coXCJTdG9wcGluZyBsb2NhbCBzdHJlYW0gdHJhY2tzXCIpO1xuXHRcdFx0XHRcdHZhciB0cmFja3MgPSBjb25maWcubXlTdHJlYW0uZ2V0VHJhY2tzKCk7XG5cdFx0XHRcdFx0Zm9yKHZhciBpIGluIHRyYWNrcykge1xuXHRcdFx0XHRcdFx0dmFyIG1zdCA9IHRyYWNrc1tpXTtcblx0XHRcdFx0XHRcdEphbnVzLmxvZyhtc3QpO1xuXHRcdFx0XHRcdFx0aWYobXN0ICE9PSBudWxsICYmIG1zdCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRcdFx0XHRtc3Quc3RvcCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdC8vIERvIG5vdGhpbmcgaWYgdGhpcyBmYWlsc1xuXHRcdFx0fVxuXHRcdFx0Y29uZmlnLnN0cmVhbUV4dGVybmFsID0gZmFsc2U7XG5cdFx0XHRjb25maWcubXlTdHJlYW0gPSBudWxsO1xuXHRcdFx0Ly8gQ2xvc2UgUGVlckNvbm5lY3Rpb25cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbmZpZy5wYy5jbG9zZSgpO1xuXHRcdFx0fSBjYXRjaChlKSB7XG5cdFx0XHRcdC8vIERvIG5vdGhpbmdcblx0XHRcdH1cblx0XHRcdGNvbmZpZy5wYyA9IG51bGw7XG5cdFx0XHRjb25maWcuY2FuZGlkYXRlcyA9IG51bGw7XG5cdFx0XHRjb25maWcubXlTZHAgPSBudWxsO1xuXHRcdFx0Y29uZmlnLnJlbW90ZVNkcCA9IG51bGw7XG5cdFx0XHRjb25maWcuaWNlRG9uZSA9IGZhbHNlO1xuXHRcdFx0Y29uZmlnLmRhdGFDaGFubmVsID0ge307XG5cdFx0XHRjb25maWcuZHRtZlNlbmRlciA9IG51bGw7XG5cdFx0fVxuXHRcdHBsdWdpbkhhbmRsZS5vbmNsZWFudXAoKTtcblx0fVxuXG5cdC8vIEhlbHBlciBtZXRob2QgdG8gbXVuZ2UgYW4gU0RQIHRvIGVuYWJsZSBzaW11bGNhc3RpbmcgKENocm9tZSBvbmx5KVxuXHRmdW5jdGlvbiBtdW5nZVNkcEZvclNpbXVsY2FzdGluZyhzZHApIHtcblx0XHQvLyBMZXQncyBtdW5nZSB0aGUgU0RQIHRvIGFkZCB0aGUgYXR0cmlidXRlcyBmb3IgZW5hYmxpbmcgc2ltdWxjYXN0aW5nXG5cdFx0Ly8gKGJhc2VkIG9uIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2dnYXJiZXIvYTE5YjRjMzM1MTAwMjhiOWM2NTcpXG5cdFx0dmFyIGxpbmVzID0gc2RwLnNwbGl0KFwiXFxyXFxuXCIpO1xuXHRcdHZhciB2aWRlbyA9IGZhbHNlO1xuXHRcdHZhciBzc3JjID0gWyAtMSBdLCBzc3JjX2ZpZCA9IFsgLTEgXTtcblx0XHR2YXIgY25hbWUgPSBudWxsLCBtc2lkID0gbnVsbCwgbXNsYWJlbCA9IG51bGwsIGxhYmVsID0gbnVsbDtcblx0XHR2YXIgaW5zZXJ0QXQgPSAtMTtcblx0XHRmb3IodmFyIGk9MDsgaTxsaW5lcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIG1saW5lID0gbGluZXNbaV0ubWF0Y2goL209KFxcdyspICovKTtcblx0XHRcdGlmKG1saW5lKSB7XG5cdFx0XHRcdHZhciBtZWRpdW0gPSBtbGluZVsxXTtcblx0XHRcdFx0aWYobWVkaXVtID09PSBcInZpZGVvXCIpIHtcblx0XHRcdFx0XHQvLyBOZXcgdmlkZW8gbS1saW5lOiBtYWtlIHN1cmUgaXQncyB0aGUgZmlyc3Qgb25lXG5cdFx0XHRcdFx0aWYoc3NyY1swXSA8IDApIHtcblx0XHRcdFx0XHRcdHZpZGVvID0gdHJ1ZTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gV2UncmUgZG9uZSwgbGV0J3MgYWRkIHRoZSBuZXcgYXR0cmlidXRlcyBoZXJlXG5cdFx0XHRcdFx0XHRpbnNlcnRBdCA9IGk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gTmV3IG5vbi12aWRlbyBtLWxpbmU6IGRvIHdlIGhhdmUgd2hhdCB3ZSB3ZXJlIGxvb2tpbmcgZm9yP1xuXHRcdFx0XHRcdGlmKHNzcmNbMF0gPiAtMSkge1xuXHRcdFx0XHRcdFx0Ly8gV2UncmUgZG9uZSwgbGV0J3MgYWRkIHRoZSBuZXcgYXR0cmlidXRlcyBoZXJlXG5cdFx0XHRcdFx0XHRpbnNlcnRBdCA9IGk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cdFx0XHRpZighdmlkZW8pXG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0dmFyIGZpZCA9IGxpbmVzW2ldLm1hdGNoKC9hPXNzcmMtZ3JvdXA6RklEIChcXGQrKSAoXFxkKykvKTtcblx0XHRcdGlmKGZpZCkge1xuXHRcdFx0XHRzc3JjWzBdID0gZmlkWzFdO1xuXHRcdFx0XHRzc3JjX2ZpZFswXSA9IGZpZFsyXTtcblx0XHRcdFx0bGluZXMuc3BsaWNlKGksIDEpOyBpLS07XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXHRcdFx0aWYoc3NyY1swXSkge1xuXHRcdFx0XHR2YXIgbWF0Y2ggPSBsaW5lc1tpXS5tYXRjaCgnYT1zc3JjOicgKyBzc3JjWzBdICsgJyBjbmFtZTooLispJylcblx0XHRcdFx0aWYobWF0Y2gpIHtcblx0XHRcdFx0XHRjbmFtZSA9IG1hdGNoWzFdO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG1hdGNoID0gbGluZXNbaV0ubWF0Y2goJ2E9c3NyYzonICsgc3NyY1swXSArICcgbXNpZDooLispJylcblx0XHRcdFx0aWYobWF0Y2gpIHtcblx0XHRcdFx0XHRtc2lkID0gbWF0Y2hbMV07XG5cdFx0XHRcdH1cblx0XHRcdFx0bWF0Y2ggPSBsaW5lc1tpXS5tYXRjaCgnYT1zc3JjOicgKyBzc3JjWzBdICsgJyBtc2xhYmVsOiguKyknKVxuXHRcdFx0XHRpZihtYXRjaCkge1xuXHRcdFx0XHRcdG1zbGFiZWwgPSBtYXRjaFsxXTtcblx0XHRcdFx0fVxuXHRcdFx0XHRtYXRjaCA9IGxpbmVzW2ldLm1hdGNoKCdhPXNzcmM6JyArIHNzcmNbMF0gKyAnIGxhYmVsOiguKyknKVxuXHRcdFx0XHRpZihtYXRjaCkge1xuXHRcdFx0XHRcdGxhYmVsID0gbWF0Y2hbMV07XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYobGluZXNbaV0uaW5kZXhPZignYT1zc3JjOicgKyBzc3JjX2ZpZFswXSkgPT09IDApIHtcblx0XHRcdFx0XHRsaW5lcy5zcGxpY2UoaSwgMSk7IGktLTtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZihsaW5lc1tpXS5pbmRleE9mKCdhPXNzcmM6JyArIHNzcmNbMF0pID09PSAwKSB7XG5cdFx0XHRcdFx0bGluZXMuc3BsaWNlKGksIDEpOyBpLS07XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmKGxpbmVzW2ldLmxlbmd0aCA9PSAwKSB7XG5cdFx0XHRcdGxpbmVzLnNwbGljZShpLCAxKTsgaS0tO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoc3NyY1swXSA8IDApIHtcblx0XHRcdC8vIENvdWxkbid0IGZpbmQgYSBGSUQgYXR0cmlidXRlLCBsZXQncyBqdXN0IHRha2UgdGhlIGZpcnN0IHZpZGVvIFNTUkMgd2UgZmluZFxuXHRcdFx0aW5zZXJ0QXQgPSAtMTtcblx0XHRcdHZpZGVvID0gZmFsc2U7XG5cdFx0XHRmb3IodmFyIGk9MDsgaTxsaW5lcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR2YXIgbWxpbmUgPSBsaW5lc1tpXS5tYXRjaCgvbT0oXFx3KykgKi8pO1xuXHRcdFx0XHRpZihtbGluZSkge1xuXHRcdFx0XHRcdHZhciBtZWRpdW0gPSBtbGluZVsxXTtcblx0XHRcdFx0XHRpZihtZWRpdW0gPT09IFwidmlkZW9cIikge1xuXHRcdFx0XHRcdFx0Ly8gTmV3IHZpZGVvIG0tbGluZTogbWFrZSBzdXJlIGl0J3MgdGhlIGZpcnN0IG9uZVxuXHRcdFx0XHRcdFx0aWYoc3NyY1swXSA8IDApIHtcblx0XHRcdFx0XHRcdFx0dmlkZW8gPSB0cnVlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gV2UncmUgZG9uZSwgbGV0J3MgYWRkIHRoZSBuZXcgYXR0cmlidXRlcyBoZXJlXG5cdFx0XHRcdFx0XHRcdGluc2VydEF0ID0gaTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIE5ldyBub24tdmlkZW8gbS1saW5lOiBkbyB3ZSBoYXZlIHdoYXQgd2Ugd2VyZSBsb29raW5nIGZvcj9cblx0XHRcdFx0XHRcdGlmKHNzcmNbMF0gPiAtMSkge1xuXHRcdFx0XHRcdFx0XHQvLyBXZSdyZSBkb25lLCBsZXQncyBhZGQgdGhlIG5ldyBhdHRyaWJ1dGVzIGhlcmVcblx0XHRcdFx0XHRcdFx0aW5zZXJ0QXQgPSBpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYoIXZpZGVvKVxuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRpZihzc3JjWzBdIDwgMCkge1xuXHRcdFx0XHRcdHZhciB2YWx1ZSA9IGxpbmVzW2ldLm1hdGNoKC9hPXNzcmM6KFxcZCspLyk7XG5cdFx0XHRcdFx0aWYodmFsdWUpIHtcblx0XHRcdFx0XHRcdHNzcmNbMF0gPSB2YWx1ZVsxXTtcblx0XHRcdFx0XHRcdGxpbmVzLnNwbGljZShpLCAxKTsgaS0tO1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciBtYXRjaCA9IGxpbmVzW2ldLm1hdGNoKCdhPXNzcmM6JyArIHNzcmNbMF0gKyAnIGNuYW1lOiguKyknKVxuXHRcdFx0XHRcdGlmKG1hdGNoKSB7XG5cdFx0XHRcdFx0XHRjbmFtZSA9IG1hdGNoWzFdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRtYXRjaCA9IGxpbmVzW2ldLm1hdGNoKCdhPXNzcmM6JyArIHNzcmNbMF0gKyAnIG1zaWQ6KC4rKScpXG5cdFx0XHRcdFx0aWYobWF0Y2gpIHtcblx0XHRcdFx0XHRcdG1zaWQgPSBtYXRjaFsxXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bWF0Y2ggPSBsaW5lc1tpXS5tYXRjaCgnYT1zc3JjOicgKyBzc3JjWzBdICsgJyBtc2xhYmVsOiguKyknKVxuXHRcdFx0XHRcdGlmKG1hdGNoKSB7XG5cdFx0XHRcdFx0XHRtc2xhYmVsID0gbWF0Y2hbMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG1hdGNoID0gbGluZXNbaV0ubWF0Y2goJ2E9c3NyYzonICsgc3NyY1swXSArICcgbGFiZWw6KC4rKScpXG5cdFx0XHRcdFx0aWYobWF0Y2gpIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gbWF0Y2hbMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKGxpbmVzW2ldLmluZGV4T2YoJ2E9c3NyYzonICsgc3NyY19maWRbMF0pID09PSAwKSB7XG5cdFx0XHRcdFx0XHRsaW5lcy5zcGxpY2UoaSwgMSk7IGktLTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihsaW5lc1tpXS5pbmRleE9mKCdhPXNzcmM6JyArIHNzcmNbMF0pID09PSAwKSB7XG5cdFx0XHRcdFx0XHRsaW5lcy5zcGxpY2UoaSwgMSk7IGktLTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRpZihsaW5lc1tpXS5sZW5ndGggPT0gMCkge1xuXHRcdFx0XHRcdGxpbmVzLnNwbGljZShpLCAxKTsgaS0tO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHNzcmNbMF0gPCAwKSB7XG5cdFx0XHQvLyBTdGlsbCBub3RoaW5nLCBsZXQncyBqdXN0IHJldHVybiB0aGUgU0RQIHdlIHdlcmUgYXNrZWQgdG8gbXVuZ2Vcblx0XHRcdEphbnVzLndhcm4oXCJDb3VsZG4ndCBmaW5kIHRoZSB2aWRlbyBTU1JDLCBzaW11bGNhc3RpbmcgTk9UIGVuYWJsZWRcIik7XG5cdFx0XHRyZXR1cm4gc2RwO1xuXHRcdH1cblx0XHRpZihpbnNlcnRBdCA8IDApIHtcblx0XHRcdC8vIEFwcGVuZCBhdCB0aGUgZW5kXG5cdFx0XHRpbnNlcnRBdCA9IGxpbmVzLmxlbmd0aDtcblx0XHR9XG5cdFx0Ly8gR2VuZXJhdGUgYSBjb3VwbGUgb2YgU1NSQ3MgKGZvciByZXRyYW5zbWlzc2lvbnMgdG9vKVxuXHRcdC8vIE5vdGU6IHNob3VsZCB3ZSBjaGVjayBpZiB0aGVyZSBhcmUgY29uZmxpY3RzLCBoZXJlP1xuXHRcdHNzcmNbMV0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMHhGRkZGRkZGRik7XG5cdFx0c3NyY1syXSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoweEZGRkZGRkZGKTtcblx0XHRzc3JjX2ZpZFsxXSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoweEZGRkZGRkZGKTtcblx0XHRzc3JjX2ZpZFsyXSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoweEZGRkZGRkZGKTtcblx0XHQvLyBBZGQgYXR0cmlidXRlcyB0byB0aGUgU0RQXG5cdFx0Zm9yKHZhciBpPTA7IGk8c3NyYy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYoY25hbWUpIHtcblx0XHRcdFx0bGluZXMuc3BsaWNlKGluc2VydEF0LCAwLCAnYT1zc3JjOicgKyBzc3JjW2ldICsgJyBjbmFtZTonICsgY25hbWUpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdFx0aWYobXNpZCkge1xuXHRcdFx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmM6JyArIHNzcmNbaV0gKyAnIG1zaWQ6JyArIG1zaWQpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdFx0aWYobXNsYWJlbCkge1xuXHRcdFx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmM6JyArIHNzcmNbaV0gKyAnIG1zbGFiZWw6JyArIG1zbGFiZWwpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdFx0aWYobGFiZWwpIHtcblx0XHRcdFx0bGluZXMuc3BsaWNlKGluc2VydEF0LCAwLCAnYT1zc3JjOicgKyBzc3JjW2ldICsgJyBsYWJlbDonICsgbGFiZWwpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdFx0Ly8gQWRkIHRoZSBzYW1lIGluZm8gZm9yIHRoZSByZXRyYW5zbWlzc2lvbiBTU1JDXG5cdFx0XHRpZihjbmFtZSkge1xuXHRcdFx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmM6JyArIHNzcmNfZmlkW2ldICsgJyBjbmFtZTonICsgY25hbWUpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdFx0aWYobXNpZCkge1xuXHRcdFx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmM6JyArIHNzcmNfZmlkW2ldICsgJyBtc2lkOicgKyBtc2lkKTtcblx0XHRcdFx0aW5zZXJ0QXQrKztcblx0XHRcdH1cblx0XHRcdGlmKG1zbGFiZWwpIHtcblx0XHRcdFx0bGluZXMuc3BsaWNlKGluc2VydEF0LCAwLCAnYT1zc3JjOicgKyBzc3JjX2ZpZFtpXSArICcgbXNsYWJlbDonICsgbXNsYWJlbCk7XG5cdFx0XHRcdGluc2VydEF0Kys7XG5cdFx0XHR9XG5cdFx0XHRpZihsYWJlbCkge1xuXHRcdFx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmM6JyArIHNzcmNfZmlkW2ldICsgJyBsYWJlbDonICsgbGFiZWwpO1xuXHRcdFx0XHRpbnNlcnRBdCsrO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmMtZ3JvdXA6RklEICcgKyBzc3JjWzJdICsgJyAnICsgc3NyY19maWRbMl0pO1xuXHRcdGxpbmVzLnNwbGljZShpbnNlcnRBdCwgMCwgJ2E9c3NyYy1ncm91cDpGSUQgJyArIHNzcmNbMV0gKyAnICcgKyBzc3JjX2ZpZFsxXSk7XG5cdFx0bGluZXMuc3BsaWNlKGluc2VydEF0LCAwLCAnYT1zc3JjLWdyb3VwOkZJRCAnICsgc3NyY1swXSArICcgJyArIHNzcmNfZmlkWzBdKTtcblx0XHRsaW5lcy5zcGxpY2UoaW5zZXJ0QXQsIDAsICdhPXNzcmMtZ3JvdXA6U0lNICcgKyBzc3JjWzBdICsgJyAnICsgc3NyY1sxXSArICcgJyArIHNzcmNbMl0pO1xuXHRcdHNkcCA9IGxpbmVzLmpvaW4oXCJcXHJcXG5cIik7XG5cdFx0aWYoIXNkcC5lbmRzV2l0aChcIlxcclxcblwiKSlcblx0XHRcdHNkcCArPSBcIlxcclxcblwiO1xuXHRcdHJldHVybiBzZHA7XG5cdH1cblxuXHQvLyBIZWxwZXIgbWV0aG9kcyB0byBwYXJzZSBhIG1lZGlhIG9iamVjdFxuXHRmdW5jdGlvbiBpc0F1ZGlvU2VuZEVuYWJsZWQobWVkaWEpIHtcblx0XHRKYW51cy5kZWJ1ZyhcImlzQXVkaW9TZW5kRW5hYmxlZDpcIiwgbWVkaWEpO1xuXHRcdGlmKG1lZGlhID09PSB1bmRlZmluZWQgfHwgbWVkaWEgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcdC8vIERlZmF1bHRcblx0XHRpZihtZWRpYS5hdWRpbyA9PT0gZmFsc2UpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBHZW5lcmljIGF1ZGlvIGhhcyBwcmVjZWRlbmNlXG5cdFx0aWYobWVkaWEuYXVkaW9TZW5kID09PSB1bmRlZmluZWQgfHwgbWVkaWEuYXVkaW9TZW5kID09PSBudWxsKVxuXHRcdFx0cmV0dXJuIHRydWU7XHQvLyBEZWZhdWx0XG5cdFx0cmV0dXJuIChtZWRpYS5hdWRpb1NlbmQgPT09IHRydWUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNBdWRpb1NlbmRSZXF1aXJlZChtZWRpYSkge1xuXHRcdEphbnVzLmRlYnVnKFwiaXNBdWRpb1NlbmRSZXF1aXJlZDpcIiwgbWVkaWEpO1xuXHRcdGlmKG1lZGlhID09PSB1bmRlZmluZWQgfHwgbWVkaWEgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBEZWZhdWx0XG5cdFx0aWYobWVkaWEuYXVkaW8gPT09IGZhbHNlIHx8IG1lZGlhLmF1ZGlvU2VuZCA9PT0gZmFsc2UpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBJZiB3ZSdyZSBub3QgYXNraW5nIHRvIGNhcHR1cmUgYXVkaW8sIGl0J3Mgbm90IHJlcXVpcmVkXG5cdFx0aWYobWVkaWEuZmFpbElmTm9BdWRpbyA9PT0gdW5kZWZpbmVkIHx8IG1lZGlhLmZhaWxJZk5vQXVkaW8gPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBEZWZhdWx0XG5cdFx0cmV0dXJuIChtZWRpYS5mYWlsSWZOb0F1ZGlvID09PSB0cnVlKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzQXVkaW9SZWN2RW5hYmxlZChtZWRpYSkge1xuXHRcdEphbnVzLmRlYnVnKFwiaXNBdWRpb1JlY3ZFbmFibGVkOlwiLCBtZWRpYSk7XG5cdFx0aWYobWVkaWEgPT09IHVuZGVmaW5lZCB8fCBtZWRpYSA9PT0gbnVsbClcblx0XHRcdHJldHVybiB0cnVlO1x0Ly8gRGVmYXVsdFxuXHRcdGlmKG1lZGlhLmF1ZGlvID09PSBmYWxzZSlcblx0XHRcdHJldHVybiBmYWxzZTtcdC8vIEdlbmVyaWMgYXVkaW8gaGFzIHByZWNlZGVuY2Vcblx0XHRpZihtZWRpYS5hdWRpb1JlY3YgPT09IHVuZGVmaW5lZCB8fCBtZWRpYS5hdWRpb1JlY3YgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcdC8vIERlZmF1bHRcblx0XHRyZXR1cm4gKG1lZGlhLmF1ZGlvUmVjdiA9PT0gdHJ1ZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc1ZpZGVvU2VuZEVuYWJsZWQobWVkaWEpIHtcblx0XHRKYW51cy5kZWJ1ZyhcImlzVmlkZW9TZW5kRW5hYmxlZDpcIiwgbWVkaWEpO1xuXHRcdGlmKG1lZGlhID09PSB1bmRlZmluZWQgfHwgbWVkaWEgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcdC8vIERlZmF1bHRcblx0XHRpZihtZWRpYS52aWRlbyA9PT0gZmFsc2UpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBHZW5lcmljIHZpZGVvIGhhcyBwcmVjZWRlbmNlXG5cdFx0aWYobWVkaWEudmlkZW9TZW5kID09PSB1bmRlZmluZWQgfHwgbWVkaWEudmlkZW9TZW5kID09PSBudWxsKVxuXHRcdFx0cmV0dXJuIHRydWU7XHQvLyBEZWZhdWx0XG5cdFx0cmV0dXJuIChtZWRpYS52aWRlb1NlbmQgPT09IHRydWUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNWaWRlb1NlbmRSZXF1aXJlZChtZWRpYSkge1xuXHRcdEphbnVzLmRlYnVnKFwiaXNWaWRlb1NlbmRSZXF1aXJlZDpcIiwgbWVkaWEpO1xuXHRcdGlmKG1lZGlhID09PSB1bmRlZmluZWQgfHwgbWVkaWEgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBEZWZhdWx0XG5cdFx0aWYobWVkaWEudmlkZW8gPT09IGZhbHNlIHx8IG1lZGlhLnZpZGVvU2VuZCA9PT0gZmFsc2UpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBJZiB3ZSdyZSBub3QgYXNraW5nIHRvIGNhcHR1cmUgdmlkZW8sIGl0J3Mgbm90IHJlcXVpcmVkXG5cdFx0aWYobWVkaWEuZmFpbElmTm9WaWRlbyA9PT0gdW5kZWZpbmVkIHx8IG1lZGlhLmZhaWxJZk5vVmlkZW8gPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHQvLyBEZWZhdWx0XG5cdFx0cmV0dXJuIChtZWRpYS5mYWlsSWZOb1ZpZGVvID09PSB0cnVlKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzVmlkZW9SZWN2RW5hYmxlZChtZWRpYSkge1xuXHRcdEphbnVzLmRlYnVnKFwiaXNWaWRlb1JlY3ZFbmFibGVkOlwiLCBtZWRpYSk7XG5cdFx0aWYobWVkaWEgPT09IHVuZGVmaW5lZCB8fCBtZWRpYSA9PT0gbnVsbClcblx0XHRcdHJldHVybiB0cnVlO1x0Ly8gRGVmYXVsdFxuXHRcdGlmKG1lZGlhLnZpZGVvID09PSBmYWxzZSlcblx0XHRcdHJldHVybiBmYWxzZTtcdC8vIEdlbmVyaWMgdmlkZW8gaGFzIHByZWNlZGVuY2Vcblx0XHRpZihtZWRpYS52aWRlb1JlY3YgPT09IHVuZGVmaW5lZCB8fCBtZWRpYS52aWRlb1JlY3YgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcdC8vIERlZmF1bHRcblx0XHRyZXR1cm4gKG1lZGlhLnZpZGVvUmVjdiA9PT0gdHJ1ZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc1NjcmVlblNlbmRFbmFibGVkKG1lZGlhKSB7XG5cdFx0SmFudXMuZGVidWcoXCJpc1NjcmVlblNlbmRFbmFibGVkOlwiLCBtZWRpYSk7XG5cdFx0aWYgKG1lZGlhID09PSB1bmRlZmluZWQgfHwgbWVkaWEgPT09IG51bGwpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0aWYgKHR5cGVvZiBtZWRpYS52aWRlbyAhPT0gJ29iamVjdCcgfHwgdHlwZW9mIG1lZGlhLnZpZGVvLm1hbmRhdG9yeSAhPT0gJ29iamVjdCcpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0dmFyIGNvbnN0cmFpbnRzID0gbWVkaWEudmlkZW8ubWFuZGF0b3J5O1xuXHRcdGlmIChjb25zdHJhaW50cy5jaHJvbWVNZWRpYVNvdXJjZSlcblx0XHRcdHJldHVybiBjb25zdHJhaW50cy5jaHJvbWVNZWRpYVNvdXJjZSA9PT0gJ2Rlc2t0b3AnIHx8IGNvbnN0cmFpbnRzLmNocm9tZU1lZGlhU291cmNlID09PSAnc2NyZWVuJztcblx0XHRlbHNlIGlmIChjb25zdHJhaW50cy5tb3pNZWRpYVNvdXJjZSlcblx0XHRcdHJldHVybiBjb25zdHJhaW50cy5tb3pNZWRpYVNvdXJjZSA9PT0gJ3dpbmRvdycgfHwgY29uc3RyYWludHMubW96TWVkaWFTb3VyY2UgPT09ICdzY3JlZW4nO1xuXHRcdGVsc2UgaWYgKGNvbnN0cmFpbnRzLm1lZGlhU291cmNlKVxuXHRcdFx0cmV0dXJuIGNvbnN0cmFpbnRzLm1lZGlhU291cmNlID09PSAnd2luZG93JyB8fCBjb25zdHJhaW50cy5tZWRpYVNvdXJjZSA9PT0gJ3NjcmVlbic7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNEYXRhRW5hYmxlZChtZWRpYSkge1xuXHRcdEphbnVzLmRlYnVnKFwiaXNEYXRhRW5hYmxlZDpcIiwgbWVkaWEpO1xuXHRcdGlmKEphbnVzLndlYlJUQ0FkYXB0ZXIuYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PSBcImVkZ2VcIikge1xuXHRcdFx0SmFudXMud2FybihcIkVkZ2UgZG9lc24ndCBzdXBwb3J0IGRhdGEgY2hhbm5lbHMgeWV0XCIpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZihtZWRpYSA9PT0gdW5kZWZpbmVkIHx8IG1lZGlhID09PSBudWxsKVxuXHRcdFx0cmV0dXJuIGZhbHNlO1x0Ly8gRGVmYXVsdFxuXHRcdHJldHVybiAobWVkaWEuZGF0YSA9PT0gdHJ1ZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc1RyaWNrbGVFbmFibGVkKHRyaWNrbGUpIHtcblx0XHRKYW51cy5kZWJ1ZyhcImlzVHJpY2tsZUVuYWJsZWQ6XCIsIHRyaWNrbGUpO1xuXHRcdGlmKHRyaWNrbGUgPT09IHVuZGVmaW5lZCB8fCB0cmlja2xlID09PSBudWxsKVxuXHRcdFx0cmV0dXJuIHRydWU7XHQvLyBEZWZhdWx0IGlzIHRydWVcblx0XHRyZXR1cm4gKHRyaWNrbGUgPT09IHRydWUpO1xuXHR9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBKYW51cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/plugins/janus.js\n");

/***/ }),

/***/ "./src/plugins/janus.videoroom.js":
/*!****************************************!*\
  !*** ./src/plugins/janus.videoroom.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _janus__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./janus */ \"./src/plugins/janus.js\");\n/* harmony import */ var _public_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../public/config */ \"./public/config/index.js\");\n\n\nlet instance = null\n\nclass JimberJanusVideoRoom {\n  constructor (roomName) {\n    if (instance === null) {\n      instance = this\n      instance.tmpId = 0\n      instance.roomName = roomName\n\n      // console.log('roomName: ', roomName)\n\n      for (var i = 0; i < roomName.length; i++) {\n        // console.log(roomName.charCodeAt(i))\n        instance.tmpId = instance.tmpId + roomName.charCodeAt(i)\n      }\n\n      // console.log('Room name translates to id: ' + instance.tmpId)\n\n      instance.server = null\n\n      if (window.location.protocol === 'http:') {\n        instance.server = _public_config__WEBPACK_IMPORTED_MODULE_1__[\"default\"].janus\n      } else {\n        instance.server = _public_config__WEBPACK_IMPORTED_MODULE_1__[\"default\"].janusHTTPS\n      }\n\n      instance.janus = null\n      instance.sfutest = null\n      instance.opaqueId = 'videoroomtest-' + _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].randomString(12)\n\n      instance.myusername = null\n      instance.myid = null\n      instance.mystream = null\n      instance.mypvtid = null\n\n      instance.feeds = []\n      instance.bitrateTimer = []\n      instance.participants = []\n\n      instance.doSimulcast = (instance.getQueryStringValue('simulcast') === 'yes' || instance.getQueryStringValue('simulcast') === 'true')\n      instance.doSimulcast2 = (instance.getQueryStringValue('simulcast2') === 'yes' || instance.getQueryStringValue('simulcast2') === 'true')\n\n      instance.init()\n    }\n\n    return instance\n  }\n\n  switchRoom (roomName) {\n    var leave = {\n      'request': 'leave',\n      'room': instance.tmpId\n    }\n\n    if (instance == null || instance.sfutest == null) {\n      instance = null\n      new JimberJanusVideoRoom(roomName)\n      return\n    }\n\n    instance.sfutest.send({\n      'message': leave,\n      error: (err) => {\n        console.error('Error: ', err)\n      },\n      success: (data) => {\n        // console.log('Successfully left room ... ', instance.tmpId)\n\n        // console.log(instance.sfutest)\n\n        instance.sfutest.detach()\n\n        instance = null\n        new JimberJanusVideoRoom(roomName)\n      }\n    })\n  }\n\n  disconnect (roomName) {\n    // console.log(instance.sfutest)\n\n    var leave = {\n      'request': 'leave',\n      'room': instance.tmpId\n    }\n\n    instance.sfutest.send({\n      'message': leave,\n      error: (err) => {\n        console.error('Error: ', err)\n      },\n      success: (data) => {\n        // console.log('success?')\n      }\n    })\n  }\n\n  connect (roomName) {\n    // console.log('Trying to join room with id ' + instance.tmpId + ' and username ' + instance.myusername)\n\n    instance = null\n    new JimberJanusVideoRoom(roomName)\n\n    // var join = {\n    //   'request': 'join',\n    //   'room': instance.tmpId,\n    //   'ptype': 'joinandconfigure',\n    //   'display': instance.myusername\n    // }\n\n    // instance.sfutest.send({\n    //   'message': join,\n    //   error: (err) => {\n    //     console.error('Error: ', err)\n    //   },\n    //   success: (data) => {\n    //     // console.log('success?')\n    //   }\n    // })\n  }\n\n  showUsers (roomName) {\n    // console.log('called')\n\n    var tmpRoomid = 0\n\n    for (var i = 0; i < roomName.length; i++) {\n      // console.log(roomName.charCodeAt(i))\n      tmpRoomid = tmpRoomid + roomName.charCodeAt(i)\n    }\n\n    instance.sfutest.send({\n      message: {\n        'request': 'list',\n        message: {\n          'audio': true,\n          'video': true\n        }\n      },\n      error: (err) => {\n        console.error('Error retrieving list of rooms: ', err)\n      },\n      success: (data) => {\n        // console.log(data.list.filter(room => room.room === tmpRoomid)[0])\n        // console.log(data.list.filter(room => room.room === tmpRoomid)[0].num_participants)\n      }\n    })\n  }\n\n  toggleMute () {\n    var muted = instance.sfutest.isAudioMuted()\n\n    if (muted) {\n      instance.sfutest.unmuteAudio()\n    } else {\n      instance.sfutest.muteAudio()\n    }\n\n    muted = instance.sfutest.isAudioMuted()\n    return muted\n  }\n\n  unpublishOwnFeed () {\n    var unpublish = { 'request': 'unpublish' }\n\n    instance.sfutest.send({\n      'message': unpublish\n    })\n  }\n\n  init () {\n    _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init({\n      debug: 'all',\n      callback: function () {\n        instance.janus = new _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n          server: _public_config__WEBPACK_IMPORTED_MODULE_1__[\"default\"].janus,\n          success: function () {\n            // console.log('janus success')\n\n            instance.janus.attach({\n              plugin: 'janus.plugin.videoroom',\n              success: function (pluginHandle) {\n                instance.sfutest = pluginHandle\n                // Janus.log('Plugin attached! (' + instance.sfutest.getPlugin() + ', id=' + instance.sfutest.getId() + ')')\n                // Janus.log('  -- This is a publisher/manager')\n\n                // Retrieve rooms\n                instance.sfutest.send({\n                  message: {\n                    'request': 'list',\n                    message: {\n                      'audio': true,\n                      'video': true\n                    }\n                  },\n                  error: (err) => {\n                    console.error('Error retrieving list of rooms: ', err)\n                  },\n                  success: (data) => {\n                    // console.log('List of rooms: ', data.list)\n                    if (data.list.some(room => room.room === instance.tmpId)) {\n                      // console.log('ROOM EXISTS')\n\n                      var username = 'SingleCore'\n\n                      var register = {\n                        'request': 'join',\n                        'room': instance.tmpId,\n                        'ptype': 'publisher',\n                        'display': username\n                      }\n                      instance.myusername = username\n                      instance.sfutest.send({\n                        'message': register,\n                        error: (err) => {\n                          // console.log('Error joining room: ', err)\n                        },\n                        success: (data) => {\n                          // console.log('Success join room: ', data)\n                        }\n                      })\n                    } else {\n                      // console.log('ROOM DOESNT EXIST, WE NEED TO CREATE IT!')\n                      // console.log('Attempting to create: ', instance.tmpId)\n\n                      instance.sfutest.send({\n                        message: {\n                          'request': 'create',\n                          'room': instance.tmpId,\n                          'description': instance.roomName,\n                          'publishers': 100,\n                          'is_private': false\n                        },\n                        error: (err) => {\n                          // console.log('Error creating room: ', err)\n                        },\n                        success: (data) => {\n                          // console.log('Success creating room: ', data)\n\n                          var username = 'SingleCore'\n\n                          var register = {\n                            'request': 'join',\n                            'room': instance.tmpId,\n                            'ptype': 'publisher',\n                            'display': username\n                          }\n                          instance.myusername = username\n                          instance.sfutest.send({\n                            'message': register\n                          })\n                        }\n                      })\n                    }\n                  }\n                })\n              },\n              error: function (error) {\n                _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error('  -- Error attaching plugin...', error)\n              },\n              consentDialog: function (on) {\n                // Janus.debug('Consent dialog should be ' + (on ? 'on' : 'off') + ' now')\n              },\n              mediaState: function (medium, on) {\n                // Janus.log('Janus ' + (on ? 'started' : 'stopped') + ' receiving our ' + medium)\n              },\n              webrtcState: function (on) {\n                // Janus.log('Janus says our WebRTC PeerConnection is ' + (on ? 'up' : 'down') + ' now')\n              },\n              onmessage: function (msg, jsep) {\n                // Janus.debug(' ::: Got a message (publisher) :::')\n                // Janus.debug(msg)\n                var event = msg['videoroom']\n                // Janus.debug('Event: ' + event)\n                if (event !== undefined && event != null) {\n                  if (event === 'joined') {\n                    // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                    instance.myid = msg['id']\n                    instance.mypvtid = msg['private_id']\n                    // Janus.log('Successfully joined room ' + msg['room'] + ' with ID ' + instance.myid)\n                    instance.publishOwnFeed(true)\n                    // Any new feed to attach to?\n                    if (msg['publishers'] !== undefined && msg['publishers'] !== null) {\n                      var list = msg['publishers']\n                      // Janus.debug('Got a list of available publishers/feeds:')\n                      // Janus.debug(list)\n                      for (var f in list) {\n                        var id = list[f]['id']\n                        var display = list[f]['display']\n                        var audio = list[f]['audio_codec']\n                        var video = list[f]['video_codec']\n                        // Janus.debug('  >> [' + id + '] ' + display + ' (audio: ' + audio + ', video: ' + video + ')')\n                        instance.newRemoteFeed(id, display, audio, video)\n                      }\n                    }\n                  } else if (event === 'destroyed') {\n                    // The room has been destroyed\n                    _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].warn('The room has been destroyed!')\n                  } else if (event === 'event') {\n                    // Any new feed to attach to?\n                    if (msg['publishers'] !== undefined && msg['publishers'] !== null) {\n                      let list = msg['publishers']\n                      // Janus.debug('Got a list of available publishers/feeds:')\n                      // Janus.debug(list)\n                      for (let f in list) {\n                        let id = list[f]['id']\n                        let display = list[f]['display']\n                        let audio = list[f]['audio_codec']\n                        let video = list[f]['video_codec']\n                        // Janus.debug('  >> [' + id + '] ' + display + ' (audio: ' + audio + ', video: ' + video + ')')\n                        instance.newRemoteFeed(id, display, audio, video)\n                      }\n                    } else if (msg['leaving'] !== undefined && msg['leaving'] !== null) {\n                      // One of the publishers has gone away?\n                      var leaving = msg['leaving']\n                      // Janus.log('Publisher left: ' + leaving)\n                      var remoteFeed = null\n                      for (var i = 1; i < 6; i++) {\n                        if (instance.feeds[i] != null && instance.feeds[i] !== undefined && instance.feeds[i].rfid === leaving) {\n                          remoteFeed = instance.feeds[i]\n                          break\n                        }\n                      }\n                      if (remoteFeed != null) {\n                        // Janus.debug('Feed ' + remoteFeed.rfid + ' (' + remoteFeed.rfdisplay + ') has left the room, detaching')\n                        // $('#remote'+remoteFeed.rfindex).empty().hide();\n                        // $('#videoremote'+remoteFeed.rfindex).empty();\n                        instance.feeds[remoteFeed.rfindex] = null\n                        remoteFeed.detach()\n                      }\n                    } else if (msg['unpublished'] !== undefined && msg['unpublished'] !== null) {\n                      // One of the publishers has unpublished?\n                      var unpublished = msg['unpublished']\n                      // Janus.log('Publisher left: ' + unpublished)\n                      if (unpublished === 'ok') {\n                        // That's us\n                        instance.sfutest.hangup()\n                        return\n                      }\n                      let remoteFeed = null\n                      for (let i = 1; i < 6; i++) {\n                        if (instance.feeds[i] != null && instance.feeds[i] !== undefined && instance.feeds[i].rfid === unpublished) {\n                          remoteFeed = instance.feeds[i]\n                          break\n                        }\n                      }\n                      if (remoteFeed != null) {\n                        // Janus.debug('Feed ' + remoteFeed.rfid + ' (' + remoteFeed.rfdisplay + ') has left the room, detaching')\n                        // $('#remote'+remoteFeed.rfindex).empty().hide();\n                        // $('#videoremote'+remoteFeed.rfindex).empty();\n                        instance.feeds[remoteFeed.rfindex] = null\n                        remoteFeed.detach()\n                      }\n                    } else if (msg['error'] !== undefined && msg['error'] !== null) {}\n                  }\n                }\n                if (jsep !== undefined && jsep !== null) {\n                  // Janus.debug('Handling SDP as well...')\n                  // Janus.debug(jsep)\n                  instance.sfutest.handleRemoteJsep({\n                    jsep: jsep\n                  })\n                  // Check if any of the media we wanted to publish has\n                  // been rejected (e.g., wrong or unsupported codec)\n                  let audio = msg['audio_codec']\n                  if (instance.mystream && instance.mystream.getAudioTracks() && instance.mystream.getAudioTracks().length > 0 && !audio) {\n                    // Audio has been rejected\n                    // toastr.warning(\"Our audio stream has been rejected, viewers won't hear us\")\n                  }\n                  let video = msg['video_codec']\n                  if (instance.mystream && instance.mystream.getVideoTracks() && instance.mystream.getVideoTracks().length > 0 && !video) {\n                    // Video has been rejected\n                    // toastr.warning(\"Our video stream has been rejected, viewers won't see us\")\n                    // Hide the webcam video\n                  }\n                }\n              },\n              onlocalstream: function (stream) {\n                // Janus.debug(' ::: Got a local stream :::')\n                instance.mystream = stream\n                // Janus.debug(stream)\n\n                // var video = document.createElement('video')\n                // video.id = stream.idd\n                // video.setAttribute('autoplay', 'true')\n                // document.getElementById('videos').prepend(video)\n                // Janus.attachMediaStream(video, stream)\n\n                var video\n\n                if (document.getElementById('feed0') === null) {\n                  video = document.createElement('video')\n                  video.id = 'feed0'\n                  video.setAttribute('autoplay', 'true')\n                  document.getElementById('videos').appendChild(video)\n                } else {\n                  video = document.getElementById('feed0')\n                  video.setAttribute('autoplay', 'true')\n                }\n\n                _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].attachMediaStream(video, stream)\n\n                if (instance.sfutest.webrtcStuff.pc.iceConnectionState !== 'completed' &&\n                instance.sfutest.webrtcStuff.pc.iceConnectionState !== 'connected') {}\n              },\n              onremotestream: function (stream) {\n                // The publisher stream is sendonly, we don't expect anything here\n              },\n              oncleanup: function () {\n                // Janus.log(' ::: Got a cleanup notification: we are unpublished now :::')\n                instance.mystream = null\n                // document.getElementById('participant1').srcObject = null\n                // console.log('Cleaning old video object ... ')\n                // $('#videolocal').html('<button id=\"publish\" class=\"btn btn-primary\">Publish</button>');\n                // $('#publish').click(function() { publishOwnFeed(true); });\n                // $(\"#videolocal\").parent().parent().unblock();\n                // $('#bitrate').parent().parent().addClass('hide');\n                // $('#bitrate a').unbind('click');\n              }\n            })\n          },\n          error: function (error) {\n            // console.log('janus Error')\n            // console.log(error)\n          },\n          destroyed: function () {\n            // console.log('janus destroyed')\n          }\n        })\n      }\n    })\n  }\n\n  publishOwnFeed (useAudio) {\n    instance.sfutest.createOffer({\n      media: {\n        audioRecv: false,\n        videoRecv: false,\n        audioSend: useAudio,\n        videoSend: true\n      }, // Publishers are sendonly\n      simulcast: instance.doSimulcast,\n      simulcast2: instance.doSimulcast2,\n      success: function (jsep) {\n        // Janus.debug('Got publisher SDP!')\n        // Janus.debug(jsep)\n\n        var publish = {\n          'request': 'configure',\n          'audio': useAudio,\n          'video': true\n        }\n\n        instance.sfutest.send({\n          'message': publish,\n          'jsep': jsep\n        })\n      },\n      error: function (error) {\n        _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error('WebRTC error:', error)\n        if (useAudio) {\n          instance.publishOwnFeed(false)\n        }\n      }\n    })\n  }\n\n  newRemoteFeed (id, display, audio, video) {\n    var remoteFeed = null\n    instance.janus.attach({\n      plugin: 'janus.plugin.videoroom',\n      // opaqueId: instance.opaqueId,\n      success: function (pluginHandle) {\n        remoteFeed = pluginHandle\n        remoteFeed.simulcastStarted = false\n        // Janus.log('Plugin attached! (' + remoteFeed.getPlugin() + ', id=' + remoteFeed.getId() + ')')\n        // Janus.log('  -- This is a subscriber')\n        // We wait for the plugin to send us an offer\n        var subscribe = {\n          'request': 'join',\n          'room': instance.tmpId,\n          'ptype': 'subscriber',\n          'feed': id,\n          'private_id': instance.mypvtid\n        }\n        if (_janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].webRTCAdapter.browserDetails.browser === 'safari' &&\n          (video === 'vp9' || (video === 'vp8' && !_janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].safariVp8))) {\n          if (video) {\n            video = video.toUpperCase()\n          }\n          subscribe['offer_video'] = false\n        }\n        remoteFeed.videoCodec = video\n        remoteFeed.send({\n          'message': subscribe\n        })\n      },\n      error: function (error) {\n        _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error('  -- Error attaching plugin...', error)\n      },\n      onmessage: function (msg, jsep) {\n        // Janus.debug(' ::: Got a message (subscriber) :::')\n        // Janus.debug(msg)\n        var event = msg['videoroom']\n        // Janus.debug('Event: ' + event)\n        if (msg['error'] !== undefined && msg['error'] !== null) {\n          // bootbox.alert(msg['error'])\n        } else if (event !== undefined && event != null) {\n          if (event === 'attached') {\n            // Subscriber created and attached\n            for (var i = 1; i < 6; i++) {\n              if (instance.feeds[i] === undefined || instance.feeds[i] === null) {\n                instance.feeds[i] = remoteFeed\n                remoteFeed.rfindex = i\n                break\n              }\n            }\n            remoteFeed.rfid = msg['id']\n            remoteFeed.rfdisplay = msg['display']\n            // Janus.log('Successfully attached to feed ' + remoteFeed.rfid + ' (' + remoteFeed.rfdisplay + ') in room ' + msg['room'])\n          } else if (event === 'event') {\n            // Check if we got an event on a simulcast-related event from this publisher\n            var substream = msg['substream']\n            var temporal = msg['temporal']\n            if ((substream !== null && substream !== undefined) || (temporal !== null && temporal !== undefined)) {\n              if (!remoteFeed.simulcastStarted) {\n                remoteFeed.simulcastStarted = true\n              }\n            }\n          } else {\n            // What has just happened?\n          }\n        }\n        if (jsep !== undefined && jsep !== null) {\n          // Janus.debug('Handling SDP as well...')\n          // Janus.debug(jsep)\n          // Answer and attach\n          remoteFeed.createAnswer({\n            jsep: jsep,\n            // Add data:true here if you want to subscribe to datachannels as well\n            // (obviously only works if the publisher offered them in the first place)\n            media: {\n              audioSend: false,\n              videoSend: false\n            }, // We want recvonly audio/video\n            success: function (jsep) {\n              // Janus.debug('Got SDP!')\n              // Janus.debug(jsep)\n              var body = {\n                'request': 'start',\n                'room': instance.tmpId\n              }\n              remoteFeed.send({\n                'message': body,\n                'jsep': jsep\n              })\n            },\n            error: function (error) {\n              _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error('WebRTC error:', error)\n              // bootbox.alert(\"WebRTC error... \" + JSON.stringify(error));\n            }\n          })\n        }\n      },\n      webrtcState: function (on) {\n        // Janus.log('Janus says this WebRTC PeerConnection (feed #' + remoteFeed.rfindex + ') is ' + (on ? 'up' : 'down') + ' now')\n      },\n      onlocalstream: function (stream) {\n        // The subscriber stream is recvonly, we don't expect anything here\n      },\n      onremotestream: function (stream) {\n        // Janus.debug('Remote feed #' + remoteFeed.rfindex)\n        // console.log('Remote feed #' + remoteFeed.rfindex)\n        console.log('Incomming onremotestream !!!! !!!!')\n        console.log(stream)\n        console.log(remoteFeed)\n        // console.log('@@@ Attaching media stream ... ', stream)\n        // console.log('streamstreamstreamstreamstreamstreamstreamstreamstream')\n        // console.log(stream)\n\n        var video\n\n        if (document.getElementById('feed' + remoteFeed.rfindex) === null) {\n          console.log('Attaching remoteFeed.id : ' + remoteFeed.id + '.')\n          video = document.createElement('video')\n          video.id = 'feed' + remoteFeed.rfindex\n          video.setAttribute('autoplay', 'true')\n          document.getElementById('videos').appendChild(video)\n        } else {\n          console.log('feed.id : ' + remoteFeed.id + ' has already been attached.')\n          video = document.getElementById('feed' + remoteFeed.rfindex)\n          video.setAttribute('autoplay', 'true')\n        }\n\n        _janus__WEBPACK_IMPORTED_MODULE_0__[\"default\"].attachMediaStream(video, stream)\n        // let participant = document.getElementById('participant1')\n        // participant.removeAttribute('hidden')\n        // Janus.attachMediaStream(participant, stream)\n        // console.log('Atteching media stream onremotestream .... ')\n        // console.log(stream.id, remoteFeed.rfindex)\n      },\n      oncleanup: function () {\n        // Janus.log(' ::: Got a cleanup notification (remote feed ' + id + ') :::')\n\n        console.log(remoteFeed)\n        document.getElementById('feed' + remoteFeed.rfindex).srcObject = null\n        remoteFeed.mystream = null\n        // mystream = null;\n        // document.getElementById('participant1').srcObject = null\n\n        // instance.participants.filter(participant => participant.id === id).srcObject = null\n\n        if (instance.bitrateTimer[remoteFeed.rfindex] !== null && instance.bitrateTimer[remoteFeed.rfindex] !== null) {\n          clearInterval(instance.bitrateTimer[remoteFeed.rfindex])\n        }\n        instance.bitrateTimer[remoteFeed.rfindex] = null\n        remoteFeed.simulcastStarted = false\n      }\n    })\n  }\n\n  getQueryStringValue (name) {\n    name = name.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]')\n\n    var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)')\n    var results = regex.exec(location.search)\n\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '))\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (JimberJanusVideoRoom);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGx1Z2lucy9qYW51cy52aWRlb3Jvb20uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvcGx1Z2lucy9qYW51cy52aWRlb3Jvb20uanM/YmFjNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSmFudXMgZnJvbSAnLi9qYW51cydcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vLi4vcHVibGljL2NvbmZpZydcbmxldCBpbnN0YW5jZSA9IG51bGxcblxuY2xhc3MgSmltYmVySmFudXNWaWRlb1Jvb20ge1xuICBjb25zdHJ1Y3RvciAocm9vbU5hbWUpIHtcbiAgICBpZiAoaW5zdGFuY2UgPT09IG51bGwpIHtcbiAgICAgIGluc3RhbmNlID0gdGhpc1xuICAgICAgaW5zdGFuY2UudG1wSWQgPSAwXG4gICAgICBpbnN0YW5jZS5yb29tTmFtZSA9IHJvb21OYW1lXG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKCdyb29tTmFtZTogJywgcm9vbU5hbWUpXG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9vbU5hbWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2cocm9vbU5hbWUuY2hhckNvZGVBdChpKSlcbiAgICAgICAgaW5zdGFuY2UudG1wSWQgPSBpbnN0YW5jZS50bXBJZCArIHJvb21OYW1lLmNoYXJDb2RlQXQoaSlcbiAgICAgIH1cblxuICAgICAgLy8gY29uc29sZS5sb2coJ1Jvb20gbmFtZSB0cmFuc2xhdGVzIHRvIGlkOiAnICsgaW5zdGFuY2UudG1wSWQpXG5cbiAgICAgIGluc3RhbmNlLnNlcnZlciA9IG51bGxcblxuICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHA6Jykge1xuICAgICAgICBpbnN0YW5jZS5zZXJ2ZXIgPSBjb25maWcuamFudXNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluc3RhbmNlLnNlcnZlciA9IGNvbmZpZy5qYW51c0hUVFBTXG4gICAgICB9XG5cbiAgICAgIGluc3RhbmNlLmphbnVzID0gbnVsbFxuICAgICAgaW5zdGFuY2Uuc2Z1dGVzdCA9IG51bGxcbiAgICAgIGluc3RhbmNlLm9wYXF1ZUlkID0gJ3ZpZGVvcm9vbXRlc3QtJyArIEphbnVzLnJhbmRvbVN0cmluZygxMilcblxuICAgICAgaW5zdGFuY2UubXl1c2VybmFtZSA9IG51bGxcbiAgICAgIGluc3RhbmNlLm15aWQgPSBudWxsXG4gICAgICBpbnN0YW5jZS5teXN0cmVhbSA9IG51bGxcbiAgICAgIGluc3RhbmNlLm15cHZ0aWQgPSBudWxsXG5cbiAgICAgIGluc3RhbmNlLmZlZWRzID0gW11cbiAgICAgIGluc3RhbmNlLmJpdHJhdGVUaW1lciA9IFtdXG4gICAgICBpbnN0YW5jZS5wYXJ0aWNpcGFudHMgPSBbXVxuXG4gICAgICBpbnN0YW5jZS5kb1NpbXVsY2FzdCA9IChpbnN0YW5jZS5nZXRRdWVyeVN0cmluZ1ZhbHVlKCdzaW11bGNhc3QnKSA9PT0gJ3llcycgfHwgaW5zdGFuY2UuZ2V0UXVlcnlTdHJpbmdWYWx1ZSgnc2ltdWxjYXN0JykgPT09ICd0cnVlJylcbiAgICAgIGluc3RhbmNlLmRvU2ltdWxjYXN0MiA9IChpbnN0YW5jZS5nZXRRdWVyeVN0cmluZ1ZhbHVlKCdzaW11bGNhc3QyJykgPT09ICd5ZXMnIHx8IGluc3RhbmNlLmdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3NpbXVsY2FzdDInKSA9PT0gJ3RydWUnKVxuXG4gICAgICBpbnN0YW5jZS5pbml0KClcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdGFuY2VcbiAgfVxuXG4gIHN3aXRjaFJvb20gKHJvb21OYW1lKSB7XG4gICAgdmFyIGxlYXZlID0ge1xuICAgICAgJ3JlcXVlc3QnOiAnbGVhdmUnLFxuICAgICAgJ3Jvb20nOiBpbnN0YW5jZS50bXBJZFxuICAgIH1cblxuICAgIGlmIChpbnN0YW5jZSA9PSBudWxsIHx8IGluc3RhbmNlLnNmdXRlc3QgPT0gbnVsbCkge1xuICAgICAgaW5zdGFuY2UgPSBudWxsXG4gICAgICBuZXcgSmltYmVySmFudXNWaWRlb1Jvb20ocm9vbU5hbWUpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgJ21lc3NhZ2UnOiBsZWF2ZSxcbiAgICAgIGVycm9yOiAoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiAnLCBlcnIpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBsZWZ0IHJvb20gLi4uICcsIGluc3RhbmNlLnRtcElkKVxuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGluc3RhbmNlLnNmdXRlc3QpXG5cbiAgICAgICAgaW5zdGFuY2Uuc2Z1dGVzdC5kZXRhY2goKVxuXG4gICAgICAgIGluc3RhbmNlID0gbnVsbFxuICAgICAgICBuZXcgSmltYmVySmFudXNWaWRlb1Jvb20ocm9vbU5hbWUpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGRpc2Nvbm5lY3QgKHJvb21OYW1lKSB7XG4gICAgLy8gY29uc29sZS5sb2coaW5zdGFuY2Uuc2Z1dGVzdClcblxuICAgIHZhciBsZWF2ZSA9IHtcbiAgICAgICdyZXF1ZXN0JzogJ2xlYXZlJyxcbiAgICAgICdyb29tJzogaW5zdGFuY2UudG1wSWRcbiAgICB9XG5cbiAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgJ21lc3NhZ2UnOiBsZWF2ZSxcbiAgICAgIGVycm9yOiAoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiAnLCBlcnIpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3N1Y2Nlc3M/JylcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgY29ubmVjdCAocm9vbU5hbWUpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnVHJ5aW5nIHRvIGpvaW4gcm9vbSB3aXRoIGlkICcgKyBpbnN0YW5jZS50bXBJZCArICcgYW5kIHVzZXJuYW1lICcgKyBpbnN0YW5jZS5teXVzZXJuYW1lKVxuXG4gICAgaW5zdGFuY2UgPSBudWxsXG4gICAgbmV3IEppbWJlckphbnVzVmlkZW9Sb29tKHJvb21OYW1lKVxuXG4gICAgLy8gdmFyIGpvaW4gPSB7XG4gICAgLy8gICAncmVxdWVzdCc6ICdqb2luJyxcbiAgICAvLyAgICdyb29tJzogaW5zdGFuY2UudG1wSWQsXG4gICAgLy8gICAncHR5cGUnOiAnam9pbmFuZGNvbmZpZ3VyZScsXG4gICAgLy8gICAnZGlzcGxheSc6IGluc3RhbmNlLm15dXNlcm5hbWVcbiAgICAvLyB9XG5cbiAgICAvLyBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgIC8vICAgJ21lc3NhZ2UnOiBqb2luLFxuICAgIC8vICAgZXJyb3I6IChlcnIpID0+IHtcbiAgICAvLyAgICAgY29uc29sZS5lcnJvcignRXJyb3I6ICcsIGVycilcbiAgICAvLyAgIH0sXG4gICAgLy8gICBzdWNjZXNzOiAoZGF0YSkgPT4ge1xuICAgIC8vICAgICAvLyBjb25zb2xlLmxvZygnc3VjY2Vzcz8nKVxuICAgIC8vICAgfVxuICAgIC8vIH0pXG4gIH1cblxuICBzaG93VXNlcnMgKHJvb21OYW1lKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ2NhbGxlZCcpXG5cbiAgICB2YXIgdG1wUm9vbWlkID0gMFxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb29tTmFtZS5sZW5ndGg7IGkrKykge1xuICAgICAgLy8gY29uc29sZS5sb2cocm9vbU5hbWUuY2hhckNvZGVBdChpKSlcbiAgICAgIHRtcFJvb21pZCA9IHRtcFJvb21pZCArIHJvb21OYW1lLmNoYXJDb2RlQXQoaSlcbiAgICB9XG5cbiAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgbWVzc2FnZToge1xuICAgICAgICAncmVxdWVzdCc6ICdsaXN0JyxcbiAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICdhdWRpbyc6IHRydWUsXG4gICAgICAgICAgJ3ZpZGVvJzogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3I6IChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmV0cmlldmluZyBsaXN0IG9mIHJvb21zOiAnLCBlcnIpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YS5saXN0LmZpbHRlcihyb29tID0+IHJvb20ucm9vbSA9PT0gdG1wUm9vbWlkKVswXSlcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YS5saXN0LmZpbHRlcihyb29tID0+IHJvb20ucm9vbSA9PT0gdG1wUm9vbWlkKVswXS5udW1fcGFydGljaXBhbnRzKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICB0b2dnbGVNdXRlICgpIHtcbiAgICB2YXIgbXV0ZWQgPSBpbnN0YW5jZS5zZnV0ZXN0LmlzQXVkaW9NdXRlZCgpXG5cbiAgICBpZiAobXV0ZWQpIHtcbiAgICAgIGluc3RhbmNlLnNmdXRlc3QudW5tdXRlQXVkaW8oKVxuICAgIH0gZWxzZSB7XG4gICAgICBpbnN0YW5jZS5zZnV0ZXN0Lm11dGVBdWRpbygpXG4gICAgfVxuXG4gICAgbXV0ZWQgPSBpbnN0YW5jZS5zZnV0ZXN0LmlzQXVkaW9NdXRlZCgpXG4gICAgcmV0dXJuIG11dGVkXG4gIH1cblxuICB1bnB1Ymxpc2hPd25GZWVkICgpIHtcbiAgICB2YXIgdW5wdWJsaXNoID0geyAncmVxdWVzdCc6ICd1bnB1Ymxpc2gnIH1cblxuICAgIGluc3RhbmNlLnNmdXRlc3Quc2VuZCh7XG4gICAgICAnbWVzc2FnZSc6IHVucHVibGlzaFxuICAgIH0pXG4gIH1cblxuICBpbml0ICgpIHtcbiAgICBKYW51cy5pbml0KHtcbiAgICAgIGRlYnVnOiAnYWxsJyxcbiAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGluc3RhbmNlLmphbnVzID0gbmV3IEphbnVzKHtcbiAgICAgICAgICBzZXJ2ZXI6IGNvbmZpZy5qYW51cyxcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnamFudXMgc3VjY2VzcycpXG5cbiAgICAgICAgICAgIGluc3RhbmNlLmphbnVzLmF0dGFjaCh7XG4gICAgICAgICAgICAgIHBsdWdpbjogJ2phbnVzLnBsdWdpbi52aWRlb3Jvb20nLFxuICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocGx1Z2luSGFuZGxlKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2Z1dGVzdCA9IHBsdWdpbkhhbmRsZVxuICAgICAgICAgICAgICAgIC8vIEphbnVzLmxvZygnUGx1Z2luIGF0dGFjaGVkISAoJyArIGluc3RhbmNlLnNmdXRlc3QuZ2V0UGx1Z2luKCkgKyAnLCBpZD0nICsgaW5zdGFuY2Uuc2Z1dGVzdC5nZXRJZCgpICsgJyknKVxuICAgICAgICAgICAgICAgIC8vIEphbnVzLmxvZygnICAtLSBUaGlzIGlzIGEgcHVibGlzaGVyL21hbmFnZXInKVxuXG4gICAgICAgICAgICAgICAgLy8gUmV0cmlldmUgcm9vbXNcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAncmVxdWVzdCc6ICdsaXN0JyxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgICdhdWRpbyc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgJ3ZpZGVvJzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmV0cmlldmluZyBsaXN0IG9mIHJvb21zOiAnLCBlcnIpXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0xpc3Qgb2Ygcm9vbXM6ICcsIGRhdGEubGlzdClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGlzdC5zb21lKHJvb20gPT4gcm9vbS5yb29tID09PSBpbnN0YW5jZS50bXBJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnUk9PTSBFWElTVFMnKVxuXG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gJ1NpbmdsZUNvcmUnXG5cbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVnaXN0ZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAncmVxdWVzdCc6ICdqb2luJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdyb29tJzogaW5zdGFuY2UudG1wSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAncHR5cGUnOiAncHVibGlzaGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzogdXNlcm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UubXl1c2VybmFtZSA9IHVzZXJuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2Z1dGVzdC5zZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogcmVnaXN0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnRXJyb3Igam9pbmluZyByb29tOiAnLCBlcnIpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1N1Y2Nlc3Mgam9pbiByb29tOiAnLCBkYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1JPT00gRE9FU05UIEVYSVNULCBXRSBORUVEIFRPIENSRUFURSBJVCEnKVxuICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdBdHRlbXB0aW5nIHRvIGNyZWF0ZTogJywgaW5zdGFuY2UudG1wSWQpXG5cbiAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAncmVxdWVzdCc6ICdjcmVhdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAncm9vbSc6IGluc3RhbmNlLnRtcElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBpbnN0YW5jZS5yb29tTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ3B1Ymxpc2hlcnMnOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdpc19wcml2YXRlJzogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnRXJyb3IgY3JlYXRpbmcgcm9vbTogJywgZXJyKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdTdWNjZXNzIGNyZWF0aW5nIHJvb206ICcsIGRhdGEpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gJ1NpbmdsZUNvcmUnXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZ2lzdGVyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1ZXN0JzogJ2pvaW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyb29tJzogaW5zdGFuY2UudG1wSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3B0eXBlJzogJ3B1Ymxpc2hlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXknOiB1c2VybmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLm15dXNlcm5hbWUgPSB1c2VybmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZnV0ZXN0LnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogcmVnaXN0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIEphbnVzLmVycm9yKCcgIC0tIEVycm9yIGF0dGFjaGluZyBwbHVnaW4uLi4nLCBlcnJvcilcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgY29uc2VudERpYWxvZzogZnVuY3Rpb24gKG9uKSB7XG4gICAgICAgICAgICAgICAgLy8gSmFudXMuZGVidWcoJ0NvbnNlbnQgZGlhbG9nIHNob3VsZCBiZSAnICsgKG9uID8gJ29uJyA6ICdvZmYnKSArICcgbm93JylcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbWVkaWFTdGF0ZTogZnVuY3Rpb24gKG1lZGl1bSwgb24pIHtcbiAgICAgICAgICAgICAgICAvLyBKYW51cy5sb2coJ0phbnVzICcgKyAob24gPyAnc3RhcnRlZCcgOiAnc3RvcHBlZCcpICsgJyByZWNlaXZpbmcgb3VyICcgKyBtZWRpdW0pXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHdlYnJ0Y1N0YXRlOiBmdW5jdGlvbiAob24pIHtcbiAgICAgICAgICAgICAgICAvLyBKYW51cy5sb2coJ0phbnVzIHNheXMgb3VyIFdlYlJUQyBQZWVyQ29ubmVjdGlvbiBpcyAnICsgKG9uID8gJ3VwJyA6ICdkb3duJykgKyAnIG5vdycpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9ubWVzc2FnZTogZnVuY3Rpb24gKG1zZywganNlcCkge1xuICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKCcgOjo6IEdvdCBhIG1lc3NhZ2UgKHB1Ymxpc2hlcikgOjo6JylcbiAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1Zyhtc2cpXG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gbXNnWyd2aWRlb3Jvb20nXVxuICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKCdFdmVudDogJyArIGV2ZW50KVxuICAgICAgICAgICAgICAgIGlmIChldmVudCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2pvaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHVibGlzaGVyL21hbmFnZXIgY3JlYXRlZCwgbmVnb3RpYXRlIFdlYlJUQyBhbmQgYXR0YWNoIHRvIGV4aXN0aW5nIGZlZWRzLCBpZiBhbnlcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UubXlpZCA9IG1zZ1snaWQnXVxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5teXB2dGlkID0gbXNnWydwcml2YXRlX2lkJ11cbiAgICAgICAgICAgICAgICAgICAgLy8gSmFudXMubG9nKCdTdWNjZXNzZnVsbHkgam9pbmVkIHJvb20gJyArIG1zZ1sncm9vbSddICsgJyB3aXRoIElEICcgKyBpbnN0YW5jZS5teWlkKVxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5wdWJsaXNoT3duRmVlZCh0cnVlKVxuICAgICAgICAgICAgICAgICAgICAvLyBBbnkgbmV3IGZlZWQgdG8gYXR0YWNoIHRvP1xuICAgICAgICAgICAgICAgICAgICBpZiAobXNnWydwdWJsaXNoZXJzJ10gIT09IHVuZGVmaW5lZCAmJiBtc2dbJ3B1Ymxpc2hlcnMnXSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gbXNnWydwdWJsaXNoZXJzJ11cbiAgICAgICAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnR290IGEgbGlzdCBvZiBhdmFpbGFibGUgcHVibGlzaGVycy9mZWVkczonKVxuICAgICAgICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKGxpc3QpXG4gICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiBpbiBsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBsaXN0W2ZdWydpZCddXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzcGxheSA9IGxpc3RbZl1bJ2Rpc3BsYXknXVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvID0gbGlzdFtmXVsnYXVkaW9fY29kZWMnXVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpZGVvID0gbGlzdFtmXVsndmlkZW9fY29kZWMnXVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSmFudXMuZGVidWcoJyAgPj4gWycgKyBpZCArICddICcgKyBkaXNwbGF5ICsgJyAoYXVkaW86ICcgKyBhdWRpbyArICcsIHZpZGVvOiAnICsgdmlkZW8gKyAnKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5uZXdSZW1vdGVGZWVkKGlkLCBkaXNwbGF5LCBhdWRpbywgdmlkZW8pXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSAnZGVzdHJveWVkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcm9vbSBoYXMgYmVlbiBkZXN0cm95ZWRcbiAgICAgICAgICAgICAgICAgICAgSmFudXMud2FybignVGhlIHJvb20gaGFzIGJlZW4gZGVzdHJveWVkIScpXG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSAnZXZlbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFueSBuZXcgZmVlZCB0byBhdHRhY2ggdG8/XG4gICAgICAgICAgICAgICAgICAgIGlmIChtc2dbJ3B1Ymxpc2hlcnMnXSAhPT0gdW5kZWZpbmVkICYmIG1zZ1sncHVibGlzaGVycyddICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGxpc3QgPSBtc2dbJ3B1Ymxpc2hlcnMnXVxuICAgICAgICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKCdHb3QgYSBsaXN0IG9mIGF2YWlsYWJsZSBwdWJsaXNoZXJzL2ZlZWRzOicpXG4gICAgICAgICAgICAgICAgICAgICAgLy8gSmFudXMuZGVidWcobGlzdClcbiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBmIGluIGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpZCA9IGxpc3RbZl1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaXNwbGF5ID0gbGlzdFtmXVsnZGlzcGxheSddXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXVkaW8gPSBsaXN0W2ZdWydhdWRpb19jb2RlYyddXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmlkZW8gPSBsaXN0W2ZdWyd2aWRlb19jb2RlYyddXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnICA+PiBbJyArIGlkICsgJ10gJyArIGRpc3BsYXkgKyAnIChhdWRpbzogJyArIGF1ZGlvICsgJywgdmlkZW86ICcgKyB2aWRlbyArICcpJylcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLm5ld1JlbW90ZUZlZWQoaWQsIGRpc3BsYXksIGF1ZGlvLCB2aWRlbylcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnWydsZWF2aW5nJ10gIT09IHVuZGVmaW5lZCAmJiBtc2dbJ2xlYXZpbmcnXSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgIC8vIE9uZSBvZiB0aGUgcHVibGlzaGVycyBoYXMgZ29uZSBhd2F5P1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWF2aW5nID0gbXNnWydsZWF2aW5nJ11cbiAgICAgICAgICAgICAgICAgICAgICAvLyBKYW51cy5sb2coJ1B1Ymxpc2hlciBsZWZ0OiAnICsgbGVhdmluZylcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVtb3RlRmVlZCA9IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IDY7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLmZlZWRzW2ldICE9IG51bGwgJiYgaW5zdGFuY2UuZmVlZHNbaV0gIT09IHVuZGVmaW5lZCAmJiBpbnN0YW5jZS5mZWVkc1tpXS5yZmlkID09PSBsZWF2aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW90ZUZlZWQgPSBpbnN0YW5jZS5mZWVkc1tpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3RlRmVlZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnRmVlZCAnICsgcmVtb3RlRmVlZC5yZmlkICsgJyAoJyArIHJlbW90ZUZlZWQucmZkaXNwbGF5ICsgJykgaGFzIGxlZnQgdGhlIHJvb20sIGRldGFjaGluZycpXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAkKCcjcmVtb3RlJytyZW1vdGVGZWVkLnJmaW5kZXgpLmVtcHR5KCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gJCgnI3ZpZGVvcmVtb3RlJytyZW1vdGVGZWVkLnJmaW5kZXgpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5mZWVkc1tyZW1vdGVGZWVkLnJmaW5kZXhdID0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlRmVlZC5kZXRhY2goKVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtc2dbJ3VucHVibGlzaGVkJ10gIT09IHVuZGVmaW5lZCAmJiBtc2dbJ3VucHVibGlzaGVkJ10gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBPbmUgb2YgdGhlIHB1Ymxpc2hlcnMgaGFzIHVucHVibGlzaGVkP1xuICAgICAgICAgICAgICAgICAgICAgIHZhciB1bnB1Ymxpc2hlZCA9IG1zZ1sndW5wdWJsaXNoZWQnXVxuICAgICAgICAgICAgICAgICAgICAgIC8vIEphbnVzLmxvZygnUHVibGlzaGVyIGxlZnQ6ICcgKyB1bnB1Ymxpc2hlZClcbiAgICAgICAgICAgICAgICAgICAgICBpZiAodW5wdWJsaXNoZWQgPT09ICdvaycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoYXQncyB1c1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2Z1dGVzdC5oYW5ndXAoKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIGxldCByZW1vdGVGZWVkID0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgNjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UuZmVlZHNbaV0gIT0gbnVsbCAmJiBpbnN0YW5jZS5mZWVkc1tpXSAhPT0gdW5kZWZpbmVkICYmIGluc3RhbmNlLmZlZWRzW2ldLnJmaWQgPT09IHVucHVibGlzaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW90ZUZlZWQgPSBpbnN0YW5jZS5mZWVkc1tpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVtb3RlRmVlZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnRmVlZCAnICsgcmVtb3RlRmVlZC5yZmlkICsgJyAoJyArIHJlbW90ZUZlZWQucmZkaXNwbGF5ICsgJykgaGFzIGxlZnQgdGhlIHJvb20sIGRldGFjaGluZycpXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAkKCcjcmVtb3RlJytyZW1vdGVGZWVkLnJmaW5kZXgpLmVtcHR5KCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gJCgnI3ZpZGVvcmVtb3RlJytyZW1vdGVGZWVkLnJmaW5kZXgpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5mZWVkc1tyZW1vdGVGZWVkLnJmaW5kZXhdID0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlRmVlZC5kZXRhY2goKVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtc2dbJ2Vycm9yJ10gIT09IHVuZGVmaW5lZCAmJiBtc2dbJ2Vycm9yJ10gIT09IG51bGwpIHt9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChqc2VwICE9PSB1bmRlZmluZWQgJiYganNlcCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgLy8gSmFudXMuZGVidWcoJ0hhbmRsaW5nIFNEUCBhcyB3ZWxsLi4uJylcbiAgICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKGpzZXApXG4gICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZnV0ZXN0LmhhbmRsZVJlbW90ZUpzZXAoe1xuICAgICAgICAgICAgICAgICAgICBqc2VwOiBqc2VwXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW55IG9mIHRoZSBtZWRpYSB3ZSB3YW50ZWQgdG8gcHVibGlzaCBoYXNcbiAgICAgICAgICAgICAgICAgIC8vIGJlZW4gcmVqZWN0ZWQgKGUuZy4sIHdyb25nIG9yIHVuc3VwcG9ydGVkIGNvZGVjKVxuICAgICAgICAgICAgICAgICAgbGV0IGF1ZGlvID0gbXNnWydhdWRpb19jb2RlYyddXG4gICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UubXlzdHJlYW0gJiYgaW5zdGFuY2UubXlzdHJlYW0uZ2V0QXVkaW9UcmFja3MoKSAmJiBpbnN0YW5jZS5teXN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCA+IDAgJiYgIWF1ZGlvKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEF1ZGlvIGhhcyBiZWVuIHJlamVjdGVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvYXN0ci53YXJuaW5nKFwiT3VyIGF1ZGlvIHN0cmVhbSBoYXMgYmVlbiByZWplY3RlZCwgdmlld2VycyB3b24ndCBoZWFyIHVzXCIpXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBsZXQgdmlkZW8gPSBtc2dbJ3ZpZGVvX2NvZGVjJ11cbiAgICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZS5teXN0cmVhbSAmJiBpbnN0YW5jZS5teXN0cmVhbS5nZXRWaWRlb1RyYWNrcygpICYmIGluc3RhbmNlLm15c3RyZWFtLmdldFZpZGVvVHJhY2tzKCkubGVuZ3RoID4gMCAmJiAhdmlkZW8pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmlkZW8gaGFzIGJlZW4gcmVqZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9hc3RyLndhcm5pbmcoXCJPdXIgdmlkZW8gc3RyZWFtIGhhcyBiZWVuIHJlamVjdGVkLCB2aWV3ZXJzIHdvbid0IHNlZSB1c1wiKVxuICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHRoZSB3ZWJjYW0gdmlkZW9cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9ubG9jYWxzdHJlYW06IGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnIDo6OiBHb3QgYSBsb2NhbCBzdHJlYW0gOjo6JylcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5teXN0cmVhbSA9IHN0cmVhbVxuICAgICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKHN0cmVhbSlcblxuICAgICAgICAgICAgICAgIC8vIHZhciB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJylcbiAgICAgICAgICAgICAgICAvLyB2aWRlby5pZCA9IHN0cmVhbS5pZGRcbiAgICAgICAgICAgICAgICAvLyB2aWRlby5zZXRBdHRyaWJ1dGUoJ2F1dG9wbGF5JywgJ3RydWUnKVxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWRlb3MnKS5wcmVwZW5kKHZpZGVvKVxuICAgICAgICAgICAgICAgIC8vIEphbnVzLmF0dGFjaE1lZGlhU3RyZWFtKHZpZGVvLCBzdHJlYW0pXG5cbiAgICAgICAgICAgICAgICB2YXIgdmlkZW9cblxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmVlZDAnKSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpXG4gICAgICAgICAgICAgICAgICB2aWRlby5pZCA9ICdmZWVkMCdcbiAgICAgICAgICAgICAgICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnYXV0b3BsYXknLCAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW9zJykuYXBwZW5kQ2hpbGQodmlkZW8pXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQwJylcbiAgICAgICAgICAgICAgICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnYXV0b3BsYXknLCAndHJ1ZScpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgSmFudXMuYXR0YWNoTWVkaWFTdHJlYW0odmlkZW8sIHN0cmVhbSlcblxuICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZS5zZnV0ZXN0LndlYnJ0Y1N0dWZmLnBjLmljZUNvbm5lY3Rpb25TdGF0ZSAhPT0gJ2NvbXBsZXRlZCcgJiZcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZnV0ZXN0LndlYnJ0Y1N0dWZmLnBjLmljZUNvbm5lY3Rpb25TdGF0ZSAhPT0gJ2Nvbm5lY3RlZCcpIHt9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9ucmVtb3Rlc3RyZWFtOiBmdW5jdGlvbiAoc3RyZWFtKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIHB1Ymxpc2hlciBzdHJlYW0gaXMgc2VuZG9ubHksIHdlIGRvbid0IGV4cGVjdCBhbnl0aGluZyBoZXJlXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9uY2xlYW51cDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEphbnVzLmxvZygnIDo6OiBHb3QgYSBjbGVhbnVwIG5vdGlmaWNhdGlvbjogd2UgYXJlIHVucHVibGlzaGVkIG5vdyA6OjonKVxuICAgICAgICAgICAgICAgIGluc3RhbmNlLm15c3RyZWFtID0gbnVsbFxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJ0aWNpcGFudDEnKS5zcmNPYmplY3QgPSBudWxsXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0NsZWFuaW5nIG9sZCB2aWRlbyBvYmplY3QgLi4uICcpXG4gICAgICAgICAgICAgICAgLy8gJCgnI3ZpZGVvbG9jYWwnKS5odG1sKCc8YnV0dG9uIGlkPVwicHVibGlzaFwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCI+UHVibGlzaDwvYnV0dG9uPicpO1xuICAgICAgICAgICAgICAgIC8vICQoJyNwdWJsaXNoJykuY2xpY2soZnVuY3Rpb24oKSB7IHB1Ymxpc2hPd25GZWVkKHRydWUpOyB9KTtcbiAgICAgICAgICAgICAgICAvLyAkKFwiI3ZpZGVvbG9jYWxcIikucGFyZW50KCkucGFyZW50KCkudW5ibG9jaygpO1xuICAgICAgICAgICAgICAgIC8vICQoJyNiaXRyYXRlJykucGFyZW50KCkucGFyZW50KCkuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAvLyAkKCcjYml0cmF0ZSBhJykudW5iaW5kKCdjbGljaycpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2phbnVzIEVycm9yJylcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVzdHJveWVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnamFudXMgZGVzdHJveWVkJylcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHB1Ymxpc2hPd25GZWVkICh1c2VBdWRpbykge1xuICAgIGluc3RhbmNlLnNmdXRlc3QuY3JlYXRlT2ZmZXIoe1xuICAgICAgbWVkaWE6IHtcbiAgICAgICAgYXVkaW9SZWN2OiBmYWxzZSxcbiAgICAgICAgdmlkZW9SZWN2OiBmYWxzZSxcbiAgICAgICAgYXVkaW9TZW5kOiB1c2VBdWRpbyxcbiAgICAgICAgdmlkZW9TZW5kOiB0cnVlXG4gICAgICB9LCAvLyBQdWJsaXNoZXJzIGFyZSBzZW5kb25seVxuICAgICAgc2ltdWxjYXN0OiBpbnN0YW5jZS5kb1NpbXVsY2FzdCxcbiAgICAgIHNpbXVsY2FzdDI6IGluc3RhbmNlLmRvU2ltdWxjYXN0MixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc2VwKSB7XG4gICAgICAgIC8vIEphbnVzLmRlYnVnKCdHb3QgcHVibGlzaGVyIFNEUCEnKVxuICAgICAgICAvLyBKYW51cy5kZWJ1Zyhqc2VwKVxuXG4gICAgICAgIHZhciBwdWJsaXNoID0ge1xuICAgICAgICAgICdyZXF1ZXN0JzogJ2NvbmZpZ3VyZScsXG4gICAgICAgICAgJ2F1ZGlvJzogdXNlQXVkaW8sXG4gICAgICAgICAgJ3ZpZGVvJzogdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgaW5zdGFuY2Uuc2Z1dGVzdC5zZW5kKHtcbiAgICAgICAgICAnbWVzc2FnZSc6IHB1Ymxpc2gsXG4gICAgICAgICAgJ2pzZXAnOiBqc2VwXG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBKYW51cy5lcnJvcignV2ViUlRDIGVycm9yOicsIGVycm9yKVxuICAgICAgICBpZiAodXNlQXVkaW8pIHtcbiAgICAgICAgICBpbnN0YW5jZS5wdWJsaXNoT3duRmVlZChmYWxzZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBuZXdSZW1vdGVGZWVkIChpZCwgZGlzcGxheSwgYXVkaW8sIHZpZGVvKSB7XG4gICAgdmFyIHJlbW90ZUZlZWQgPSBudWxsXG4gICAgaW5zdGFuY2UuamFudXMuYXR0YWNoKHtcbiAgICAgIHBsdWdpbjogJ2phbnVzLnBsdWdpbi52aWRlb3Jvb20nLFxuICAgICAgLy8gb3BhcXVlSWQ6IGluc3RhbmNlLm9wYXF1ZUlkLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHBsdWdpbkhhbmRsZSkge1xuICAgICAgICByZW1vdGVGZWVkID0gcGx1Z2luSGFuZGxlXG4gICAgICAgIHJlbW90ZUZlZWQuc2ltdWxjYXN0U3RhcnRlZCA9IGZhbHNlXG4gICAgICAgIC8vIEphbnVzLmxvZygnUGx1Z2luIGF0dGFjaGVkISAoJyArIHJlbW90ZUZlZWQuZ2V0UGx1Z2luKCkgKyAnLCBpZD0nICsgcmVtb3RlRmVlZC5nZXRJZCgpICsgJyknKVxuICAgICAgICAvLyBKYW51cy5sb2coJyAgLS0gVGhpcyBpcyBhIHN1YnNjcmliZXInKVxuICAgICAgICAvLyBXZSB3YWl0IGZvciB0aGUgcGx1Z2luIHRvIHNlbmQgdXMgYW4gb2ZmZXJcbiAgICAgICAgdmFyIHN1YnNjcmliZSA9IHtcbiAgICAgICAgICAncmVxdWVzdCc6ICdqb2luJyxcbiAgICAgICAgICAncm9vbSc6IGluc3RhbmNlLnRtcElkLFxuICAgICAgICAgICdwdHlwZSc6ICdzdWJzY3JpYmVyJyxcbiAgICAgICAgICAnZmVlZCc6IGlkLFxuICAgICAgICAgICdwcml2YXRlX2lkJzogaW5zdGFuY2UubXlwdnRpZFxuICAgICAgICB9XG4gICAgICAgIGlmIChKYW51cy53ZWJSVENBZGFwdGVyLmJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09ICdzYWZhcmknICYmXG4gICAgICAgICAgKHZpZGVvID09PSAndnA5JyB8fCAodmlkZW8gPT09ICd2cDgnICYmICFKYW51cy5zYWZhcmlWcDgpKSkge1xuICAgICAgICAgIGlmICh2aWRlbykge1xuICAgICAgICAgICAgdmlkZW8gPSB2aWRlby50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgfVxuICAgICAgICAgIHN1YnNjcmliZVsnb2ZmZXJfdmlkZW8nXSA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgcmVtb3RlRmVlZC52aWRlb0NvZGVjID0gdmlkZW9cbiAgICAgICAgcmVtb3RlRmVlZC5zZW5kKHtcbiAgICAgICAgICAnbWVzc2FnZSc6IHN1YnNjcmliZVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgSmFudXMuZXJyb3IoJyAgLS0gRXJyb3IgYXR0YWNoaW5nIHBsdWdpbi4uLicsIGVycm9yKVxuICAgICAgfSxcbiAgICAgIG9ubWVzc2FnZTogZnVuY3Rpb24gKG1zZywganNlcCkge1xuICAgICAgICAvLyBKYW51cy5kZWJ1ZygnIDo6OiBHb3QgYSBtZXNzYWdlIChzdWJzY3JpYmVyKSA6OjonKVxuICAgICAgICAvLyBKYW51cy5kZWJ1Zyhtc2cpXG4gICAgICAgIHZhciBldmVudCA9IG1zZ1sndmlkZW9yb29tJ11cbiAgICAgICAgLy8gSmFudXMuZGVidWcoJ0V2ZW50OiAnICsgZXZlbnQpXG4gICAgICAgIGlmIChtc2dbJ2Vycm9yJ10gIT09IHVuZGVmaW5lZCAmJiBtc2dbJ2Vycm9yJ10gIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBib290Ym94LmFsZXJ0KG1zZ1snZXJyb3InXSlcbiAgICAgICAgfSBlbHNlIGlmIChldmVudCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50ICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAoZXZlbnQgPT09ICdhdHRhY2hlZCcpIHtcbiAgICAgICAgICAgIC8vIFN1YnNjcmliZXIgY3JlYXRlZCBhbmQgYXR0YWNoZWRcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgNjsgaSsrKSB7XG4gICAgICAgICAgICAgIGlmIChpbnN0YW5jZS5mZWVkc1tpXSA9PT0gdW5kZWZpbmVkIHx8IGluc3RhbmNlLmZlZWRzW2ldID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZmVlZHNbaV0gPSByZW1vdGVGZWVkXG4gICAgICAgICAgICAgICAgcmVtb3RlRmVlZC5yZmluZGV4ID0gaVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbW90ZUZlZWQucmZpZCA9IG1zZ1snaWQnXVxuICAgICAgICAgICAgcmVtb3RlRmVlZC5yZmRpc3BsYXkgPSBtc2dbJ2Rpc3BsYXknXVxuICAgICAgICAgICAgLy8gSmFudXMubG9nKCdTdWNjZXNzZnVsbHkgYXR0YWNoZWQgdG8gZmVlZCAnICsgcmVtb3RlRmVlZC5yZmlkICsgJyAoJyArIHJlbW90ZUZlZWQucmZkaXNwbGF5ICsgJykgaW4gcm9vbSAnICsgbXNnWydyb29tJ10pXG4gICAgICAgICAgfSBlbHNlIGlmIChldmVudCA9PT0gJ2V2ZW50Jykge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgZ290IGFuIGV2ZW50IG9uIGEgc2ltdWxjYXN0LXJlbGF0ZWQgZXZlbnQgZnJvbSB0aGlzIHB1Ymxpc2hlclxuICAgICAgICAgICAgdmFyIHN1YnN0cmVhbSA9IG1zZ1snc3Vic3RyZWFtJ11cbiAgICAgICAgICAgIHZhciB0ZW1wb3JhbCA9IG1zZ1sndGVtcG9yYWwnXVxuICAgICAgICAgICAgaWYgKChzdWJzdHJlYW0gIT09IG51bGwgJiYgc3Vic3RyZWFtICE9PSB1bmRlZmluZWQpIHx8ICh0ZW1wb3JhbCAhPT0gbnVsbCAmJiB0ZW1wb3JhbCAhPT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgICAgICBpZiAoIXJlbW90ZUZlZWQuc2ltdWxjYXN0U3RhcnRlZCkge1xuICAgICAgICAgICAgICAgIHJlbW90ZUZlZWQuc2ltdWxjYXN0U3RhcnRlZCA9IHRydWVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBXaGF0IGhhcyBqdXN0IGhhcHBlbmVkP1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoanNlcCAhPT0gdW5kZWZpbmVkICYmIGpzZXAgIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBKYW51cy5kZWJ1ZygnSGFuZGxpbmcgU0RQIGFzIHdlbGwuLi4nKVxuICAgICAgICAgIC8vIEphbnVzLmRlYnVnKGpzZXApXG4gICAgICAgICAgLy8gQW5zd2VyIGFuZCBhdHRhY2hcbiAgICAgICAgICByZW1vdGVGZWVkLmNyZWF0ZUFuc3dlcih7XG4gICAgICAgICAgICBqc2VwOiBqc2VwLFxuICAgICAgICAgICAgLy8gQWRkIGRhdGE6dHJ1ZSBoZXJlIGlmIHlvdSB3YW50IHRvIHN1YnNjcmliZSB0byBkYXRhY2hhbm5lbHMgYXMgd2VsbFxuICAgICAgICAgICAgLy8gKG9idmlvdXNseSBvbmx5IHdvcmtzIGlmIHRoZSBwdWJsaXNoZXIgb2ZmZXJlZCB0aGVtIGluIHRoZSBmaXJzdCBwbGFjZSlcbiAgICAgICAgICAgIG1lZGlhOiB7XG4gICAgICAgICAgICAgIGF1ZGlvU2VuZDogZmFsc2UsXG4gICAgICAgICAgICAgIHZpZGVvU2VuZDogZmFsc2VcbiAgICAgICAgICAgIH0sIC8vIFdlIHdhbnQgcmVjdm9ubHkgYXVkaW8vdmlkZW9cbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc2VwKSB7XG4gICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKCdHb3QgU0RQIScpXG4gICAgICAgICAgICAgIC8vIEphbnVzLmRlYnVnKGpzZXApXG4gICAgICAgICAgICAgIHZhciBib2R5ID0ge1xuICAgICAgICAgICAgICAgICdyZXF1ZXN0JzogJ3N0YXJ0JyxcbiAgICAgICAgICAgICAgICAncm9vbSc6IGluc3RhbmNlLnRtcElkXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmVtb3RlRmVlZC5zZW5kKHtcbiAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGJvZHksXG4gICAgICAgICAgICAgICAgJ2pzZXAnOiBqc2VwXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICBKYW51cy5lcnJvcignV2ViUlRDIGVycm9yOicsIGVycm9yKVxuICAgICAgICAgICAgICAvLyBib290Ym94LmFsZXJ0KFwiV2ViUlRDIGVycm9yLi4uIFwiICsgSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2VicnRjU3RhdGU6IGZ1bmN0aW9uIChvbikge1xuICAgICAgICAvLyBKYW51cy5sb2coJ0phbnVzIHNheXMgdGhpcyBXZWJSVEMgUGVlckNvbm5lY3Rpb24gKGZlZWQgIycgKyByZW1vdGVGZWVkLnJmaW5kZXggKyAnKSBpcyAnICsgKG9uID8gJ3VwJyA6ICdkb3duJykgKyAnIG5vdycpXG4gICAgICB9LFxuICAgICAgb25sb2NhbHN0cmVhbTogZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAvLyBUaGUgc3Vic2NyaWJlciBzdHJlYW0gaXMgcmVjdm9ubHksIHdlIGRvbid0IGV4cGVjdCBhbnl0aGluZyBoZXJlXG4gICAgICB9LFxuICAgICAgb25yZW1vdGVzdHJlYW06IGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgLy8gSmFudXMuZGVidWcoJ1JlbW90ZSBmZWVkICMnICsgcmVtb3RlRmVlZC5yZmluZGV4KVxuICAgICAgICAvLyBjb25zb2xlLmxvZygnUmVtb3RlIGZlZWQgIycgKyByZW1vdGVGZWVkLnJmaW5kZXgpXG4gICAgICAgIGNvbnNvbGUubG9nKCdJbmNvbW1pbmcgb25yZW1vdGVzdHJlYW0gISEhISAhISEhJylcbiAgICAgICAgY29uc29sZS5sb2coc3RyZWFtKVxuICAgICAgICBjb25zb2xlLmxvZyhyZW1vdGVGZWVkKVxuICAgICAgICAvLyBjb25zb2xlLmxvZygnQEBAIEF0dGFjaGluZyBtZWRpYSBzdHJlYW0gLi4uICcsIHN0cmVhbSlcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3N0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbXN0cmVhbScpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHN0cmVhbSlcblxuICAgICAgICB2YXIgdmlkZW9cblxuICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQnICsgcmVtb3RlRmVlZC5yZmluZGV4KSA9PT0gbnVsbCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdBdHRhY2hpbmcgcmVtb3RlRmVlZC5pZCA6ICcgKyByZW1vdGVGZWVkLmlkICsgJy4nKVxuICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKVxuICAgICAgICAgIHZpZGVvLmlkID0gJ2ZlZWQnICsgcmVtb3RlRmVlZC5yZmluZGV4XG4gICAgICAgICAgdmlkZW8uc2V0QXR0cmlidXRlKCdhdXRvcGxheScsICd0cnVlJylcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW9zJykuYXBwZW5kQ2hpbGQodmlkZW8pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2ZlZWQuaWQgOiAnICsgcmVtb3RlRmVlZC5pZCArICcgaGFzIGFscmVhZHkgYmVlbiBhdHRhY2hlZC4nKVxuICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQnICsgcmVtb3RlRmVlZC5yZmluZGV4KVxuICAgICAgICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnYXV0b3BsYXknLCAndHJ1ZScpXG4gICAgICAgIH1cblxuICAgICAgICBKYW51cy5hdHRhY2hNZWRpYVN0cmVhbSh2aWRlbywgc3RyZWFtKVxuICAgICAgICAvLyBsZXQgcGFydGljaXBhbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFydGljaXBhbnQxJylcbiAgICAgICAgLy8gcGFydGljaXBhbnQucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKVxuICAgICAgICAvLyBKYW51cy5hdHRhY2hNZWRpYVN0cmVhbShwYXJ0aWNpcGFudCwgc3RyZWFtKVxuICAgICAgICAvLyBjb25zb2xlLmxvZygnQXR0ZWNoaW5nIG1lZGlhIHN0cmVhbSBvbnJlbW90ZXN0cmVhbSAuLi4uICcpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHN0cmVhbS5pZCwgcmVtb3RlRmVlZC5yZmluZGV4KVxuICAgICAgfSxcbiAgICAgIG9uY2xlYW51cDogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBKYW51cy5sb2coJyA6OjogR290IGEgY2xlYW51cCBub3RpZmljYXRpb24gKHJlbW90ZSBmZWVkICcgKyBpZCArICcpIDo6OicpXG5cbiAgICAgICAgY29uc29sZS5sb2cocmVtb3RlRmVlZClcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQnICsgcmVtb3RlRmVlZC5yZmluZGV4KS5zcmNPYmplY3QgPSBudWxsXG4gICAgICAgIHJlbW90ZUZlZWQubXlzdHJlYW0gPSBudWxsXG4gICAgICAgIC8vIG15c3RyZWFtID0gbnVsbDtcbiAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcnRpY2lwYW50MScpLnNyY09iamVjdCA9IG51bGxcblxuICAgICAgICAvLyBpbnN0YW5jZS5wYXJ0aWNpcGFudHMuZmlsdGVyKHBhcnRpY2lwYW50ID0+IHBhcnRpY2lwYW50LmlkID09PSBpZCkuc3JjT2JqZWN0ID0gbnVsbFxuXG4gICAgICAgIGlmIChpbnN0YW5jZS5iaXRyYXRlVGltZXJbcmVtb3RlRmVlZC5yZmluZGV4XSAhPT0gbnVsbCAmJiBpbnN0YW5jZS5iaXRyYXRlVGltZXJbcmVtb3RlRmVlZC5yZmluZGV4XSAhPT0gbnVsbCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW5zdGFuY2UuYml0cmF0ZVRpbWVyW3JlbW90ZUZlZWQucmZpbmRleF0pXG4gICAgICAgIH1cbiAgICAgICAgaW5zdGFuY2UuYml0cmF0ZVRpbWVyW3JlbW90ZUZlZWQucmZpbmRleF0gPSBudWxsXG4gICAgICAgIHJlbW90ZUZlZWQuc2ltdWxjYXN0U3RhcnRlZCA9IGZhbHNlXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGdldFF1ZXJ5U3RyaW5nVmFsdWUgKG5hbWUpIHtcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bW10vLCAnXFxcXFsnKS5yZXBsYWNlKC9bXFxdXS8sICdcXFxcXScpXG5cbiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCdbXFxcXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpXG4gICAgdmFyIHJlc3VsdHMgPSByZWdleC5leGVjKGxvY2F0aW9uLnNlYXJjaClcblxuICAgIHJldHVybiByZXN1bHRzID09PSBudWxsID8gJycgOiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cXCsvZywgJyAnKSlcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBKaW1iZXJKYW51c1ZpZGVvUm9vbVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/plugins/janus.videoroom.js\n");

/***/ }),

/***/ "./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&":
/*!***************************************************************************************************!*\
  !*** ./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& ***!
  \***************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _cache_loader_cacheDirectory_node_modules_cache_vue_loader_cacheIdentifier_7b93bd1d_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!cache-loader?{\"cacheDirectory\":\"node_modules/.cache/vue-loader\",\"cacheIdentifier\":\"7b93bd1d-vue-loader-template\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& */ \"./node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"7b93bd1d-vue-loader-template\\\"}!./node_modules/vue-loader/lib/loaders/templateLoader.js?!./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"render\", function() { return _cache_loader_cacheDirectory_node_modules_cache_vue_loader_cacheIdentifier_7b93bd1d_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"render\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"staticRenderFns\", function() { return _cache_loader_cacheDirectory_node_modules_cache_vue_loader_cacheIdentifier_7b93bd1d_vue_loader_template_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"staticRenderFns\"]; });\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5odG1sP3Z1ZSZ0eXBlPXRlbXBsYXRlJmlkPTk4M2NiZTJlJnNjb3BlZD10cnVlJi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvZnJlZWZsb3djb25uZWN0Lmh0bWw/MTNkZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgKiBmcm9tIFwiLSFjYWNoZS1sb2FkZXI/e1xcXCJjYWNoZURpcmVjdG9yeVxcXCI6XFxcIm5vZGVfbW9kdWxlcy8uY2FjaGUvdnVlLWxvYWRlclxcXCIsXFxcImNhY2hlSWRlbnRpZmllclxcXCI6XFxcIjdiOTNiZDFkLXZ1ZS1sb2FkZXItdGVtcGxhdGVcXFwifSEuLi8uLi8uLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvbG9hZGVycy90ZW1wbGF0ZUxvYWRlci5qcz8/dnVlLWxvYWRlci1vcHRpb25zIS4vZnJlZWZsb3djb25uZWN0Lmh0bWw/dnVlJnR5cGU9dGVtcGxhdGUmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmXCIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\n");

/***/ }),

/***/ "./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&":
/*!*******************************************************************************!*\
  !*** ./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js& ***!
  \*******************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _node_modules_vue_cli_plugin_eslint_node_modules_eslint_loader_index_js_ref_13_0_freeflowconnect_js_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader??ref--13-0!./freeflowconnect.js?vue&type=script&lang=js& */ \"./node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js?!./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&\");\n/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__[\"default\"] = (_node_modules_vue_cli_plugin_eslint_node_modules_eslint_loader_index_js_ref_13_0_freeflowconnect_js_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[\"default\"]); //# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5qcz92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5qcz9lNmY2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb2QgZnJvbSBcIi0hLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0B2dWUvY2xpLXBsdWdpbi1lc2xpbnQvbm9kZV9tb2R1bGVzL2VzbGludC1sb2FkZXIvaW5kZXguanM/P3JlZi0tMTMtMCEuL2ZyZWVmbG93Y29ubmVjdC5qcz92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyZcIjsgZXhwb3J0IGRlZmF1bHQgbW9kOyBleHBvcnQgKiBmcm9tIFwiLSEuLi8uLi8uLi9ub2RlX21vZHVsZXMvQHZ1ZS9jbGktcGx1Z2luLWVzbGludC9ub2RlX21vZHVsZXMvZXNsaW50LWxvYWRlci9pbmRleC5qcz8/cmVmLS0xMy0wIS4vZnJlZWZsb3djb25uZWN0LmpzP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJlwiIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&\n");

/***/ }),

/***/ "./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&":
/*!******************************************************************************************************************!*\
  !*** ./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& ***!
  \******************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/vue-style-loader??ref--8-oneOf-1-0!../../../node_modules/css-loader??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!./freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& */ \"./node_modules/vue-style-loader/index.js?!./node_modules/css-loader/index.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src/index.js?!./node_modules/sass-loader/dist/cjs.js?!./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\");\n/* harmony import */ var _node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0__);\n/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));\n /* harmony default export */ __webpack_exports__[\"default\"] = (_node_modules_vue_style_loader_index_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_dist_cjs_js_ref_8_oneOf_1_3_freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); //# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvZnJlZWZsb3djb25uZWN0LnNjc3M/ZTNhZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9kIGZyb20gXCItIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtc3R5bGUtbG9hZGVyL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0wIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0xIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYi9sb2FkZXJzL3N0eWxlUG9zdExvYWRlci5qcyEuLi8uLi8uLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0yIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9zYXNzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cmVmLS04LW9uZU9mLTEtMyEuL2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJlwiOyBleHBvcnQgZGVmYXVsdCBtb2Q7IGV4cG9ydCAqIGZyb20gXCItIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtc3R5bGUtbG9hZGVyL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0wIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0xIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYi9sb2FkZXJzL3N0eWxlUG9zdExvYWRlci5qcyEuLi8uLi8uLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPz9yZWYtLTgtb25lT2YtMS0yIS4uLy4uLy4uL25vZGVfbW9kdWxlcy9zYXNzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cmVmLS04LW9uZU9mLTEtMyEuL2ZyZWVmbG93Y29ubmVjdC5zY3NzP3Z1ZSZ0eXBlPXN0eWxlJmluZGV4PTAmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmbGFuZz1zY3NzJlwiIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\n");

/***/ }),

/***/ "./src/views/freeflowconnect/index.vue":
/*!*********************************************!*\
  !*** ./src/views/freeflowconnect/index.vue ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& */ \"./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\");\n/* harmony import */ var _freeflowconnect_js_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./freeflowconnect.js?vue&type=script&lang=js& */ \"./src/views/freeflowconnect/freeflowconnect.js?vue&type=script&lang=js&\");\n/* empty/unused harmony star reexport *//* harmony import */ var _freeflowconnect_scss_vue_type_style_index_0_id_983cbe2e_scoped_true_lang_scss___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss& */ \"./src/views/freeflowconnect/freeflowconnect.scss?vue&type=style&index=0&id=983cbe2e&scoped=true&lang=scss&\");\n/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ \"./node_modules/vue-loader/lib/runtime/componentNormalizer.js\");\n/* harmony import */ var _node_modules_vuetify_loader_lib_runtime_installComponents_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../node_modules/vuetify-loader/lib/runtime/installComponents.js */ \"./node_modules/vuetify-loader/lib/runtime/installComponents.js\");\n/* harmony import */ var _node_modules_vuetify_loader_lib_runtime_installComponents_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_vuetify_loader_lib_runtime_installComponents_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var vuetify_lib_components_VAvatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! vuetify/lib/components/VAvatar */ \"./node_modules/vuetify/lib/components/VAvatar/index.js\");\n/* harmony import */ var vuetify_lib_components_VBtn__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! vuetify/lib/components/VBtn */ \"./node_modules/vuetify/lib/components/VBtn/index.js\");\n/* harmony import */ var vuetify_lib_components_VCard__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! vuetify/lib/components/VCard */ \"./node_modules/vuetify/lib/components/VCard/index.js\");\n/* harmony import */ var vuetify_lib_components_VDialog__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! vuetify/lib/components/VDialog */ \"./node_modules/vuetify/lib/components/VDialog/index.js\");\n/* harmony import */ var vuetify_lib_components_VGrid__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! vuetify/lib/components/VGrid */ \"./node_modules/vuetify/lib/components/VGrid/index.js\");\n/* harmony import */ var vuetify_lib_components_VIcon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! vuetify/lib/components/VIcon */ \"./node_modules/vuetify/lib/components/VIcon/index.js\");\n/* harmony import */ var vuetify_lib_components_VTextField__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! vuetify/lib/components/VTextField */ \"./node_modules/vuetify/lib/components/VTextField/index.js\");\n/* harmony import */ var vuetify_lib_components_VToolbar__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! vuetify/lib/components/VToolbar */ \"./node_modules/vuetify/lib/components/VToolbar/index.js\");\n\n\n\n\n\n\n/* normalize component */\n\nvar component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(\n  _freeflowconnect_js_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n  _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"render\"],\n  _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"staticRenderFns\"],\n  false,\n  null,\n  \"983cbe2e\",\n  null\n  \n)\n\n/* vuetify-loader */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n_node_modules_vuetify_loader_lib_runtime_installComponents_js__WEBPACK_IMPORTED_MODULE_4___default()(component, {VAvatar: vuetify_lib_components_VAvatar__WEBPACK_IMPORTED_MODULE_5__[\"VAvatar\"],VBtn: vuetify_lib_components_VBtn__WEBPACK_IMPORTED_MODULE_6__[\"VBtn\"],VCard: vuetify_lib_components_VCard__WEBPACK_IMPORTED_MODULE_7__[\"VCard\"],VCardActions: vuetify_lib_components_VCard__WEBPACK_IMPORTED_MODULE_7__[\"VCardActions\"],VCardText: vuetify_lib_components_VCard__WEBPACK_IMPORTED_MODULE_7__[\"VCardText\"],VCardTitle: vuetify_lib_components_VCard__WEBPACK_IMPORTED_MODULE_7__[\"VCardTitle\"],VDialog: vuetify_lib_components_VDialog__WEBPACK_IMPORTED_MODULE_8__[\"VDialog\"],VFlex: vuetify_lib_components_VGrid__WEBPACK_IMPORTED_MODULE_9__[\"VFlex\"],VIcon: vuetify_lib_components_VIcon__WEBPACK_IMPORTED_MODULE_10__[\"VIcon\"],VRow: vuetify_lib_components_VGrid__WEBPACK_IMPORTED_MODULE_9__[\"VRow\"],VSpacer: vuetify_lib_components_VGrid__WEBPACK_IMPORTED_MODULE_9__[\"VSpacer\"],VTextField: vuetify_lib_components_VTextField__WEBPACK_IMPORTED_MODULE_11__[\"VTextField\"],VToolbar: vuetify_lib_components_VToolbar__WEBPACK_IMPORTED_MODULE_12__[\"VToolbar\"]})\n\n\n/* hot reload */\nif (true) {\n  var api = __webpack_require__(/*! ./node_modules/vue-hot-reload-api/dist/index.js */ \"./node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(__webpack_require__(/*! vue */ \"./node_modules/vue/dist/vue.runtime.esm.js\"))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('983cbe2e')) {\n      api.createRecord('983cbe2e', component.options)\n    } else {\n      api.reload('983cbe2e', component.options)\n    }\n    module.hot.accept(/*! ./freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& */ \"./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\", function(__WEBPACK_OUTDATED_DEPENDENCIES__) { /* harmony import */ _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true& */ \"./src/views/freeflowconnect/freeflowconnect.html?vue&type=template&id=983cbe2e&scoped=true&\");\n(function () {\n      api.rerender('983cbe2e', {\n        render: _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"render\"],\n        staticRenderFns: _freeflowconnect_html_vue_type_template_id_983cbe2e_scoped_true___WEBPACK_IMPORTED_MODULE_0__[\"staticRenderFns\"]\n      })\n    })(__WEBPACK_OUTDATED_DEPENDENCIES__); }.bind(this))\n  }\n}\ncomponent.options.__file = \"src/views/freeflowconnect/index.vue\"\n/* harmony default export */ __webpack_exports__[\"default\"] = (component.exports);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3MvZnJlZWZsb3djb25uZWN0L2luZGV4LnZ1ZS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvaW5kZXgudnVlPzdkNmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVuZGVyLCBzdGF0aWNSZW5kZXJGbnMgfSBmcm9tIFwiLi9mcmVlZmxvd2Nvbm5lY3QuaHRtbD92dWUmdHlwZT10ZW1wbGF0ZSZpZD05ODNjYmUyZSZzY29wZWQ9dHJ1ZSZcIlxuaW1wb3J0IHNjcmlwdCBmcm9tIFwiLi9mcmVlZmxvd2Nvbm5lY3QuanM/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9anMmXCJcbmV4cG9ydCAqIGZyb20gXCIuL2ZyZWVmbG93Y29ubmVjdC5qcz92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyZcIlxuaW1wb3J0IHN0eWxlMCBmcm9tIFwiLi9mcmVlZmxvd2Nvbm5lY3Quc2Nzcz92dWUmdHlwZT1zdHlsZSZpbmRleD0wJmlkPTk4M2NiZTJlJnNjb3BlZD10cnVlJmxhbmc9c2NzcyZcIlxuXG5cbi8qIG5vcm1hbGl6ZSBjb21wb25lbnQgKi9cbmltcG9ydCBub3JtYWxpemVyIGZyb20gXCIhLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL3J1bnRpbWUvY29tcG9uZW50Tm9ybWFsaXplci5qc1wiXG52YXIgY29tcG9uZW50ID0gbm9ybWFsaXplcihcbiAgc2NyaXB0LFxuICByZW5kZXIsXG4gIHN0YXRpY1JlbmRlckZucyxcbiAgZmFsc2UsXG4gIG51bGwsXG4gIFwiOTgzY2JlMmVcIixcbiAgbnVsbFxuICBcbilcblxuLyogdnVldGlmeS1sb2FkZXIgKi9cbmltcG9ydCBpbnN0YWxsQ29tcG9uZW50cyBmcm9tIFwiIS4uLy4uLy4uL25vZGVfbW9kdWxlcy92dWV0aWZ5LWxvYWRlci9saWIvcnVudGltZS9pbnN0YWxsQ29tcG9uZW50cy5qc1wiXG5pbXBvcnQgeyBWQXZhdGFyIH0gZnJvbSAndnVldGlmeS9saWIvY29tcG9uZW50cy9WQXZhdGFyJztcbmltcG9ydCB7IFZCdG4gfSBmcm9tICd2dWV0aWZ5L2xpYi9jb21wb25lbnRzL1ZCdG4nO1xuaW1wb3J0IHsgVkNhcmQgfSBmcm9tICd2dWV0aWZ5L2xpYi9jb21wb25lbnRzL1ZDYXJkJztcbmltcG9ydCB7IFZDYXJkQWN0aW9ucyB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVkNhcmQnO1xuaW1wb3J0IHsgVkNhcmRUZXh0IH0gZnJvbSAndnVldGlmeS9saWIvY29tcG9uZW50cy9WQ2FyZCc7XG5pbXBvcnQgeyBWQ2FyZFRpdGxlIH0gZnJvbSAndnVldGlmeS9saWIvY29tcG9uZW50cy9WQ2FyZCc7XG5pbXBvcnQgeyBWRGlhbG9nIH0gZnJvbSAndnVldGlmeS9saWIvY29tcG9uZW50cy9WRGlhbG9nJztcbmltcG9ydCB7IFZGbGV4IH0gZnJvbSAndnVldGlmeS9saWIvY29tcG9uZW50cy9WR3JpZCc7XG5pbXBvcnQgeyBWSWNvbiB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVkljb24nO1xuaW1wb3J0IHsgVlJvdyB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVkdyaWQnO1xuaW1wb3J0IHsgVlNwYWNlciB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVkdyaWQnO1xuaW1wb3J0IHsgVlRleHRGaWVsZCB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVlRleHRGaWVsZCc7XG5pbXBvcnQgeyBWVG9vbGJhciB9IGZyb20gJ3Z1ZXRpZnkvbGliL2NvbXBvbmVudHMvVlRvb2xiYXInO1xuaW5zdGFsbENvbXBvbmVudHMoY29tcG9uZW50LCB7VkF2YXRhcixWQnRuLFZDYXJkLFZDYXJkQWN0aW9ucyxWQ2FyZFRleHQsVkNhcmRUaXRsZSxWRGlhbG9nLFZGbGV4LFZJY29uLFZSb3csVlNwYWNlcixWVGV4dEZpZWxkLFZUb29sYmFyfSlcblxuXG4vKiBob3QgcmVsb2FkICovXG5pZiAobW9kdWxlLmhvdCkge1xuICB2YXIgYXBpID0gcmVxdWlyZShcIi92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlLzNib3RfZnJvbnRlbmRfc3RhZ2luZ19idWlsZC9ub2RlX21vZHVsZXMvdnVlLWhvdC1yZWxvYWQtYXBpL2Rpc3QvaW5kZXguanNcIilcbiAgYXBpLmluc3RhbGwocmVxdWlyZSgndnVlJykpXG4gIGlmIChhcGkuY29tcGF0aWJsZSkge1xuICAgIG1vZHVsZS5ob3QuYWNjZXB0KClcbiAgICBpZiAoIWFwaS5pc1JlY29yZGVkKCc5ODNjYmUyZScpKSB7XG4gICAgICBhcGkuY3JlYXRlUmVjb3JkKCc5ODNjYmUyZScsIGNvbXBvbmVudC5vcHRpb25zKVxuICAgIH0gZWxzZSB7XG4gICAgICBhcGkucmVsb2FkKCc5ODNjYmUyZScsIGNvbXBvbmVudC5vcHRpb25zKVxuICAgIH1cbiAgICBtb2R1bGUuaG90LmFjY2VwdChcIi4vZnJlZWZsb3djb25uZWN0Lmh0bWw/dnVlJnR5cGU9dGVtcGxhdGUmaWQ9OTgzY2JlMmUmc2NvcGVkPXRydWUmXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGFwaS5yZXJlbmRlcignOTgzY2JlMmUnLCB7XG4gICAgICAgIHJlbmRlcjogcmVuZGVyLFxuICAgICAgICBzdGF0aWNSZW5kZXJGbnM6IHN0YXRpY1JlbmRlckZuc1xuICAgICAgfSlcbiAgICB9KVxuICB9XG59XG5jb21wb25lbnQub3B0aW9ucy5fX2ZpbGUgPSBcInNyYy92aWV3cy9mcmVlZmxvd2Nvbm5lY3QvaW5kZXgudnVlXCJcbmV4cG9ydCBkZWZhdWx0IGNvbXBvbmVudC5leHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/views/freeflowconnect/index.vue\n");

/***/ })

}]);